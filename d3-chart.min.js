!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).d3Chart={})}(this,function(t){"use strict";function z(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2*Math.PI,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0,o=t,a=e,r=i;Math.abs(r-a-2*Math.PI)<=1e-5&&(r-=1e-5);var l=Math.cos(a-Math.PI/2)*o,s=Math.sin(a-Math.PI/2)*o,u=Math.cos(r-Math.PI/2)*o,h=Math.sin(r-Math.PI/2)*o,c=0,_=1;function d(){return o+" "+o+" 0 "+c+" "+_+" "}return Math.abs(r-a)>=Math.PI&&(c=1),void 0!==n?_=isNaN(Number(n))?1:Number(n):void 0===n&&(r+a)/2>Math.PI/2&&(r+a)/2<Math.PI/2*3&&(_=0),_?"M"+l+" "+s+"A"+d()+" "+u+" "+h:"M"+u+" "+h+"A"+d()+" "+l+" "+s}function at(t){return"none"!==t.style("display")?t.node().getBBox():{x:0,y:0,width:0,height:0}}function e(t){t.style("display","block")}function i(t){t.style("display","none")}function B(t,e,i){t.attr("transform","translate("+e+","+i+")")}function n(t){var e=t+Math.floor(1e9*Math.random()).toString(32)+Date.now().toString(32);return null==document.getElementById(e)?e:n(t)}function C(t){return t.filter(function(t){return!1!==t.active})}function A(t,e,i,n){var o=Math.min(t,e)/2,a=t/2,r=e/2,l=0;if(Math.abs(n-i)<=Math.PI/2){var s=Math.min(n,i),u=Math.max(n,i);o=Math.min(t,e),0<=s&&u<=Math.PI/2?(a=(t-o)/2,r=(e-o)/2+o,l=1):s>=Math.PI/2&&u<=Math.PI?(a=(t-o)/2,r=(e-o)/2,l=2):s>=Math.PI&&u<=3*Math.PI/2?(a=(t-o)/2+o,r=(e-o)/2,l=3):s>=3*Math.PI/2&&u<=2*Math.PI&&(a=(t-o)/2+o,r=(e-o)/2+o,l=4)}return{radius:o,cx:a,cy:r,quadrant:l}}function y(t){var e=t.split(/[\-\/]/);if(3!==e.length)return t;if(e[0].length<4){var i=d3.range(4-e[0].length).map(function(){return 0}).join("");e[0]=i+e[0]}return 1===e[1].length&&(e[1]="0"+e[1]),1===e[2].length&&(e[2]="0"+e[2]),e.join("-")}function S(t,e){var i,n=window.location.href;return void 0===e&&(e="Safari"==(-1<(i=navigator.userAgent).indexOf("Opera")||-1<i.indexOf("OPR")?"Opera":-1<i.indexOf("compatible")&&-1<i.indexOf("MSIE")?"IE":-1<i.indexOf("Edge")?"Edge":-1<i.indexOf("Firefox")?"Firefox":-1<i.indexOf("Safari")&&-1==i.indexOf("Chrome")?"Safari":-1<i.indexOf("Chrome")&&-1<i.indexOf("Safari")?"Chrome":window.ActiveXObject||"ActiveXObject"in window?"IE>=11":"Unkonwn")&&!/\/#\//.test(n)),e?n+t:t}function D(t,e){var i=/[^\u4e00-\u9fa5\w-]/gi;return e=null==e||i.test(e)?"-":e,t.toString().replace(i,e)}function l(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.abs(parseFloat(t))||e}function tt(t){for(var e=t.x,i=void 0===e?0:e,n=t.y,o=void 0===n?0:n,a=t.width,r=void 0===a?100:a,l=t.height,s=void 0===l?100:l,u=t.cornerRadius,h=void 0===u?0:u,c=t.roundCorners,_=void 0===c?[0,1,2,3]:c,d=i,f=o,p=i+r,y=o+s,g=Math.min(Math.min(r,s)/2,h),v=g+" "+g+" 0 0 1",m=["L"+d+" "+f,"L"+p+" "+f,"L"+p+" "+y,"L"+d+" "+y],x=["A"+v+" "+(d+g)+" "+f,"A"+v+" "+p+" "+(f+g),"A"+v+" "+(p-g)+" "+y,"A"+v+" "+d+" "+(y-g)],S=[],k=0;k<=3;k++){var b=_.includes(k)?x[k]:m[k];S.push(b)}return"\n    M"+d+" "+(f+g)+"\n    "+S[0]+"\n    H"+(p-g)+"\n    "+S[1]+"\n    V"+(y-g)+"\n    "+S[2]+"\n    H"+(d+g)+"\n    "+S[3]+"\n    Z\n  "}function rt(t,e){var i=t.x,n=t.y,o=t.x+t.width,a=t.y+t.height,r=e.x,l=e.y,s=e.x+e.width,u=e.y+e.height;return!(s<i||o<r||u<n||a<l)}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},h=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},v=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},o=function(){function t(){r(this,t),this.elem=null,this._pos=[0,0],this._show=!0,this.id=n("")}return s(t,[{key:"update",value:function(){}},{key:"show",value:function(){return e(this.elem),this._show=!0,this}},{key:"hide",value:function(){return i(this.elem),this._show=!1,this}},{key:"width",value:function(){return at(this.elem).width}},{key:"height",value:function(){return at(this.elem).height}},{key:"translate",value:function(t,e){return arguments.length?(this.pos=[t,e],B(this.elem,t,e),this):this.pos}},{key:"isShow",get:function(){return this._show}}]),t}();function W(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=arguments[2];return!e.length||e[0].length<(i||2)||t.some(function(t){return void 0===e[0][t]})}function m(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return t.slice(1).some(function(t){return!isNaN(parseFloat(t[e]))})}function a(t,e){var o=0,a=1;if(e.forEach(function(t){"objCol"===t.function?o=t.index:"vCol"===t.function&&(a=t.index)}),W(t,[o,a])||!m(t,a))return[];var r=[],l=t[0][o],s=t[0][a];return t.slice(1).forEach(function(t,e){var i=parseFloat(t[a]);if(!isNaN(i)){var n=t[o];""!=t[o]&&null!=t[o]&&null!=t[o]||(n="$-"+e),r.push({name:n,showLegend:n!="$-"+e,value:+t[a],nameLabel:l,valueLabel:s})}}),r.forEach(function(t,e){t.key=D(t.name)+"-"+e}),r}function T(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(1===e.length)return t;var i=e.filter(function(t){return"objCol"===t.function||"vCol"===t.function&&t.configurable}).map(function(t){return t.index});return t.map(function(t){return t.filter(function(t,e){return 0<=i.indexOf(e)})})}function _(t,e){var i=0,n=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(i=t.index,n=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),W(t,[i],2))return[];for(var a=T(t,e),r={},l=[],s=a.length,u=a[0],h=[],c=[],_=1;_<s;_++)c.push(a[_].length);c.sort(function(t,e){return e-t});for(var d=0;d<s;d++)for(var f=0;f<c[0];f++)h.push(isNaN(parseFloat(a[d][f])));if(0==h.filter(function(t,e){return 0==t}).length)return[];if(n){for(var p=[],y=1;y<s;y++)p.push(a[y].length);p.sort(function(t,e){return e-t});for(var g=1;g<s;g++){var v=a[g],m=v[i];if(""!=m&&null!=m&&null!=m||(m="$-"+g),m){for(var x={name:m,showLegend:m!="$-"+g,data:[]},S=0;S<p[0];S++){var k=u[S];""!=k&&null!=k&&null!=k||(k="&-"+S),S!==i&&x.data.push({name:k,showAxisText:k!="&-"+S,value:""==v[S]||isNaN(parseFloat(v[S]))||null==v[S]||null==v[S]?0:v[S],tooltipValueShow:!isNaN(parseFloat(v[S]))})}l.push(x)}}}else{for(var b=[],w=1;w<s;w++)b.push(a[w].length);b.sort(function(t,e){return e-t});for(var O=1;O<b[0];O++)if(O!==i){var C=u[O];""!=u[O]&&null!=u[O]&&null!=u[O]||(C="$-"+O),r[C+"-"+O]={name:C,showLegend:C!="$-"+O,data:[]}}for(var F=1;F<s;F++){var P=a[F],z=P[i];if(""!=z&&null!=z&&null!=z||(z="&-"+F),z)for(var A=0;A<b[0];A++){var L=u[A];""!=u[A]&&null!=u[A]&&null!=u[A]||(L="$-"+A),A!==i&&L&&r[L+"-"+A].data.push({name:z,showAxisText:z!="&-"+F,value:""==P[A]||isNaN(parseFloat(P[A]))||null==P[A]||null==P[A]?0:P[A],tooltipValueShow:!isNaN(parseFloat(P[A]))})}}for(var M in r)l.push(r[M])}return l.forEach(function(t,e){t.key=D(t.name)+"-"+e}),l}function L(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:12,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"sans-serif",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"50%",r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"middle",l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"...",s=t.append("text").style("text-anchor",r).style("font-size",n+"px").style("font-family",o).attr("dy","0.35em");return s.append("textPath").attr("startOffset",a).attr("xlink:href",function(){return"#"+e.attr("id")}).text(function(){var t=e.node().getTotalLength();return H(i,t,n,o,l)}),s}function E(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sans-serif";if(!t.toString||!t)return 0;var n=d3.select("defs");n.empty()&&(n=d3.select("svg").append("defs"));var o=n.append("text").style("font-size",e+"px").style("font-family",i).text(t.toString()),a=o.node().getComputedTextLength();return o.remove(),a}function et(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sans-serif";return Math.ceil(d3.max(t,function(t){return E(t,e,i)}))}function H(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:12,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"sans-serif",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"...";if(E(t,i,n)<=e)return t;if(E(o,i,n)>=e)return"";for(var a=t.toString().split(""),r=a.length,l="",s=0;s<r;s++)if(E((l+=a[s])+o,i,n)>e)return 0===s?"":l.slice(0,s)+o}var p="legend-group",g=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","legend"),e.group=e.elem.append("g"),e._data=[],e._shapeType="circle",e._shapeWidth=12,e._shapeHeight=12,e._shapeStroke="none",e._rowGap=6,e._colGap=20,e._innerGap=6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._limitedWidth=400,e._horizontalAlign="center",e._onClick=function(){},e._each=function(){},e._orient="horizontal",e}return h(i,o),s(i,[{key:"update",value:function(){var o=this,a=o.group,r=Math.max(o._shapeHeight,o._fontSize),l=o._limitedWidth-o._shapeWidth-o._innerGap,s=0,u=0;o.elem.selectAll("."+p).remove();var h=a.append("g").attr("class",p);o._data.forEach(function(t){var e=H(t.name?t.name:"",l,o._fontSize,o._fontFamily),i=o._shapeWidth+o._innerGap+E(e,o._fontSize,o._fontFamily);if("vertical"===o._orient)o._legendItem(t,h,0,u),u=u+r+o._rowGap;else{var n=s+i+o._colGap;n>o._limitedWidth&&(s=0,n=i+o._colGap,u+=r+o._rowGap,h=a.append("g").attr("class",p)),o._legendItem(t,h,s,u),s=n}});var t=at(a).width;return"center"===o._horizontalAlign?a.call(B,o._limitedWidth/2-t/2,0):"left"===o._horizontalAlign?a.call(B,0,0):"right"===o._horizontalAlign&&a.call(B,o._limitedWidth-t,0),o}},{key:"_shapeElem",value:function(t){var e=void 0;return(e="rect"===this._shapeType?t.append("rect").attr("width",this._shapeWidth).attr("height",this._shapeHeight):t.append("circle").attr("cx",this._shapeWidth/2).attr("cy",this._shapeHeight/2).attr("r",Math.min(this._shapeWidth,this._shapeHeight)/2)).attr("class","legend-shape"),e}},{key:"_legendItem",value:function(t,e,i,n){var o=e.append("g").datum(t).attr("class","legend-item").call(B,i,n).on("click",this._onClick).each(this._each);return this._shapeElem(o).style("fill",t.color),o.append("text").attr("x",this._shapeWidth+this._innerGap).attr("y",this._shapeHeight/2).attr("dy","0.35em").style("text-anchor","start").style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("fill",this._fontColor).text(H(t.name?t.name:"",this._limitedWidth-this._shapeWidth-this._innerGap,this._fontSize,this._fontFamily)),o}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"shapeType",value:function(t){return arguments.length?(this._shapeType=t,this):this._shapeType}},{key:"shapeWidth",value:function(t){return arguments.length?(this._shapeWidth=t,this):this._shapeWidth}},{key:"shapeHeight",value:function(t){return arguments.length?(this._shapeHeight=t,this):this._shapeHeight}},{key:"rowGap",value:function(t){return arguments.length?(this._rowGap=t,this):this._rowGap}},{key:"colGap",value:function(t){return arguments.length?(this._colGap=t,this):this._colGap}},{key:"innerGap",value:function(t){return arguments.length?(this._innerGap=t,this):this._innerGap}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"onClick",value:function(t){return arguments.length?(this._onClick=t,this):this._onClick}},{key:"each",value:function(t){return arguments.length?(this._each=t,this):this._each}}]),i}(),x=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return h(i,o),s(i,[{key:"update",value:function(){var t=this;return t.elem.attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),i}(),k=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return h(i,o),s(i,[{key:"update",value:function(){var t=this;return t.elem.attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),i}(),b=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return h(i,o),s(i,[{key:"update",value:function(){var t=this;return t.elem.attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),i}(),w=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),i=t._groups?t:d3.select(t);return e.elem=i.append("div").attr("class","chart-tooltip").style("position","absolute").style("pointer-events","none").style("-moz-user-select","none").style("-webkit-user-select","none").style("-ms-user-select","none").style("user-select","none"),"static"!=i.style("position")&&"initial"!=i.style("position")||i.style("position","relative"),e._data=[],e._x=0,e._y=0,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#fff",e._backgroundColor="rgba(0,0,0,0.7)",e._borderRadius=5,e._padding={top:5,right:8,bottom:5,left:8},e._textAlign="left",e._locked=!1,e._scale=1,e._scaleValue=1,e}return h(n,o),s(n,[{key:"update",value:function(){var t=this,e=t._fontSize;if(t._locked)return t;t._scaleValue="function"==typeof t._scale?t._scale():t._scale,t.elem.style("background-color",t._backgroundColor).style("border-radius",t._borderRadius+"px").style("font-size",e+"px").style("font-family",t._fontFamily).style("color",t._fontColor).style("text-align",t._textAlign).style("padding",t._padding.top+"px "+t._padding.right+"px "+t._padding.bottom+"px "+t._padding.left+"px");var i=t.elem.selectAll("div").data(t._data);i.exit().remove();var n=i.enter().append("div").attr("class","tooltip-row").style("white-space","nowrap");n.append("span").attr("class","tooltip-color-circle"),n.append("span").attr("class","tooltip-text");var o=n.merge(i);return o.select(".tooltip-color-circle").style("width","0px").style("height","0px").style("border-radius","50%").style("display","inline-block").style("margin","0px").style("vertical-align","middle").filter(function(t){return t.color}).style("width",e+"px").style("height",e+"px").style("background-color",function(t){return t.color}).style("margin-right","3px"),o.select(".tooltip-text").text(function(t){return t.text}).style("vertical-align","middle"),this}},{key:"move",value:function(t){var e=this;if(e._locked||!e.isShow)return e;var i=e._scaleValue||1,n=0,o=0,a=e.elem,r=a.node().parentNode,l=a.node().getBoundingClientRect(),s=r.getBoundingClientRect(),u=t||d3.mouse(r);return o=u[0]+l.width+8>s.width?u[0]-l.width-8:u[0]+8,n=u[1]+l.height+5>s.height?u[1]-l.height-0:u[1]+0,a.transition().duration(10).style("top",n/i+"px").style("left",o/i+"px"),e}},{key:"show",value:function(){return this._locked||(e(this.elem),this._show=!0),this}},{key:"hide",value:function(){return this._locked||(i(this.elem),this._show=!1),this}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"lock",value:function(t){return arguments.length?(this._locked=t,this):this._locked}},{key:"scale",value:function(t){return arguments.length?(this._scale=t,this):this._scale}}]),n}();function O(t,i){return t.forEach(function(t,e){t.color=i[e],t.color_special=i[e+1]}),t}var F=function(){function i(t,e){r(this,i),this._blockData=t,this._projectTheme=e,this._dataSrc=t.dataSrc,this._blockTheme=t.theme,this._props=t.props,this._columnMap=this._props.map,this._legend=this._props.legend,this._font=this._props.font,this._axis=this._props.axis,this._title=this._props.titleDisplay,this._label=this._props.label,this._display=this._props.display,this._animation=this._props.animation,this._unitDisplay=this._props.unitDisplay,this._sourceDisplay=this._props.sourceDisplay,this._dataSolveFunc=a}return s(i,[{key:"dataSolveFunc",value:function(t){return arguments.length&&"function"==typeof t?(this._dataSolveFunc=t,this):this._dataSolveFunc}},{key:"generateColorList",value:function(t){var e,i,n,o=this._props.colors.type,a=(e=this._props.colors.list,i=this._blockData,n=this._projectTheme,e.map(function(t){return function(t,e,i){var n=void 0;if("number"==typeof t){var o=e.theme&&e.theme.colors;n=o&&o[t%o.length]||i&&i.colors[t]||"#000"}else n=t;return n}(t,i,n)}));if(!t)return a;var r=a;switch(o){case"linear":var l=a.slice(0,2),s=d3.scaleLinear().domain([0,t-1]).range(l);r=d3.range(t).map(function(t,e){return s(e)});break;case"single":r=d3.range(t).map(function(){return a[0]});break;default:if(r=a.slice(0),a.length<t)for(var u=a.length;r.push(a[u%a.length]),++u<t;);}return r}},{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]);return O(t,this.generateColorList(t.length))}},{key:"dataType",get:function(){var t="2d";if("cross-table"===this._dataSrc.dataType)t="cross-table";else{var e=this._dataSrc.data;t=e[1]?"2sheet":e[0].length+"d"}return t}},{key:"width",get:function(){return parseFloat(this._props.size.width)-2}},{key:"height",get:function(){return parseFloat(this._props.size.height)-2}},{key:"font",get:function(){return{fontSize:this._font.fontSize||this._blockData.theme.fonts.fontSize||12,color:this._font.color||this._blockData.theme.fonts.fontColor||"#000",fontFamily:this._font.fontFamily||this._blockData.theme.fonts.fontFamily||"sans-serif"}}},{key:"display",get:function(){return Object.assign({},this._props.display)}},{key:"animation",get:function(){return Object.assign({},this._props.animation)}},{key:"unitDisplay",get:function(){return Object.assign({},this._props.unitDisplay)}},{key:"sourceDisplay",get:function(){return Object.assign({},this._props.sourceDisplay)}},{key:"legend",get:function(){return{show:!1!==this._legend.show,xPosition:this._legend.xPosition,yPosition:this._legend.yPosition}}},{key:"tooltipShow",get:function(){return this._props.tooltip}},{key:"axis",get:function(){return{color:this._axis.color||this._blockTheme.axis.color,x:this._axis.x,y:this._axis.y,y1:this._axis.y1}}},{key:"label",get:function(){return Object.assign({},this._props.label)}},{key:"grid",get:function(){var t=this._axis.grid;return{showX:null==t?null:"all"===t.show||"x"===t.show,showY:null==t?null:"all"===t.show||"y"===t.show,color:null==t?null:t.color||this._blockTheme.grid&&this._blockTheme.grid.color||"#ccc"}}},{key:"backgroundColor",get:function(){return this._props.backgroundColor||"transparent"}},{key:"colors",get:function(){return this._props.colors}},{key:"title",get:function(){var t=this._title||{};return{show:!1!==t.show,text:t.text||"",xPosition:t.xPosition||"center",yPosition:t.yPosition||"top",fontSize:t.fontSize||24,color:t.color||"#000",fontFamily:t.fontFamily||"noto"}}}]),i}(),P=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t._groups?t.append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1"):d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1"),e.defs=e.elem.append("defs"),e.group=e.elem.append("g").attr("class","svg-group"),e.mainGroup=e.group.append("g").attr("class","main-group"),e.title=new x(e.group),e.unitText=new k(e.group),e.sourceText=new b(e.group),e.legend=new g(e.group),e.tooltip=new w(t),e.labelTextClass="chart-label-text",e._data=[],e._width=400,e._height=400,e._backgroundColor=null,e._fontSize=12,e._fontColor="#000",e._fontFamily="sans-serif",e._transition=!0,e._duration=500,e._legendShow=!0,e._legendX="center",e._legendY="bottom",e._titleShow=!0,e._titleText="",e._titleX="center",e._titleY="top",e._titleFontSize=24,e._titleColor="#000",e._titleFontFamily="sans-serif",e._marginTop=20,e._marginRight=24,e._marginBottom=18,e._marginLeft=24,e._gapPadding=10,e._titlePadding=10,e._unitPadding=15,e._sourcePadding=15,e._sortValue=0,e._sortedDataCopy=null,e._dataType="2d",e._tooltipShow=!0,e}return h(i,o),s(i,[{key:"update",value:function(){return this.styleSvg(),this.sortData(),this.removeLabelText(),this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateLegend(),this.updateCore(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateTitle",value:function(){var t=this,e=t.title;if(!t._titleShow)return e.hide();var i="center"===t._titleX?"middle":"left"===t._titleX?"start":"end";e.text(t._titleText).color(t._titleColor).fontSize(t._titleFontSize).fontFamily(t._titleFontFamily).fontWeight("bold").textAnchor(i).dy("1em"),e.update(),e.show()}},{key:"updateUnit",value:function(){var t=this,e=t.unitText;if(!t._unitShow)return e.hide();var i="center"===t._unitX?"middle":"left"===t._unitX?"start":"end";e.text(t._unitWord).color(t._unitColor).fontSize(t._unitFontSize).fontFamily(t._unitFontFamily).textAnchor(i).dy("1em"),e.update(),e.show()}},{key:"updateSource",value:function(){var t=this,e=t.sourceText;if(!t._sourceShow)return e.hide();var i="center"===t._sourceX?"middle":"left"===t._sourceX?"start":"end";e.text(t._sourceWord).color(t._sourceColor).fontSize(t._sourceFontSize).fontFamily(t._sourceFontFamily).textAnchor(i).dy("1em"),e.update(),e.show()}},{key:"updateLegend",value:function(){var t=this,e=t.legend,i=this._width-this._marginLeft-this._marginRight;if(!t._legendShow)return e.hide();e.show(),e.limitedWidth(i).fontSize(t._fontSize).fontFamily(t._fontFamily).fontColor(t._fontColor).horizontalAlign(t._legendX).each(function(t){var e=!1===t.active;d3.select(this).classed("clicked",e).style("opacity",e?.5:1)}),this.configLegend(),e.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy;t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"updateCore",value:function(){}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateCore()}},{key:"removeLabelText",value:function(){this.elem.selectAll("."+this.labelTextClass).remove()}},{key:"styleSvg",value:function(){this.elem.attr("width",this._width).attr("height",this._height).style("background-color",this._backgroundColor).style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("user-select","none"),this.group.call(B,this._marginLeft,this._marginTop)}},{key:"layout",value:function(){var t=this.title,e=this.unitText,i=this.sourceText,n=this.legend,o=this.mainGroup,a=t.height(),r=e.height(),l=(i.height(),n.height()),s=this.heightOfMainGroup,u=this._titleText&&this._titleShow?this._titlePadding:0,h=this._unitWord&&this._unitShow?this._unitPadding:0,c=this._sourceWord&&this._sourceShow?this._sourcePadding:0,_=this._legendShow&&0!=l?this._gapPadding:0,d="top",f="bottom",p=this._titleY,y=this._legendY;p!==d&&p!==f&&(p=d),y!==d&&y!==f&&(y=f);var g=0,v=0,m=0,x=0,S=0;p===d&&y===d?(g=0,m=(S=(x=(v=a+u)+r+h)+l+_)+s+c):p===f&&y===f?(v=0,m=(g=(x=(S=r+h)+s+_)+l+u)+a+c):p===d&&y===f?(g=0,m=(x=(S=(v=a+u)+r+h)+s+_)+l+c):(x=0,m=(g=(S=(v=l+_)+r+h)+s+u)+a+c);var k=this._width-this._marginLeft-this._marginRight,b="center"===this._titleX?k/2:"left"===this._titleX?0:k,w="center"===this._unitX?k/2:"left"===this._unitX?0:k,O="center"===this._sourceX?k/2:"left"===this._sourceX?0:k;t.translate(b,g),e.translate(w,v),i.translate(O,m),n.translate(0,x),o.call(B,0,S),0==this._marginLeft&&(b="center"===this._titleX?(this._width-24-this._marginRight)/2+24:"left"===this._titleX?24:k,w="center"===this._unitX?(this._width-24-this._marginRight)/2+24:"left"===this._unitX?24:k,O="center"===this._sourceX?(this._width-24-this._marginRight)/2+24:"left"===this._sourceX?24:k,t.translate(b,g),e.translate(w,v),i.translate(O,m),"left"===this._legendX?n.translate(24,x):"center"===this._legendX&&n.translate(12,x))}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"backgroundColor",value:function(t){return arguments.length?(this._backgroundColor=t,this):this._backgroundColor}},{key:"legendShow",value:function(t){return arguments.length?(this._legendShow=t,this):this._legendShow}},{key:"legendX",value:function(t){return arguments.length?(this._legendX=t,this):this._legendX}},{key:"legendY",value:function(t){return arguments.length?(this._legendY=t,this):this._legendY}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"gapPadding",value:function(t){return arguments.length?(this._gapPadding=parseFloat(t),this):this._gapPadding}},{key:"unitPadding",value:function(t){return arguments.length?(this._unitPadding=parseFloat(t),this):this._unitPadding}},{key:"sourcePadding",value:function(t){return arguments.length?(this._sourcePadding=parseFloat(t),this):this._sourcePadding}},{key:"marginTop",value:function(t){return arguments.length?(this._marginTop=parseFloat(t),this):this._marginTop}},{key:"marginRight",value:function(t){return arguments.length?(this._marginRight=parseFloat(t),this):this._marginRight}},{key:"marginBottom",value:function(t){return arguments.length?(this._marginBottom=parseFloat(t),this):this._marginBottom}},{key:"marginLeft",value:function(t){return arguments.length?(this._marginLeft=parseFloat(t),this):this._marginLeft}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"sortValue",value:function(t){return arguments.length?(this._sortValue=parseFloat(t),this):this._sortValue}},{key:"dataType",value:function(t){return arguments.length?(this._dataType=t,this):this._dataType}},{key:"tooltipShow",value:function(t){return arguments.length?(this._tooltipShow=t,this):this._tooltipShow}},{key:"titleShow",value:function(t){return arguments.length?(this._titleShow=t,this):this._titleShow}},{key:"titleText",value:function(t){return arguments.length?(this._titleText=t,this):this._titleText}},{key:"titleColor",value:function(t){return arguments.length?(this._titleColor=t,this):this._titleColor}},{key:"titleFontSize",value:function(t){return arguments.length?(this._titleFontSize=t,this):this._titleFontSize}},{key:"titleFontFamily",value:function(t){return arguments.length?(this._titleFontFamily=t,this):this._titleFontFamily}},{key:"titleX",value:function(t){return arguments.length?(this._titleX=t,this):this._titleX}},{key:"titleY",value:function(t){return arguments.length?(this._titleY=t,this):this._titleY}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"colors",value:function(t){return arguments.length?(this._colors=t,this):this._colors}},{key:"sortData",value:function(){var t=this._data.slice(0),e=this._sortValue,i=this._dataType,n=t.map(function(t){return t.color}),o=void 0;"cross-table"===i?(t.forEach(function(t){t.sum=d3.sum(t.data,function(t){return t.value})}),o=1===e?function(t,e){return t.sum-e.sum}:-1===e?function(t,e){return e.sum-t.sum}:null):o=1===e?function(t,e){return t.value-e.value}:-1===e?function(t,e){return e.value-t.value}:null,this._sortedDataCopy=o?t.sort(o).map(function(t,e){return t.color=n[e],t}):t}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=a;switch(i.dataType){case"cross-table":n=_;break;default:n=a}return i.dataSolveFunc(n),i}},{key:"setPublicOption",value:function(t){this.data(t.data).backgroundColor(t.backgroundColor).width(t.width).height(t.height).colorList(t._blockTheme.colors).colors(t.colors),this.fontFamily(t.font.fontFamily).fontSize(t.font.fontSize).fontColor(t.font.color),this.titleShow(t.title.show).titleText(t.title.text).titleColor(t.title.color).titleFontFamily(t.title.fontFamily).titleFontSize(t.title.fontSize).titleX(t.title.xPosition).titleY(t.title.yPosition),this.legendShow(t.legend.show).legendX(t.legend.xPosition).legendY(t.legend.yPosition),this.tooltipShow(t.tooltipShow),this.dataType(t.dataType)}},{key:"setSelfOption",value:function(t){}},{key:"setOption",value:function(t,e,i){var n=this.buildOption(t,e);this.setPublicOption(n),this.setSelfOption(n),this.update()}},{key:"widthOfNoMargin",get:function(){var t=this._width-this._marginLeft-this._marginRight;return 0<t?t:0}},{key:"heightOfNoMargin",get:function(){var t=this._height-this._marginTop-this._marginBottom;return 0<t?t:0}},{key:"heightOfMainGroup",get:function(){var t=this._titleText&&this._titleShow?this.title.height()+this._titlePadding:0,e=this._unitWord&&this._unitShow?this.unitText.height()+this._unitPadding:0,i=this._sourceWord&&this._sourceShow?this.sourceText.height()+this._sourcePadding:0,n=this._legendShow?this.legend.height()+(0==this.legend.height()?0:this._gapPadding):0,o=this.heightOfNoMargin-n-t-e-i;return 0<o?o:0}},{key:"activeData",get:function(){return C(this.sortedDataCopy)}},{key:"sortedDataCopy",get:function(){return this._sortedDataCopy}}]),i}(),M=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g"),e.group=e.elem.append("g"),e._data=[],e._transition=!0,e._duration=300,e._onTransitionStart=function(){},e._onTransitionEnd=function(){},e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return h(i,o),s(i,[{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}},{key:"onTransitionStart",value:function(t){return arguments.length?(this._onTransitionStart="function"==typeof t?t:function(){},this):this._onTransitionStart}},{key:"onTransitionEnd",value:function(t){return arguments.length?(this._onTransitionEnd="function"==typeof t?t:function(){},this):this._onTransitionEnd}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),R=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","pie"),e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._innerRadius=0,e._outerRadius=0,e._startAngle=0,e._endAngle=2*Math.PI,e._cornerRadius=0,e._padAngle=.01,e._padRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._innerRadiusRatio=.75,e._sortMethod=null,e}return h(i,M),s(i,[{key:"update",value:function(){var n=this,o=n._data;n.arcFunc.innerRadius(n._innerRadius).outerRadius(n._outerRadius).cornerRadius(n._cornerRadius).padAngle(n._padAngle).padRadius(n._padRadius),n.pieFunc.value(function(t){return Math.abs(t.value)}).startAngle(n._startAngle).endAngle(n._endAngle).sort(n._sortMethod);var t=n.pieFunc(n._data);n.group.selectAll(".pie-path").remove();var e=n.group.selectAll("path").data(t);if(e.exit().remove(),e.merge(e.enter().append("path")).attr("class","pie-path").style("stroke",n._areaBorderColor).style("stroke-width",n._areaBorderWidth).style("fill",function(t){return t.data.color}).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout).transition().duration(function(t,e){return function(t){for(var e=0,i=0;i<t;i++)e=o[i].percent/100;return 2e3*e}(e+1)}).ease(d3.easeLinear).delay(function(t,e){return function(t){for(var e=0,i=0;i<t;i++)e+=o[i].percent/100;return 2e3*e}(e)}).attrTween("d",function(e){var i=d3.interpolate(e.startAngle,e.endAngle);return function(t){return e.endAngle=i(t),n.arcFunc(e)}}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd),n.group.selectAll(".pie-texts").remove(),n.group.selectAll(".pie-percents").remove(),n.group.selectAll(".pie-numbers").remove(),0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||null==n._contentOption||null==n._contentChoice||0==n._positionOptions.indexOf(n._positionChoice)||2==n._positionOptions.indexOf(n._positionChoice)||-1==n._positionOptions.indexOf(n._positionChoice)||0==n._contentChoice.length)n.group.selectAll(".pie-texts text").style("display","none"),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none");else if(1==n._positionOptions.indexOf(n._positionChoice)){var i=n.group.append("g").selectAll("g").data(t);i.exit().remove(),i.enter().append("g").attr("class","pie-text-groups").merge(i).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]-1.3*n._fontSize}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]+1.3*n._fontSize})}),1==n._contentChoice.length?0==n._contentOption.indexOf(n._contentChoice[0])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]}),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]}),n.group.selectAll(".pie-texts text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]}),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-texts text").style("display","none")):2==n._contentChoice.length&&(0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","none")):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-percents text").style("display","none")):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return m(t)[0]}).attr("y",function(t){return m(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-texts text").style("display","none")))}for(var a=n.group.selectAll(".pie-text-groups"),r=[],l=[],s=0;s<a._groups[0].length;s++){l.push(s);for(var u=s+1;u<a._groups[0].length;u++){rt(at(d3.select(a._groups[0][s])),at(d3.select(a._groups[0][u])))&&(r.push(s),d3.select(a._groups[0][s]).style("opacity","0"))}}for(var h=new Set(r),c=Array.from(h),_=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(c,l),d=0;d<c.length;d++){for(var f=[],p=0;p<_.length;p++){var y=at(d3.select(a._groups[0][c[d]])),g=at(d3.select(a._groups[0][_[p]]));if(f.push(rt(y,g)),rt(y,g)){if(c[d]==_[p])continue;d3.select(a._groups[0][c[d]]).style("opacity","0")}}0==f.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var v=0;v<_.length;v++)d3.select(a._groups[0][_[v]]).style("opacity","1");function m(t){var e=.7*n._outerRadius,i=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(i)*e,Math.sin(i)*e]}return n}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}}]),i}(),N=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","outside-text-polygon"),e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._innerRadius=0,e._outerRadius=0,e._startAngle=0,e._endAngle=2*Math.PI,e._cornerRadius=0,e._padAngle=0,e._padRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._sortMethod=null,e._type="normal",e._areaType="normal",e}return h(i,M),s(i,[{key:"update",value:function(){var o=this,t=d3.max(o._data,function(t){return Math.abs(t.value)}),e=o._outerRadius,n=d3.scaleLinear().domain([0,t]).range([0,e]),i=o.group;"normal"==o._type?o.pieFunc.value(function(t){return+t.value}).startAngle(o._startAngle).endAngle(o._endAngle).sort(o._sortMethod):o.pieFunc.value(1).startAngle(o._startAngle).endAngle(o._endAngle).sort(o._sortMethod);var a=o.pieFunc(o._data);function r(t){return t.startAngle+(t.endAngle-t.startAngle)/2}function l(t){var e="normal"==o._type?o._outerRadius:n(Math.abs(t.data.value)),i=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(i)*e,Math.sin(i)*e]}i.selectAll(".half-texts").remove(),i.selectAll(".half-percent").remove(),i.selectAll(".half-numbers").remove(),i.selectAll("g").remove();var s=i.append("g").selectAll("g").data(a);s.exit().remove(),s.enter().append("g").attr("class","pie-texts").merge(s).each(function(t,e){d3.select(this).append("g").attr("class","half-texts").append("text").text(t.data.name=="$-"+e?"":t.data.name).attr("dy","-0.6em").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t){var e=l(t);return"normal"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1):"half"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)<0?-1:1):void 0}).attr("y",function(t){return 1.2*l(t)[1]}).transition().duration(o._transition?o._duration:0).ease(d3.easeLinear).styleTween("text-anchor",function(t){this._current=this._current||t;var i=d3.interpolate(this._current,t);return this._current=i(0),function(t){var e=i(t);return"normal"==o._areaType?r(e)<Math.PI||r(e)==Math.PI?"start":"end":"half"==o._areaType?0<r(e)||0==r(e)?"start":"end":void 0}}),d3.select(this).append("g").attr("class","half-percent").append("text").text(t.data.percent+"%").attr("dy","0.4em").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t){var e=l(t);return"normal"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1):"half"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)<0?-1:1):void 0}).attr("y",function(t){return 1.2*l(t)[1]}).transition().duration(o._transition?o._duration:0).ease(d3.easeLinear).styleTween("text-anchor",function(t){this._current=this._current||t;var i=d3.interpolate(this._current,t);return this._current=i(0),function(t){var e=i(t);return"normal"==o._areaType?r(e)<Math.PI||r(e)==Math.PI?"start":"end":"half"==o._areaType?0<r(e)||0==r(e)?"start":"end":void 0}}),d3.select(this).append("g").attr("class","half-numbers").append("text").text(t.data.value).attr("dy","1.4em").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t){var e=l(t);return"normal"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1):"half"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)<0?-1:1):void 0}).attr("y",function(t){return 1.2*l(t)[1]}).transition().duration(o._transition?o._duration:0).ease(d3.easeLinear).styleTween("text-anchor",function(t){this._current=this._current||t;var i=d3.interpolate(this._current,t);return this._current=i(0),function(t){var e=i(t);return"normal"==o._areaType?r(e)<Math.PI||r(e)==Math.PI?"start":"end":"half"==o._areaType?0<r(e)||0==r(e)?"start":"end":void 0}})}).transition().duration(o._transition?o._duration:0).ease(d3.easeLinear).attr("x",function(t){return 1.2*l(t)[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1)}).attr("y",function(t){return 1.2*l(t)[1]});var u=o.group.selectAll("polyline").data(a);u.exit().remove(),u.merge(u.enter().append("polyline")).style("stroke",function(t){return t.data.color}).style("fill","none").transition().duration(o._transition?o._duration:0).ease(d3.easeLinear).attrTween("points",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var e=n(t),i=l(e);return"normal"==o._areaType?[i,1.2*i[0],1.2*i[1],1.2*i[0]+.1*o._outerRadius*(r(e)>Math.PI?-1:1),1.2*i[1]]:"half"==o._areaType?[i,1.2*i[0],1.2*i[1],1.2*i[0]+.1*o._outerRadius*(r(e)<0?-1:1),1.2*i[1]]:void 0}});i.selectAll(".half-texts text").nodes(),i.selectAll(".half-percent text").nodes(),i.selectAll(".half-numbers text").nodes(),i.selectAll("polyline").nodes();0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length||-1==o._positionOptions.indexOf(o._positionChoice)?(i.selectAll(".half-texts text").style("display","none"),i.selectAll(".half-percent text").style("display","none"),i.selectAll(".half-numbers text").style("display","none"),i.selectAll("polyline").style("display","none")):0!=o._positionOptions.indexOf(o._positionChoice)&&2!=o._positionOptions.indexOf(o._positionChoice)||(1==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])?(i.selectAll(".half-texts text").style("display","block").attr("dy","0.3em"),i.selectAll(".half-percent text").style("display","none"),i.selectAll(".half-numbers text").style("display","none"),i.selectAll("polyline").style("display","block")):1==o._contentOption.indexOf(o._contentChoice[0])?(i.selectAll(".half-percent text").style("display","block").attr("dy","0.3em"),i.selectAll(".half-texts text").style("display","none"),i.selectAll(".half-numbers text").style("display","none"),i.selectAll("polyline").style("display","block")):2==o._contentOption.indexOf(o._contentChoice[0])&&(i.selectAll(".half-numbers text").style("display","block").attr("dy","0.3em"),i.selectAll(".half-percent text").style("display","none"),i.selectAll(".half-texts text").style("display","none"),i.selectAll("polyline").style("display","block")):2==o._contentChoice.length&&(0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(i.selectAll(".half-texts text").style("display","block").attr("dy","-0.1em"),i.selectAll(".half-percent text").style("display","block").attr("dy","0.9em"),i.selectAll(".half-numbers text").style("display","none"),i.selectAll("polyline").style("display","block")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(i.selectAll(".half-texts text").style("display","block").attr("dy","-0.1em"),i.selectAll(".half-numbers text").style("display","block").attr("dy","0.9em"),i.selectAll(".half-percent text").style("display","none"),i.selectAll("polyline").style("display","block")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(i.selectAll(".half-percent text").style("display","block").attr("dy","-0.1em"),i.selectAll(".half-numbers text").style("display","block").attr("dy","0.9em"),i.selectAll(".half-texts text").style("display","none"),i.selectAll("polyline").style("display","block"))));for(var h=i.selectAll(".pie-texts"),c=i.selectAll("polyline"),_=[],d=[],f=0;f<h._groups[0].length;f++){d.push(f);for(var p=f+1;p<h._groups[0].length;p++){rt(at(d3.select(h._groups[0][f])),at(d3.select(h._groups[0][p])))&&(_.push(f),d3.select(h._groups[0][f]).style("opacity","0"),d3.select(c._groups[0][f]).style("opacity","0"))}}for(var y=new Set(_),g=Array.from(y),v=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(g,d),m=0;m<g.length;m++){for(var x=[],S=0;S<v.length;S++){var k=at(d3.select(h._groups[0][g[m]])),b=at(d3.select(h._groups[0][v[S]]));if(x.push(rt(k,b)),rt(k,b)){if(g[m]==v[S])continue;d3.select(h._groups[0][g[m]]).style("opacity","0"),d3.select(c._groups[0][g[m]]).style("opacity","0")}}0==x.filter(function(t){return 1==t}).length&&v.push(g[m])}for(var w=0;w<v.length;w++)d3.select(h._groups[0][v[w]]).style("opacity","1"),d3.select(c._groups[0][v[w]]).style("opacity","1");return o}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"values",value:function(t){return arguments.length?(this._values=t,this):this._values}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"areaType",value:function(t){return arguments.length?(this._areaType=t,this):this._areaType}},{key:"level",value:function(t){return arguments.length?(this._level=t,this):this._level}}]),i}(),j=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","round-corner-donut-chart"),e.core=e.pie=new R(e.mainGroup),e.lineText=new N(e.mainGroup),e._innerRadius=0,e._padAngle=.01,e._startAngle=0,e._endAngle=2*Math.PI,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=10,e._areaBorderColor="#fff",e._areaBorderWidth=0,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){for(var r=this,o=r.pie,t=r.lineText,e=r.widthOfNoMargin,i=(r.legend.height(),[]),n=0;n<r.activeData.length;n++)i.push(r.activeData[n].name);et(i,r._fontSize,r._fontFamily);var a=.74*r.heightOfMainGroup,l=.88*r.widthOfNoMargin;null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||0==r._contentChoice.length?(a=.88*r.heightOfMainGroup,l=.88*r.widthOfNoMargin):0!=r._labelShow&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||(a=.88*r.heightOfMainGroup,l=.88*r.widthOfNoMargin);for(var s=r._startAngle,u=r._endAngle,h=A(l,a,s,u),c=h.radius,_=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*c:0),d=[],f=0;f<r.activeData.length;f++)d.push(r.activeData[f].value);for(var p=0,y=0;y<r.activeData.length;y++)p+=r.activeData[y].value;for(var g=0;g<r.activeData.length;g++)r.activeData[g].percent=(r.activeData[g].value/p*100).toFixed(1);o.data(r.activeData).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).areaBorderColor(r._areaBorderColor).areaBorderWidth(r._areaBorderWidth).startAngle(s).endAngle(u).padAngle(r._padAngle).transition(r._transition).duration(r._duration).onTransitionEnd(function(t,e){var i=d3.select(this.parentNode),n="arc-path-"+t.data.key.replace(/\s*/g,"")+"-"+r.id,o=z((_+c)*r._labelRadiusRatio,t.startAngle+.025,t.endAngle-.025),a=r.defs.select("#"+n).empty()?r.defs.append("path").attr("d",o).attr("id",n):r.defs.select("#"+n).attr("d",o);0==r._labelShow||null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||0==r._positionOptions.indexOf(r._positionChoice)||0==r._contentChoice.length?r.group.selectAll(".chart-label-text").style("display","none"):1==r._positionOptions.indexOf(r._positionChoice)&&(1==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])?L(i,a,t.data.name=="$-"+e?"":t.data.name,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):1==r._contentOption.indexOf(r._contentChoice[0])?L(i,a,t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentOption.indexOf(r._contentChoice[0])&&L(i,a,t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1])||1==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1]))&&L(i,a,t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==r._contentChoice.length&&L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"))}).onMouseover(function(n,t){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(c,1.05*c);return function(t){var e=i(t);return o.arcFunc.outerRadius(e),o.arcFunc(n)}});var e=[{text:""+(n.data.name=="$-"+t?"":n.data.name),color:n.data.color},{text:n.data.valueLabel+": "+n.data.value}];r.tooltip.data(e).update().show()}).onMousemove(function(){r.tooltip.move()}).onMouseout(function(n){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(1.05*c,c);return function(t){var e=i(t);return o.arcFunc.outerRadius(e),o.arcFunc(n)}}),r.tooltip.hide()});var v=h.cx+(e-l)/2,m=r.heightOfMainGroup/2;null!=r._labelShow&&(0!=r._labelShow&&0==r._positionOptions.indexOf(r._positionChoice)?(t.data(r.activeData).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).startAngle(s).endAngle(u).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).values(d).transition(r._transition).duration(r._duration),r.lineText.translate(v||0,m).update(),r.group.select(".outside-text-polygon").attr("display","block")):0!=r._labelShow&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||r.group.select(".outside-text-polygon").attr("display","none")),r.pie.translate(v||0,m).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._contentChoice=i.contentChoice?i.contentChoice:this._contentChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}}]),i}(),Y=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","pie-chart"),e.core=e.pie=new R(e.mainGroup),e.lineText=new N(e.mainGroup),e._innerRadius=0,e._cornerRadius=null,e._padAngle=0,e._startAngle=0,e._endAngle=2*Math.PI,e._marginTop=20,e._marginRight=24,e._marginBottom=20,e._marginLeft=24,e._gapPadding=10,e._labelRadiusRatio=.8,e._innerRadiusRatio=null,e._areaBorderWidth=1,e._areaBorderColor="#fff",e._labelShow=!1,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部径向",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){for(var r=this,l=r.pie,t=r.lineText,e=r.widthOfNoMargin,i=(r.legend.height(),[]),n=0;n<r.activeData.length;n++)i.push(r.activeData[n].name);et(i,r._fontSize,r._fontFamily);var o=.74*r.heightOfMainGroup,a=.74*r.widthOfNoMargin;null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||0==r._contentChoice.length?(o=.88*r.heightOfMainGroup,a=.88*r.widthOfNoMargin):0!=r._labelShow&&0!=r._positionOptions.indexOf(r._positionChoice)&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||(o=.88*r.heightOfMainGroup,a=.88*r.widthOfNoMargin);for(var s=r._startAngle,u=r._endAngle,h=A(a,o,s,u),c=h.radius,_=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*c:0),d=[],f=0;f<r.activeData.length;f++)d.push(r.activeData[f].value);for(var p=0,y=0;y<r.activeData.length;y++)p+=r.activeData[y].value;for(var g=0;g<r.activeData.length;g++)r.activeData[g].percent=(r.activeData[g].value/p*100).toFixed(1);var v=r.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});v.unshift(v[v.length-1]),v.pop(v[v.length-1]),l.data(v).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).areaBorderColor(r._areaBorderColor).areaBorderWidth(r._areaBorderWidth).startAngle(s).endAngle(u).padAngle(r._padAngle).transition(r._transition).duration(r._duration).onTransitionEnd(function(t,e){var i=d3.select(this.parentNode);if(1!=l.data().length){var n="arc-path-"+t.data.key.replace(/\s*/g,"")+"-"+r.id,o=z((_+c)*r._labelRadiusRatio,t.startAngle+.025,t.endAngle-.025),a=r.defs.select("#"+n).empty()?r.defs.append("path").attr("d",o).attr("id",n):r.defs.select("#"+n).attr("d",o);0==r._labelShow||null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||1==r._positionOptions.indexOf(r._positionChoice)||2==r._positionOptions.indexOf(r._positionChoice)||0==r._contentChoice.length?r.group.selectAll(".chart-label-text").style("display","none"):0==r._positionOptions.indexOf(r._positionChoice)&&(1==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])?L(i,a,t.data.name=="$-"+e?"":t.data.name,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):1==r._contentOption.indexOf(r._contentChoice[0])?L(i,a,t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentOption.indexOf(r._contentChoice[0])&&L(i,a,t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1])||1==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1]))&&L(i,a,t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==r._contentChoice.length&&L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"))}else i.append("text").attr("class",r.labelTextClass).attr("dy","0.35em").style("text-anchor","middle").text(t.data.name=="$-"+e?"":t.data.name).style("pointer-events","none")}).onMouseover(function(n,t){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(c,1.05*c);return function(t){var e=i(t);return l.arcFunc.outerRadius(e),l.arcFunc(n)}});var e=[{text:""+(n.data.name=="$-"+t?"":n.data.name),color:n.data.color},{text:n.data.valueLabel+": "+n.data.value}];r.tooltip.data(e).update().show()}).onMousemove(function(){r.tooltip.move()}).onMouseout(function(n){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(1.05*c,c);return function(t){var e=i(t);return l.arcFunc.outerRadius(e),l.arcFunc(n)}}),r.tooltip.hide()});var m=h.cx+(e-a)/2,x=r.heightOfMainGroup/2;if(null!=r._labelShow)if(0!=r._labelShow&&2==r._positionOptions.indexOf(r._positionChoice)){var S=r.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});S.unshift(S[S.length-1]),S.pop(S[S.length-1]),t.data(S).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).startAngle(s).endAngle(u).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).values(d).transition(r._transition).duration(r._duration),r.lineText.translate(m||0,x).update(),r.group.selectAll(".outside-text-polygon").attr("display","block")}else 0!=r._labelShow&&0!=r._positionOptions.indexOf(r._positionChoice)&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||r.group.selectAll(".outside-text-polygon").attr("display","none");r.pie.translate(m||0,x).update()}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._contentChoice=i.contentChoice?i.contentChoice:this._contentChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY)}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}}]),i}(),X={projectId:"152774965629885248",blockId:"774001527749729302",type:"chart",dataSrc:{srcType:"local",dataType:"object-table",data:[[["",""],["比利时","12"],["英国","90"],["加拿大","11"],["俄罗斯","99"],["中国2","19"],["印度","87"],["瑞士","12"],["澳大利亚","30"],["西班牙","50"],["巴西","70"]]],url:"",download:!1},label:"<d-Rose2-chart>",templateId:"5944734748594536331",templateSwitch:"key-value",theme:{themeId:"0",name:"默认主题",colors:["#00aeef","#c759a1","#5552a3","#00bef3","#d07cb3","#6a65ad","#6ecff6","#dda6cc","#908ac2","#afe2fa","#e7c4dd","#b5b1d8","#d2eefc","#f0ddec","#d5d2ea"],fonts:{fontSize:"13",color:"#313131",fontFamily:"noto"},grid:{color:"#ccc"},backgroundColor:"#FFFFFF",axis:{color:"#313131"},price:"0"},props:{size:{height:"400",width:"500",ratio:1,rotate:0},label:{display:!0,positionChoice:"内部径向",contentChoice:["名称","百分比","数值"],textLabel:{color:"#000",fontFamily:"noto",fontSize:13}},animation:{startDelay:1,duration:500,moveStyle:1,endPause:1},map:[[{name:"名称",index:0,allowType:["string"],isLegend:!1,function:"objCol",configurable:!1},{name:"值",index:1,allowType:["number"],isLegend:!0,function:"vCol",configurable:!1}]],titleDisplay:{show:!1,text:"title-abc",xPosition:"center",yPosition:"top",fontSize:"16",color:"#000",fontFamily:"站酷高端黑"},legend:{show:!0,xPosition:"center",yPosition:"bottom"},axis:{grid:{show:"all",color:"#e9e9e9"},color:"#313131",x:{labelShow:!0,name:"X",range:[]},y:{labelShow:!0,name:"Y",range:[]}},font:{fontSize:"13",color:"#313131",fontFamily:"noto"},tooltip:!0,colors:{type:"multiple",list:[0,1,2,3,4]},backgroundColor:""},function_type:["比较类","比例类","占比类"],chart_type:"饼图",title:"玫瑰图",thumb:"http://image.dydata.io/YVLmRojEG564VMaFTzMdky.jpg?v=1&imageMogr2/thumbnail/250x/quality/90",position:{top:"100",left:"100"}},G=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._padAngle=.01,e._labelRadiusRatio=.8,e._labelRadiusRatio=.8,e._innerRadiusRatio=null,e._areaBorderWidth=1,e._areaBorderColor="#fff",e._cornerRadius=10,e._labelShow=!0,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,Y),s(i,[{key:"start",value:function(){this.setOption(X)}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._contentChoice=i.contentChoice?i.contentChoice:this._contentChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}}]),i}(),V=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","wave-circle"),e.group=e.elem.append("g"),e._outerDonut=e.group.append("path"),e._innerCircle=e.group.append("circle"),e._textElem=e.group.append("text"),e._clipTextElem=e.group.append("text"),e._waveClip=e.group.append("defs").append("clipPath"),e._waveClipPath=e._waveClip.append("path"),e._radius=50,e._value=60,e._clipId=n("wave-clip"),e._waveCount=3,e._waveColor="#178BCA",e._outerCircleColor=null,e._minValue=0,e._maxValue=100,e._circleThickness=.05,e._circleFillGap=.05,e._waveHeightRatio=.05,e._waveRiseTime=1e3,e._waveAnimateTime=1500,e._waveRise=!0,e._textSize=.5,e._textSuffix="%",e._textColor="#045681",e._waveTextColor="#A4DBf8",e}return h(i,o),s(i,[{key:"update",value:function(){for(var n=this,t=n._radius,e=n._radius,i=n._circleThickness*n._radius,o=n._circleFillGap*n._radius,a=n._radius-i-o,r=n._textSize*n._radius,l=2*n._radius/n._waveCount,s=n._waveCount+1,u=l*s,h=n._waveHeightRatio*n._radius,c=(1-(Number(n.value)<n._minValue?n._minValue:Number(n.value)>n._maxValue?n._maxValue:Number(n.value))/(n._maxValue-n._minValue))*n._radius*2,_=[],d=0;d<100;d++){var f=d*(s*Math.PI*2)/100,p=Math.sin(f);_.push({x:f,y:p})}var y,g,v=d3.scaleLinear().domain([0,2*Math.PI*s]).range([0,u]),m=d3.scaleLinear().domain([-1,1]).range([0,h]),x=d3.area().x(function(t){return v(t.x)}).y0(function(t){return m(t.y)}).y1(function(t){return 2*n._radius});return n._waveClip.attr("id",n._clipId).call(B,0,c),n._waveClipPath.datum(_).attr("d",x),n._outerDonut.attr("d",d3.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(n._radius-i).outerRadius(n._radius)).style("fill",n._outerCircleColor||n._waveColor).call(B,t,e),n._innerCircle.attr("cx",t).attr("cy",e).attr("r",a).style("fill",n._waveColor).attr("clip-path","url("+S("#"+n._clipId)+")"),n._textElem.attr("x",t).attr("y",e).attr("text-anchor","middle").attr("font-size",r+"px").attr("dy","0.35em").style("fill",n._textColor).text(n.value+n._textSuffix),n._clipTextElem.attr("x",t).attr("y",e).attr("text-anchor","middle").attr("font-size",r+"px").attr("dy","0.35em").style("fill",n._waveTextColor).text(n.value+n._textSuffix).attr("clip-path","url("+S("#"+n._clipId)+")"),y=d3.transition().duration(n._waveRiseTime).ease(d3.easeLinear),g=function(){var e=this,i=d3.interpolate(n._minValue,n.value);return function(t){e.textContent=d3.format("d")(i(t))+n._textSuffix}},n._waveClip.call(B,0,2*n._radius).transition(y).call(B,0,c),n._textElem.text("0"+n._textSuffix).transition(y).tween("text",g),n._clipTextElem.text("0"+n._textSuffix).transition(y).tween("text",g),function t(){n._waveClipPath.attr("transform","translate("+(-u+2*n._radius)+",0)").transition().duration(n._waveAnimateTime).ease(d3.easeLinear).attr("transform","translate(0,0)").on("end",t)}(),n.elem.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),n}},{key:"value",value:function(t){return arguments.length?(this.value=t,this):this.value}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"waveColor",value:function(t){return arguments.length?(this._waveColor=t,this):this._waveColor}},{key:"waveCount",value:function(t){return arguments.length?(this._waveCount=t,this):this._waveCount}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),I=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","wave-circle-chart"),e._circleMargin=2,e._labelMargin=2,e._maxCountOfOneLine=5,e}return h(i,P),s(i,[{key:"updateCore",value:function(){var n=this,t=n.activeData,e=t.length,o=n.widthOfNoMargin,i=n.heightOfMainGroup,a=Math.min(n._maxCountOfOneLine,e),r=Math.ceil(e/a),l=o/a,s=i/r,u=1.2*n.fontSize()+2*n._labelMargin,h=s-u,c=(Math.min(l,h)-2*n._circleMargin)/2,_=n.mainGroup.selectAll("g.wave-circle-item").data(t,function(t){return t.name});if(_.exit().remove(),t.length){var d=_.enter().append("g").attr("class","wave-circle-item");d.append("g"),d.append("text").attr("class",n.labelTextClass);var f=d.merge(_);f.select("g").call(B,n._circleMargin+l/2-c,n._circleMargin+h/2-c).each(function(t,e){d3.select(this).selectAll("*").remove();var i=new V(d3.select(this));i.radius(c).waveColor(t.color).value(t.value).onMouseover(function(t,e){var i=[{text:t.name+": "+t.value+"%",color:t.color}];n.tooltip.data(i).update().show()}).onMousemove(function(){n.tooltip.move()}).onMouseout(function(t){n.tooltip.hide()}),i.update()}),f.select("."+this.labelTextClass).call(B,l/2,2*n._circleMargin+h/2+c+n._labelMargin).attr("dy","0.85em").style("text-anchor","middle").style("fill",n._fontColor).text(function(t){return t.showLegend?H(t.name,l,n._fontSize,n._fontFamily):""});var p=e%a,y=(Math.ceil(e/a)-1)*a;f.attr("transform",function(t,e){var i=e%a*l,n=Math.floor(e/a)*s;return p&&y<=e&&(i=o/p*(e%a+.5)-c),"translate("+i+","+n+")"})}}},{key:"removeLabelText",value:function(){}},{key:"maxCountOfOneLine",value:function(t){return arguments.length?(this._maxCountOfOneLine=t,this):this._maxCountOfOneLine}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}}]),i}(),Z=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rose-pie"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,e=i._startAngle,n=i._endAngle,o=d3.max(t,function(t){return Math.abs(t.value)}),a=i._radius,r=d3.scaleLinear().domain([0,o]).range([0,a]),l=i.arcFunc.innerRadius(0).outerRadius(function(t){return r(Math.abs(t.data.value))}).cornerRadius(i._cornerRadius),s=i.pieFunc.value(1).startAngle(e).endAngle(n).sort(i._sortMethod),u=i.group.selectAll("g.arc-group").data(s(t));u.exit().remove();var h=u.enter().append("g").attr("class","arc-group");if(h.append("path"),u.merge(h).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout).select("path").style("stroke",i._stroke).style("stroke-width",i._strokeWidth).style("fill",function(t){return t.data.color}).transition().duration(i._transition?i._duration:0).ease(d3.easeLinear).attrTween("d",function(i){var n=d3.interpolateNumber(0,r(Math.abs(i.data.value)));return function(t){var e=n(t);return l.outerRadius(e),l(i)}}).on("start",i._onTransitionStart).on("end",i._onTransitionEnd),i.group.selectAll(".pie-texts").remove(),i.group.selectAll(".pie-percents").remove(),i.group.selectAll(".pie-numbers").remove(),0==i._labelShow||null==i._labelShow||null==i._positionOptions||null==i._positionChoice||null==i._contentOption||null==i._contentChoice||0==i._positionOptions.indexOf(i._positionChoice)||2==i._positionOptions.indexOf(i._positionChoice)||-1==i._positionOptions.indexOf(i._positionChoice)||0==i._contentChoice.length)i.group.selectAll(".pie-texts text").style("display","none"),i.group.selectAll(".pie-percents text").style("display","none"),i.group.selectAll(".pie-numbers text").style("display","none");else if(1==i._positionOptions.indexOf(i._positionChoice)){var c=i.group.append("g").selectAll("g").data(s(t));c.exit().remove(),c.enter().append("g").attr("class","pie-text-groups").merge(c).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("text-anchor","middle").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]-1.3*i._fontSize}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("text-anchor","middle").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("text-anchor","middle").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]+1.3*i._fontSize})}),1==i._contentChoice.length?0==i._contentOption.indexOf(i._contentChoice[0])?(i.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]}),i.group.selectAll(".pie-percents text").style("display","none"),i.group.selectAll(".pie-numbers text").style("display","none")):1==i._contentOption.indexOf(i._contentChoice[0])?(i.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]}),i.group.selectAll(".pie-texts text").style("display","none"),i.group.selectAll(".pie-numbers text").style("display","none")):2==i._contentOption.indexOf(i._contentChoice[0])&&(i.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]}),i.group.selectAll(".pie-percents text").style("display","none"),i.group.selectAll(".pie-texts text").style("display","none")):2==i._contentChoice.length&&(0==i._contentOption.indexOf(i._contentChoice[0])&&1==i._contentOption.indexOf(i._contentChoice[1])||1==i._contentOption.indexOf(i._contentChoice[0])&&0==i._contentOption.indexOf(i._contentChoice[1])?(i.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]-i._fontSize/1.7}),i.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]+i._fontSize/1.7}),i.group.selectAll(".pie-numbers text").style("display","none")):0==i._contentOption.indexOf(i._contentChoice[0])&&2==i._contentOption.indexOf(i._contentChoice[1])||2==i._contentOption.indexOf(i._contentChoice[0])&&0==i._contentOption.indexOf(i._contentChoice[1])?(i.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]-i._fontSize/1.7}),i.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]+i._fontSize/1.7}),i.group.selectAll(".pie-percents text").style("display","none")):(1==i._contentOption.indexOf(i._contentChoice[0])&&2==i._contentOption.indexOf(i._contentChoice[1])||2==i._contentOption.indexOf(i._contentChoice[0])&&1==i._contentOption.indexOf(i._contentChoice[1]))&&(i.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]-i._fontSize/1.7}),i.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return C(t)[0]}).attr("y",function(t){return C(t)[1]+i._fontSize/1.7}),i.group.selectAll(".pie-texts text").style("display","none")))}for(var _=i.group.selectAll(".pie-text-groups"),d=[],f=[],p=0;p<_._groups[0].length;p++){f.push(p);for(var y=p+1;y<_._groups[0].length;y++){rt(at(d3.select(_._groups[0][p])),at(d3.select(_._groups[0][y])))&&(d.push(p),d3.select(_._groups[0][p]).style("opacity","0"))}}for(var g=new Set(d),v=Array.from(g),m=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(v,f),x=0;x<v.length;x++){for(var S=[],k=0;k<m.length;k++){var b=at(d3.select(_._groups[0][v[x]])),w=at(d3.select(_._groups[0][m[k]]));if(S.push(rt(b,w)),rt(b,w)){if(v[x]==m[k])continue;d3.select(_._groups[0][v[x]]).style("opacity","0")}}0==S.filter(function(t){return 1==t}).length&&m.push(v[x])}for(var O=0;O<m.length;O++)d3.select(_._groups[0][m[O]]).style("opacity","1");function C(t){var e=.7*r(Math.abs(t.data.value)),i=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(i)*e,Math.sin(i)*e]}}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}}]),i}(),Q=function(t){function e(){r(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._showX=!0,t._showY=!0,t._stroke="#ccc",t._strokeDasharray="2 2",t}return h(e,o),s(e,[{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}},{key:"showX",value:function(t){return arguments.length?(this._showX=t,this):this._showX}},{key:"showY",value:function(t){return arguments.length?(this._showY=t,this):this._showY}}]),e}(),q="grid-arc-path",U="grid-line",K=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","polar-grid"),e.group=e.elem.append("g"),e._radius=100,e._startAngle=0,e._endAngle=2*Math.PI,e._donutCount=5,e._sectorCount=5,e}return h(i,Q),s(i,[{key:"update",value:function(){var i=this,o=i._startAngle,a=i._endAngle,r=i._radius,l=i.group.style("fill","none").style("stroke",i._stroke).style("stroke-dasharray",i._strokeDasharray);!function(){if(!i._showX)return l.selectAll("."+q).remove();var n=i._donutCount,t=l.selectAll("."+q).data(d3.range(n));t.exit().remove(),t.enter().append("path").attr("class",q).merge(t).attr("d",function(t,e){var i=r/n*(e+1);return z(i,o,a)})}(),function(){if(!i._showY)return l.selectAll("."+U).remove();var t=i._sectorCount||1,n=(a-o)/t,e=l.selectAll("."+U).data(d3.range(t+1));e.exit().remove(),e.enter().append("line").attr("class",U).merge(e).attr("x1",0).attr("y1",0).attr("x2",function(t,e){var i=o+n*e;return Math.cos(i-Math.PI/2)*r}).attr("y2",function(t,e){var i=o+n*e;return Math.sin(i-Math.PI/2)*r})}()}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=parseFloat(t),this):this._donutCount}},{key:"sectorCount",value:function(t){return arguments.length?(this._sectorCount=parseFloat(t),this):this._sectorCount}}]),i}(),J=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.grid=null,e._gridStroke="#ccc",e._gridStrokeDasharray="3 3",e._gridShowX=!0,e._gridShowY=!0,e}return h(i,P),s(i,[{key:"gridStroke",value:function(t){return arguments.length?(this._gridStroke=t,this):this._gridStroke}},{key:"gridStrokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}},{key:"gridShowX",value:function(t){return arguments.length?(this._gridShowX=t,this):this._gridShowX}},{key:"gridShowY",value:function(t){return arguments.length?(this._gridShowY=t,this):this._gridShowY}},{key:"setPublicOption",value:function(t){u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setPublicOption",this).call(this,t);var e=t.grid;this.gridStroke(e.color).gridShowX(e.showX).gridShowY(e.showY)}}]),i}(),$=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rose-chart"),e.core=e.rose=new Z(e.mainGroup),e.grid=new K(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,J),s(i,[{key:"updateCore",value:function(){var h=this,c=h.rose,t=h.grid,e=h._startAngle,i=h._endAngle,n=h.widthOfNoMargin,o=h.heightOfMainGroup,_=h._fontSize,a=.75*n,r=.75*o,l=A(a,r,e,i),s=l.radius,u=l.cx,d=l.cy,f=s+10,p=f+_;t.donutCount(6).sectorCount(h.activeData.length).startAngle(e).endAngle(i).radius(f).stroke(h._gridStroke).strokeDasharray(h._gridStrokeDasharray).showX(h._gridShowX).showY(h._gridShowY),c.data(h.activeData).radius(s).startAngle(e).endAngle(i).cornerRadius(h._cornerRadius).stroke(h._stroke).strokeWidth(h._strokeWidth).sortMethod(h._sortMethod).transition(h._transition).duration(h._duration).onTransitionEnd(function(t,e){var i=c.arcFunc.outerRadius()(t),n=d3.select(this.parentNode),o=t.startAngle,a=t.endAngle,r="arc-path-"+t.data.key+"-"+h.id,l=z(i-_,o+.015,a-.015);L(n,h.defs.select("#"+r).empty()?h.defs.append("path").attr("d",l).attr("id",r):h.defs.select("#"+r).attr("d",l),t.data.value.toString(),h._textLabel.fontSize,h._textLabel.fontFamily).classed(h.labelTextClass,!0).style("pointer-events","none").style("fill",h._textLabel.color).style("font-size",h._textLabel.fontSize).style("font-family",h._textLabel.fontFamily),0==h._labelShow?n.selectAll("text").style("display","none"):n.selectAll("text").style("display","block");var s="outer-arc-path-"+t.data.key+"-"+h.id,u=z(p,o+.015,a-.015);L(n,h.defs.select("#"+s).empty()?h.defs.append("path").attr("d",u).attr("id",s):h.defs.select("#"+s).attr("d",u),t.data.name=="$-"+e?"":t.data.name,_,h._fontFamily).attr("class",h.labelTextClass).style("pointer-events","none").style("fill",h._fontColor)}).onMouseover(function(t,e){d3.select(this).transition().style("opacity",.8);var i=[{text:""+(t.data.name=="$-"+e?"":t.data.name),color:t.data.color},{text:t.data.valueLabel+": "+t.data.value}];h.tooltip.data(i).update().show()}).onMousemove(function(){h.tooltip.move()}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),h.tooltip.hide()});var y=(n-a)/2+u,g=(o-r)/2+d,v=l.quadrant,m=(p-s)/2;switch(v){case 4:y+=m,g+=m;break;case 1:y-=m,g+=m;break;case 2:y-=m,g-=m;break;case 3:y+=m,g-=spcae}t.translate(y,g).update(),c.translate(y,g).update()}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),i}(),it=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._startAngle=3*Math.PI/2,e._endAngle=2*Math.PI,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,$),s(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),i}(),nt="icon-bar-group",ot="icon-bar-clip-path",lt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","icon-bar"),e.defs=e.elem.append("defs"),e._width=400,e._height=400,e._icon={name:"male",width:14.57,height:25,path:"m14.57,9.54l0,5.91q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5l-0.91,0l0,12.95q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-6.59l-0.91,0l0,6.59q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-12.95l-0.91,0l0,5q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5.91q0,-1.14,0.8,-1.93t1.93,-0.8l9.09,0q1.14,0,1.93,0.8t0.8,1.93Zm-4.09,-6.36q0,1.32,-0.93,2.25t-2.25,0.93t-2.25,-0.93t-0.93,-2.25t0.93,-2.25t2.25,-0.93t2.25,0.93t0.93,2.25Z"},e._backFill="#ccc",e._countOfOneRow=20,e._padding=2,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,e=i._width,n=i._height,o=i._icon,a=i._countOfOneRow,r=i._padding,l=t.length,s=d3.max(t,function(t){return t.value}),u=e/a,h=n/Math.max(1,l),c=Math.min((u-2*r)/o.width,(h-2*r)/o.height),_=(u-2*r)*c,d=o.height*c,f=function(t){return a<=s?a*t.value/s:t.value},p=i.defs,y="icon-"+i.id;p.select("#"+y).empty()&&p.append("path").attr("id",y).attr("d",o.path);var g=p.selectAll("."+ot).data(t,function(t){return t.name});g.exit().remove();var v=g.enter().append("clipPath").attr("class",ot).attr("id",function(t,e){return"icon-clip-"+e+"-"+i.id});v.append("rect"),v.merge(g).select("rect").attr("x",0).attr("y",-1).attr("width",function(t){return f(t)*u}).attr("height",h);var m=i.group.selectAll("."+nt).data(t,function(t){return t.key});m.exit().remove(),m.selectAll("*").remove();var x=m.enter().append("g").attr("class",nt).merge(m).attr("transform",function(t,e){return"translate(0, "+h*e+")"}).each(i._onTransitionStart).each(i._onTransitionEnd).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout),S=x.append("rect").attr("class","icon-bar-back-rect"),k=x.append("g").attr("class","icon-bar-back-group").call(B,0,(h-d)/2),b=x.append("g").attr("class","icon-bar-front-group").call(B,0,(h-d)/2).attr("clip-path",function(t,e){return"url(#icon-clip-"+e+"-"+i.id+")"});return S.attr("width",e).attr("height",h).style("opacity",0),k.selectAll("g").data(d3.range(a)).enter().append("g").attr("transform",function(t,e){return"translate("+(u*e+Math.max((u-_)/2,r))+",0)"}).append("path").attr("d",o.path).style("fill",i._backFill).attr("transform","scale("+c+")"),b.each(function(t,e){d3.select(this).selectAll("g").data(function(t){return d3.range(Math.ceil(f(t)))}).enter().append("g").attr("transform",function(t,e){return"translate("+(u*e+Math.max((u-_)/2,r))+",0)"}).append("path").attr("d",o.path).style("fill",t.color).style("stroke-width",1/c).attr("transform","scale("+c+")")}),i}},{key:"backFill",value:function(t){return arguments.length?(this._backFill=t,this):this._backFill}},{key:"icon",value:function(t){return arguments.length?(this._icon=t,this):this._icon}},{key:"countOfOneRow",value:function(t){return arguments.length?(this._countOfOneRow=t,this):this._countOfOneRow}},{key:"padding",value:function(t){return arguments.length?(this._padding=t,this):this._padding}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}}]),i}(),st=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","icon-bar-chart"),e.core=e.iconBar=new lt(e.mainGroup),e._icon={name:"male",width:14.57,height:25,path:"m14.57,9.54l0,5.91q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5l-0.91,0l0,12.95q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-6.59l-0.91,0l0,6.59q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-12.95l-0.91,0l0,5q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5.91q0,-1.14,0.8,-1.93t1.93,-0.8l9.09,0q1.14,0,1.93,0.8t0.8,1.93Zm-4.09,-6.36q0,1.32,-0.93,2.25t-2.25,0.93t-2.25,-0.93t-0.93,-2.25t0.93,-2.25t2.25,-0.93t2.25,0.93t0.93,2.25Z"},e._iconBackFill="#ccc",e._countOfOneRow=10,e._iconPadding=2,e._innerPadding=5,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var o=this,a=o.iconBar,n=o.tooltip,t=o.activeData,e=o.widthOfNoMargin,i=o.heightOfMainGroup,r=o._fontSize,l=.25*e,s=t.length?d3.max(t,function(t,e){return E(t.name=="$-"+e?"":t.name,r,o._fontFamily)}):0,u=Math.min(l,s),h=t.length?d3.max(t,function(t){return E(t.value,o._textLabel.fontSize,o._textLabel.fontFamily)}):0,c=o._labelShow?Math.min(l,h):0;a.data(o.activeData).width(o.widthOfNoMargin-u-c-2*o._innerPadding).height(i).backFill(o._iconBackFill).countOfOneRow(o._countOfOneRow).icon(o._icon).padding(o._iconPadding),a.translate(u+o._innerPadding,0).onMouseover(function(t,e){var i=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];n.data(i).update().show(),d3.select(this).select(".icon-bar-front-group").selectAll("path").style("stroke","#000")}).onMousemove(function(t,e){n.move()}).onMouseout(function(t,e){n.hide(),d3.select(this).select(".icon-bar-front-group").selectAll("path").style("stroke","none")}).onTransitionStart(function(t,e){var i=d3.select(this),n=o.heightOfMainGroup/a.data().length;i.append("text").attr("class",o.labelTextClass).attr("x",-o._innerPadding).attr("y",n/2).attr("dy","0.35em").style("text-anchor","end").style("fill",o._fontColor).text(H(t.name=="$-"+e?"":t.name,u,r,o._fontFamily)),o._labelShow&&i.append("text").attr("class",o.labelTextClass).attr("x",o.widthOfNoMargin-u-c-o._innerPadding).attr("y",n/2).attr("dy","0.35em").style("text-anchor","start").style("fill",o._textLabel.color).style("font-size",o._textLabel.fontSize).style("font-family",o._textLabel.fontFamily).text(H(t.value,c,o._textLabel.fontSize,o._textLabel.fontFamily))}),a.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"iconBackFill",value:function(t){return arguments.length?(this._iconBackFill=t,this):this._iconBackFill}},{key:"icon",value:function(t){return arguments.length?(this._icon=t,this):this._icon}},{key:"countOfOneRow",value:function(t){return arguments.length?(this._countOfOneRow=t,this):this._countOfOneRow}},{key:"iconPadding",value:function(t){return arguments.length?(this._iconPadding=t,this):this._iconPadding}}]),i}(),ut="radial-bar-group",ht=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","radial-bar"),e.arcFunc=d3.arc(),e._innerRadius=0,e._outerRadius=100,e._lineRatio=.7,e._startAngle=0,e._endAngle=2*Math.PI*.75,e._cornerRadius=0,e._showMark=!1,e._markRadius=5,e._minLineWidth=2,e}return h(i,M),s(i,[{key:"update",value:function(){var t=this,e=t._data,i=t._outerRadius,n=t._innerRadius,o=t._startAngle,a=t._endAngle,r=t._lineRatio,l=t.group,s=t.arcFunc,u=e.length,h=d3.max(e,function(t){return Math.abs(t.value)}),c=(i-n)/u,_=Math.max(c*r,t._minLineWidth),d=function(t,e){return n+c*(e+1)-_/2},f=d3.scaleLinear().domain([0,h]).range([o,a]),p=function(t){return f(Math.abs(t))};s.innerRadius(function(t,e){return d(0,e)-_/2}).outerRadius(function(t,e){return d(0,e)+_/2}).startAngle(o).endAngle(function(t){return p(t.value)}).cornerRadius(t._cornerRadius);var y=l.selectAll("."+ut).data(e,function(t){return t.key});y.exit().remove();var g=y.enter().append("g").attr("class",ut);g.append("path").attr("class","arc-path"),t._showMark&&g.append("circle").attr("class","mark-circle");var v=g.merge(y).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout);t._showMark?v.select("circle").attr("cx",function(t,e){return d(0,e)*Math.cos(p(t.value)-Math.PI/2)}).attr("cy",function(t,e){return d(0,e)*Math.sin(p(t.value)-Math.PI/2)}).attr("r",t._markRadius).style("fill",function(t){return t.color}).style("opacity",1):v.select("circle").style("opacity",0),v.select("path").style("fill",function(t){return t.color}).attr("d",function(t,e){return s({value:0},e)}).transition().duration(t._transition?t._duration:0).ease(d3.easeLinear).attrTween("d",function(e,i){var n=d3.interpolate(o,p(e.value));return function(t){return s.endAngle(n(t)),s(e,i)}}).on("start",t._onTransitionStart).on("end",t._onTransitionEnd)}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"lineRatio",value:function(t){return arguments.length?(this._lineRatio=t,this):this._lineRatio}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"showMark",value:function(t){return arguments.length?(this._showMark=t,this):this._showMark}},{key:"markRadius",value:function(t){return arguments.length?(this._markRadius=t,this):this._markRadius}},{key:"minLineWidth",value:function(t){return arguments.length?(this._minLineWidth=t,this):this._minLineWidth}}]),i}(),ct=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","radial-bar-chart"),e.core=e.radialBar=new ht(e.mainGroup),e._innerRadiusRatio=.1,e._startAngle=0,e._endAngle=2*Math.PI*.75,e._showMark=!1,e._markRadius=10,e._minLineWidth=2,e._lineRatio=.7,e._cornerRadius=0,e._labelShow=!0,e._positionOptions=["内部居右","外部","内部居左"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var t=this,n=t.tooltip,e=t.radialBar,i=t.widthOfNoMargin,o=t.heightOfMainGroup,a=Math.min(i,o)/2,r=a*t._innerRadiusRatio,l=[];if("linear"==t._colors.type){var s=[isNaN(parseFloat(t._colors.list[0]))?t._colors.list[0]:t._colorList[t._colors.list[0]],isNaN(parseFloat(t._colors.list[1]))?t._colors.list[1]:t._colorList[t._colors.list[1]]],u=d3.scaleLinear().domain([t.activeData.length-1,0]).range(s);l=function(t){for(var e,i,n=t.length,o=0;o<n-1;o++){for(var a=(e=o)+1;a<n;a++)t[a].value<t[e].value&&(e=a);i=t[o],t[o]=t[e],t[e]=i}return t}(t.activeData).map(function(t,e){return t.color=u(e),t})}else l=t.activeData.sort(function(t,e){return t.value-e.value});e.data(l).innerRadius(r).outerRadius(a).startAngle(t._startAngle).endAngle(t._endAngle).lineRatio(t._lineRatio).cornerRadius(t._cornerRadius).showMark(t._showMark).markRadius(t._markRadius).minLineWidth(t._minLineWidth).transition(t._transition).duration(t._duration).onMouseover(function(t,e){d3.select(this).style("opacity",.8);var i=[{text:""+(t.showLegend?t.name:""),color:t.color},{text:t.valueLabel+": "+t.value}];n.data(i).update().show()}).onMousemove(function(){n.move()}).onMouseout(function(){d3.select(this).style("opacity",1),n.hide()}).onTransitionStart(t._onTransitionStart()).onTransitionEnd(t._onTransitionEnd()),e.translate(i/2,o/2).update()}},{key:"configLegend",value:function(){var t=this,n=[];if("linear"==t._colors.type){var e=[isNaN(parseFloat(t._colors.list[0]))?t._colors.list[0]:t._colorList[t._colors.list[0]],isNaN(parseFloat(t._colors.list[1]))?t._colors.list[1]:t._colorList[t._colors.list[1]]],i=d3.scaleLinear().domain([t.activeData.length-1,0]).range(e);n=function(t){for(var e,i,n=t.length,o=0;o<n-1;o++){for(var a=(e=o)+1;a<n;a++)t[a].value<t[e].value&&(e=a);i=t[o],t[o]=t[e],t[e]=i}return t}(t.activeData).map(function(t,e){return t.color=i(e),t}).filter(function(t,e){return 1==t.showLegend})}else n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"lineRatio",value:function(t){return arguments.length?(this._lineRatio=t,this):this._lineRatio}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"showMark",value:function(t){return arguments.length?(this._showMark=t,this):this._showMark}},{key:"markRadius",value:function(t){return arguments.length?(this._markRadius=t,this):this._markRadius}},{key:"minLineWidth",value:function(t){return arguments.length?(this._minLineWidth=t,this):this._minLineWidth}},{key:"_onTransitionStart",value:function(){var a=this;return function(t,e){var i=d3.select(this.parentNode),n=a.radialBar.arcFunc,o=(n.innerRadius()(t,e)+n.outerRadius()(t,e))/2;i.append("text").attr("class",a.labelTextClass).attr("x","-5px").attr("y",-o).attr("dy","0.35em").style("text-anchor","end").style("fill",a._fontColor).text(t.showLegend?t.name:"")}}},{key:"_onTransitionEnd",value:function(){var _=this;return _.group.selectAll(".radial-bar-texts").remove(),function(t,e){var i=d3.select(this.parentNode),n=_.radialBar.arcFunc,o=(n.innerRadius()(t,e)+n.outerRadius()(t,e))/2,a=n.startAngle()(t,e),r=n.endAngle()(t,e),l=r>Math.PI/2&&r<=3*Math.PI/2,s="arc-path-"+t.key+"-"+_.id;if(0==_._labelShow||null==_._labelShow||null==_._positionOptions||null==_._positionChoice)_.group.selectAll(".radial-bar-texts").style("display","none");else if(0==_._positionOptions.indexOf(_._positionChoice)){var u=z(o,a,r-.05,!l);L(i,_.defs.select("#"+s).empty()?_.defs.append("path").attr("d",u).attr("id",s):_.defs.select("#"+s).attr("d",u),t.value,_._textLabel.fontSize,_._textLabel.fontFamily,l?"0%":"100%").attr("class","radial-bar-texts").style("text-anchor",l?"start":"end").style("pointer-events","none").style("fill",_._textLabel.color).style("font-size",_._textLabel.fontSize).style("font-family",_._textLabel.fontFamily).style("display",_._labelShow?"block":"none")}else if(1==_._positionOptions.indexOf(_._positionChoice)){var h=z(o,r,2*Math.PI,!l);L(i,_.defs.select("#"+s).empty()?_.defs.append("path").attr("d",h).attr("id",s):_.defs.select("#"+s).attr("d",h),t.value,_._textLabel.fontSize,_._textLabel.fontFamily,l?"95%":"5%").attr("class","radial-bar-texts").style("text-anchor",l?"end":"start").style("pointer-events","none").style("fill",_._textLabel.color).style("font-size",_._textLabel.fontSize).style("font-family",_._textLabel.fontFamily).style("display",_._labelShow?"block":"none")}else if(2==_._positionOptions.indexOf(_._positionChoice)){var c=z(o,a,a+Math.PI);L(i,_.defs.select("#"+s).empty()?_.defs.append("path").attr("d",c).attr("id",s):_.defs.select("#"+s).attr("d",c),t.value,_._textLabel.fontSize,_._textLabel.fontFamily,"0%").attr("class","radial-bar-texts").attr("dx",_._fontSize/2).style("text-anchor","start").style("pointer-events","none").style("fill",_._textLabel.color).style("font-size",_._textLabel.fontSize).style("font-family",_._textLabel.fontFamily).style("display",_._labelShow?"block":"none")}}}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.lineRatio(l(e.barWidthPercent?e.barWidthPercent:this._lineRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius))}}]),i}(),_t=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","radial-line-chart"),e._lineRatio=0,e._innerRadiusRatio=.2,e._showMark=!0,e._markRadius=5,e._minLineWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,ct),s(i,[{key:"_onTransitionEnd",value:function(){var u=this;return function(t,e){var i=d3.select(this.parentNode),n=u.radialBar.arcFunc,o=(n.innerRadius()(t,e)+n.outerRadius()(t,e))/2,a=(n.startAngle()(t,e),n.endAngle()(t,e)),r=a>Math.PI/2&&a<=3*Math.PI/2,l="arc-path-"+t.key+"-"+u.id,s=z(o,a,2*Math.PI,!r);L(i,u.defs.select("#"+l).empty()?u.defs.append("path").attr("d",s).attr("id",l):u.defs.select("#"+l).attr("d",s),t.value,u._textLabel.fontSize,u._textLabel.fontFamily,r?"95%":"5%").attr("class",u.labelTextClass).style("text-anchor",r?"end":"start").style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).style("display",u._labelShow?"block":"none")}}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.markRadius(l(e.endPointRadius?e.endPointRadius:this._markRadius)).minLineWidth(l(e.lineWidth?e.lineWidth:this._minLineWidth)).lineRatio(0)}}]),i}(),dt=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.xAxis=null,e.yAxis=null,e.yAxisDoubleY=null,e.xScale=null,e.yScale=null,e._marginTop=20,e._marginRight=24,e._marginBottom=18,e._marginLeft=24,e._gapPadding=15,e._titlePadding=20,e._unitPadding=15,e._sourcePadding=10,e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._xRange=null,e._yRange=null,e._xDomain=null,e._yDomain=null,e._clipShow=null,e._xTitle="",e._yTitle="",e._axisLineStroke=null,e._xTickShow=!0,e._yTickShow=!0,e}return h(o,J),s(o,[{key:"update",value:function(){return this._marginLeft=this._yTitle?0:24,this._titlePadding=this._unitWord&&this._unitShow?10:this._titlePadding,(this._yLeftName||this._yRightName)&&(this._marginLeft=this._yLeftName?0:24,this._marginRight=this._yRightName?0:24),this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"bottom"==this._legendY?8:15:this._gapPadding=0,this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateAxis(),this.updateCore(),this.updateScale(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).xRange(t._xRange).transition(t._transition).duration(t._duration),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).yRange(t._yRange).transition(t._transition).duration(t._duration);i.titleHeight;var _=(c-e.allowedMaxTextHeight())/(3*u);i.tickCount(_),i.compute(),n.range([0,h-i.width]),e.compute(),o.range([c-e.height,0]);var d=i.width,f=c-e.height,p=i.width;e.translate(d,f).update(),i.translate(p,0).update()}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"updateScale",value:function(){}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=void 0;if(t.length){var o=d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),a=1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})});n=o<0?a<=0?[o,0]:[o,a]:[0,a]}else n=[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}},{key:"xType",value:function(t){return arguments.length?(this._xType=t,this):this._xType}},{key:"yType",value:function(t){return arguments.length?(this._yType=t,this):this._yType}},{key:"xOrient",value:function(t){return arguments.length?(this._xOrient=t,this):this._xOrient}},{key:"yOrient",value:function(t){return arguments.length?(this._yOrient=t,this):this._yOrient}},{key:"xDomain",value:function(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"yDomain",value:function(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"xRange",value:function(t){return arguments.length?(this._xRange=t,this):this._xRange}},{key:"yRange",value:function(t){return arguments.length?(this._yRange=t,this):this._yRange}},{key:"clipShow",value:function(t){return arguments.length?(this._clipShow=t,this):this._clipShow}},{key:"clipShowX",value:function(t){return arguments.length?(this._clipShowX=t,this):this._clipShowX}},{key:"xTitle",value:function(t){return arguments.length?(this._xTitle=t,this):this._xTitle}},{key:"yTitle",value:function(t){return arguments.length?(this._yTitle=t,this):this._yTitle}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"yLeftName",value:function(t){return arguments.length?(this._yLeftName=t,this):this._yLeftName}},{key:"yLeftTitle",value:function(t){return arguments.length?(this._yLeftTitle=t,this):this._yLeftTitle}},{key:"yRightName",value:function(t){return arguments.length?(this._yRightName=t,this):this._yRightName}},{key:"yRightTitle",value:function(t){return arguments.length?(this._yRightTitle=t,this):this._yRightTitle}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"times",value:function(t){return arguments.length?(this._times=t,this):this._times}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(e.color).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xRange(i.range).yRange(n.range).clipShow(n.range).clipShowX(i.range)}},{key:"widthOfCore",get:function(){var t=this.yAxis?this.yAxis.width:0,e=this.widthOfNoMargin-t;return 0<e?e:0}},{key:"heightOfCore",get:function(){var t=this.xAxis?this.xAxis.height:0,e=this.heightOfMainGroup-t;return 0<e?e:0}}]),o}(),ft=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","axis"),e.group=e.elem.append("g"),e.axisFunc=null,e._orient="bottom",e._type="category",e._scaleFunc=null,e._tickSize=6,e._tickPadding=3,e._tickCount=null,e._tickFormat=null,e._minTickDistance=null,e._axisLineShow=!0,e._tickShow=!0,e._title="",e._titleShow=!0,e._titlePadding=5,e._fontSize=12,e._fontColor="#000",e._fontFamily="sans-serif",e._lineStroke="#000",e._transition=!0,e._duration=500,e._tickValues=[],e._tickValueTexts=[],e}return h(i,o),s(i,[{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"scaleFunc",value:function(t){return arguments.length?(this._scaleFunc=t,this):this._scaleFunc}},{key:"tickSize",value:function(t){return arguments.length?(this._tickSize=t,this):this._tickSize}},{key:"tickPadding",value:function(t){return arguments.length?(this._tickPadding=t,this):this._tickPadding}},{key:"tickFormat",value:function(t){return arguments.length?(this._tickFormat=t,this):this._tickFormat}},{key:"tickCount",value:function(t){return arguments.length?(this._tickCount=t,this):this._tickValues.length||this._tickCount}},{key:"minTickDistance",value:function(t){return arguments.length?(this._minTickDistance=t,this):this._minTickDistance}},{key:"tickLineShow",value:function(t){return arguments.length?(this._tickLineShow=t,this):this._tickLineShow}},{key:"axisLineShow",value:function(t){return arguments.length?(this._axisLineShow=t,this):this._axisLineShow}},{key:"title",value:function(t){return arguments.length?(this._title=t,this):this._title}},{key:"titlePadding",value:function(t){return arguments.length?(this._titlePadding=t,this):this._titlePadding}},{key:"titleShow",value:function(t){return arguments.length?(this._titleShow=t,this):this._titleShow}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"xRange",value:function(t){return arguments.length?(this._xRange=t,this):this._xRange}},{key:"yRange",value:function(t){return arguments.length?(this._yRange=t,this):this._yRange}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}},{key:"lineStroke",value:function(t){return arguments.length?(this._lineStroke=t,this):this._lineStroke}},{key:"tickLabelShow",value:function(t){return arguments.length?(this._tickLabelShow=t,this):this._tickLabelShow}},{key:"tickShow",value:function(t){return arguments.length?(this._tickShow=t,this):this._tickShow}},{key:"titleHeight",get:function(){return this._title&&this._titleShow?1.25*this._fontSize+this._titlePadding:0}},{key:"tickLocations",get:function(){var e=this;return this._tickValues.map(function(t){return e._scaleFunc(t)})}}]),i}(),pt="axis-group",yt="x-title",gt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-x-line"),e._orient="bottom",e._type="category",e._allowedMaxTextHeight=30,e._tickTextRotate=0,e._tickTextHeight=0,e}return h(i,ft),s(i,[{key:"update",value:function(){var i=this,n=i._orient,t=i._scaleFunc,e=i.group,o=i._fontSize,a=i._tickTextRotate,r=i._tickValueTexts,l=void 0;(l=i.axisFunc="top"===n?d3.axisTop(t):d3.axisBottom(t)).tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding);var s=e.select("."+pt).empty()?e.append("g").attr("class",pt):e.select("."+pt);s.style("font-size",o+"px").style("font-family",i._fontFamily).transition().duration(i._transition?i._duration:0).call(l).on("start",function(t,e){s.selectAll(".tick text").style("fill",i._fontColor).attr("dx",0).attr("dy","0.9em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+i._tickTextRotate+")").filter(function(){return"top"!==n}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",i._lineStroke),s.select("path").style("stroke",i._lineStroke).style("display",i._axisLineShow?"block":"none")}),i._rotateFlag&&(s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",i._fontColor).attr("dx",0).attr("dy","0.71em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+i._tickTextRotate+")").filter(function(){return"top"!==n}).attr("dy","0.5em"));var u=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)}),h=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)});d3.selectAll(u).remove(),d3.selectAll(h).remove();var c=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var _=e.select("."+yt).empty()?e.append("g").attr("class",yt):e.select("."+yt),d=_.select("text").empty()?_.append("text"):_.select("text"),f=c/r.length,p=d3.max(r,function(t){return E(t,o,i._fontFamily)});_.call(B,c/2+Math.abs(t.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(p<.8*f?this._tickTextHeight:1.2*this._tickTextHeight):0),d.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dy",i._tickShow?1.325*o/2+6:1.325*o/2+12).text(i._title)}else e.select("."+yt).remove()}},{key:"compute",value:function(){var e=this,i=[],n=[],o=0,a=0,t=!1;function r(){e._tickTextRotate=o,e._tickValues=i,e._tickValueTexts=n,e._tickTextHeight=a,e._rotateFlag=t}var l=e._scaleFunc,s=e._type,u=e._fontSize,h=(e._minTickDistance,e._allowedMaxTextHeight),c=Math.abs(l.range()[0]-l.range()[1]),_=void 0,d=void 0;if(i="category"===s?l.domain():l.ticks(e._tickCount),"number"===s&&0!=e._xRange.length&&i.push(e._xRange[0]),function(){var t=!1;_=c/i.length,(d=d3.max(i.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)})||0)<.8*_&&(n=i,a=(o=0)==d?0:1.125*u,r(),t=!0);return t}())return e;o="top"===e._orient?45:-45;var f=Math.abs(Math.sin(Math.PI/4));d*f<h?(a=d*f,n=i,t=!1):(a=h,n=i.map(function(t){return H(t,a/f,u,e._fontFamily)}),t=!0);Math.abs(Math.cos(Math.PI/4));var p=c/i.length;if("category"===s&&p<2*u){var y=Math.ceil(2*u/p);i=i.filter(function(t,e){return e%y==0})}return r(),e}},{key:"allowedMaxTextHeight",value:function(t){return arguments.length?(this._allowedMaxTextHeight=t,this):this._allowedMaxTextHeight}},{key:"height",get:function(){var e=this,t=this._scaleFunc,i=Math.abs(t.range()[0]-t.range()[1])/this._tickValueTexts.length,n=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}),o=0;return this.isShow&&(o=(this._tickShow?(n?this._tickSize+this._tickPadding:0)+(n<.8*i?this._tickTextHeight:1.2*this._tickTextHeight):0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),o}}]),i}(),vt="axis-group",mt="y-title",xt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-line"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return h(i,ft),s(i,[{key:"update",value:function(){var e=this,t=this,i=t._orient,n=t._scaleFunc,o=t.group,a=t._fontSize,r=t._tickValueTexts,l=void 0;l=t.axisFunc="right"===i?d3.axisRight(n):d3.axisLeft(n);var s=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(s=d3.format("d")),l.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(s);var u=o.select("."+vt).empty()?o.append("g").attr("class",vt):o.select("."+vt);u.transition().duration(t._transition?t._duration:0).call(l).on("start",function(){u.selectAll(".tick text").style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return r[e]}),u.selectAll(".tick line").style("stroke",t._lineStroke).style("display","none"),u.select("path").style("stroke",t._lineStroke).style("display","none")});var h=t.group.selectAll(".axis-y-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)||"$-"==String(t.__data__).slice(0,2)});d3.selectAll(h).remove();var c=Math.abs(n.range()[0]-n.range()[1]);if(t._titleShow&&t._title){var _=o.select("."+mt).empty()?o.append("g").attr("class",mt):o.select("."+mt),d=_.select("text").empty()?_.append("text"):_.select("text"),f=(E(t._title,a,t._fontFamily),d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}));_.call(B,-(this._tickShow?(f?this._tickSize+this._tickPadding:5)+this._tickTextWidth:0),c/2),d.attr("y",-5).style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else o.select("."+mt).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=e._yRange.length&&t.push(-1==String(e._yRange[0]).indexOf(".")?e._yRange[0]:e._yRange[0].toFixed(0));var s=d3.max(t.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,r,e._fontFamily)})||0;return s<=l?(i=t,n=s):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var e=this,t=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}),i=0;return this.isShow&&(i=this._tickShow?(t?this._tickSize+this._tickPadding:0)+this._tickTextWidth+(this._titleShow&&this._title?1.125*this._fontSize+24:0):this._titleShow&&this._title?1.125*this._fontSize+24:0),i}}]),i}(),St=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("line").attr("class","guide-line"),e._x1=0,e._y1=0,e._x2=0,e._y2=100,e._stroke="#000",e._strokeDasharray="3 3",e}return h(i,o),s(i,[{key:"update",value:function(){var t=this;return t.elem.attr("x1",t._x1).attr("y1",t._y1).attr("x2",t._x2).attr("y2",t._y2).style("stroke",t._stroke).style("stroke-dasharray",t._strokeDasharray).style("pointer-events","none"),t}},{key:"x1",value:function(t){return arguments.length?(this._x1=t,this):this._x1}},{key:"y1",value:function(t){return arguments.length?(this._y1=t,this):this._y1}},{key:"x2",value:function(t){return arguments.length?(this._x2=t,this):this._x2}},{key:"y2",value:function(t){return arguments.length?(this._y2=t,this):this._y2}},{key:"x",value:function(t){return arguments.length?(this._x1=this._x2=t,this):[this._x1,this._x2]}},{key:"y",value:function(t){return arguments.length?(this._y1=this._y2=t,this):[this._y1,this._y2]}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}}]),i}(),kt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","scatter-plot"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=2,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i.group,e=i._data,n=i._xScale,o=i._yScale;t.selectAll(".scatter-plot").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","scatter-plot").attr("cx",function(t){return n(t.name)||0}).attr("cy",function(t){return o(t.value)||0}).merge(e).style("fill",i._fill||t.color).style("stroke",i._stroke||t.color).style("stroke-width",i._strokeWidth).attr("r",i._radius).attr("cx",function(t){return n(t.name)||0}).attr("cy",function(t){return o(t.value)||0})});for(var r=t.selectAll(".scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return i}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}(),bt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","overlap-area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._fillOpacity=.7,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,n=i._areaFunc||d3.area().x(function(t){return i._xScale(t.name)}).y0(i._yScale.range()[0]).y1(function(t){return i._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});n.curve(i._curve);var o=i._lineFunc||d3.line().x(function(t){return i._xScale(t.name)}).y(function(t){return i._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});o.curve(i._curve);var e=i.group;e.selectAll(".overlap-area").remove(),e.selectAll(".overlap").remove(),e.selectAll(".overlap-line").remove();var a=e.append("g").attr("class","overlap-area").selectAll("g").data(t,function(t){return t.name});return a.exit().remove(),a.enter().append("g").merge(a).each(function(t,e){d3.select(this).append("g").append("path").attr("class","overlap").style("fill",t.color).style("fill-opacity",i._fillOpacity).transition().duration(i._transition?i._duration:0).attr("d",n(t.data)),d3.select(this).append("g").append("path").attr("class","overlap-line").style("fill","none").style("stroke",i._stroke||t.color||"#000").style("stroke-width",i._lineWidth).style("stroke-opacity",1).style("stroke-dasharray",i._strokeDasharry).transition().duration(i._transition?i._duration:0).attr("d",o(t.data))}),i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}}]),i}(),wt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,e=i.group,n=i._xScale,o=i._yScale,a=e.selectAll("g").data(t,function(t){return t.name});a.exit().remove(),a.enter().append("g").attr("class","ranking-text-group").merge(a).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").attr("x",function(t){return n(t.name)+("mix"==i._type?n.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?o(t.total)||0:o(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t){return n(t.name)+("mix"==i._type?n.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?o(t.total)||0:o(t.value)||0}).attr("text-anchor","middle").style("display",i._labelShow?"block":"none")}),null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?e.selectAll(".ranking-text-group text").style("display","none"):0==i._positionOptions.indexOf(i._positionChoice)?e.selectAll(".ranking-text-group text").attr("dy",.4*-i._fontSize):1==i._positionOptions.indexOf(i._positionChoice)&&e.selectAll(".ranking-text-group text").attr("dy",1.3*i._fontSize);for(var r=e.selectAll(".ranking-text-group text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){rt(at(d3.select(r._groups[0][u])),at(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(_,s),f=0;f<_.length;f++){for(var p=[],y=0;y<d.length;y++){var g=at(d3.select(r._groups[0][_[f]])),v=at(d3.select(r._groups[0][d[y]]));if(p.push(rt(g,v)),rt(g,v)){if(_[f]==d[y])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==p.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),i}(),Ot=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("clipPath").attr("id",e.id),e.rect=e.elem.append("rect"),e._width=100,e._height=100,e._transition=!0,e._duration=500,e._paddingVertical=[5,0],e._paddingHorizontal=[20,20],e}return h(i,o),s(i,[{key:"update",value:function(){var t=this,e=t.rect,i=t._width,n=t._paddingVertical,o=t._paddingHorizontal;return e.attr("x",-i-o[0]).attr("y",-n[0]).attr("width",i+o[0]+o[1]).attr("height",t._height+n[0]+n[1]),e.transition().duration(t._transition?t._duration:0).attr("x",-o[0]),t}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"paddingVertical",value:function(t){return arguments.length?(this._paddingVertical=t,this):this._paddingVertical}},{key:"paddingHorizontal",value:function(t){return arguments.length?(this._paddingHorizontal=t,this):this._paddingHorizontal}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}}]),i}(),Ct=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("clipPath").attr("id",e.id),e.rect=e.elem.append("rect").attr("class","x"+e.id),e._width=100,e._height=100,e._transition=!0,e._duration=500,e._paddingVertical=[0,0],e._paddingHorizontal=[0,0],e}return h(i,o),s(i,[{key:"update",value:function(){var t=this,e=t.rect,i=t._width,n=t._paddingVertical,o=t._paddingHorizontal;return e.attr("x",-i-o[0]).attr("y",-n[0]).attr("width",i+o[0]+o[1]).attr("height",t._height+n[0]+n[1]),e.transition().duration(t._transition?t._duration:0).attr("x",-o[0]),t}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"paddingVertical",value:function(t){return arguments.length?(this._paddingVertical=t,this):this._paddingVertical}},{key:"paddingHorizontal",value:function(t){return arguments.length?(this._paddingHorizontal=t,this):this._paddingHorizontal}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}}]),i}(),Ft="grid-x-line",Pt="grid-y-line",zt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","plane-grid"),e.group=e.elem.append("g"),e._width=400,e._height=400,e._xTickLocations=[],e._yTickLocations=[],e}return h(i,Q),s(i,[{key:"update",value:function(){var e=this,i=e._width,n=e._height,o=e.group.style("fill","none").style("stroke",e._stroke).style("stroke-dasharray",e._strokeDasharray).style("pointer-events","none");!function(){if(!e._showX)return o.selectAll("."+Ft).remove();var t=o.selectAll("."+Ft).data(e._yTickLocations);t.exit().remove(),t.enter().append("line").attr("class",Ft).merge(t).attr("x1",0).attr("y1",function(t){return t+.5}).attr("x2",i).attr("y2",function(t){return t+.5})}(),function(){if(!e._showY)return o.selectAll("."+Pt).remove();var t=o.selectAll("."+Pt).data(e._xTickLocations);t.exit().remove(),t.enter().append("line").attr("class",Pt).merge(t).attr("y1",0).attr("x1",function(t){return t}).attr("y2",n).attr("x2",function(t){return t})}()}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"xTickLocations",value:function(t){return arguments.length?(this._xTickLocations=t,this):this._xTickLocations}},{key:"yTickLocations",value:function(t){return arguments.length?(this._yTickLocations=t,this):this._yTickLocations}}]),i}(),At=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem=t.append("g").attr("class","bands-overlay").style("opacity",0),e._data=[],e._bandHeight=100,e._bandWidth=50,e._isScalePoint=!0,e._isHorizontal=!1,e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return h(i,o),s(i,[{key:"update",value:function(){var t=this,e=t._data,i=t.elem,n=t._bandWidth,o=t._bandHeight,a=t._isScalePoint,r=t._isHorizontal,l=a?n/2:0,s=i.selectAll("rect").data(e);return s.exit().remove(),s.enter().append("rect").merge(s).attr("x",function(t,e){return r?0:n*e-l}).attr("y",function(t,e){return r?o*e-l:0}).attr("width",n).attr("height",o).style("fill","#000").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),t}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"bandWidth",value:function(t){return arguments.length?(this._bandWidth=t,this):this._bandWidth}},{key:"bandHeight",value:function(t){return arguments.length?(this._bandHeight=t,this):this._bandHeight}},{key:"isScalePoint",value:function(t){return arguments.length?(this._isScalePoint=t,this):this._isScalePoint}},{key:"isHorizontal",value:function(t){return arguments.length?(this._isHorizontal=t,this):this._isHorizontal}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}();function Lt(t,e){var i=0,n=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(i=t.index,n=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),W(t,[i],2))return[];for(var a=T(t,e),r={},l=[],s=a.length,u=a[0],h=[],c=[],_=1;_<s;_++)c.push(a[_].length);c.sort(function(t,e){return e-t});for(var d=0;d<s;d++)for(var f=0;f<c[0];f++)h.push(isNaN(parseFloat(a[d][f])));if(0==h.filter(function(t,e){return 0==t}).length)return[];if(n){for(var p=[],y=1;y<s;y++)p.push(a[y].length);p.sort(function(t,e){return e-t});for(var g=1;g<s;g++){var v=a[g],m=v[i];if(""!=m&&null!=m&&null!=m||(m="$-"+g),m){for(var x={name:m,showLegend:m!="$-"+g,data:[]},S=0;S<p[0];S++){var k=u[S];""!=k&&null!=k&&null!=k||(k="&-"+S),S!==i&&x.data.push({name:k,showAxisText:k!="&-"+S,value:v[S]})}l.push(x)}}}else{for(var b=[],w=1;w<s;w++)b.push(a[w].length);b.sort(function(t,e){return e-t});for(var O=1;O<b[0];O++)if(O!==i){var C=u[O];""!=u[O]&&null!=u[O]&&null!=u[O]||(C="$-"+O),r[C+"-"+O]={name:C,showLegend:C!="$-"+O,data:[]}}for(var F=1;F<s;F++){var P=a[F],z=P[i];if(""!=z&&null!=z&&null!=z||(z="&-"+F),z)for(var A=0;A<b[0];A++){var L=u[A];""!=u[A]&&null!=u[A]&&null!=u[A]||(L="$-"+A),A!==i&&L&&r[L+"-"+A].data.push({name:z,showAxisText:z!="&-"+F,value:P[A]})}}for(var M in r)l.push(r[M])}return l.forEach(function(t,e){t.key=D(t.name)+"-"+e}),l}var Mt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","overlap-area-chart"),e.grid=new zt(e.coreGroup),e.areaPlot=new bt(e.coreGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new kt(e.coreGroup),e.stackText=new wt(e.coreGroup),e.clipArea=new Ot(e.defs),e.AnimationArea=new Ct(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yLabel="",e._xLabel="",e._sortValue=null,e._curve=d3.curveCardinal,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var t=this,i=t.activeData,e=t.grid,n=t.areaPlot,r=t.guideScatter,o=t.stackText,l=t.tooltip,a=t.overlay,s=t.guideLine,u=t.clipArea,h=(t.AnimationArea,t.xScale),c=t.yScale,_=t.widthOfCore,d=t.heightOfCore;Math.min(d3.min(i,function(t){return d3.min(t.data,function(t){return+t.value})}),0);e.width(_).height(d).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),n.data(i).xScale(h).yScale(c).curve(t._curve),r.data(i).xScale(h).yScale(c).radius(3.5).stroke("#fff").strokeWidth(2),s.y1(0).y2(d).stroke("#c6c6c6").strokeDasharray("0 0"),a.data(h.domain()).isScalePoint(!0).bandWidth(h.step()).bandHeight(d).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update(),s.x(h(n)).update(),r.data(a).update(),l.show(),s.show(),r.show()}).onMousemove(function(){l.move()}).onMouseout(function(){l.hide(),s.hide(),r.hide()}),o.data(i).xScale(h).yScale(c).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice),t.coreGroup.call(B,t.yAxis.width+.5,0),0!=t._clipShow.length?(u.width(_).height(d).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+u.id+")")):(u.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","")),u.update(),r.elem.style("pointer-events","none");var f=t.group.selectAll(".overlap-area-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(f).remove(),e.update(),a.update(),n.update(),o.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Lt;return i.dataSolveFunc(n),i}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}}]),i}(),Dt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","multiple-line-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e._lineFunc||d3.line().x(function(t){return e._xScale(t.name)+e._xScale.bandwidth()/2}).y(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(e._curve);var n=e.group.selectAll("path").data(t,function(t){return t.key});return n.exit().remove(),n.enter().append("path").merge(n).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._lineWidth).style("stroke-dasharray",e._strokeDasharry).transition().duration(e._transition?e._duration:0).attr("d",function(t){return i(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),i}(),Wt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","line-scatter-plot"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=2,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i.group,e=i._data,n=i._xScale,o=i._yScale;t.selectAll(".scatter-plot").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","scatter-plot").attr("cx",function(t){return n(t.name)+n.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0}).merge(e).style("fill",i._fill||t.color).style("stroke",i._stroke||t.color).style("stroke-width",i._strokeWidth).attr("r",i._radius).attr("cx",function(t){return n(t.name)+n.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0})});for(var r=t.selectAll(".scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return i}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}(),Tt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.grid=new zt(e.coreGroup),e.linePlot=new Dt(e.coreGroup),e.scatterPlot=new Wt(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new Wt(e.coreGroup),e.stackText=new wt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._showPoints=!0,e._curve=d3.curveCardinal,e._strokeWidth=2,e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=i.grid,e=i.linePlot,n=i.scatterPlot,o=i.clipArea,l=i.tooltip,a=i.overlay,s=i.guideLine,u=i.guideScatter,h=i.stackText,c=i.xScale,_=i.yScale,d=i.widthOfCore,f=i.heightOfCore;Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0);t.width(d).height(f).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(0==i._yDomain[0]?i.yAxis.tickLocations.slice(1):i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray),e.data(r).xScale(c).yScale(_).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).curve(i._curve).strokeWidth(i._strokeWidth),n.data(r).xScale(c).yScale(_).radius(i._endPointRadius).stroke("#fff").strokeWidth(1),s.y1(0).y2(f).strokeDasharray(i._gridStrokeDasharray),u.xScale(c).yScale(_).fill("#fff"),a.data(c.domain()).isScalePoint(!1).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update().show(),s.x(0).update().show(),i.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(c(n)+c.bandwidth()/2)+",0)"),u.data(a).update().show()}).onMousemove(function(){l.move()}).onMouseout(function(){l.hide(),s.hide(),u.hide()}),h.data(r).xScale(c).yScale(_).type("mix").fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice),i.coreGroup.call(B,i.yAxis.width+.5,0),0!=i._clipShow.length?(o.width(d).height(f).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url(#"+o.id+")")):(o.width(i._width).height(i._height).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","")),o.update(),u.elem.style("pointer-events","none");var p=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),a.update(),t.update(),e.update(),n.update().show(),h.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};this.strokeWidth(l(e.lineWidth)).curve(r[e.lineType]||d3.curveLinear)}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Lt;return i.dataSolveFunc(n),i}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}(),Rt=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","step-line-chart"),e._showPoints=!1,e._curve=d3.curveStepAfter,e._strokeWidth=2,e._labelShow=!1,e._endPointRadius=0,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,Tt),s(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};this.strokeWidth(l(e.lineWidth)).curve(r[e.lineType]||d3.curveLinear)}}]),i}();function Nt(t,e){return t.sourceLinks.length?t.depth:e-1}function jt(t){return function(){return t}}function Yt(t,e){return Gt(t.source,e.source)||t.index-e.index}function Xt(t,e){return Gt(t.target,e.target)||t.index-e.index}function Gt(t,e){return t.y0-e.y0}function Bt(t){return t.value}function Et(t){return(t.y0+t.y1)/2}function Ht(t){return Et(t.source)*t.value}function Vt(t){return Et(t.target)*t.value}function It(t){return t.index}function Zt(t){return t.nodes}function Qt(t){return t.links}function qt(t,e){var i=t.get(e);if(!i)throw new Error("missing: "+e);return i}function Ut(){var a=0,s=0,r=1,u=1,l=24,h=8,e=It,c=Nt,i=Zt,n=Qt,_=32;function o(){var t={nodes:i.apply(null,arguments),links:n.apply(null,arguments)};return function(t){t.nodes.forEach(function(t,e){t.index=e,t.sourceLinks=[],t.targetLinks=[]});var o=d3.map(t.nodes,e);t.links.forEach(function(t,e){t.index=e;var i=t.source,n=t.target;"object"!==(void 0===i?"undefined":f(i))&&(i=t.source=qt(o,i)),"object"!==(void 0===n?"undefined":f(n))&&(n=t.target=qt(o,n)),i.sourceLinks.push(t),n.targetLinks.push(t)})}(t),t.nodes.forEach(function(t){t.value=Math.max(d3.sum(t.sourceLinks,Bt),d3.sum(t.targetLinks,Bt))}),function(t){var e,i,n;for(e=t.nodes,i=[],n=0;e.length;++n,e=i,i=[])e.forEach(function(t){t.depth=n,t.sourceLinks.forEach(function(t){i.indexOf(t.target)<0&&i.push(t.target)})});for(e=t.nodes,i=[],n=0;e.length;++n,e=i,i=[])e.forEach(function(t){t.height=n,t.targetLinks.forEach(function(t){i.indexOf(t.source)<0&&i.push(t.source)})});var o=(r-a-l)/(n-1);t.nodes.forEach(function(t){t.x1=(t.x0=a+Math.max(0,Math.min(n-1,Math.floor(c.call(null,t,n))))*o)+l})}(t),function(t){var e=d3.nest().key(function(t){return t.x0}).sortKeys(d3.ascending).entries(t.nodes).map(function(t){return t.values});i=d3.min(e,function(t){return(u-s-(t.length-1)*h)/d3.sum(t,Bt)}),e.forEach(function(t){t.forEach(function(t,e){t.y1=(t.y0=e)+t.value*i})}),t.links.forEach(function(t){t.width=t.value*i}),l();var i;for(var n=1,o=_;0<o;--o)r(n*=.99),l(),a(n),l();function a(i){e.forEach(function(t){t.forEach(function(t){if(t.targetLinks.length){var e=(d3.sum(t.targetLinks,Ht)/d3.sum(t.targetLinks,Bt)-Et(t))*i;t.y0+=e,t.y1+=e}})})}function r(i){e.slice().reverse().forEach(function(t){t.forEach(function(t){if(t.sourceLinks.length){var e=(d3.sum(t.sourceLinks,Vt)/d3.sum(t.sourceLinks,Bt)-Et(t))*i;t.y0+=e,t.y1+=e}})})}function l(){e.forEach(function(t){var e,i,n,o=s,a=t.length;for(t.sort(Gt),n=0;n<a;++n)e=t[n],0<(i=o-e.y0)&&(e.y0+=i,e.y1+=i),o=e.y1+h;if(0<(i=o-h-u))for(o=e.y0-=i,e.y1-=i,n=a-2;0<=n;--n)e=t[n],0<(i=e.y1+h-o)&&(e.y0-=i,e.y1-=i),o=e.y0})}}(t),d(t),t}function d(t){t.nodes.forEach(function(t){t.sourceLinks.sort(Xt),t.targetLinks.sort(Yt)}),t.nodes.forEach(function(t){var e=t.y0,i=e;t.sourceLinks.forEach(function(t){t.y0=e+t.width/2,e+=t.width}),t.targetLinks.forEach(function(t){t.y1=i+t.width/2,i+=t.width})})}return o.update=function(t){return d(t),t},o.nodeId=function(t){return arguments.length?(e="function"==typeof t?t:jt(t),o):e},o.nodeAlign=function(t){return arguments.length?(c="function"==typeof t?t:jt(t),o):c},o.nodeWidth=function(t){return arguments.length?(l=+t,o):l},o.nodePadding=function(t){return arguments.length?(h=+t,o):h},o.nodes=function(t){return arguments.length?(i="function"==typeof t?t:jt(t),o):i},o.links=function(t){return arguments.length?(n="function"==typeof t?t:jt(t),o):n},o.size=function(t){return arguments.length?(a=s=0,r=+t[0],u=+t[1],o):[r-a,u-s]},o.extent=function(t){return arguments.length?(a=+t[0][0],r=+t[1][0],s=+t[0][1],u=+t[1][1],o):[[a,s],[r,u]]},o.iterations=function(t){return arguments.length?(_=+t,o):_},o}function Kt(t){return[t.source.x1,t.y0]}function Jt(t){return[t.target.x0,t.y1]}function $t(){return d3.linkHorizontal().source(Kt).target(Jt)}function te(){return d3.linkVertical().source(function(t){return[t.y0,t.source.x1]}).target(function(t){return[t.y1,t.target.x0]})}var ee=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","sankey-plot"),e.sankeyFunc=Ut(),e._width=400,e._height=400,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._strokeOpacity=.3,e._sortByIndex=!0,e._onMouseoverLink=function(){},e._onMousemoveLink=function(){},e._onMouseoutLink=function(){},e._eventOnDrag=function(){},e}return h(i,M),s(i,[{key:"update",value:function(){var n=this,e=n._width,o=n._height,t=n._data,a=n.sankeyFunc,i=n.group;a.nodeId(function(t){return t.key}).size([e,o]);var r=a.nodePadding(),l=a(t),s=l.nodes.filter(function(t){return t.sourceLinks.length||t.targetLinks.length}),u=(i.select(".links-group").empty()?i.append("g").attr("class","links-group").style("fill","none"):i.select(".links-group")).selectAll(".link").data(l.links);u.exit().remove();var h=u.enter().append("path").attr("class","link").merge(u).attr("d",$t()).style("stroke",function(t){return t.source.color}).style("stroke-width",function(t){return Math.max(1,t.width)}).style("stroke-opacity",n._strokeOpacity).on("mouseover",n._onMouseoverLink).on("mousemove",n._onMousemoveLink).on("mouseout",n._onMouseoutLink),c=(i.select(".nodes-group").empty()?i.append("g").attr("class","nodes-group"):i.select(".nodes-group")).selectAll(".node-group").data(s);c.exit().remove();var _=c.enter().append("g").attr("class","node-group");_.append("rect"),_.append("text");var d=_.merge(c).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout);d.select("rect").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("width",function(t){return Math.max(0,t.x1-t.x0)}).attr("height",function(t){return Math.max(0,t.y1-t.y0)}).style("fill",function(t){return t.color}).style("stroke","#333"),d.select("text").attr("x",function(t){return t.x1<=e/2?t.x1+6:t.x0-6}).attr("y",function(t){return(t.y0+t.y1)/2}).attr("dy","0.35em").style("text-anchor",function(t){return t.x1<=e/2?"start":"end"}).style("font-size",n._fontSize+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).text(function(t){return t.y1-t.y0+r<n._fontSize?"":t.name});var f=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(t){var e=d3.event.dy,i=t.y1-t.y0;t.y0=Math.max(0,Math.min(t.y0+e,o-i)),t.y1=t.y0+i,d3.select(this).select("rect").attr("y",t.y0),d3.select(this).select("text").attr("y",function(t){return(t.y0+t.y1)/2}),a.update(l),h.attr("d",$t()),n._eventOnDrag()});return d.style("cursor","move").call(f),n}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"strokeOpacity",value:function(t){return arguments.length?(this._strokeOpacity=t,this):this._strokeOpacity}},{key:"onMouseoverLink",value:function(t){return arguments.length?(this._onMouseoverLink="function"==typeof t?t:function(){},this):this._onMouseoverLink}},{key:"onMousemoveLink",value:function(t){return arguments.length?(this._onMousemoveLink="function"==typeof t?t:function(){},this):this._onMousemoveLink}},{key:"onMouseoutLink",value:function(t){return arguments.length?(this._onMouseoutLink="function"==typeof t?t:function(){},this):this._onMouseoutLink}},{key:"eventOnDrag",value:function(t){return arguments.length?(this._eventOnDrag="function"==typeof t?t:function(){},this):this._eventOnDrag}},{key:"sortByIndex",value:function(t){return arguments.length?(this._sortByIndex=t,this):this._sortByIndex}}]),i}();function ie(t,e){var r=0,l=1,s=2;if(e.forEach(function(t){"objCol"===t.function?r=t.index:"targetCol"===t.function?l=t.index:"vCol"===t.function&&(s=t.index)}),W(t,[r,l,s])||!m(t,s))return{names:[],nodes:[],links:[],valueLabel:""};var u=[],h=[],c=[],_={},d={};return t.slice(1).forEach(function(t){var e=t[r],i=t[l],n=+t[s],o=e+"-s",a=i+"-t";d[e]||(c.push(e),d[e]=!0),d[i]||(c.push(i),d[i]=!0),_[o]||(u.push({name:e,key:o}),_[o]=!0),_[a]||(u.push({name:i,key:a}),_[a]=!0),n&&h.push({source:o,target:a,value:n})}),{names:c,nodes:u,links:h,valueLabel:t[0][s]}}function ne(h,t){var c=0,_=1,d=2;if(t.forEach(function(t){"objCol"===t.function?c=t.index:"targetCol"===t.function?_=t.index:"vCol"===t.function&&(d=t.index)}),W(h,[c,_,d])||c===_||!m(h,d))return{names:[],nodes:[],links:[],valueLabel:""};for(var f=[],p=[],y=[],g={},e=function(t,e){var i=h[t],n=i[c],o=i[_],a=+i[d],r=n,l=o;if(!r||!l||!a||function(t,e,i){if(e===i)return!0;if(t[e]&&0<=t[e].ancestors.indexOf(t[i]))return!0;return!1}(g,r,l))return"continue";g[r]||(f.push({name:n,key:r}),y.push(n),g[r]={ancestors:[],decendents:[]}),g[l]||(f.push({name:o,key:l}),y.push(o),g[l]={ancestors:[],decendents:[]});var s=g[r],u=g[l];[s].concat(v(s.ancestors)).forEach(function(t){var e;(e=t.decendents).push.apply(e,[u].concat(v(u.decendents)))}),[u].concat(v(u.decendents)).forEach(function(t){var e;(e=t.ancestors).push.apply(e,[s].concat(v(s.ancestors)))}),p.push({source:r,target:l,value:a})},i=1,n=h.length;i<n;i++)e(i);return{names:y,nodes:f,links:p,valueLabel:h[0][d]}}var oe=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=this.generateColorList(t.names.length),i=d3.scaleOrdinal().domain(t.names).range(e);return t.nodes.forEach(function(t){return t.color=i(t.name)}),t.legendData=t.names.map(function(t){return{name:t,color:i(t)}}),t}}]),i}(),ae=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","sankey-chart"),e.sankey=new ee(e.mainGroup),e}return h(i,P),s(i,[{key:"updateCore",value:function(){var t=this,i=t.sankey,n=t.tooltip,o=t._data.valueLabel;i.data(t.activeData).width(t.widthOfNoMargin).height(t.heightOfMainGroup).fontSize(t._fontSize).fontFamily(t._fontFamily).fontColor(t._fontColor).onMouseover(function(e){var t=[{color:e.color,text:e.name},{text:o+"："+Math.max(d3.sum(e.sourceLinks,function(t){return t.value}),d3.sum(e.targetLinks,function(t){return t.value}))}];i.elem.selectAll(".link").filter(function(t){return t.source===e||t.target===e}).style("stroke-opacity",.9),n.data(t).update().show()}).onMousemove(function(t){n.move()}).onMouseout(function(e){n.hide(),i.elem.selectAll(".link").filter(function(t){return t.source===e||t.target===e}).style("stroke-opacity",i.strokeOpacity())}).onMouseoverLink(function(t){var e=[{text:t.source.name+" → "+t.target.name+"："+t.value}];d3.select(this).style("stroke-opacity",.9),n.data(e).update().show()}).onMousemoveLink(function(t){n.move()}).onMouseoutLink(function(t){d3.select(this).style("stroke-opacity",i.strokeOpacity()),n.hide()}).eventOnDrag(function(){n.move()}),i.update()}},{key:"configLegend",value:function(){var t=this,n=t._data;t.legend.data(n.legendData).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.legendData.forEach(function(t){t.name===e.name&&(t.active=!i)}),n.nodes.forEach(function(t){t.name===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var i=new oe(t,e);return i.dataSolveFunc(ne),i}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this._data.nodes,i=this._data.links.filter(function(e){return t.some(function(t){return!1!==t.active&&t.key===e.source})&&t.some(function(t){return!1!==t.active&&t.key===e.target})}).map(function(t){return Object.assign({},t)});return{nodes:t.filter(function(e){return!1!==e.active&&(i.some(function(t){return e.key===t.source})||i.some(function(t){return e.key===t.target}))}).map(function(t){return Object.assign({},t)}),links:i}}}]),i}(),re=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,ae),s(e,[{key:"buildOption",value:function(t,e){var i=new oe(t,e);return i.dataSolveFunc(ie),i}}]),e}(),le=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,ee),s(e,[{key:"update",value:function(){var n=this,o=n._width,e=n._height,t=n._data,a=n.sankeyFunc,i=n._fontSize,r=n.group.call(B,0,i);a.nodeId(function(t){return t.key}).size([e-2*i,o]);var l=a.nodePadding(),s=a(t),u=s.nodes.filter(function(t){return t.sourceLinks.length||t.targetLinks.length}),h=(r.select(".links-group").empty()?r.append("g").attr("class","links-group").style("fill","none"):r.select(".links-group")).selectAll(".link").data(s.links);h.exit().remove();var c=h.enter().append("path").attr("class","link").merge(h).attr("d",te()).style("stroke",function(t){return t.source.color}).style("stroke-width",function(t){return Math.max(1,t.width)}).style("stroke-opacity",n._strokeOpacity).on("mouseover",n._onMouseoverLink).on("mousemove",n._onMousemoveLink).on("mouseout",n._onMouseoutLink),_=(r.select(".nodes-group").empty()?r.append("g").attr("class","nodes-group"):r.select(".nodes-group")).selectAll(".node-group").data(u);_.exit().remove();var d=_.enter().append("g").attr("class","node-group");d.append("rect"),d.append("text");var f=d.merge(_).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout);f.select("rect").attr("x",function(t){return t.y0}).attr("y",function(t){return t.x0}).attr("width",function(t){return Math.max(0,t.y1-t.y0)}).attr("height",function(t){return Math.max(0,t.x1-t.x0)}).style("fill",function(t){return t.color}).style("stroke","#333"),f.select("text").attr("y",function(t){return t.x0<=e/2?t.x0-6:t.x1+6}).attr("x",function(t){return(t.y0+t.y1)/2}).attr("dy",function(t){return t.x0<=e/2?"0":"0.66em"}).style("text-anchor","middle").style("font-size",i+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).text(function(t){return H(t.name,t.y1-t.y0+l,i,n._fontFamily)});var p=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(t){var e=d3.event.dx,i=t.y1-t.y0;t.y0=Math.max(0,Math.min(t.y0+e,o-i)),t.y1=t.y0+i,d3.select(this).select("rect").attr("x",t.y0),d3.select(this).select("text").attr("x",function(t){return(t.y0+t.y1)/2}),a.update(s),c.attr("d",te()),n._eventOnDrag()});return f.style("cursor","move").call(p),n}}]),e}(),se=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","vetical-sankey-chart"),e.sankey=new le(e.mainGroup),e}return h(i,ae),s(i,[{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}}]),i}(),ue=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.keyArr,i=this.generateColorList(e.length);return t.legendData=e.map(function(t,e){return{name:t,color:i[e]}}),t}}]),i}();function he(t,e){var r=0,l=1,s=2;if(e.forEach(function(t){"objCol"===t.function?r=t.index:"targetCol"===t.function?l=t.index:"vCol"===t.function&&(s=t.index)}),W(t,[r,l,s])||!m(t,s))return{keyArr:[],matrix:[],valueLabel:""};var n=[],u={},o=0;t.slice(1).forEach(function(t){var e=t[r],i=t[l];void 0===u[e]&&(u[e]=o,n.push(e),o++),void 0===u[i]&&(u[i]=o,n.push(i),o++)});var h=d3.range(o).map(function(t){return d3.range(o).map(function(t){return 0})});return t.slice(1).forEach(function(t){var e=t[r],i=t[l],n=t[s],o=u[e],a=u[i];h[o][a]=Math.abs(n)||0}),{keyArr:n,matrix:h,valueLabel:t[0][s]}}var ce=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","chord"),e.chordFunc=d3.chord(),e._innerRadius=100,e._outerRadius=120,e._padAngle=.02,e._onMouseoverChord=function(){},e._onMousemoveChord=function(){},e._onMouseoutChord=function(){},e}return h(i,M),s(i,[{key:"update",value:function(){var t=this,e=t._data.matrix,i=t._data.nodes,n=t.group;if(!(i.length<=1)){var o=t._innerRadius,a=t._outerRadius,r=t._padAngle,l=t.chordFunc.padAngle(r).sortChords(d3.descending),s=d3.arc().innerRadius(o).outerRadius(a),u=d3.ribbon().radius(o);n.datum(l(e)).call(B,a,a);var h=n.selectAll(".arc-group").data(function(t){return t.groups});h.exit().remove();var c=h.enter().append("g").attr("class","arc-group");c.append("path").attr("class","arc-path"),c.merge(h).each(t._onTransitionEnd).select("path").attr("d",s).style("fill",function(t){return i[t.index].color}).style("stroke",function(t){return i[t.index].color}).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout);var _=n.selectAll(".ribbon-path").data(function(t){return t});return _.exit().remove(),_.enter().append("path").attr("class","ribbon-path").merge(_).attr("d",u).style("fill",function(t){return i[t.source.index].color}).style("stroke",function(t){return d3.rgb(i[t.source.index].color).darker()}).style("fill-opacity",.8).style("stroke-opacity",.8).on("mouseover",t._onMouseoverChord).on("mousemove",t._onMousemoveChord).on("mouseout",t._onMouseoutChord),t}n.selectAll("*").remove()}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"onMouseoverChord",value:function(t){return arguments.length?(this._onMouseoverChord="function"==typeof t?t:function(){},this):this._onMouseoverChord}},{key:"onMousemoveChord",value:function(t){return arguments.length?(this._onMousemoveChord="function"==typeof t?t:function(){},this):this._onMousemoveChord}},{key:"onMouseoutChord",value:function(t){return arguments.length?(this._onMouseoutChord="function"==typeof t?t:function(){},this):this._onMouseoutChord}}]),i}(),_e=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","chord-chart"),e.chord=new ce(e.mainGroup),e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var o=this,t=o.activeData,a=t.nodes,i=o.chord,n=o.tooltip,e=o.widthOfNoMargin,r=o.heightOfMainGroup,l=o._fontSize,s=o._data.valueLabel,u=Math.min(e,r)/2-l,h=.9*u;function c(t,e){"number"==typeof e?i.group.selectAll(".ribbon-path").filter(function(t){return t.source.index!==e&&t.target.index!==e}).transition().style("opacity",t):i.group.selectAll(".ribbon-path").filter(function(t){return this!==e}).transition().style("opacity",t)}i.data(t).innerRadius(h).outerRadius(u).translate(e/2-u,r/2-u).onMouseover(function(t){var e=t.index,i=[{color:a[e].color,text:a[e].name},{text:s+"："+t.value}];n.data(i).update().show(),c(0,e)}).onMousemove(function(){n.move()}).onMouseout(function(t){n.hide(),c(1,t.index)}).onMouseoverChord(function(t){var e=[];e=t.source.value===t.target.value?[{text:a[t.source.index].name+" ↔ "+a[t.target.index].name+"："+t.source.value}]:[{text:a[t.source.index].name+" → "+a[t.target.index].name+"："+t.source.value},{text:a[t.target.index].name+" → "+a[t.source.index].name+"："+t.target.value}],n.data(e).update().show(),c(.1,this)}).onMousemoveChord(function(){n.move()}).onMouseoutChord(function(t){n.hide(),c(1,this)}).onTransitionEnd(function(t){var e=d3.select(this),i="arc-path-"+t.index+"-"+o.id,n=z(u+l-2,t.startAngle,t.endAngle);L(e,o.defs.select("#"+i).empty()?o.defs.append("path").attr("d",n).attr("id",i):o.defs.select("#"+i).attr("d",n),a[t.index].name,l,o._fontFamily).attr("class",o.labelTextClass).style("pointer-events","none").style("fill",o._fontColor)}),i.update()}},{key:"configLegend",value:function(){var t=this,e=t.legend,n=t._data.legendData;e.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.name===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var i=new ue(t,e);return i.dataSolveFunc(he),i}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this._data,e=t.matrix,i=t.legendData,n=[];i.forEach(function(t,e){!1===t.active&&n.push(e)});var o=i.filter(function(t){return!1!==t.active}),a=[];return e.forEach(function(t,e){if(n.indexOf(e)<0){var i=[];t.forEach(function(t,e){n.indexOf(e)<0&&i.push(t)}),a.push(i)}}),{nodes:o,matrix:a}}}]),i}(),de=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","icon-pie"),e.defs=e.elem.append("defs"),e._width=400,e._height=400,e._icon={name:"male",width:14.57,height:25,path:"m14.57,9.54l0,5.91q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5l-0.91,0l0,12.95q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-6.59l-0.91,0l0,6.59q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-12.95l-0.91,0l0,5q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5.91q0,-1.14,0.8,-1.93t1.93,-0.8l9.09,0q1.14,0,1.93,0.8t0.8,1.93Zm-4.09,-6.36q0,1.32,-0.93,2.25t-2.25,0.93t-2.25,-0.93t-0.93,-2.25t0.93,-2.25t2.25,-0.93t2.25,0.93t0.93,2.25Z"},e._countOfOneRow=20,e._rowCount=5,e._padding=2,e}return h(i,M),s(i,[{key:"update",value:function(){var p=this,y=p._data,g=p._width,t=p._height,e=p._padding,v=p._icon,m=p._countOfOneRow,l=p._rowCount,s=d3.sum(y,function(t){return t.value}),n=y.length,u=0,x=y.map(function(t){var e=s<=m*l?t.value:t.value/s*(m*l),i=u+e,n=u;u=i;var o=Math.floor(e),a=!1,r=!1;return n%1!=0&&(a=!0,o++),i%1!=0&&(r=!0,o++),{percent:e,count:o,startPercent:n,endPercent:i,hasHead:a,hasTail:r}});s<m*l&&(l=Math.ceil(s/m)),s<m&&(m=Math.ceil(s));var S=g/m,k=t/l,b=S-2*e,w=k-2*e,O=Math.min(b/v.width,w/v.height);return b=v.width*O,w=v.height*O,function(){var _=p.group,d=p.defs,f=p.id;_.selectAll("*").remove(),d.selectAll("*").remove();var t=f+"-icon";d.append("path").attr("id",t).attr("d",v.path);for(var e=function(e){var i=x[e];if(!i.percent)return"continue";var t=Math.floor(i.startPercent),n=i.startPercent%m*S,o=Math.floor(t/m)*k,a=Math.ceil(i.endPercent),r=i.endPercent%m==0?(i.endPercent-1)%m*S+S:i.endPercent%m*S,l=(Math.ceil(a/m)-1)*k,s=d.append("clipPath").attr("id","clip-path-"+f+"-"+e);s.append("path").attr("id","icon-overlay-"+f+"-"+e).attr("d",function(){var t=Math.floor(i.startPercent/m)<Math.floor(i.endPercent/m),e="M"+n+","+(o+k)+"V"+o+"H"+(t?g:r)+"V"+(t?l:l+k);return t&&(e+="H"+r+"v"+k+"H0V"+(o+k)),e+="Z"}).style("fill","transparent");for(var u=_.append("g").attr("clip-path","url(#clip-path-"+f+"-"+e+")"),h=function(i){var t=u.append("g").attr("transform",function(){var t=i%m*S,e=Math.floor(i/m)*k;return"translate("+t+","+e+")"});t.append("path").attr("class","icon-path-"+e).attr("d",v.path).style("fill",y[e].color).style("stroke-width",1/O).attr("transform","translate("+(S-b)/2+", "+(k-w)/2+")scale("+O+")")},c=t;c<a;c++)h(c);u.append("use").datum({index:e,data:y[e]}).attr("xlink:href","#icon-overlay-"+f+"-"+e).on("mouseover",p._onMouseover).on("mousemove",p._onMousemove).on("mouseout",p._onMouseout)},i=0;i<n;i++)e(i)}(),p}},{key:"icon",value:function(t){return arguments.length?(this._icon=t,this):this._icon}},{key:"countOfOneRow",value:function(t){return arguments.length?(this._countOfOneRow=t,this):this._countOfOneRow}},{key:"padding",value:function(t){return arguments.length?(this._padding=t,this):this._padding}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}}]),i}(),fe=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","icon-pie-chart"),e.iconPie=new de(e.mainGroup),e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var t=this,e=t.iconPie,n=t.tooltip,o=e.elem;e.data(t.activeData).width(t.widthOfNoMargin).height(t.heightOfMainGroup).onMouseover(function(t,e){o.selectAll(".icon-path-"+t.index).style("fill-opacity",.4);var i=[{color:t.data.color,text:t.data.name=="$-"+t.index?"":t.data.name},{text:t.data.valueLabel+": "+t.data.value}];n.data(i).update().show()}).onMousemove(function(){n.move()}).onMouseout(function(t){o.selectAll(".icon-path-"+t.index).style("stroke","none").style("fill-opacity",1),n.hide()}),e.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}}]),i}(),pe=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","two-level-pie"),e.overlayCircle=e.elem.append("defs").append("clipPath").attr("id","overlay-"+e.id).append("circle"),e._radius=0,e._cornerRadius=4,e._padAngle=.01,e._stroke="#fff",e._strokeWidth=1,e._each=function(){},e}return h(i,R),s(i,[{key:"update",value:function(){var t=this,e=t._data,i=t._radius,n=d3.partition().size([2*Math.PI,i])(d3.hierarchy(e).sum(function(t){return t.value})),o=n.descendants(),a=Math.min(d3.min(o,function(t){return t.value})/n.value*Math.PI,t._padAngle),r=d3.arc().startAngle(function(t){return t.x0}).endAngle(function(t){return t.x1}).innerRadius(function(t){return 1===t.depth?t.y0-3:t.y0}).outerRadius(function(t){return 1===t.depth?t.y1-3:t.y1}).padAngle(a).cornerRadius(t._cornerRadius);t.overlayCircle.attr("r",0).transition().duration(t._transition?t._duration:0).ease(d3.easeLinear).attr("r",i);var l=t.group.call(B,i,i).attr("clip-path","url(#overlay-"+t.id+")").selectAll("g").data(o.filter(function(t){return 0!==t.depth}),function(t){return t.data.key});l.exit().remove();var s=l.enter().append("g");return s.append("path"),s.merge(l).select("path").attr("class","arc-path").attr("d",r).style("fill",function(t){if(t.data.color)return t.data.color;var e=t.parent,i=d3.scaleLinear().clamp(!1).domain([0,1]),n=d3.hsl(e.data.color),o=e.children.length;if(1===o)n.l+=.08;else{i.range([n.l+Math.min(.4,.08*o)/2,n.l-Math.min(.4,.08*o)/2]);var a=e.children.indexOf(t)/(o-1);console.log(a),n.l=i(a)}return n}).style("stroke",t._stroke).style("stroke-width",t._strokeWidth).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout).each(t._each),t}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"each",value:function(t){return arguments.length?(this._each="function"==typeof t?t:function(){},this):this._each}}]),i}(),ye=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.nodes,n=this.generateColorList(e.length);return e.forEach(function(t,e){var i=n[e];t.color=i}),t}}]),i}();function ge(t,e){var a=0,r=1,l=2;if(e.forEach(function(t){"objCol"===t.function?a=t.index:"typeCol"===t.function?r=t.index:"vCol"===t.function&&(l=t.index)}),W(t,[a,r,l])||!m(t,l))return{nodes:[],valueLabel:""};var s={};t.slice(1).forEach(function(t,e){var i=t[a],n=t[r],o=t[l];s[i]?s[i].children.push({name:null==n?"":n,key:n+"-t-"+e,index:e,value:""==o||isNaN(parseFloat(o))||null==o||null==o?0:o}):s[i]={name:i,key:i+"-s-"+e,index:e,children:[{name:null==n?"":n,key:n+"-t-"+e,index:e,value:""==o||isNaN(parseFloat(o))||null==o||null==o?0:o}]}});var i=[];for(var n in s)i.push(s[n]);return i.forEach(function(t){return t.sum=d3.sum(t.children,function(t){return t.value})}),{nodes:i,valueLabel:t[0][l]}}var ve=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,P),s(e,[{key:"updateCore",value:function(){}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.nodes,o=n.map(function(t,e){return{name:t.name,color:t.color,key:t.name+"-"+e}});t.legend.data(o).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),o.forEach(function(t){t.key===e.key&&(t.active=!i)}),n.forEach(function(t){t.name===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){var t=this._data.nodes;-1===this._sortValue?t.sort(function(t,e){return e.sum-t.sum||t.index-e.index}):1===this._sortValue&&t.sort(function(t,e){return t.sum-e.sum||t.index-e.index}),this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var i=new ye(t,e);return i.dataSolveFunc(ge),i}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}},{key:"activeData",get:function(){return{children:this.sortedDataCopy.nodes.filter(function(t){return!1!==t.active})}}}]),e}(),me=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","two-level-donut-chart"),e.core=new pe(e.mainGroup),e.lineText=new N(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,ve),s(i,[{key:"updateCore",value:function(){for(var a=this,t=a.core,i=a.tooltip,e=a.lineText,n=a.activeData,o=[],r=[],l=0;l<n.children.length;l++)for(var s=0;s<n.children[l].children.length;s++){n.children[l].children[s].percent=(n.children[l].children[s].value/n.children[l].sum*100).toFixed(1);var u=d3.scaleLinear().clamp(!1).domain([0,1]),h=d3.hsl(n.children[l].color),c=n.children[l].children.length;if(1===c)h.l+=.08;else{u.range([h.l+Math.min(.4,.08*c)/2,h.l-Math.min(.4,.08*c)/2]);var _=n.children[l].children.indexOf(n.children[l].children[s])/(c-1);h.l=u(_)}n.children[l].children[s].color=h,o.push(n.children[l].children[s]),r.push(n.children[l].children[s].name)}var d=a._data.valueLabel,f=(et(r,a._fontSize,a._fontFamily),.74*a.widthOfNoMargin),p=.74*a.heightOfMainGroup;null==a._labelShow||null==a._positionOptions||null==a._positionChoice||null==a._contentOption||null==a._contentChoice||0==a._contentChoice.length?(f=.88*a.widthOfNoMargin,p=.88*a.heightOfMainGroup):0!=a._labelShow&&1!=a._positionOptions.indexOf(a._positionChoice)&&-1!=a._positionOptions.indexOf(a._positionChoice)||(f=.88*a.widthOfNoMargin,p=.88*a.heightOfMainGroup);var y=Math.min(f,p)/2;t.data(a.activeData).radius(y).translate(a.widthOfNoMargin/2-y,a.heightOfMainGroup/2-y).transition(a._transition).duration(a._duration).onMouseover(function(t){var e=[{color:t.data.color||t.parent.data.color,text:t.data.name},{text:d+"："+(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(1))}];i.data(e).update().show(),d3.select(this).transition().duration(20).style("fill-opacity",.7)}).onMousemove(function(){i.move()}).onMouseout(function(){i.hide(),d3.select(this).transition().duration(20).style("fill-opacity",1)}).each(function(t){var e=d3.select(this.parentNode),i="arc-path-"+t.data.key+"-"+t.depth+"-"+a.id,n=z(.5*(t.y0+t.y1),t.x0,t.x1),o=a.defs.select("#"+i).empty()?a.defs.append("path").attr("d",n).attr("id",i):a.defs.select("#"+i).attr("d",n);0==a._labelShow||null==a._labelShow||null==a._positionOptions||null==a._positionChoice||null==a._contentOption||null==a._contentChoice||0==a._contentChoice.length?a.group.selectAll(".chart-label-text").style("display","none"):0!=a._positionOptions.indexOf(a._positionChoice)&&1!=a._positionOptions.indexOf(a._positionChoice)||!t.children?1!=a._positionOptions.indexOf(a._positionChoice)||t.children||(1==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])?L(e,o,t.data.name,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily):1==a._contentOption.indexOf(a._contentChoice[0])?L(e,o,t.data.percent+"%",a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily):2==a._contentOption.indexOf(a._contentChoice[0])&&L(e,o,t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily):2==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])&&1==a._contentOption.indexOf(a._contentChoice[1])||1==a._contentOption.indexOf(a._contentChoice[0])&&0==a._contentOption.indexOf(a._contentChoice[1])?L(e,o,t.data.name+"  "+t.data.percent+"%",a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])||2==a._contentOption.indexOf(a._contentChoice[0])&&0==a._contentOption.indexOf(a._contentChoice[1])?L(e,o,t.data.name+"  "+t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])||2==a._contentOption.indexOf(a._contentChoice[0])&&1==a._contentOption.indexOf(a._contentChoice[1]))&&L(e,o,t.data.percent+"%  "+t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==a._contentChoice.length&&L(e,o,t.data.name+"  "+t.data.percent+"%  "+t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve")):L(e,o,t.data.name,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily)}),null!=a._labelShow&&(0!=a._labelShow&&0==a._positionOptions.indexOf(a._positionChoice)?(e.data(o).outerRadius(y).cornerRadius(a._cornerRadius).startAngle(a._startAngle).endAngle(a._endAngle).fontSize(a._textLabel.fontSize).fontColor(a._textLabel.color).fontFamily(a._textLabel.fontFamily).labelShow(a._labelShow).positionOptions(a._positionOptions).positionChoice(a._positionChoice).contentOption(a._contentOption).contentChoice(a._contentChoice).values(o).level("two").transition(a._transition).duration(a._duration),a.lineText.translate(a.widthOfNoMargin/2,a.heightOfMainGroup/2).update(),a.group.select(".outside-text-polygon").attr("display","block")):0!=a._labelShow&&1!=a._positionOptions.indexOf(a._positionChoice)&&-1!=a._positionOptions.indexOf(a._positionChoice)||a.group.select(".outside-text-polygon").attr("display","none")),t.update()}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}}]),i}(),xe=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.nodes,i=this.generateColorList(e.length);return e.forEach(function(t,e){return t.color=i[e]}),t}}]),i}();function Se(t,e){var i=0,n=1;return e.forEach(function(t){"objCol"===t.function?i=t.index:"vCol"===t.function&&(n=t.index)}),W(t,[i,n])||!m(t,n)?{nodes:[],valueLabel:""}:{nodes:t.slice(1).map(function(t,e){return{name:t[i],key:t[i]+"-"+e,value:t[n]}}),valueLabel:t[0][n]}}var ke=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","treemap"),e._width=400,e._height=400,e._paddingInner=1,e}return h(i,M),s(i,[{key:"update",value:function(){var o=this,t=o._data,e=o.group,a=o._fontSize,r=o._fontFamily;if(t.children.length<1)return e.selectAll("*").remove(),o;var i=d3.treemap().size([o._width,o._height]).paddingInner(o._paddingInner).round(!0),n=d3.hierarchy(t).sum(function(t){return t.value});i(n);var l=e.selectAll(".node").data(n.leaves(),function(t){return t.data.key});l.exit().remove();var s=l.enter().append("g").attr("class","node");s.append("rect"),s.merge(l).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).transition().duration(o._transition?o._duration:0).on("end",o._onTransitionEnd).select("rect").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).style("fill",function(t){return t.data.color}),o.group.selectAll(".one-level-treemap-group").remove();var u=e.append("g").selectAll("g").data(n.leaves(),function(t){return t.data.key});return u.exit().remove(),u.enter().append("g").attr("class","one-level-treemap-group").merge(u).each(function(t,e){t.y1,t.y0;var i=t.x1-t.x0,n=d3.select(this).append("g").attr("class","one-level-treemap-texts").attr("transform",function(){return null==o._positionOptions||null==o._positionChoice?0:0==o._positionOptions.indexOf(o._positionChoice)?"translate("+(t.x0+6)+","+(t.y0+6)+")":1==o._positionOptions.indexOf(o._positionChoice)?"translate("+((t.x1-t.x0)/2+t.x0)+","+((t.y1-t.y0)/2+t.y0)+")":void 0}).attr("font-size",a+"px").attr("font-family",r).attr("text-anchor",function(){return null==o._positionOptions||null==o._positionChoice?0:0==o._positionOptions.indexOf(o._positionChoice)?"start":1==o._positionOptions.indexOf(o._positionChoice)?"middle":void 0}).style("fill",o._fontColor);n.append("text").attr("class","one-level-treemap-name").attr("dy","0.75em").text(H(null==t.data.name?"":t.data.name,i-10,a,r)),n.append("text").attr("class","one-level-treemap-percent").attr("dy","2em").text(H(isNaN(parseFloat(t.data.value))?"":t.data.percent,i-10,a,r)),n.append("text").attr("class","one-level-treemap-value").attr("dy","3.25em").text(H(isNaN(parseFloat(t.data.value))?"":t.data.value,i-10,a,r))}),0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length?o.group.selectAll(".one-level-treemap-group").style("display","none"):0==o._positionOptions.indexOf(o._positionChoice)?1==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".one-level-treemap-name").style("display","block"),o.group.selectAll(".one-level-treemap-percent").style("display","none"),o.group.selectAll(".one-level-treemap-value").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".one-level-treemap-name").style("display","none"),o.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.75em"),o.group.selectAll(".one-level-treemap-value").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(o.group.selectAll(".one-level-treemap-name").style("display","none"),o.group.selectAll(".one-level-treemap-percent").style("display","none"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","0.75em")):2==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".one-level-treemap-name").style("display","block"),o.group.selectAll(".one-level-treemap-percent").style("display","block"),o.group.selectAll(".one-level-treemap-value").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".one-level-treemap-name").style("display","block"),o.group.selectAll(".one-level-treemap-percent").style("display","none"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","2em")):1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])&&(o.group.selectAll(".one-level-treemap-name").style("display","none"),o.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.75em"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","2em")):3==o._contentChoice.length&&(o.group.selectAll(".one-level-treemap-name").style("display","block"),o.group.selectAll(".one-level-treemap-percent").style("display","block"),o.group.selectAll(".one-level-treemap-value").style("display","block")):1==o._positionOptions.indexOf(o._positionChoice)&&(1==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","0.5em"),o.group.selectAll(".one-level-treemap-percent").style("display","none"),o.group.selectAll(".one-level-treemap-value").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".one-level-treemap-name").style("display","none"),o.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.5em"),o.group.selectAll(".one-level-treemap-value").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(o.group.selectAll(".one-level-treemap-name").style("display","none"),o.group.selectAll(".one-level-treemap-percent").style("display","none"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","0.5em")):2==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","-0.125em"),o.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","1.125em"),o.group.selectAll(".one-level-treemap-value").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","-0.125em"),o.group.selectAll(".one-level-treemap-percent").style("display","none"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","1.125em")):1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])&&(o.group.selectAll(".one-level-treemap-name").style("display","none"),o.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","-0.125em"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","1.125em")):3==o._contentChoice.length&&(o.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","-0.75em"),o.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.5em"),o.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","1.75em"))),o}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}}]),i}(),be=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","one-level-treemap-chart"),e.treemap=new ke(e.mainGroup),e._sortValue=-1,e._marginLeft=24,e._marginRight=24,e._labelShow=!0,e._positionOptions=["内部左上","内部居中"],e._positionChoice="内部左上",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称","数值"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){for(var t=this,e=t.treemap,i=t.tooltip,n=t.widthOfNoMargin,o=t.heightOfMainGroup,a=t._data.valueLabel,r=(t._fontSize,t._fontFamily,t.activeData),l=0,s=0;s<(0==r.length?0:r.children.length);s++)l+=isNaN(parseFloat(r.children[s].value))?0:parseFloat(r.children[s].value);for(var u=0;u<r.children.length;u++)r.children[u].percent=((isNaN(parseFloat(r.children[u].value))?0:parseFloat(r.children[u].value))/l*100).toFixed(2)+"%";e.data(t.activeData).width(n).height(o).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).transition(t._transition).duration(t._duration).onMouseover(function(t){var e=[{color:t.data.color,text:t.data.name},{text:a+"："+(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(2))}];i.data(e).update().show(),d3.select(this).style("fill-opacity",.7)}).onMousemove(function(){i.move()}).onMouseout(function(){i.hide(),d3.select(this).style("fill-opacity",1)}).onTransitionEnd(function(t){}),e.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.nodes;t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){-1===this._sortValue&&this._data.nodes.sort(function(t,e){return e.value-t.value}),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new xe(t,e);return i.dataSolveFunc(Se),i}},{key:"activeData",get:function(){return{children:this.sortedDataCopy.nodes.filter(function(t){return!1!==t.active})}}}]),i}(),we=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","two-level-treemap"),e._clipId="clip-overlay-"+e.id,e.overlayRect=e.elem.append("defs").append("clipPath").attr("id",e._clipId).append("rect"),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleLinear(),e._width=400,e._height=400,e._paddingInner=1,e._paddingOuter=2,e._stroke="#fff",e._parentFillOpacity=.7,e._transition=!1,e._duration=400,e}return h(i,M),s(i,[{key:"update",value:function(){var o=this;o.group.attr("clip-path","url("+S("#"+o._clipId)+")");var t=o._data,a=o.group;if(t.children.length<1)return a.selectAll("*").remove(),o;var r=!1,l=!1,e=o._width,i=o._height,s=o.xScale.domain([0,1]).range([0,e]),u=o.yScale.domain([0,1]).range([0,i]),h=d3.hierarchy(t).sum(function(t){return t.value});function n(){var t=(a.select(".children-group").empty()?a.append("g").attr("class","children-group"):a.select(".children-group")).selectAll(".child-node").data(h.leaves(),function(t){return t.data.key});t.exit().remove();var e=t.enter().append("g").attr("class","child-node");e.append("rect"),e.merge(t).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).on("click",function(){l=!0,_(h)}).transition().duration(o._transition||l?o._duration:0).on("start",r?o._onTransitionStart:null).on("end.a",r?o._onTransitionEnd:null).on("end.b",function(){l=!1}).select("rect").attr("x",function(t){return s(t.x0)}).attr("y",function(t){return u(t.y0)}).attr("width",function(t){return s(t.x1)-s(t.x0)}).attr("height",function(t){return u(t.y1)-u(t.y0)}).style("fill",function(t){return t.parent.data.color}).style("stroke",o._stroke).style("stroke-width",o._paddingInner).style("opacity",1)}function c(){var t=a.select(".parent-group").empty()?a.append("g").attr("class","parent-group"):a.select(".parent-group"),e=h.descendants().filter(function(t){return 1===t.depth}),i=t.selectAll(".parent-node").data(e,function(t){return t.data.key});i.exit().remove();var n=i.enter().append("g").attr("class","parent-node");n.append("rect"),n.merge(i).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).on("click",function(t){l=!0,_(t)}).transition().duration(o._transition||l?o._duration:0).on("start.a",r?null:o._onTransitionStart).on("start.b",function(){t.style("display",r?"none":"block")}).on("end",r?null:o._onTransitionEnd).select("rect").attr("x",function(t){return s(t.x0)}).attr("y",function(t){return u(t.y0)}).attr("width",function(t){return s(t.x1)-s(t.x0)}).attr("height",function(t){return u(t.y1)-u(t.y0)}).style("fill",function(t){return t.data.color}).style("fill-opacity",o._parentFillOpacity).style("stroke",o._stroke).style("stroke-width",o._paddingOuter).style("opacity",1)}function _(t){var e=t.depth;s.domain([t.x0,t.x1]),u.domain([t.y0,t.y1]),r=1===e,n(),c()}return d3.treemap().size([1,1]).round(!1)(h),o.overlayRect.attr("width",e).attr("height",i),_(h),o}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}}]),i}(),Oe=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","two-level-treemap-chart"),e.treemap=new we(e.mainGroup),e._sortValue=-1,e._labelShow=!0,e._positionOptions=["内部左上","内部居中"],e._positionChoice="内部左上",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称","数值"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,ve),s(i,[{key:"updateCore",value:function(){for(var l=this,s=l.treemap,i=l.tooltip,t=l.widthOfNoMargin,e=l.heightOfMainGroup,n=l._data.valueLabel,u=(l._fontSize,l._fontFamily),o=l.activeData,a=0,r=0;r<o.children.length;r++)a+=o.children[r].sum;for(var h=0;h<o.children.length;h++){o.children[h].percent=(o.children[h].sum/a*100).toFixed(2)+"%";for(var c=0;c<o.children[h].children.length;c++)o.children[h].children[c].percent=(parseFloat(o.children[h].children[c].value)/o.children[h].sum*100).toFixed(2)+"%"}s.data(l.activeData).width(t).height(e).onMouseover(function(t){var e=[{color:t.data.color||t.parent.data.color,text:t.data.name},{text:n+"："+(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(2))}];i.data(e).update().show(),d3.select(this).select("rect").style("opacity",.5)}).onMousemove(function(){i.move()}).onMouseout(function(){i.hide(),d3.select(this).select("rect").style("opacity",1)}).onTransitionStart(function(){s.elem.selectAll(".two-level-treemap-texts").remove()}).onTransitionEnd(function(t){var e=s.xScale,i=s.yScale,n=i(t.y1)-i(t.y0),o=e(t.x1)-e(t.x0),a=d3.select(this).append("g").attr("class","two-level-treemap-texts").attr("transform",function(){return null==l._positionOptions||null==l._positionChoice?"translate(0)":0==l._positionOptions.indexOf(l._positionChoice)?"translate("+(e(t.x0)+6)+","+(i(t.y0)+6)+")":1==l._positionOptions.indexOf(l._positionChoice)?"translate("+((e(t.x1)-e(t.x0))/2+e(t.x0))+","+((i(t.y1)-i(t.y0))/2+i(t.y0))+")":void 0}).style("font-size",l._textLabel.fontSize+"px").style("font-family",l._textLabel.fontFamily).style("fill",l._textLabel.color).attr("text-anchor",function(){return null==l._positionOptions||null==l._positionChoice?0:0==l._positionOptions.indexOf(l._positionChoice)?"start":1==l._positionOptions.indexOf(l._positionChoice)?"middle":void 0}),r="";n>l._textLabel.fontSize+10&&(r=H(t.data.name,o-10,l._textLabel.fontSize,u),a.append("text").attr("class","two-level-treemap-name").attr("dy","0.75em").text(r),a.append("text").attr("class","two-level-treemap-percent").attr("dy","2em").text(H(t.data.percent,o-10,l._textLabel.fontSize,u)),a.append("text").attr("class","two-level-treemap-value").attr("dy","3.25em").text(H(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(2),o-10,l._textLabel.fontSize,u))),0==l._labelShow||null==l._labelShow||null==l._positionOptions||null==l._positionChoice||null==l._contentOption||null==l._contentChoice||0==l._contentChoice.length?l.group.selectAll(".two-level-treemap-texts").style("display","none"):0==l._positionOptions.indexOf(l._positionChoice)?1==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","none")):1==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.75em"),l.group.selectAll(".two-level-treemap-value").style("display","none")):2==l._contentOption.indexOf(l._contentChoice[0])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","0.75em")):2==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])&&1==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","block"),l.group.selectAll(".two-level-treemap-value").style("display","none")):0==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","2em")):1==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.75em"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","2em")):3==l._contentChoice.length&&(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","block"),l.group.selectAll(".two-level-treemap-value").style("display","block")):1==l._positionOptions.indexOf(l._positionChoice)&&(1==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","0.5em"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","none")):1==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.5em"),l.group.selectAll(".two-level-treemap-value").style("display","none")):2==l._contentOption.indexOf(l._contentChoice[0])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","0.5em")):2==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])&&1==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","-0.125em"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","1.125em"),l.group.selectAll(".two-level-treemap-value").style("display","none")):0==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","-0.125em"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","1.125em")):1==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","-0.125em"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","1.125em")):3==l._contentChoice.length&&(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","-0.75em"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.5em"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","1.75em")))}),s.update()}},{key:"sortData",value:function(){var t=this._data.nodes;-1===this._sortValue?t.sort(function(t,e){return e.sum-t.sum||t.index-e.index}).forEach(function(t){t.children.sort(function(t,e){return e.sum-t.sum||t.index-e.index})}):1===this._sortValue&&t.sort(function(t,e){return t.sum-e.sum||t.index-e.index}).forEach(function(t){t.children.sort(function(t,e){return t.sum-e.sum||t.index-e.index})}),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}}]),i}();function Ce(t,e){var i=0,n=0;if(e.forEach(function(t){"sourceCol"===t.function?i=t.index:"targetCol"===t.function&&(n=t.index)}),W(t,[i,n]))return{nodesObj:{},nodesArr:[],root:{}};for(var o=[],a={},r=0,l=t.length,s=1;s<l;s++){var u=t[s],h=u[i],c=u[n];if(h&&c&&h!==c){if(!a[h]){var _={name:h,index:r};a[h]=_,o.push(_),r++}if(!a[c]){var d={name:c,index:r};a[c]=d,o.push(d),r++}var f=a[h],p=a[c];p.parent||((p.parent=f).children?f.children.push(p):f.children=[p])}}var y=null,g=o.filter(function(t){return!t.parent});return function e(t){var i=t.depth?t.depth:t.depth=0;t.children&&t.children.forEach(function(t){t.depth=i+1,e(t)})}(y=1===g.length?g[0]:1<g.length?{name:"",children:g}:{name:"",children:[]}),{nodesObj:a,nodesArr:o,root:y}}function Fe(t,e){var i=Ce(t[0],e[0]),n=Se(t[1],e[1]);return i.nodesArr.forEach(function(e){n.nodes.forEach(function(t){e.name===t.name&&(e.value=t.value)})}),{root:i.root,valueLabel:n.valueLabel}}var Pe=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data,this._columnMap),e=t.root;if(e&&e.children){var i=e.children.slice(0);e.name&&i.unshift(e),O(i,this.generateColorList(i.length))}return{root:t.root,valueLabel:t.valueLabel}}}]),i}(),ze=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","sunburst"),e.arcFunc=d3.arc(),e._radius=200,e._stroke="#fff",e._duration=750,e}return h(i,M),s(i,[{key:"update",value:function(){var u,h,a=this,t=a._data,e=a._radius,n=d3.hierarchy(t).sum(function(t){return t.value}),r=2*Math.PI,o=d3.partition().size([r,e]);o(n),h=u=.075,function i(t,e){if(1<t.depth){var n=t.parent,o=n.children.length-1,a=Math.pow(-1,t.depth),r=d3.hsl(n.data.color),l=r.l;h=a<0&&l<u*o?l/(o+2):0<a&&1-l<u*o?(1-l)/(o+2):u,r.l+=h*e*a,t.data.color=r.toString()}var s=t.children;s&&s.forEach(function(t,e){i(t,e)})}(n);var i=a.arcFunc.innerRadius(function(t){return Math.max(0,t.y0)}).outerRadius(function(t){return Math.max(0,t.y1)}).startAngle(function(t){return t.x0}).endAngle(function(t){return t.x1}),l=a.group,s=!1,c={oldState:f(n),newState:f(n),currentRootNode:n,currentClickedNode:n};function _(t){var e=t.data.name?t.descendants():t.descendants().slice(1),i=l.selectAll(".arc-group").data(e,function(t){return t.data.name});i.select("text").remove(),i.exit().transition().duration(a._transition||s?a._duration:0).on("start",a._onTransitionStart).remove().select("path").attrTween("d",function(t){return p.call(this,function(t){if(!s)return{x0:t.x0,x1:t.x1,y0:0,y1:0};if(t.depth<c.currentClickedNode.depth)return{x0:t.x0,x1:t.x1,y0:0,y1:0};return{x0:t.x0>=c.oldState.x1?r:0,x1:t.x0>=c.oldState.x1?r:0,y0:0,y1:0}}(t))});var n=i.enter().append("g").attr("class","arc-group");n.append("path").style("fill",function(t){return t.data.color}).style("stroke",a._stroke).each(function(t){this._currentArc=function(t){if(!s)return{x0:t.x0,x1:t.x1,y0:0,y1:0};return{x0:t.x0>=c.newState.x1?r:0,x1:t===c.currentRootNode||t.x0>=c.newState.x1?r:0,y0:0,y1:0}}(t)});var o=n.merge(i).on("click",d).on("mouseover",a._onMouseover).on("mousemove",a._onMousemove).on("mouseout",a._onMouseout);o.select("path").style("fill",function(t){return t.data.color}).style("stroke",a._stroke),o.transition().duration(a._transition||s?a._duration:0).on("start",a._onTransitionStart).on("end.a",a._onTransitionEnd).on("end.b",function(){s=!1}).select("path").attrTween("d",function(t){return p.call(this,f(t))})}function d(e){if(!s&&e.data.name!==n.data.name){s=!0;var t=(c.currentClickedNode=e)===c.currentRootNode?e.data.parent:e.data;c.oldState=f(e),c.currentRootNode=d3.hierarchy(t).sum(function(t){return t.value}),o(c.currentRootNode);var i=c.currentRootNode.descendants().filter(function(t){return t.data.name===e.data.name})[0];c.newState=f(i),_(c.currentRootNode)}}function f(t){return{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1}}function p(t){var e=d3.interpolate(this._currentArc,t);return this._currentArc=e(0),function(t){return i(e(t))}}return _(n),a}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}}]),i}();var Ae=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","sunburst-chart"),e.sunburst=new ze(e.mainGroup),e._sortValue=-1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,P),s(i,[{key:"updateCore",value:function(){var i=this,n=i.sunburst,o=i.tooltip,a=i.activeData,t=i.widthOfNoMargin,e=i.heightOfMainGroup,r=Math.min(t,e)/2,l=i._fontSize,s=i._fontFamily;n.data(a.root).radius(r).translate(t/2,e/2).transition(i._transition).duration(i._duration).onMouseover(function(t){var e=[{color:t.data.color,text:t.data.name},{text:a.valueLabel+"："+t.value}];o.data(e).update().show()}).onMousemove(function(){o.move()}).onMouseout(function(){o.hide()}).onTransitionStart(function(){d3.select(this).select("text").style("opacity",0).remove()}).onTransitionEnd(function(t){var a=n.arcFunc,e="";(e=0===t.depth?H(t.data.name,2*(t.y1-t.y0),l,s):t.y0*(t.x1-t.x0)<1.25*l?"":H(t.data.name,t.y1-t.y0,l,s))&&(d3.select(this).append("text").attr("class",i.labelTextClass).style("pointer-events","none").style("font-size",i._textLabel.fontSize+"px").style("font-family",i._textLabel.fontFamily).style("fill",i._textLabel.color).attr("transform",function(t){var e,i,n=90<(i=(((e=t).x0+e.x1)/2-Math.PI/2)/Math.PI*180)?i-180:i,o=a.centroid(t);return 0===t.depth&&(o=[n=0,0]),"translate("+o+")rotate("+n+")"}).append("tspan").attr("class","sunburst-texts").attr("x",0).attr("y",0).attr("dy","0.35em").style("text-anchor","middle").style("fill",i._textLabel.color).text(e),0==i._labelShow?d3.selectAll(".sunburst-texts").style("display","none"):d3.selectAll(".sunburst-texts").style("display","block"))}),n.update()}},{key:"configLegend",value:function(){var t=this,e=t.sortedDataCopy.root,n=e.children?e.children.map(function(t){return t}):[];e.name&&n.unshift(e),t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.name===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){var t=this._data,e=t.root;!function e(t){var i=Math.abs(t.value)||0;t.children&&t.children.forEach(function(t){i+=e(t)});t.sum=i;return i}(e),-1===this._sortValue&&function e(t){t.children&&t.children.sort(function(t,e){return e.sum-t.sum||t.index-e.index}).forEach(function(t){e(t)})}(e),this._sortedDataCopy=t}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Pe(t,e);return i.dataSolveFunc(Fe),i}},{key:"activeData",get:function(){var t=this.sortedDataCopy,e=t.root,i={name:e.name,color:e.color,value:e.value,sum:e.sum,children:e.children&&e.children.filter(function(t){return!1!==t.active})};return!1===e.active&&(i.children=[]),{root:i,valueLabel:t.valueLabel}}}]),i}();var Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI6SURBVHjafJLLTlNhFIX7GlBaUJwABYlODIWWJoAil0QBQZyQoPGpIFigpVJNeAkSSCRATI2A1BZs6WnOIcSe/3Iu+ZxoC0njYI3WWoNv7xWwrOtDIYRRq9l12bYwtHaMXO67obU2bPuuL4QwLMs6CEipfyulkFLWBZDJfOZB52PW1zMAKNXwlVIoJW8CQkhTSokQAiEEnueSze4QDvURDvXSFoyQSmXxPLee+Zuv3in7vkelYrAwv0xieJpIzwCJ4WnmZpcolcr4vt+87PsehlGlVqshhSSfLxAbmuDk5AwpFbZtU6kY+L7XKEupTIDt7R0W5pfrzOXyFfHYJMXiBQCO4/Bm8T2bm9sASCmrAcdxzHT6E+FQL4nhafL5AuXSFQcHxwxGx9nf+0K5fEWxeMnTsRmCrT0kkxm01tXAt9yJ2Xn/EeFQL5GeKLHYJPHYFIPR53R3PWEwOk48PkU8NkkkEqU9/JCO9n6Ojr5WA1prM5ncoi0YITE8zenpD4rFS/b3D4gOPGN3d4+Li0vOz38yNjpDa0sXKyvrKKUazKlUlrnZpVvMlTvMruvweuEta2vpBvPta5dLV9i2jdaaQuGC2NAEZ2fnOI6DbduUSmU8z0Mp1ezPPpWKweLiO0ZHXhLpiTI68oL5V8uUfv3nz//W47ou6VSWtmCE9nAfrS3dfPiwhes2WZiUqum2NzY+cq+jn9XVzabbllLeBCzr+kgIadq2qEsIaWrHMY+Pc6bW2mzmW5Z1+GcAWWbj+pgdyZ8AAAAASUVORK5CYII=",Me=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","tree"),e._width=400,e._height=400,e._visibleDepth=5,e._maxRadius=20,e._textPadding=4,e._linkStrokeOpacity=.35,e._nodeFillOpacity=.45,e._nodeStrokeOpacity=.6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._hasValue=!0,e}return h(i,M),s(i,[{key:"update",value:function(){var o=this,t=o._data,e=o._width,i=o._height,n=i/2,a=Math.min(o._maxRadius,Math.floor(.0375*i)),r=o._fontSize,l=o._fontFamily,s=o._textPadding,u=8*r,h=o._labelShow?5*r:10,c=Math.min(E(t.name,r,l),u),_=o._labelShow?c+s+a:10,d=d3.hierarchy(t).sum(function(t){return t.value||0}),f=d.descendants(),p=d.leaves().length,y=d3.max(f,function(t){return t.depth})||1,g=d3.max(f,function(t){return t.value}),v=(e-_-h)/Math.min(o._visibleDepth,y),m=Math.max(i/p,r+4),x=v-2*s,S=d3.tree().nodeSize([m,v]).separation(function(t,e){return t.parent==e.parent?1:1.25}),k=d3.linkHorizontal().x(function(t){return t.y}).y(function(t){return t.x}),b=d3.zoom().scaleExtent([.1,3]);S(d);var w=d3.max(f,function(t){return t.x}),O=d3.min(f,function(t){return t.x}),C=i/2;(n<-O&&w<n||-O<n&&n<w)&&(C-=(w+O)/2);var F=d3.scaleSqrt().domain([0,g]).range([0,a]),P=o._hasValue,z=function(t){var e=t.depth?F(t.value):a/2;return P?e:a},A=function(t){return P?t.data.color:t._children?t.data.color:"#fff"},L=function(t){var e=P&&0===t.depth?a:z(t);return(t.children||t._children?-1:1)*(e+s)},M=!1,D=function(){return o._transition||M?o._duration:0},W=o.group;W.transition().duration(D).call(B,_,C),W.select(".bg-rect").empty()?W.append("rect").attr("class","bg-rect").attr("width",e).attr("height",i).style("opacity",0).call(B,-_,-C):W.select(".bg-rect");var T=W.select(".zoom-group").empty()?W.append("g").attr("class","zoom-group"):W.select(".zoom-group"),R=T.select(".links-group").empty()?T.append("g").attr("class","links-group"):T.select(".links-group"),N=T.select(".nodes-group").empty()?T.append("g").attr("class","nodes-group"):T.select(".nodes-group"),j=!1,Y=W.select(".zoom-controller");function X(t){var i,e;S(d),i=t,(e=R.selectAll("path").data(d.links(),function(t){return t.target.data.name})).enter().append("path").attr("d",function(t){var e={x:i.x0,y:i.y0};return k({source:e,target:e})}).merge(e).style("fill","none").style("stroke-width",function(t){return 2*z(t.target)}).style("stroke",function(t){return t.target.data.color}).style("stroke-linecap","round").style("stroke-opacity",o._linkStrokeOpacity).transition().duration(D).attr("d",function(t){return k(t)}),e.exit().transition().duration(D).attr("d",function(t){var e={x:i.x,y:i.y};return k({source:e,target:e})}).remove(),function(e){var t=N.selectAll(".node-group").data(d.descendants(),function(t){return t.data.name}),i=t.enter().append("g").attr("class","node-group").style("cursor","pointer").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout);i.append("circle").attr("r",z).style("fill",A).style("fill-opacity",o._nodeFillOpacity).style("stroke",function(t){return t.data.color}).style("stroke-opacity",o._nodeStrokeOpacity),t.select("circle").style("fill",A).style("stroke",function(t){return t.data.color}),i.append("text").attr("class","tree-texts").attr("x",L).attr("y",0).attr("dy","0.35em").style("text-anchor",function(t){return t.children||t._children?"end":"start"}).style("font-size",o._fontSize+"px").style("font-family",o._fontFamily).style("fill",o._fontColor).text(function(t){return t.depth?H(t.data.name,x,o._fontSize,l):H(t.data.name,u,r,l)}),i.merge(t).on("click",G).transition().duration(D).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}).on("end",function(){M=!1}).select("text").style("fill-opacity",o._labelShow?1:0);var n=t.exit().transition().duration(D).attr("transform",function(){return"translate("+e.y+","+e.x+")"}).remove();n.select("circle").attr("r",0),n.select("text").style("fill-opacity",0)}(t),f.forEach(function(t){t.x0=t.x,t.y0=t.y})}function G(t){var e;M=!0,(e=t).children?(e._children=e.children,e.children=null):e._children&&(e.children=e._children,e._children=null),X(t=e)}Y.empty()?(Y=W.append("image").attr("class","zoom-controller").attr("x",-_).attr("y",-C).attr("xlink:href",Le).on("click",function(){j=!j,W.on(".zoom",null),j?(Y.attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGpSURBVHjafJLNruIwDIV5/zdBQqAKKHXzJxXYQlrgFdreRWgCG9rb5MyCuR0KM7OwFOXks3NsT+I4Pi+XS/MeURQZIjJRFH1oq9XKTKfT00QIceec4zWSJIHWObquQ1EUSJJkpCulsFgs7hPOuWGM4SeICIfDAd4HhAB4H6C1BhENb4QQmM/nZgSnaQrOOaqqhrUObdvBWoe6/oIQYkjwARMROBdDEiklrHVQSoEoBWMMnD8TjOA4jnE4HFFVNdI0BRG9wQQiQlmW0HkOInrCaZqa41Gj73tY6yClhJQS2+0Wzt2w3e4gpYQQAtdrg957nE5nzGYzM8myzHTdN0LA4NFaB+duaNsOzt2Gu8ejRQgB3ges1+tn5TzP0fd++KZSCrvdDs7dsN/voZSClBLXawPvAy6Xy7Pyj2etNer665+ek4RQlhWKovjj+bXbQgi8np+wHI3oo9vjOQuUZYWmsXg8WjSNRVXV/5/z64ZprYcNCwHI8wJEyV837P4KM8YQb2JonaNtOxTFCZvNZqT/hu8TzvmZMWbeg4hMlmWGiD40IYSJouj0awAemusiRGff+AAAAABJRU5ErkJggg==").select("title").text("点击关闭缩放功能"),W.call(b)):Y.attr("xlink:href",Le).select("title").text("点击开启缩放功能")})).append("title").text("点击开启缩放功能"):Y.attr("x",-_).attr("y",-C),d.x0=d.x,d.y0=d.y,b.on("zoom",function(){var t=d3.event.transform;T.attr("transform",t)}),X(d)}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"linkStrokeOpacity",value:function(t){return arguments.length?(this._linkStrokeOpacity=t,this):this._linkStrokeOpacity}},{key:"nodeStrokeOpacity",value:function(t){return arguments.length?(this._nodeStrokeOpacity=t,this):this._nodeStrokeOpacity}},{key:"nodeFillOpacity",value:function(t){return arguments.length?(this._nodeFillOpacity=t,this):this._nodeFillOpacity}},{key:"visibleDepth",value:function(t){return arguments.length?(this._visibleDepth=t,this):this._visibleDepth}},{key:"textPadding",value:function(t){return arguments.length?(this._textPadding=t,this):this._textPadding}},{key:"maxRadius",value:function(t){return arguments.length?(this._maxRadius=t,this):this._maxRadius}},{key:"hasValue",value:function(t){return arguments.length?(this._hasValue=t,this):this._hasValue}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}}]),i}(),De=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.root;if(e&&e.children){var i=e.children;O(i,this.generateColorList(i.length))}return{root:t.root||{children:[]},valueLabel:t.valueLabel}}}]),i}(),We=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","tree-chart"),e.tree=new Me(e.mainGroup),e._maxRadius=4,e._hasValue=!1,e._nodeFillOpacity=1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,P),s(i,[{key:"updateCore",value:function(){var i=this,n=i.tree,o=i.tooltip,a=i.activeData;if(!a.root||!a.root.children)return i;var t=i.widthOfNoMargin,e=i.heightOfMainGroup;n.data(a.root).width(t).height(e).maxRadius(i._maxRadius).hasValue(i._hasValue).nodeFillOpacity(i._nodeFillOpacity).transition(i._transition).duration(i._duration).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).onMouseover(function(e){d3.select(this).select("circle").style("fill-opacity",1).style("stroke-opacity",1),n.elem.select(".links-group").selectAll("path").filter(function(t){return t.target===e}).style("stroke-opacity",.7);var t=[{color:e.data.color,text:e.data.name}];i._hasValue&&t.push({text:a.valueLabel+"："+(-1==String(e.value).indexOf(".")?e.value:e.value.toFixed(2))}),o.data(t).update().show()}).onMousemove(function(){o.move()}).onMouseout(function(e){o.hide(),d3.select(this).select("circle").style("fill-opacity",n.nodeFillOpacity()).style("stroke-opacity",n.nodeStrokeOpacity()),n.elem.select(".links-group").selectAll("path").filter(function(t){return t.target===e}).style("stroke-opacity",n.linkStrokeOpacity())}),n.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.root.children||[];t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.name===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){var t,e=this._data.root;e&&e.children&&e.children.length&&((t=e).color=t.children[0].color,function e(t){1<t.depth&&(t.color=t.parent.color),t.children&&t.children.forEach(function(t){e(t)})}(t)),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new De(t,e);return i.dataSolveFunc(Ce),i}},{key:"activeData",get:function(){var t=this.sortedDataCopy,e=t.root;return{root:{name:e.name,color:e.color,value:e.value||0,children:e.children&&e.children.filter(function(t){return!1!==t.active})},valueLabel:t.valueLabel}}}]),i}();var Te=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data,this._columnMap),e=t.root;if(e&&e.children){var i=e.children;O(i,this.generateColorList(i.length))}return{root:t.root||{children:[]},valueLabel:t.valueLabel}}}]),i}(),Re=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._hasValue=!0,e._maxRadius=20,e._nodeFillOpacity=.45,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,We),s(i,[{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Te(t,e);return i.dataSolveFunc(Fe),i}}]),i}(),Ne=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.keys,i=this.generateColorList(e.length),n={};return e.forEach(function(t,e){return n[t]=i[e]}),t.colorMap=n,t}}]),i}();function je(t,e){var n=0;if(e.forEach(function(t){"objCol"===t.function&&(n=+t.index)}),W(t,[n],2))return{keys:[],dataForStack:[]};var i=T(t,e),o=i[0];return{keys:o.filter(function(t,e){return e!==n}),dataForStack:i.slice(1).map(function(t){var i={};return t.forEach(function(t,e){e===n?i.name=t:i[o[e]]=t}),i})}}var Ye=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._fillOpacity=.7,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e._areaFunc||d3.area().x(function(t){return e._xScale(t.name)}).y0(e._yScale.range()[0]).y1(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(e._curve);var n=e.group.selectAll("path").data(t,function(t){return t.key});return n.exit().remove(),n.enter().append("path").merge(n).style("fill",function(t){return t.color}).style("fill-opacity",e._fillOpacity).transition().duration(e._transition?e._duration:0).attr("d",function(t){return i(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}}]),i}(),Xe=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stream-graph"),e}return h(i,Ye),s(i,[{key:"update",value:function(){for(var i=this,n=i._data,t=[],o=[],e=0;e<n.keys.length;e++){for(var a=[],r=0;r<n.dataForStack.length;r++)a.push(n.dataForStack[r][n.keys[e]]);t.push(d3.max(a))}for(var l=0;l<n.keys.length;l++)for(var s=0;s<n.stackData[l].length;s++)n.stackData[l][s].data[n.keys[l]]==t[l]&&o.push([n.stackData[l][s][0],n.stackData[l][s][1],n.stackData[l][s].data.name]);var u=i.group,h=n.stackData,c=i._areaFunc||d3.area().x(function(t){return i._xScale(t.data.name)}).y0(function(t){return i._yScale(t[0])}).y1(function(t){return i._yScale(t[1])});u.select(".stream-graph-group").remove();var _=u.append("g").attr("class","stream-graph-group"),d=_.selectAll("path").data(h,function(t){return t.key});d.exit().remove(),d.enter().append("path").merge(d).style("fill",function(t){return n.colorMap[t.key]}).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout).transition().duration(i._transition?i._duration:0).attr("d",c);var f=_.selectAll("text").data(n.keys);f.exit().remove(),f.enter().append("text").attr("class","stream-graph-texts").merge(d).text(function(t,e){return n.keys[e]}).attr("x",function(t,e){return i._xScale(o[e][2])}).attr("y",function(t,e){return(i._yScale(o[e][1])-i._yScale(o[e][0]))/2+i._yScale(o[e][0])}).attr("text-anchor","middle").attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily),0==i._labelShow?u.selectAll(".stream-graph-texts").style("display","none"):u.selectAll(".stream-graph-texts").style("display","block");for(var p=u.selectAll(".stream-graph-texts"),y=[],g=[],v=0;v<p._groups[0].length;v++){g.push(v);for(var m=v+1;m<p._groups[0].length;m++){rt(at(d3.select(p._groups[0][v])),at(d3.select(p._groups[0][m])))&&(y.push(v),d3.select(p._groups[0][v]).style("opacity","0"))}}for(var x=new Set(y),S=Array.from(x),k=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(S,g),b=0;b<S.length;b++){for(var w=[],O=0;O<k.length;O++){var C=at(d3.select(p._groups[0][S[b]])),F=at(d3.select(p._groups[0][k[O]]));if(w.push(rt(C,F)),rt(C,F)){if(S[b]==k[O])continue;d3.select(p._groups[0][S[b]]).style("opacity","0")}}0==w.filter(function(t){return 1==t}).length&&k.push(S[b])}for(var P=0;P<k.length;P++)d3.select(p._groups[0][k[P]]).style("opacity","1");return i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}}]),i}(),Ge=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.grid=new zt(e.coreGroup),e.streamgraph=new Xe(e.coreGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var e=this,r=e.activeData,t=e.streamgraph,i=e.grid,l=e.tooltip,n=e.overlay,s=e.guideLine,o=e.clipArea,u=e.xScale,a=e.yScale,h=(e.widthOfNoMargin,e.heightOfMainGroup,e._fontSize),c=(d3.max(r.keys,function(t){return E(t,h,e._fontFamily)}),e.widthOfCore),_=e.heightOfCore,d=r.stackData,f=r.colorMap,p=d3.max(d,function(t){return d3.max(t,function(t){return Math.max(t[0],t[1])})}),y=d3.min(d,function(t){return d3.min(t,function(t){return Math.min(t[0],t[1])})});a.domain([y,p]).range([0,_]);var g=d3.area().x(function(t){return u(t.data.name)}).y0(function(t){return a(t[0])}).y1(function(t){return a(t[1])}).curve(d3.curveBasis);t.data(r).areaFunc(g).xScale(u).yScale(a).fontSize(e._textLabel.fontSize).fontColor(e._textLabel.color).fontFamily(e._textLabel.fontFamily).labelShow(e._labelShow).onMouseover(function(e){var t=e.key,i=[{text:t,color:f[t]}];l.data(i).update().show(),d3.select(this).style("stroke","#000"),d3.select(this.parentNode).selectAll("path").filter(function(t){return t!=e}).style("fill-opacity",.3)}).onMousemove(function(t){l.move()}).onMouseout(function(){d3.select(this).style("stroke","none"),d3.select(this.parentNode).selectAll("path").style("fill-opacity",1),l.hide()}),i.width(c).height(_).xTickLocations(e.xAxis.tickLocations).showX(!1).showY(e._gridShowY).stroke(e._gridStroke).strokeDasharray(e._gridStrokeDasharray),s.y1(0).y2(_).strokeDasharray(e._gridStrokeDasharray),n.data(u.domain()).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var i=t,n=[{text:i}],o=r.dataForStack[e];for(var a in o)"name"!==a&&!1!==r.states[a]&&n.push({color:r.colorMap[a],text:a+"："+o[a]});l.data(n).update(),s.x(u(i)).update(),l.show(),s.show()}).onMousemove(function(){l.move()}).onMouseout(function(){l.hide(),s.hide()}),o.width(c).height(_).transition(e._transition).duration(e._duration),e.coreGroup.attr("clip-path","url(#"+o.id+")"),i.update(),n.update(),o.update(),t.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy,e=n.colorMap,o=[];for(var i in e)o.push({name:i,color:e[i]});t.legend.data(o).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),o.forEach(function(t){t.name===e.name&&(t.active=!i)}),n.states[e.name]=!i,t.onDataChange()})}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.xScale,n=t.widthOfNoMargin,o=t.heightOfMainGroup;i.domain(t._xDomain).range([0,n]),e.scaleFunc(i).allowedMaxTextHeight(.3*o).type(t._xType).orient(t._xOrient).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(t._fontSize).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),e.compute(),e.translate(0,o-e.height).update()}},{key:"computeDomain",value:function(){this.xDomain(this.activeData.dataForStack.map(function(t){return t.name}))}},{key:"sortData",value:function(){var t=this._data,e={};t.keys.forEach(function(t){return e[t]=!0}),t.states||(t.states=e),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Ne(t,e);return i.dataSolveFunc(je),i}},{key:"activeData",get:function(){var e=this.sortedDataCopy,t=e.keys.filter(function(t){return!1!==e.states[t]}),i=d3.stack().keys(t).order(d3.stackOrderNone).offset(d3.stackOffsetWiggle)(e.dataForStack);return{states:e.states,keys:t,stackData:i,colorMap:e.colorMap,dataForStack:e.dataForStack}}}]),i}(),Be=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","radar"),e._radius=200,e._donutCount=5,e._fillOpacity=.35,e._borderWidth=2,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._endPointRadius=3.5,e._tickTextColor="#333",e._tickTextSize=10,e}return h(i,M),s(i,[{key:"update",value:function(){var o=this,t=o._data,e=o.group;if(t.length){var a=o._radius,i=o._donutCount,n=(o._fontSize,t[0].data.map(function(t){return t.name})),r=n.length,l=d3.max(t,function(t){return 1.05*d3.max(t.data,function(t){return parseFloat(t.value)})});if(l<=1)l=1;else{var s=.5*Math.pow(10,Math.floor(Math.log10(l)));l=Math.ceil(l/s)*s}for(var u=d3.range(i+1).map(function(t){return l/i*t}),h=[],c=0;c<r;c++){for(var _=[],d=0;d<t.length;d++)_.push(t[d].data[c].value);h.push(d3.max(_))}var f=d3.scaleLinear().domain([0,l]).range([0,a]),p=d3.scaleLinear().domain([0,r]).range([0,2*Math.PI]),y=d3.areaRadial().angle(function(t,e){return p(e)}).outerRadius(function(t){return f(t.value)}).curve(d3.curveCardinalClosed),g=e.selectAll(".tick-text").data(u);g.exit().remove(),g.enter().append("text").attr("class","tick-text").merge(g).attr("y",function(t,e){return-a/i*e}).attr("dy","0.35em").style("font-size",o._tickTextSize).style("text-anchor","middle").style("fill",o._tickTextColor).text(function(t){return-1==String(t).indexOf(".")?t:t.toFixed(1)}).style("text-anchor","middle");var v=e.selectAll(".radar-group").data(t,function(t){return t.key});v.exit().remove();var m=v.enter().append("g").attr("class","radar-group");m.append("path").attr("class","radar-area"),m.append("g").attr("class","radar-points"),m.append("g").attr("class","radar-area-texts");var x=m.merge(v).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout);x.select(".radar-area").attr("d",function(t){return y(t.data)}).style("fill",function(t){return t.color}).style("fill-opacity",o._fillOpacity).style("stroke",function(t){return t.color}).style("stroke-width",o._borderWidth);var S=x.select(".radar-points").selectAll("circle").data(function(e){return e.data.map(function(t){return t.color=e.color,t})});S.exit().remove(),S.enter().append("circle").merge(S).attr("r",o._endPointRadius).attr("cx",function(t,e){return f(t.value)*Math.cos(p(e)-Math.PI/2)}).attr("cy",function(t,e){return f(t.value)*Math.sin(p(e)-Math.PI/2)}).style("fill",function(t){return t.color}),e.selectAll(".radar-area-texts").remove();var k=e.append("g").selectAll("g").attr("class","radar-area-groups").data(t);k.exit().remove(),k.enter().append("g").merge(k).each(function(t,e){var i=d3.select(this).selectAll("text").data(function(t){return t.data.map(function(t){return t})});i.exit().remove(),i.enter().append("text").attr("class","radar-area-texts").merge(i).text(function(t){return t.value}).attr("x",function(t,e){return t.value==h[e]?(f(t.value)+.05*a)*Math.cos(p(e)-Math.PI/2):(f(t.value)-.05*a)*Math.cos(p(e)-Math.PI/2)}).attr("y",function(t,e){return t.value==h[e]?(f(t.value)+.05*a)*Math.sin(p(e)-Math.PI/2):(f(t.value)-.05*a)*Math.sin(p(e)-Math.PI/2)}).attr("text-anchor",function(t,e){return 0==p(e)||p(e)==Math.PI?"middle":p(e)>Math.PI&&t.value!=h[e]?"start":p(e)>Math.PI&&t.value==h[e]||0<p(e)&&p(e)<Math.PI&&t.value!=h[e]?"end":void 0}).attr("dy",function(t,e){if(t.value==h[e])if(t.value==d3.max(h)){if(p(e)<Math.PI/2||p(e)>1.5*Math.PI)return"1.3em";if(p(e)>Math.PI/2&&p(e)<1.5*Math.PI)return"-1.3em";if(p(e)==Math.PI/2||p(e)==1.5*Math.PI)return"1.1em"}else{if(0==p(e))return"0.3em";if(p(e)==Math.PI)return"-0.3em";if(p(e)<Math.PI/2||p(e)>1.5*Math.PI)return"1.3em";if(p(e)>Math.PI/2&&p(e)<1.5*Math.PI)return"-1.3em";if(p(e)==Math.PI/2||p(e)==1.5*Math.PI)return"1.1em"}else if(t.value!=h[e])return 0==p(e)||p(e)>Math.PI&&p(e)<1.5*Math.PI?0:"0.4em"}).style("font-size",o._fontSize).style("font-family",o._fontFamily).style("fill",o._fontColor).style("display",o._labelShow?"block":"none")});var b=e.selectAll(".radar-text").data(n);b.exit().remove(),b.enter().append("text").attr("class","radar-text").merge(b).attr("dy",function(t,e){return p(e)==Math.PI?10:"0.1em"}).each(function(t,e){var i=p(e),n=a+parseFloat(o._themeFontSize)/2+8;d3.select(this).attr("x",function(){return n*Math.cos(i-Math.PI/2)}).attr("y",function(){return n*Math.sin(i-Math.PI/2)}).style("text-anchor",function(){return i%Math.PI?i<Math.PI?"start":"end":"middle"})}).style("font-size",o._themeFontSize).style("font-family",o._themeFontFamily).style("fill",o._themeFontColor).text(function(t,e){return t=="&-"+(e+1)?"":t});for(var w=e.selectAll(".radar-area-texts"),O=[],C=[],F=0;F<w._groups[0].length;F++){C.push(F);for(var P=F+1;P<w._groups[0].length;P++){rt(at(d3.select(w._groups[0][F])),at(d3.select(w._groups[0][P])))&&(O.push(F),d3.select(w._groups[0][F]).style("opacity","0"))}}for(var z=new Set(O),A=Array.from(z),L=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(A,C),M=0;M<A.length;M++){for(var D=[],W=0;W<L.length;W++){var T=at(d3.select(w._groups[0][A[M]])),R=at(d3.select(w._groups[0][L[W]]));if(D.push(rt(T,R)),rt(T,R)){if(A[M]==L[W])continue;d3.select(w._groups[0][A[M]]).style("opacity","0")}}0==D.filter(function(t){return 1==t}).length&&L.push(A[M])}for(var N=0;N<L.length;N++)d3.select(w._groups[0][L[N]]).style("opacity","1");return o}e.selectAll("*").remove()}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"themeFontColor",value:function(t){return arguments.length?(this._themeFontColor=t,this):this._themeFontColor}},{key:"themeFontSize",value:function(t){return arguments.length?(this._themeFontSize=t,this):this._themeFontSize}},{key:"themeFontFamily",value:function(t){return arguments.length?(this._themeFontFamily=t,this):this._themeFontFamily}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=t,this):this._donutCount}},{key:"tickTextColor",value:function(t){return arguments.length?(this._tickTextColor=t,this):this._tickTextColor}},{key:"tickTextSize",value:function(t){return arguments.length?(this._tickTextSize=t,this):this._tickTextSize}}]),i}(),Ee=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","radar-chart"),e.grid=new K(e.mainGroup),e.radar=new Be(e.mainGroup),e._sortValue=null,e._donutCount=5,e._fillOpacity=0,e._endPointRadius=3.5,e._borderWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,J),s(i,[{key:"updateCore",value:function(){var t=this,e=t.activeData,i=t.radar,n=t.grid,o=t.tooltip,a=(t._fontSize,t.widthOfNoMargin),r=t.heightOfMainGroup,l=Math.min(.82*a,.82*r)/2;i.data(e).radius(l).borderWidth(t._borderWidth).endPointRadius(t._endPointRadius).labelShow(t._labelShow).donutCount(t._donutCount).fillOpacity(.6).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).themeFontSize(t._fontSize).themeFontColor(t._fontColor).themeFontFamily(t._fontFamily).tickTextColor(t._fontColor).translate(a/2,r/2).onMouseover(function(t,e){d3.select(this.parentNode).selectAll(".radar-area").transition().style("fill-opacity",.5),d3.select(this).select(".radar-area").transition().style("fill-opacity",.75);var i=[{color:t.color,text:t.name=="$-"+(e+1)?"":t.name}];t.data.forEach(function(t,e){i.push({text:(t.name=="&-"+(e+1)?"":t.name)+"："+t.value})}),o.data(i).update().show()}).onMousemove(function(){o.move()}).onMouseout(function(){d3.select(this.parentNode).transition().selectAll(".radar-area").style("fill-opacity",.6),o.hide()}),n.radius(l).donutCount(t._donutCount).sectorCount(e[0]?e[0].data.length:1).translate(a/2,r/2).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray).showX(t._gridShowX).showY(t._gridShowY),i.update(),n.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.fillOpacity(e.fillOpacity).endPointRadius(e.endPointRadius).borderWidth(e.borderWidth)}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}}]),i}(),He=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=function(t){var e=[],i={};t.forEach(function(t){t.children.forEach(function(t){var e=t.name;i[e]?i[e]++:i[e]=0})});var n=0;for(var o in i)e.push({name:o,count:i[o],index:n}),n++;return e.sort(function(t,e){return e.count-t.count||t.index-e.index}),e.slice(0,2).map(function(t){return t.name})}(t.nodes),i=this.generateColorList(e.length),n={};return e.forEach(function(t,e){return n[t]=i[e]}),t.colorMap=n,t.keys=e,t}}]),i}();var Ve=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","pyramid"),e._xScale=null,e._yScale=null,e._stroke="#fff",e}return h(i,M),s(i,[{key:"update",value:function(){for(var n=this,o=n.group,t=n._data,a=[],r=[],e=0;e<t.nodes.length;e++)null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?(r.push(0),a.push(0)):1==n._labelShow&&0==n._positionOptions.indexOf(n._positionChoice)?(a.push(E(t.nodes[e].children[0].value,n._fontSize,n._fontFamily)),r.push(E(t.nodes[e].children[1].value,n._fontSize,n._fontFamily))):(r.push(0),a.push(0));var i,l=t.nodes,s=t.colorMap,u=t.keys,h=n._xScale,c=n._yScale,_=Math.abs(h.range()[1]-h.range()[0]),d=_/2,f=c.bandwidth(),p=u[0],y=s[p],g=u[1],v=s[g],m=[],x=[];l.forEach(function(t){var e=t.children.filter(function(t){return t.name===p})[0],i=t.children.filter(function(t){return t.name===g})[0];m.push({name:t.name,key:t.key,color:y,value:e&&Math.abs(e.value)||0}),x.push({name:t.name,key:t.key,color:v,value:i&&Math.abs(i.value)||0})}),function(){var t=o.select(".left-group").empty()?o.append("g").attr("class","left-group"):o.select(".left-group");t.selectAll("text").remove();var e=t.selectAll("rect").data(m,function(t){return t.key});e.exit().remove();e.enter().append("rect").merge(e).attr("x",function(t){return h(-t.value)-(0==r.length?0:d3.max(r))}).attr("y",function(t){return c(t.name)}).attr("width",function(t){return d-h(-t.value)+(0==r.length?0:d3.max(r))}).attr("height",f).style("fill",y).style("stroke",n._stroke);var i=t.selectAll("text").data(m,function(t){return t.key});i.exit().remove(),i.enter().append("text").attr("class","pyramid-left-texts").merge(i).text(function(t){return 0==t.value?"":t.value}).attr("x",function(t){return h(-t.value)-(0==r.length?0:d3.max(r))}).attr("y",function(t){return c(t.name)}).attr("dy",f/2+n._fontSize/3).attr("dx",function(t,e){return null==n._positionOptions||null==n._positionChoice?0:0==n._positionOptions.indexOf(n._positionChoice)?(d3.selectAll(".pyramid-left-texts").attr("text-anchor","end"),.3*-n._fontSize):1==n._positionOptions.indexOf(n._positionChoice)?(d3.selectAll(".pyramid-left-texts").attr("text-anchor","end"),d-h(-t.value)-.3*n._fontSize):void 0}).attr("fill",n._fontColor).attr("font-size",n._fontSize).style("font-family",n._fontFamily).style("display",n._labelShow?"block":"none")}(),function(){var t=o.select(".right-group").empty()?o.append("g").attr("class","right-group"):o.select(".right-group");t.selectAll("text").remove();var e=t.selectAll("rect").data(x,function(t){return t.key});e.exit().remove();e.enter().append("rect").merge(e).attr("x",d).attr("y",function(t){return c(t.name)}).attr("width",function(t){return h(t.value)-d-(0==a.length?0:d3.max(a))}).attr("height",f).style("fill",v).style("stroke",n._stroke);var i=t.selectAll("text").data(x,function(t){return t.key});i.exit().remove(),i.enter().append("text").attr("class","pyramid-right-texts").merge(i).text(function(t){return 0==t.value?"":t.value}).attr("x",d-(0==a.length?0:d3.max(a))).attr("y",function(t){return c(t.name)}).attr("dy",f/2+n._fontSize/3).attr("dx",function(t,e){return null==n._positionOptions||null==n._positionChoice?0:0==n._positionOptions.indexOf(n._positionChoice)?h(t.value)-d+.3*n._fontSize:1==n._positionOptions.indexOf(n._positionChoice)?.3*n._fontSize:void 0}).attr("fill",n._fontColor).attr("font-size",n._fontSize).style("font-family",n._fontFamily).style("display",n._labelShow?"block":"none")}(),(i=(o.select(".overlay-group").empty()?o.append("g").attr("class","overlay-group"):o.select(".overlay-group")).selectAll("rect").data(l,function(t){return t.key})).exit().remove(),i.enter().append("rect").merge(i).attr("x",0).attr("y",function(t){return c(t.name)}).attr("width",_).attr("height",f).style("fill","#fff").style("stroke","none").style("fill-opacity",0).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout);for(var S=o.selectAll(".pyramid text"),k=[],b=[],w=0;w<S._groups[0].length;w++){b.push(w);for(var O=w+1;O<S._groups[0].length;O++){rt(at(d3.select(S._groups[0][w])),at(d3.select(S._groups[0][O])))&&(k.push(w),d3.select(S._groups[0][w]).style("opacity","0"))}}for(var C=new Set(k),F=Array.from(C),P=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(F,b),z=0;z<F.length;z++){for(var A=[],L=0;L<P.length;L++){var M=at(d3.select(S._groups[0][F[z]])),D=at(d3.select(S._groups[0][P[L]]));if(A.push(rt(M,D)),rt(M,D)){if(F[z]==P[L])continue;d3.select(S._groups[0][F[z]]).style("opacity","0")}}0==A.filter(function(t){return 1==t}).length&&P.push(F[z])}for(var W=0;W<P.length;W++)d3.select(S._groups[0][P[W]]).style("opacity","1");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}}]),i}(),Ie=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","pyramid-chart"),e.grid=new zt(e.coreGroup),e.core=new Ve(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._marginLeft=15,e._marginRight=20,e._xType="number",e._yType="category",e._yTitle="y",e._xTitle="x",e._labelShow=!1,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var e=this,t=e.core,i=e.tooltip,n=e.grid,o=e.activeData,a=o.colorMap,r=e.widthOfCore,l=e.heightOfCore,s=[],u=[],h=0;h<e.activeData.nodes.length;h++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(u.push(0),s.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?(s.push(E(e.activeData.nodes[h].children[0].value,e._textLabel.fontSize,e._textLabel.fontFamily)),u.push(E(e.activeData.nodes[h].children[1].value,e._textLabel.fontSize,e._textLabel.fontFamily))):(u.push(0),s.push(0));t.data(o).xScale(e.xScale).yScale(e.yScale).fontSize(e._textLabel.fontSize).fontColor(e._textLabel.color).fontFamily(e._textLabel.fontFamily).labelShow(e._labelShow).positionOptions(e._positionOptions).positionChoice(e._positionChoice).onMouseover(function(t){d3.select(this).style("fill-opacity",.8);var e=[{text:t.name}];t.children.forEach(function(t){t.name in a&&e.push({color:a[t.name],text:t.name+"："+t.value})}),i.data(e).update().show()}).onMousemove(function(){i.move()}).onMouseout(function(){d3.select(this).style("fill-opacity",0),i.hide()}),n.width(r-(0==u.length?0:d3.max(u))-(0==s.length?0:d3.max(s))).height(l).xTickLocations(e.xAxis.tickLocations.slice().map(function(t){return t-(0==u.length?0:d3.max(u))})).yTickLocations(e.yAxis.tickLocations.slice().map(function(t){return t+e.yScale.bandwidth()/2})).showX(e._gridShowX).showY(e._gridShowY).stroke(e._gridStroke).strokeDasharray(e._gridStrokeDasharray),e.coreGroup.call(B,e.yAxis.width+.5+(0==u.length?0:d3.max(u)),0),n.update(),t.update()}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).xRange(t._xRange).transition(t._transition).duration(t._duration),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).yRange(t._yRange).transition(t._transition).duration(t._duration);i.titleHeight;var _=(c-e.allowedMaxTextHeight())/u;e.tickCount(_);for(var d=[],f=[],p=0;p<t.activeData.nodes.length;p++)null==t._labelShow||null==t._positionOptions||null==t._positionChoice||-1==t._positionOptions.indexOf(t._positionChoice)?(f.push(0),d.push(0)):1==t._labelShow&&0==t._positionOptions.indexOf(t._positionChoice)?(d.push(E(t.activeData.nodes[p].children[0].value,t._textLabel.fontSize,t._textLabel.fontFamily)),f.push(E(t.activeData.nodes[p].children[1].value,t._textLabel.fontSize,t._textLabel.fontFamily))):(f.push(0),d.push(0));i.compute(),n.nice().range([0==f.length?0:d3.max(f),h-i.width-(0==d.length?0:d3.max(d))]),e.compute(),o.range([c-e.height,0]);var y=i.width,g=c-e.height,v=i.width;e.translate(y,g).update(),i.translate(v,0).update()}},{key:"configLegend",value:function(){var t=this._sortedDataCopy,e=[];for(var i in t.colorMap)e.push({name:i,color:t.colorMap[i]});this.legend.data(e)}},{key:"computeDomain",value:function(){var t=this._data.nodes,e=0<t.length?d3.max(t,function(t){return d3.max(t.children,function(t){return Math.abs(t.value)})}).toFixed(0):1;this._xDomain=[-e,e],this._yDomain=t.length?t.map(function(t){return t.name}):[0,1],this.xAxis.tickFormat(function(t){return Math.abs(t)})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new He(t,e);return i.dataSolveFunc(ge),i}},{key:"activeData",get:function(){return this._sortedDataCopy}}]),i}();function Ze(t,e){t.on("mouseover",e._onMouseover).on("mousemove",e._onMousemove).on("mouseout",e._onMouseout)}var Qe=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bar-plot"),e._xScale=null,e._yScale=null,e._fill=null,e._stroke="#fff",e._strokeWidth=1,e._showZeroLine=!0,e._zeroLineStroke="#000",e._fontColor="#000",e._fontSize=13,e._cornerRadius=0,e}return h(i,M),s(i,[{key:"update",value:function(){for(var e=this,t=e._data,i=e._xScale,n=e._yScale.clamp(!0),o=i.bandwidth(),a=n.domain(),r=a.every(function(t){return 0<=t})?"up":a.every(function(t){return t<=0})?"down":"both",l=n.range()[0],s=e._transition?e._duration:0,u=[],h=0;h<t.length;h++)u.push(t[h].value);var c=et(u,e._fontSize,e._fontFamily),_=e.group,d=_.selectAll(".rect").data(t);d.exit().transition().duration(s).remove();var f=d.enter().append("path").attr("class","rect").merge(d).style("fill",function(t){return e._fill||t.color}).style("stroke-width",e._strokeWidth).style("stroke",e._stroke).call(Ze,e),p=_.selectAll("text").data(t);p.exit().transition().duration(s).remove();var y=p.enter().append("text").attr("class","simple-bar-texts").merge(p).text(function(t){return t.value}).attr("fill",e._fontColor).attr("font-size",e._fontSize).style("display",e._labelShow?"block":"none");if("up"===r)f.attr("d",function(t){return tt({x:i(t.name),y:n(t.value),width:o,height:Math.abs(l-n(t.value)),cornerRadius:e._cornerRadius})}),y.attr("x",function(t){return i(t.name)}).attr("y",function(t){return n(t.value)}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(l-n(t.value))-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?y.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?y.attr("transform",function(t){return"rotate(-90 "+(i(t.name)+o/2||0)+" "+(n(t.value)+Math.abs(l-n(t.value))-.7*e._fontSize)+" )"}).attr("text-anchor","start"):y.attr("transform","rotate(0)");else if("down"===r)f.attr("d",function(t){return tt({x:i(t.name),y:0,width:o,height:n(t.value),cornerRadius:e._cornerRadius})}),y.attr("x",function(t){return i(t.name)}).attr("y",0).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?n(t.value)-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?y.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?y.attr("transform",function(t){return"rotate(-90 "+(i(t.name)+o/2||0)+" "+(n(t.value)-.7*e._fontSize)+" )"}).attr("text-anchor","start"):y.attr("transform","rotate(0)");else{var g=Math.round(n(0));f.attr("d",function(t){return tt({x:i(t.name),y:0<=t.value?n(t.value):g,width:o,height:Math.abs(g-n(t.value)),cornerRadius:e._cornerRadius})}),y.attr("x",function(t){return i(t.name)}).attr("y",function(t){return 0<=t.value?n(t.value):g}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(g-n(t.value))-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?y.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?y.attr("transform",function(t){return"rotate(-90 "+(i(t.name)+o/2||0)+" "+((0<=t.value?n(t.value):g)+Math.abs(g-n(t.value))-.7*e._fontSize)+" )"}).attr("text-anchor","start"):y.attr("transform","rotate(0)"),(_.select(".zero-line").empty()?_.append("line").attr("class","zero-line"):_.select(".zero-line")).attr("x1",i.range()[0]).attr("y1",g).attr("x2",i.range()[1]).attr("y2",g).style("stroke",e._showZeroLine?e._zeroLineStroke:"none")}if(null==e._positionOptions||null==e._positionChoice)y.style("display","none");else if(0==e._positionOptions.indexOf(e._positionChoice)){for(var v=_.selectAll(".simple-bar-texts"),m=[],x=[],S=0;S<v._groups[0].length;S++){x.push(S);for(var k=S+1;k<v._groups[0].length;k++){rt(at(d3.select(v._groups[0][S])),at(d3.select(v._groups[0][k])))&&(m.push(S),d3.select(v._groups[0][S]).style("opacity","0"))}}for(var b=new Set(m),w=Array.from(b),O=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(w,x),C=0;C<w.length;C++){for(var F=[],P=0;P<O.length;P++){var z=at(d3.select(v._groups[0][w[C]])),A=at(d3.select(v._groups[0][O[P]]));if(F.push(rt(z,A)),rt(z,A)){if(w[C]==O[P])continue;d3.select(v._groups[0][w[C]]).style("opacity","0")}}0==F.filter(function(t){return 1==t}).length&&O.push(w[C])}for(var L=0;L<O.length;L++)d3.select(v._groups[0][O[L]]).style("opacity","1")}return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}}]),i}(),qe=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("rect").attr("class","overlay-rect"),e._width=0,e._height=0,e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return h(i,o),s(i,[{key:"update",value:function(){return this.elem.attr("x",0).attr("y",0).attr("width",this._width<0?0:this._width).attr("height",this._height).style("fill","#000").style("opacity",0).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),this}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),Ue=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","multiple-bar"),e.overlay=new qe(e.group),e._width=400,e._height=400,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._zeroLineStroke="#000",e._gapPadding=5,e._allowedMaxTextWidth=100,e._xScale=d3.scaleBand(),e._yScale=d3.scaleLinear(),e._mainLeft=0,e._mainWidth=0,e}return h(i,M),s(i,[{key:"update",value:function(){var t,a=this,e=a._data,i=a._width,n=a._height,r=a._fontSize,l=a._fontFamily,s=a._gapPadding,u=n/e.length,o=d3.max(e,function(t){return d3.max(t.data,function(t){return Math.abs(t.value)})}),h=d3.max(e,function(t){return E(t.name,r,l)}),c=h>a._allowedMaxTextWidth,_=0<e.length?Math.min(h,a._allowedMaxTextWidth):0+a._gapPadding,d=1.25*r+a._gapPadding,f=i-_-d,p=a._xScale.domain(0<e.length?e[0].data.map(function(t){return t.name}):[]).range([0,f]),y=a._yScale.domain([-o,o]).range([u,0]);return(t=a.group.selectAll(".bar-plot-group").data(e,function(t){return t.key})).exit().remove(),t.enter().append("g").attr("class","bar-plot-group").merge(t).style("font-size",r+"px").style("font-family",l).each(function(t){var e=d3.select(this),i=e.property("bar-plot")||new Qe(e);e.property("bar-plot",i);var n=e.select(".left-text").empty()?e.append("text").attr("class","left-text"):e.select(".left-text"),o=e.select(".right-text").empty()?e.append("text").attr("class","right-text"):e.select(".right-text");n.attr("x",-s).attr("y",u/2).attr("dy","0.35em").style("text-anchor","end").style("fill",a._fontColor).text(function(t){return c?H(t.name,_,r,l):t.name}).attr("font-size",a._fontSize).attr("font-family",a._fontFamily),o.attr("x",f+s).attr("y",u/2).attr("dy","0.35em").style("text-anchor","start").style("fill",a._fontColor).text("0").attr("font-size",a._fontSize).attr("font-family",a._fontFamily),i.data(t.data).xScale(p).yScale(y).fill(t.color).showZeroLine(a._showZeroLine).zeroLineStroke(a._zeroLineStroke).transition(a._transition).duration(a._duration),i.update()}).attr("transform",function(t,e){return"translate("+_+", "+u*e+")"}),a.overlay.elem.raise(),a.overlay.width(f).height(n).translate(_,0).onMouseover(a._onMouseover).onMousemove(a._onMousemove).onMouseout(a._onMouseout).update(),a._mainLeft=_,a._mainWidth=f,a}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"xScale",get:function(){return this._xScale}},{key:"yScale",get:function(){return this._yScale}},{key:"mainLeft",get:function(){return this._mainLeft}},{key:"mainWidth",get:function(){return this._mainWidth}}]),i}(),Ke="axis-group",Je="x-title",$e=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-x"),e._orient="bottom",e._type="category",e._allowedMaxTextHeight=30,e._tickTextRotate=0,e._tickTextHeight=0,e}return h(i,ft),s(i,[{key:"update",value:function(){var i=this,n=i._orient,t=i._scaleFunc,e=i.group,o=i._fontSize,a=i._tickTextRotate,r=i._tickValueTexts,l=void 0;(l=i.axisFunc="top"===n?d3.axisTop(t):d3.axisBottom(t)).tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding);var s=e.select("."+Ke).empty()?e.append("g").attr("class",Ke):e.select("."+Ke);s.style("font-size",o+"px").style("font-family",i._fontFamily).transition().duration(i._transition?i._duration:0).call(l).on("start",function(t,e){s.selectAll(".tick text").style("fill",i._fontColor).attr("dx",0).attr("dy","0.71em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+i._tickTextRotate+")").filter(function(){return"top"!==n}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",i._lineStroke),s.select("path").style("stroke",i._lineStroke).style("display",i._axisLineShow?"block":"none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var h=e.select("."+Je).empty()?e.append("g").attr("class",Je):e.select("."+Je),c=h.select("text").empty()?h.append("text"):h.select("text");h.call(B,u/2,i.height),c.attr("dy","0.5em").attr("text-anchor","middle").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dy","-0.5em").text(i._title)}else e.select("."+Je).remove()}},{key:"compute",value:function(){var e=this,i=[],n=[],o=0,a=0;function r(){e._tickTextRotate=o,e._tickValues=i,e._tickValueTexts=n,e._tickTextHeight=a}var t=e._scaleFunc,l=e._type,s=e._fontSize,u=(e._minTickDistance,e._allowedMaxTextHeight),h=Math.abs(t.range()[0]-t.range()[1]),c=void 0,_=void 0;if(i="category"===l?t.domain():t.ticks(e._tickCount),"number"===l&&0!=t.domain()[0]&&i.push(t.domain()[0]),function(){var t=!1;c=h/i.length,(_=d3.max(i,function(t){return E(t,s,e._fontFamily)}))<c&&(o=0,n=i,a=1.125*s,r(),t=!0);return t}())return e;o="top"===e._orient?45:-45;var d=Math.abs(Math.sin(Math.PI/4));_*d<u?(a=_*d,n=i):(a=u,n=i.map(function(t){return H(t,a/d,s,e._fontFamily)}));Math.abs(Math.cos(Math.PI/4));var f=h/i.length;if("category"===l&&f<2*s){var p=Math.ceil(2*s/f);i=i.filter(function(t,e){return e%p==0})}return r(),e}},{key:"allowedMaxTextHeight",value:function(t){return arguments.length?(this._allowedMaxTextHeight=t,this):this._allowedMaxTextHeight}},{key:"height",get:function(){var t=0;return this.isShow&&(t=(this._tickShow?this._tickSize+this._tickPadding+1.2*this._tickTextHeight:0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),t}}]),i}(),ti=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","multiple-bar-chart"),e.core=new Ue(e.coreGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.xAxis=new $e(e.mainGroup),e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var t=this,a=t.activeData,r=t.core,l=t.tooltip,e=t.overlay,s=t.guideLine,i=t.widthOfCore,n=t.heightOfCore,u=r.xScale;s.y1(0).y2(n),r.data(a).width(i).height(n).fontSize(t._fontSize).fontColor(t._fontColor).fontFamily(t._fontFamily).zeroLineStroke(t._axisLineStroke).showZeroLine(t._xTickShow).allowedMaxTextWidth(i/5).update(),e.data(u.domain()).bandWidth(u.step()).bandHeight(n).isScalePoint(!1).translate(r.mainLeft,0).onMouseover(function(t,e){var n=t,i=u.step(),o=[{text:n}];a.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});o.push({text:t.name+": "+i[0].value,color:t.color})}),l.data(o).update(),s.x(u(n)+r.mainLeft+i/2).update(),l.show(),s.show()}).onMousemove(function(){l.move()}).onMouseout(function(){l.hide(),s.hide()}),e.update()}},{key:"updateAxis",value:function(){var t=this.xAxis;t.scaleFunc(d3.scaleLinear().range([0,this.widthOfNoMargin])).title(this._xTitle).fontSize(this._fontSize).fontColor(this._fontColor).fontFamily(this._fontFamily).transition(!1).axisLineShow(!1).tickShow(!1),t.translate(0,this.heightOfMainGroup-t.height).update()}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}}]),i}(),ei=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bubble-plot"),e._radius=function(){},e._cx=function(){},e._cy=function(){},e._fill=null,e._stroke=null,e._strokeWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e.group,n=e._transition?e._duration:0,o=i.selectAll("circle").data(t,function(t){return t.key});return o.exit().transition().duration(n).attr("r",0).remove(),o.enter().append("circle").merge(o).attr("cx",e._cx).attr("cy",e._cy).style("fill",function(t){return e._fill||t.color}).style("fill-opacity",.4).style("stroke",function(t){return t.color}).style("stroke-width",e._strokeWidth).on("mouseover",e._onMouseover).on("mousemove",e._onMousemove).on("mouseout",e._onMouseout).transition().duration(n).attr("r",e._radius),e}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"cx",value:function(t){return arguments.length?(this._cx=t,this):this._cx}},{key:"cy",value:function(t){return arguments.length?(this._cy=t,this):this._cy}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}(),ii=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.categories,n=this.generateColorList(e.length),o={},a=[];return e.forEach(function(t,e){var i=n[e];o[t]=i,a.push({name:t,color:i})}),t.nodes.forEach(function(t){return t.color=o[t.category]}),t.legendData=a,t}}]),i}();function ni(t,e){var s=0,u=1,h=2,c=3,_=4;if(e.forEach(function(t){"typeCol"===t.function?s=t.index:"objCol"===t.function?u=t.index:"X轴"===t.name?h=t.index:"Y轴"===t.name?c=t.index:"半径"===t.name&&(_=t.index)}),W(t,[s,u,h,c,_])||!m(t,h)||!m(t,c)||!m(t,_))return{categories:[],nodes:[],labels:[]};var d=[],f=[],p={};t.slice(1).forEach(function(t,e){var i=t[s],n=t[u],o=t[h],a=t[c],r=t[_],l=i+"-"+n+"-"+e;p[i]||(p[i]=i,d.push(i)),f.push({category:i,name:n,x:o,y:a,radius:r,key:l})});var i=t[0],n={category:i[s],name:i[u],x:i[h],y:i[c],radius:i[_]};return{categories:d,nodes:f,labels:n}}var oi="axis-group",ai="y-title",ri=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-horizontal"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=6,e}return h(i,ft),s(i,[{key:"update",value:function(){var e=this,t=this,i=t._orient,n=t._scaleFunc,o=t.group,a=t._fontSize,r=t._tickValueTexts,l=void 0;l=t.axisFunc="right"===i?d3.axisRight(n):d3.axisLeft(n);var s=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(s=d3.format("d")),l.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(s);var u=o.select("."+oi).empty()?o.append("g").attr("class",oi):o.select("."+oi);u.transition().duration(t._transition?t._duration:0).call(l).on("start",function(){u.selectAll(".tick text").style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return r[e]}),u.selectAll(".tick line").style("stroke",t._lineStroke),u.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none")});var h=t.group.selectAll(".axis-y-horizontal .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)||"&-"==String(t.__data__).slice(0,2)});d3.selectAll(h).remove();var c=Math.abs(n.range()[0]-n.range()[1]);if(t._titleShow&&t._title){var _=o.select("."+ai).empty()?o.append("g").attr("class",ai):o.select("."+ai),d=_.select("text").empty()?_.append("text"):_.select("text"),f=(E(t._title,a,t._fontFamily),d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(null==t?"":t,e._fontSize,e._fontFamily)}));_.call(B,-(this._tickShow?(f?this._tickSize+this._tickPadding:5)+this._tickTextWidth:0),c/2),d.attr("y",-5).style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else o.select("."+ai).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=e._yRange.length&&t.push(-1==String(e._yRange[0]).indexOf(".")?e._yRange[0]:e._yRange[0].toFixed(0));var s=d3.max(t.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(null==t?"":t,r,e._fontFamily)})||0;return s<=l?(i=t,n=s):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var e=this,t=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(null==t?"":t,e._fontSize,e._fontFamily)}),i=0;return this.isShow&&(i=this._tickShow?(t?this._tickSize+this._tickPadding:0)+this._tickTextWidth+(this._title?1.125*this._fontSize+24:0):this._titleShow&&this._title?1.125*this._fontSize+24:0),i}}]),i}(),li=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouping-bubble-chart"),e.clipArea=new Ot(e.defs),e.grid=new zt(e.coreGroup),e.core=new ei(e.coreGroup),e.xAxis=new gt(e.mainGroup).tickFormat(function(t){return t}),e.yAxis=new ri(e.mainGroup),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleLinear(),e._xType="number",e._yType="number",e._sortValue=-1,e._maxRadius=15,e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var t=this,e=t.core,i=t.tooltip,n=t.grid,o=t.clipArea,a=t.activeData,r=a.nodes,l=a.labels,s=t.widthOfCore,u=t.heightOfCore,h=t.xScale,c=t.yScale,_=t._maxRadius,d=d3.max(r,function(t){return Math.abs(t.radius)}),f=d3.scaleSqrt().domain([0,d]).range([0,_]);e.data(r).cx(function(t){return h(t.x)}).cy(function(t){return c(t.y)}).radius(function(t){return f(Math.abs(t.radius))}).stroke("#fff").transition(t._transition).duration(t._duration).onMouseover(function(t){d3.select(this).style("stroke","#000");var e=[{color:t.color,text:l.category+"："+t.category},{text:l.name+"："+t.name},{text:l.x+"："+t.x},{text:l.y+"："+t.y},{text:l.radius+"："+t.radius}];i.data(e).update().show()}).onMousemove(function(){i.move()}).onMouseout(function(){d3.select(this).style("stroke","#fff"),i.hide()}),n.width(s).height(u).xTickLocations(t.xAxis.tickLocations).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),t.coreGroup.call(B,t.yAxis.width+.5,0),0!=t._clipShow.length?o.width(s).height(u).paddingVertical([0,0]).transition(t._transition).duration(t._duration):o.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+o.id+")"),o.update(),e.update(),n.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy,o=n.legendData;t.legend.data(o).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),o.forEach(function(t){t.name===e.name&&(t.active=!i)}),n.nodes.forEach(function(t){t.category===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData.nodes,e=this._xDomain||[],i=this._yDomain||[],n=d3.extent(t,function(t){return t.x}),o=d3.extent(t,function(t){return t.y}),a=isNaN(parseFloat(e[0]))?Math.min(0,n[0]||0):parseFloat(e[0]),r=isNaN(parseFloat(e[1]))?Math.max(1,n[1]||0):parseFloat(e[1]),l=isNaN(parseFloat(i[0]))?Math.min(0,o[0]||0):parseFloat(i[0]),s=isNaN(parseFloat(i[1]))?Math.max(1,o[1]||0):parseFloat(i[1]);this._xDomain=[a,r],this._yDomain=[l,s]}},{key:"sortData",value:function(){var t=this._data;-1===this._sortValue?t.nodes.sort(function(t,e){return e.radius-t.radius||t.index-e.index}):1===this._sortValue&&t.nodes.sort(function(t,e){return t.radius-e.radius||t.index-e.index}),this._sortedDataCopy=t}},{key:"buildOption",value:function(t,e){var i=new ii(t,e);return i.dataSolveFunc(ni),i}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}},{key:"maxRadius",value:function(t){return arguments.length?(this._maxRadius=t,this):this._maxRadius}},{key:"activeData",get:function(){var t=this.sortedDataCopy;return{nodes:t.nodes.filter(function(t){return!1!==t.active}),labels:t.labels}}}]),i}(),si=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.minValue,i=t.maxValue,n=t.data,o=this.generateColorList(),a=o.length,r=(i-e)/(a-1),l=d3.range(a).map(function(t){return e+r*t}),s=d3.scaleLinear().domain(l).range(o);return n.forEach(function(t){t.nodes.forEach(function(t){return t.color=s(t.value)})}),t.colorScale=s,t}}]),i}();function ui(t,e){var i=0,n=1;if(e.forEach(function(t){"objCol"===t.function?i=t.index:"vCol"===t.function&&(n=t.index)}),W(t,[i,n])||!m(t,n))return{data:[],minValue:0,maxValue:0,dateLabel:"",valueLabel:""};for(var o={},a=/^\d{1,4}(\-|\/)\d{1,2}(\-|\/)\d{1,2}$/,r=1,l=t.length;r<l;r++){var s=t[r],u=s[i],h=parseFloat(s[n]);if(a.test(u)&&!isNaN(h)&&"Invalid Date"!==new Date(u)){u=y(u);var c=new Date(u),_=c.getFullYear();o[_]||(o[_]=[]),o[_].push({date:c,dateString:u,value:h})}}var d=[];for(var f in o)d.push({year:parseInt(f),nodes:o[f]});var p=d3.max(d,function(t){return d3.max(t.nodes,function(t){return t.value})});return{data:d,minValue:d3.min(d,function(t){return d3.min(t.nodes,function(t){return t.value})}),maxValue:p,dateLabel:t[0][i],valueLabel:t[0][n]}}var hi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","calendar-heatmap"),e._cellSize=20,e._cellFill="#fff",e._cellStroke="#ccc",e._monthStroke="#000",e}return h(i,M),s(i,[{key:"update",value:function(){var t,e,i,n=this,o=n._data,a=parseInt(o.year),r=o.nodes,l=n._cellSize,s=n.group;function u(t){var e=new Date(t.getFullYear(),t.getMonth()+1,0),i=t.getDay(),n=d3.timeWeek.count(d3.timeYear(t),t),o=e.getDay(),a=d3.timeWeek.count(d3.timeYear(e),e);return"M"+(n+1)*l+","+i*l+"H"+n*l+"V"+7*l+"H"+a*l+"V"+(o+1)*l+"H"+(a+1)*l+"V0H"+(n+1)*l+"Z"}(t=(s.select(".bottom-group").empty()?s.append("g").attr("class","bottom-group"):s.select(".bottom-group")).selectAll(".bottom-rect").data(function(){return d3.timeDays(new Date(a,0,1),new Date(a+1,0,1))})).exit().remove(),t.enter().append("rect").attr("class","bottom-rect").merge(t).attr("x",function(t){return d3.timeWeek.count(d3.timeYear(t),t)*l}).attr("y",function(t){return t.getDay()*l}).attr("width",l).attr("height",l).style("fill",n._cellFill).style("stroke",n._cellStroke).style("stroke-dasharray",function(){return n._gridShowX&&n._gridShowY?0:n._gridShowX?l+" "+l:n._gridShowY?"0 "+l+" 0":void 0}).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout),(e=(s.select(".active-group").empty()?s.append("g").attr("class","active-group"):s.select(".active-group")).selectAll(".color-rect").data(r,function(t){return t.date})).exit().remove(),e.enter().append("rect").attr("class","color-rect").merge(e).attr("x",function(t){return d3.timeWeek.count(d3.timeYear(t.date),t.date)*l}).attr("y",function(t){return t.date.getDay()*l}).attr("width",l).attr("height",l).style("fill",function(t){return t.color}).style("stroke",n._cellStroke).style("stroke-dasharray",function(){return n._gridShowX&&n._gridShowY?0:n._gridShowX?l+" "+l:n._gridShowY?"0 "+l+" 0":void 0}).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout),(i=(s.select(".month-group").empty()?s.append("g").attr("class","month-group"):s.select(".month-group")).selectAll(".month-path").data(function(){return d3.timeMonths(new Date(a,0,1),new Date(a+1,0,1))})).exit().remove(),i.enter().append("path").attr("class","month-path").merge(i).style("fill","none").style("stroke",n._monthStroke).attr("d",u)}},{key:"cellSize",value:function(t){return arguments.length?(this._cellSize=t,this):this._cellSize}},{key:"cellFill",value:function(t){return arguments.length?(this._cellFill=t,this):this._cellFill}},{key:"cellStroke",value:function(t){return arguments.length?(this._cellStroke=t,this):this._cellStroke}},{key:"monthStroke",value:function(t){return arguments.length?(this._monthStroke=t,this):this._monthStroke}},{key:"gridShowX",value:function(t){return arguments.length?(this._gridShowX=t,this):this._gridShowX}},{key:"gridShowY",value:function(t){return arguments.length?(this._gridShowY=t,this):this._gridShowY}}]),i}(),ci=function(){function e(t){r(this,e),this.id=n(""),this.elem=t.append("linearGradient").attr("id",this.id),this._colorList=[],this._offsetList=[]}return s(e,[{key:"update",value:function(){var t=this.elem,e=this._colorList,i=this._offsetList||[],n=e.length;if(i.length!==n){var o=1/(n-1);i=d3.range(n).map(function(t){return o*t})}var a=t.selectAll("stop").data(e);return a.exit().remove(),a.enter().append("stop").merge(a).attr("offset",function(t,e){return i[e]}).attr("stop-color",function(t){return t}),this}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"offsetList",value:function(t){return arguments.length?(this._offsetList=t,this):this._offsetList}}]),e}(),_i=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","gradient-legend"),e.group=e.elem.append("g"),e.defs=e.elem.append("defs"),e.gradient=new ci(e.defs),e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._rectWidth=100,e._rectHeight=30,e._colorList=[],e._startText=0,e._endText=1,e._paddingHor=3,e._paddingVer=5,e._limitedWidth=400,e._horizontalAlign="center",e._title="title",e}return h(i,o),s(i,[{key:"update",value:function(){var t=this,e=t.gradient,i=t._rectWidth,n=t._rectHeight,o=t.group.style("font-size",t._fontSize+"px").style("font-family",t._fontFamily),a=o.select("rect").empty()?o.append("rect"):o.select("rect"),r=o.select(".start-text").empty()?o.append("text").attr("class","start-text"):o.select(".start-text"),l=o.select(".end-text").empty()?o.append("text").attr("class","end-text"):o.select(".end-text"),s=o.select(".legend-title").empty()?o.append("text").attr("class","legend-title"):o.select(".legend-title");e.colorList(t._colorList).update(),a.attr("x",0).attr("y",0).attr("width",i).attr("height",n).style("fill","url(#"+t.gradient.id+")"),s.attr("x",i/2).attr("y",n+t._paddingVer).attr("dy","1em").style("text-anchor","middle").text(t._title),r.attr("x",-t._paddingHor).attr("y",n/2).attr("dy","0.35em").style("text-anchor","end").style("fill",t._fontColor).text(t._startText),l.attr("x",i+t._paddingHor).attr("y",n/2).attr("dy","0.35em").style("text-anchor","start").style("fill",t._fontColor).text(t._endText);var u=t._horizontalAlign;return"left"===u?o.call(B,E(this._startText,t._fontSize,t._fontFamily),0):"right"===u?o.call(B,t._limitedWidth-i-E(this._endText,t._fontSize,t._fontFamily),0):o.call(B,t._limitedWidth/2-i/2,0),t}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"rectWidth",value:function(t){return arguments.length?(this._rectWidth=t,this):this._rectWidth}},{key:"rectHeight",value:function(t){return arguments.length?(this._rectHeight=t,this):this._rectHeight}},{key:"paddingHor",value:function(t){return arguments.length?(this._paddingHor=t,this):this._paddingHor}},{key:"paddingVer",value:function(t){return arguments.length?(this._paddingVer=t,this):this._paddingVer}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"startText",value:function(t){return arguments.length?(this._startText=t,this):this._startText}},{key:"endText",value:function(t){return arguments.length?(this._endText=t,this):this._endText}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"title",value:function(t){return arguments.length?(this._title=t,this):this._title}}]),i}(),di=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","calendar-heatmap-chart"),e.legend=new _i(e.group),e.xAxis=new $e(e.mainGroup),e._sortValue=1,e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var n=this,t=n.activeData,e=t.data,o=t.valueLabel,a=n.tooltip,i=n.widthOfCore,r=n.heightOfCore/e.length,l=Math.min(r/7,i/56),s=n._gridShowX||n._gridShowY?n._gridStroke:"none",u=n._xTickShow?n._axisLineStroke:"none",h=53*l,c=7*l,_=d3.timeFormat("%Y-%m-%d"),d=n.coreGroup.selectAll(".year-group").data(e,function(t){return t.year});d.exit().remove(),d.enter().append("g").attr("class","year-group").merge(d).attr("transform",function(t,e){return"translate("+(i-h)/2+", "+(r*e+(r-c)/2)+")"}).each(function(t){var e=d3.select(this),i=e.property("calendar")||new hi(e);e.property("calendar",i),i.data(t).cellSize(l).cellStroke(s).monthStroke(u).gridShowX(n._gridShowX).gridShowY(n._gridShowY).onMouseover(function(t){var e=[];e=t instanceof Date?[{text:_(t)}]:[{text:t.dateString,color:t.color},{text:o+"："+t.value}],d3.select(this).raise().style("stroke","#000"),a.data(e).update().show()}).onMousemove(function(){a.move()}).onMouseout(function(){d3.select(this).style("stroke",s),a.hide()}),i.update(),(e.select("text").empty()?e.append("text"):e.select("text")).attr("transform","translate(-6, "+c/2+")rotate(-90)").style("font-size",n._fontSize).style("font-family",n._fontFamily).style("fill",n._fontColor).style("text-anchor","middle").text(t.year)})}},{key:"updateLegend",value:function(){var t=this.legend,e=this.widthOfNoMargin;if(!this._legendShow)return t.hide();t.show(),t.limitedWidth(e).horizontalAlign(this._legendX).rectWidth(e/5).rectHeight(e/5/10).fontSize(this._fontSize).fontFamily(this._fontFamily).fontColor(this._fontColor),this.configLegend(),t.update()}},{key:"configLegend",value:function(){var t=this.sortedDataCopy;this.legend.colorList(t.colorScale.range()).startText(t.minValue).endText(t.maxValue).title(t.valueLabel)}},{key:"updateAxis",value:function(){var t=this.xAxis;t.scaleFunc(d3.scaleLinear().range([0,this.widthOfNoMargin])).title(this._xTitle).fontSize(this._fontSize).fontColor(this._fontColor).fontFamily(this._fontFamily).transition(!1).axisLineShow(!1).tickShow(!1),t.translate(0,this.heightOfMainGroup-t.height).update()}},{key:"computeDomain",value:function(){}},{key:"sortData",value:function(){var t=this._data.data;1===this._sortValue?t.sort(function(t,e){return t.year-e.year}):-1===this._sortValue&&t.sort(function(t,e){return e.year-t.year}),this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var i=new si(t,e);return i.dataSolveFunc(ui),i}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this.sortedDataCopy;return{data:t.data,valueLabel:t.valueLabel}}}]),i}(),fi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","hollow-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="",e._borderWidth=0,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,n=i.group;n.select(".hollow-bar-rects").remove();var e=n.append("g").attr("class","hollow-bar-rects").selectAll("rect").data(t,function(t){return t.key});e.exit().remove();var o=e.enter().append("rect").merge(e).style("fill",function(t){return i._fillColor||t.color}).style("fill-opacity",function(t){return i._fillOpacity}).style("stroke",function(t){return i._borderColor||t.color}).style("stroke-width",function(t){return i._borderWidth||i._strokeWidth||0}).style("fill-opacity",function(t){return i._fillOpacity}).style("rx",i._barCornerRadius).style("ry",i._barCornerRadius);if(this._rectObj?(o.attr("x",this._rectObj.xFunc),o.attr("y",this._rectObj.yFunc),o.attr("width",this._rectObj.widthFunc),o.attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){n.select(".hollow-bar-texts").remove();var a=n.append("g").attr("class","hollow-bar-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").attr("class","hollow-bar-text").merge(e).text(this._textObj.textFunc).attr("fill",i._textObj.colorFunc).attr("font-size",i._textObj.fontSize).attr("font-family",i._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dy",this._textObj.dyFunc).attr("dx",function(t,e){return null==i._labelShow||0==i._labelShow||null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?.3*i._textObj.fontSize:1==i._positionOptions.indexOf(i._positionChoice)?-i._xScale(t.value)+.3*i._textObj.fontSize:2==i._positionOptions.indexOf(i._positionChoice)?.3*-i._textObj.fontSize-at(d3.select(n.selectAll(".hollow-bar-texts text").nodes()[e])).width:void 0}).style("display",this._textObj.labelShow?"block":"none");null!=i._labelShow&&0!=i._labelShow&&null!=i._positionOptions&&null!=i._positionChoice&&-1!=i._positionOptions.indexOf(i._positionChoice)||n.selectAll(".hollow-bar-texts text").style("display","none")}for(var r=n.selectAll(".hollow-bar-text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){rt(at(d3.select(r._groups[0][u])),at(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(_,s),f=0;f<_.length;f++){for(var p=[],y=0;y<d.length;y++){var g=at(d3.select(r._groups[0][_[f]])),v=at(d3.select(r._groups[0][d[y]]));if(p.push(rt(g,v)),rt(g,v)){if(_[f]==d[y])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==p.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),i}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),pi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("rect").attr("class","selectOverlay-rect"),e._width=0,e._height=0,e._shadowColor="#000",e}return h(i,o),s(i,[{key:"update",value:function(){return this.elem.attr("x",0).attr("y",0).attr("width",this._width<0?0:this._width).attr("height",this._height).style("fill",this._shadowColor).style("opacity",.15),this}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),i}(),yi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","hollow-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new fi(e.coreGroup),e.overlay=new qe(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new ri(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._strokeWidth=2,e._rectHeight=.5,e._labelShow=!1,e._positionOptions=["右边","内部居左","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var h=this,c=h.activeData,_=[],t=[];c.children.forEach(function(e){e.children.forEach(function(t){t.color=e.color,_.push(t)})});for(var e=0;e<_.length;e++)null==h._labelShow||null==h._positionOptions||null==h._positionChoice||-1==h._positionOptions.indexOf(h._positionChoice)?t.push(0):1==h._labelShow&&0==h._positionOptions.indexOf(h._positionChoice)?t.push(E(_[e].value,h._textLabel.fontSize,h._textLabel.fontFamily)):t.push(0);var i=h.grid,n=h.rectPlot,d=h.tooltip,o=h.overlay,f=h.selectOverlay,a=h.xScale,p=h.yScale,r=h.widthOfCore,l=h.heightOfCore,s=p.step();i.width(r-(0==t.length?0:d3.max(t))).height(l).xTickLocations(h.xAxis.tickLocations.slice(1)).yTickLocations(h.yAxis.tickLocations).showX(h._gridShowX).showY(h._gridShowY).stroke(h._gridStroke).strokeDasharray(h._gridStrokeDasharray),o.width(r-(0==t.length?0:d3.max(t))).height(l).onMouseover(function(){d.show(),f.show()}).onMousemove(function(){for(var t=h.elem.node().parentNode,e=d3.mouse(t),i=d3.mouse(this)[1],n=p.step(),o=Math.floor(i/n),a=p.domain()[_.length-o-1],r="",l=0;l<c.children.length;l++)for(var s=0;s<c.children[l].children.length;s++)c.children[l].children[s].name==a&&(r=c.children[l].name);var u=[{text:r}];a&&(u.push({text:_[_.length-o-1].name+": "+_[_.length-o-1].value,color:_[_.length-o-1].color}),f.translate(0,p(a))),d.data(u).update().move([e[0],e[1]])}).onMouseout(function(){d.hide(),f.hide()}),f.width(r-(0==t.length?0:d3.max(t))).height(p.step()).shadowColor("#ccc").hide(),n.data(_).xScale(a).yScale(p).labelShow(h._labelShow).positionOptions(h._positionOptions).positionChoice(h._positionChoice).fillColor("none").strokeWidth(h._strokeWidth).rectObj({xFunc:function(){return 0},yFunc:function(t,e){return h.yScale.range()[0]-(e*s+(s-s*h._rectHeight)/2+s*h._rectHeight)},widthFunc:function(t){return h.xScale(t.value)},heightFunc:function(t){return s*h._rectHeight}}).textObj({xFunc:function(t,e){return h.xScale(t.value)},yFunc:function(t,e){return h.yScale.range()[0]-(e*s+(s-.9*s*h._rectHeight)/2+.7*s*h._rectHeight)},dyFunc:.5*s*h._rectHeight/2+h._textLabel.fontSize/3,colorFunc:function(){return h._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:h._textLabel.fontSize,fontFamily:h._textLabel.fontFamily,labelShow:h._labelShow}),h.coreGroup.call(B,h.yAxis.width+.5,0),i.update(),f.update(),n.update(),o.update()}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e.widthOfNoMargin,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);var _=e.activeData,d=[];_.children.forEach(function(e){e.children.forEach(function(t){t.color=e.color,d.push(t)})});for(var f=[],p=0;p<d.length;p++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?f.push(0):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?f.push(E(d[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):f.push(0);i&&i.titleHeight;var y=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(y).compute(),i.compute();var g=(h-i.width-(0==f.length?0:d3.max(f)))/t._tickValues.length,v=d3.max(t._tickValues,function(t){return E(t,u,e._fontFamily)}),m=(t._tickShow?t._tickSize+t._tickPadding+(v<g?1.125*t._fontSize:t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-m,0]),i.compute(),n.range([0,h-i.width-(0==f.length?0:d3.max(f))]),t.compute();var x=i.width,S=c-m,k=i.width;t.translate(x,S).update(),i.translate(k,0).update()}},{key:"computeDomain",value:function(){var t=this.activeData,i=[];t.children.forEach(function(e){e.children.forEach(function(t){t.color=e.color,i.push(t)})});var e=this._xDomain||[],n=i.length?i.map(function(t){return t.name}):[0,1],o=i.length?[Math.min(d3.min(i,function(t){return+t.value}),0),d3.max(i,function(t){return+t.value})]:[0,1];this._xDomain=[isNaN(parseFloat(e[0]))?o[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?o[1]:parseFloat(e[1])],this._yDomain=n}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.nodes,o=n.map(function(t,e){return{name:t.name,color:t.color,key:t.name+"-"+e}});t.legend.data(o).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),o.forEach(function(t){t.key===e.key&&(t.active=!i)}),n.forEach(function(t){t.name===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"sortData",value:function(){var t=this._data.nodes;-1===this._sortValue?t.sort(function(t,e){return e.sum-t.sum||t.index-e.index}):1===this._sortValue&&t.sort(function(t,e){return t.sum-e.sum||t.index-e.index}),this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var i=new ye(t,e);return i.dataSolveFunc(ge),i}},{key:"activeData",get:function(){return{children:this.sortedDataCopy.nodes.filter(function(t){return!1!==t.active})}}}]),i}(),gi=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,kt),s(e,[{key:"update",value:function(){var i=this,t=i.group,e=i._data,n=i._xScale,o=i._yScale;t.selectAll(".stacked-scatter-circle").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","stacked-scatter-circle").attr("cx",function(t){return n(t.name)||0}).attr("cy",function(t){return o(t.total)||0}).merge(e).style("fill",i._fill||t.color).style("stroke",i._stroke||t.color).style("stroke-width",i._strokeWidth).attr("r",i._radius).attr("cx",function(t){return n(t.name)||0}).attr("cy",function(t){return o(t.total)||0})});for(var r=t.selectAll(".stacked-scatter-circle").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return i}}]),e}(),vi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","ranking-line-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e._lineFunc||d3.line().x(function(t){return e._xScale(t.name)}).y(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(e._curve);var n=e.group.selectAll("path").data(t,function(t){return t.key});return n.exit().remove(),n.enter().append("path").merge(n).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._lineWidth).style("stroke-dasharray",e._strokeDasharry).transition().duration(e._transition?e._duration:0).attr("d",function(t){return i(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),i}(),mi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stacked-chart"),e.grid=new zt(e.coreGroup),e.areaPlot=new Ye(e.coreGroup),e.linePlot=new vi(e.coreGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new gi(e.coreGroup),e.stackText=new wt(e.coreGroup),e.clipArea=new Ot(e.defs),e.AnimationArea=new Ct(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._curve=d3.curveCardinal,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=t.grid,n=t.areaPlot,o=t.linePlot,r=t.guideScatter,l=t.tooltip,a=t.stackText,s=t.overlay,u=t.guideLine,h=t.clipArea,c=(t.AnimationArea,t.xScale),_=t.yScale,d=t.widthOfCore,f=t.heightOfCore,p=0;p<i.length;p++)for(var y=0;y<i[p].data.length;y++)i[p].data[y].value=parseFloat(i[p].data[y].value),i[p].data[y].total=0==p?isNaN(parseFloat(i[p].data[y].value))?0:parseFloat(i[p].data[y].value):i[p-1].data[y].total+(isNaN(parseFloat(i[p].data[y].value))?0:parseFloat(i[p].data[y].value));Math.min(d3.min(i,function(t){return d3.min(t.data,function(t){return+t.total})}),0);e.width(d).height(f).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),n.data(i).xScale(c).yScale(_).fillOpacity(.7).curve(t._curve).areaFunc(d3.area().x(function(t){return c(t.name)}).y0(function(t){return _(t.total-t.value)}).y1(function(t){return _(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),o.data(i).xScale(c).yScale(_).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).mainGroup(t.mainGroup).curve(t._curve).lineFunc(d3.line().x(function(t){return c(t.name)}).y(function(t){return _(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),r.data(i).xScale(c).yScale(_).radius(3.5).stroke("#fff").strokeWidth(2),u.y1(0).y2(f).stroke("#c6c6c6").strokeDasharray("0 0"),s.data(c.domain()).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update(),u.x(c(n)).update(),r.data(a).update(),l.show(),u.show(),r.show()}).onMousemove(function(){l.move()}).onMouseout(function(){l.hide(),u.hide(),r.hide()}),a.data(i).xScale(c).yScale(_).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice),t.coreGroup.call(B,t.yAxis.width+.5,0),0!=t._clipShow.length?h.width(d).height(f).paddingVertical([0,0]).transition(t._transition).duration(t._duration):h.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+h.id+")"),h.update(),r.elem.style("pointer-events","none");var g=t.group.selectAll(".stacked-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(g).remove(),e.update(),s.update(),n.update(),o.update(),a.update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Lt;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var i=0;i<t[e].data.length;i++)t[e].data[i].value=parseFloat(t[e].data[i].value),t[e].data[i].total=0==e?isNaN(parseFloat(t[e].data[i].value))?0:parseFloat(t[e].data[i].value):t[e-1].data[i].total+(isNaN(parseFloat(t[e].data[i].value))?0:parseFloat(t[e].data[i].value));var n=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})})]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(n[0]))?a[0]:parseFloat(n[0]),isNaN(parseFloat(n[1]))?isNaN(parseFloat(n[0]))?a[1]:a[1]<n[0]?1.5*n[0]:a[1]:parseFloat(n[1])]}}]),i}(),xi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rect-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="#000",e._borderWidth=0,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e.group,n=i.selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var o=n.enter().append("g").append("rect").merge(n).style("fill",function(t){return e._fillColor||t.color}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return e._strokeColor||t.color}).style("stroke-width",function(t){return e._strokeWidth||0});if(this._rectObj?(o.attr("x",e._rectObj.xFunc),o.attr("y",this._rectObj.yFunc),o.attr("width",this._rectObj.widthFunc),o.attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){i.selectAll(".symmetric-texts").remove();var a=i.append("g").attr("class","symmetric-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("g").append("text").merge(a).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).style("display",this._textObj.labelShow?"block":"none")}o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);for(var r=i.selectAll(".symmetric-texts text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){rt(at(d3.select(r._groups[0][u])),at(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(_,s),f=0;f<_.length;f++){for(var p=[],y=0;y<d.length;y++){var g=at(d3.select(r._groups[0][_[f]])),v=at(d3.select(r._groups[0][d[y]]));if(p.push(rt(g,v)),rt(g,v)){if(_[f]==d[y])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==p.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return e}},{key:"updateChangeWaterfall",value:function(){var e=this,t=e._data,i=e.group;i.select(".change-rects").remove();var n=i.append("g").attr("class","change-rects").selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var o=n.enter().append("rect").merge(n).style("fill",function(t){return 0<t.value?e._fillColor||t.color:e._fillColor||t.color_special}).style("fill-opacity",function(t){return e._fillOpacity}).style("rx",e._barCornerRadius).style("ry",e._barCornerRadius).style("stroke",function(t){return 0<t.value?e._borderColor||t.color:e._borderColor||t.color_special}).style("stroke-width",function(t){return e._borderWidth||0});if(this._rectObj?(o.attr("x",e._rectObj.xFunc),o.attr("y",this._rectObj.yFunc),o.attr("width",this._rectObj.widthFunc),o.attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){i.select(".change-texts").remove();var a=i.append("g").attr("class","change-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").merge(a).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).attr("text-anchor","middle").style("display",this._textObj.labelShow?"block":"none");null!=e._labelShow&&null!=e._positionOptions&&null!=e._positionChoice&&-1!=e._positionOptions.indexOf(e._positionChoice)||i.selectAll(".change-texts text").style("display","none")}return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e}},{key:"updateFormWaterfall",value:function(){var e=this,t=e._data,i=e.group;i.select(".form-rects").remove();var n=i.append("g").attr("class","form-rects").selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var o=n.enter().append("rect").merge(n).style("fill",function(t){return 0<t.value?e._fillColor||t.color:e._fillColor||t.color_special}).style("fill-opacity",function(t){return e._fillOpacity}).style("rx",e._barCornerRadius).style("ry",e._barCornerRadius).style("stroke",function(t){return 0<t.value?e._borderColor||t.color:e._borderColor||t.color_special}).style("stroke-width",function(t){return e._borderWidth||0});if(this._rectObj?(o.attr("x",e._rectObj.xFunc),o.attr("y",this._rectObj.yFunc),o.attr("width",this._rectObj.widthFunc),o.attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){i.select(".form-texts").remove();var a=i.append("g").attr("class","form-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").merge(a).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).attr("text-anchor","middle").style("display",this._textObj.labelShow?"block":"none");null!=e._labelShow&&null!=e._positionOptions&&null!=e._positionChoice&&-1!=e._positionOptions.indexOf(e._positionChoice)||i.selectAll(".form-texts text").style("display","none")}return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e}},{key:"updateHorizontalBar",value:function(){var i=this,t=i._data,e=i.group;e.select(".horizontal-bar-rects").remove();var n=e.append("g").attr("class","horizontal-bar-rects").selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var o=n.enter().append("rect").merge(n).style("fill",function(t){return i._fillColor||t.color}).style("fill-opacity",function(t){return i._fillOpacity}).style("stroke",function(t){return i._borderColor||i._strokeColor||t.color}).style("stroke-width",function(t){return i._borderWidth||i._strokeWidth||0}).style("fill-opacity",function(t){return i._fillOpacity}).style("rx",i._barCornerRadius).style("ry",i._barCornerRadius);if(this._rectObj?(o.attr("x",i._rectObj.xFunc),o.attr("y",this._rectObj.yFunc),o.attr("width",this._rectObj.widthFunc),o.attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){e.select(".horizontal-bar-texts").remove();var a=e.append("g").attr("class","horizontal-bar-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").attr("class","horizontal-bar-text").merge(n).text(this._textObj.textFunc).attr("fill",i._textObj.colorFunc).attr("font-size",i._textObj.fontSize).attr("font-family",i._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dy",this._textObj.dyFunc).attr("dx",function(t,e){if(null==i._labelShow||0==i._labelShow||null==i._positionOptions||null==i._positionChoice)return 0;if(0==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return.3*i._textObj.fontSize;if(t.value<0)return-E(t.value,i._textObj.fontSize,i._textObj.fontFamily)-.3*i._textObj.fontSize}else if(1==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return-(i._xScale(t.value)-i._xScale(0))+.3*i._textObj.fontSize;if(t.value<0)return i._xScale(0)-i._xScale(t.value)-.3*i._textObj.fontSize-E(t.value,i._textObj.fontSize,i._textObj.fontFamily)}else if(2==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return-(i._xScale(t.value)-i._xScale(0))/2-E(t.value,i._textObj.fontSize,i._textObj.fontFamily)/2;if(t.value<0)return(i._xScale(0)-i._xScale(t.value))/2-E(t.value,i._textObj.fontSize,i._textObj.fontFamily)/2}else if(3==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return.3*-i._textObj.fontSize-E(t.value,i._textObj.fontSize,i._textObj.fontFamily);if(t.value<0)return.3*i._textObj.fontSize}}).style("display",this._textObj.labelShow?"block":"none");null!=i._labelShow&&0!=i._labelShow&&null!=i._positionOptions&&null!=i._positionChoice||e.selectAll(".horizontal-bar-texts text").style("display","none")}for(var r=e.selectAll(".horizontal-bar-text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){rt(at(d3.select(r._groups[0][u])),at(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(_,s),f=0;f<_.length;f++){for(var p=[],y=0;y<d.length;y++){var g=at(d3.select(r._groups[0][_[f]])),v=at(d3.select(r._groups[0][d[y]]));if(p.push(rt(g,v)),rt(g,v)){if(_[f]==d[y])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==p.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),i}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),Si=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t,i,e=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),n=this.generateColorList(e.length);return i=n,(t=e).forEach(function(e,t){e.color=i[t],e.color_special=i[t+1],e.data.forEach(function(t){t.color=e.color,t.color_special=e.color_special})}),t}}]),i}(),ki="legend-group",bi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","waterfalllegend"),e.group=e.elem.append("g"),e._data=[],e._shapeType="circle",e._shapeWidth=12,e._shapeHeight=12,e._shapeStroke="none",e._rowGap=6,e._colGap=20,e._innerGap=6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._limitedWidth=400,e._horizontalAlign="center",e._onClick=function(){},e._each=function(){},e._orient="horizontal",e}return h(i,o),s(i,[{key:"update",value:function(){var a=this,r=a.group,l=Math.max(a._shapeHeight,a._fontSize),s=a._limitedWidth-a._shapeWidth-a._innerGap,u=0,h=0;a.elem.selectAll("."+ki).remove();var c=r.append("g").attr("class",ki);if(0<a._data.length){var t={name:a._data[0].name,data:a._data[0].data,color:a._data[0].color,color_special:a._data[0].color_special,key:a._data[0].key,name1:"收入"},e={name:a._data[0].name,data:a._data[0].data,color:a._data[0].color,color_special:a._data[0].color_special,key:a._data[0].key,name1:"支出"},i=[];i.push(t),i.push(e),i.forEach(function(t,e){var i=H(t.name1,s,a._fontSize,a._fontFamily),n=a._shapeWidth+a._innerGap+E(i,a._fontSize,a._fontFamily);if("vertical"===a._orient)a._legendItem(t,c,0,h,e),h=h+l+a._rowGap;else{var o=u+n+a._colGap;o>a._limitedWidth&&(u=0,o=n+a._colGap,h+=l+a._rowGap,c=r.append("g").attr("class",ki)),a._legendItem(t,c,u,h,e),u=o}});var n=at(r).width;"center"===a._horizontalAlign?r.call(B,a._limitedWidth/2-n/2,0):"left"===a._horizontalAlign?r.call(B,0,0):"right"===a._horizontalAlign&&r.call(B,a._limitedWidth-n,0)}return a}},{key:"_shapeElem",value:function(t){var e=void 0;return(e="rect"===this._shapeType?t.append("rect").attr("width",this._shapeWidth).attr("height",this._shapeHeight):t.append("circle").attr("cx",this._shapeWidth/2).attr("cy",this._shapeHeight/2).attr("r",Math.min(this._shapeWidth,this._shapeHeight)/2)).attr("class","legend-shape"),e}},{key:"_legendItem",value:function(e,t,i,n,o){var a=t.append("g").datum(e).attr("class","legend-item").call(B,i,n).on("click",this._onClick).each(this._each);return this._shapeElem(a).style("fill",function(t){return 0==o?e.color:e.color_special}),a.append("text").attr("x",this._shapeWidth+this._innerGap).attr("y",this._shapeHeight/2).attr("dy","0.35em").style("text-anchor","start").style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("fill",this._fontColor).text(H(e.name1,this._limitedWidth-this._shapeWidth-this._innerGap,this._fontSize,this._fontFamily)),a}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"shapeType",value:function(t){return arguments.length?(this._shapeType=t,this):this._shapeType}},{key:"shapeWidth",value:function(t){return arguments.length?(this._shapeWidth=t,this):this._shapeWidth}},{key:"shapeHeight",value:function(t){return arguments.length?(this._shapeHeight=t,this):this._shapeHeight}},{key:"rowGap",value:function(t){return arguments.length?(this._rowGap=t,this):this._rowGap}},{key:"colGap",value:function(t){return arguments.length?(this._colGap=t,this):this._colGap}},{key:"innerGap",value:function(t){return arguments.length?(this._innerGap=t,this):this._innerGap}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"onClick",value:function(t){return arguments.length?(this._onClick=t,this):this._onClick}},{key:"each",value:function(t){return arguments.length?(this._each=t,this):this._each}}]),i}();function wi(t,e){var i=0,n=1;if(e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"vCol"===t.function&&(n=t.index)}),W(t,[i,n])||!m(t,n))return[];var o={},a=[],r=t.length,l=t[0][n];""!=l&&null!=l&&null!=l||(l="$-0"),o[l]={name:l,showLegend:"$-0"!=l,data:[]};for(var s=0,u=1;u<r;u++){var h=t[u],c=h[i];if(""!=c&&null!=c&&null!=c||(c="&-"+u),c){var _=l;1==u?s=isNaN(parseFloat(t[1][n]))?0:parseFloat(t[1][n]):s+=isNaN(parseFloat(h[n]))?0:parseFloat(h[n]),o[_].data.push({name:c,showAxisText:c!="&-"+u,value:""==h[n]||isNaN(parseFloat(h[n]))||null==h[n]||null==h[n]?0:h[n],total:s})}}for(var d in o)a.push(o[d]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Oi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","change-waterfall-histogram-chart"),e.grid=new zt(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(1),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e.legend=new bi(e.group),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new xi(e.coreGroup),e.overlay=new At(e.coreGroup),e._histogramWidth=1,e._yScaleHeight=1.05,e._barWidthPercent=.5,e._barCornerRadius=0,e._borderWidth=0,e._borderColor="none",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["上面","内部居下","内部居中"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=r.toString()?r[0].data:[],e=i.grid,l=i.tooltip,n=i.rectPlot,o=i.overlay,s=i.selectOverlay,a=i._barWidthPercent,u=i.xScale,h=i.yScale,c=i.widthOfCore,_=i.heightOfCore,d=Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total})}),0),f=(d3.max(r,function(t){return d3.max(t.data,function(t){return+t.total})}),d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),r.length&&r[0].data[0].value,i.widthOfNoMargin,i.heightOfMainGroup);i.yAxis.width,i.xAxis.height;o.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update(),s.translate(u(n),0),l.show()}).onMousemove(function(){l.move(),s.show()}).onMouseout(function(){l.hide(),s.hide()}),n.data(t).xScale(u).yScale(h).barCornerRadius(i._barCornerRadius).borderWidth(i._borderWidth).borderColor(i._borderColor).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).rectObj({xFunc:function(t,e){return u.step()*e+u.step()*(1-i._histogramWidth*a)/2},yFunc:function(t){return t.value<0?h(t.total-t.value):h(t.total)},widthFunc:function(){return u.step()*i._histogramWidth*a},heightFunc:function(t){return 0<d||0==d?Math.abs(h.range()[0]-h(Math.abs(t.value))):d<0?Math.abs(h(0)-h(Math.abs(t.value))):void 0}}).textObj({xFunc:function(t,e){return u.step()*e+u.step()*(1-i._histogramWidth*a)/2},yFunc:function(t){return t.value<0?h(t.total-t.value):h(t.total)},dxFunc:function(t,e){return u.step()*i._histogramWidth*a/2},dyFunc:function(t,e){return 0==i._positionOptions.indexOf(i._positionChoice)?.5*-i._textLabel.fontSize:1==i._positionOptions.indexOf(i._positionChoice)?0<d?h.range()[0]-h(Math.abs(t.value))-.5*i._textLabel.fontSize:h(0)-h(Math.abs(t.value))-.5*i._textLabel.fontSize:2==i._positionOptions.indexOf(i._positionChoice)?0<d?(h.range()[0]-h(Math.abs(t.value)))/2+.4*i._textLabel.fontSize:(h(0)-h(Math.abs(t.value)))/2+.4*i._textLabel.fontSize:void 0},colorFunc:function(){return i._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:i._textLabel.fontSize,fontFamily:i._textLabel.fontFamily,labelShow:i._labelShow}).fillOpacity(i._fillOpacity),e.width(c).height(_).xTickLocations(i.xAxis.tickLocations).yTickLocations(i.yAxis.tickLocations.slice(1)).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray),s.width(u.step()).height(_).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)");var p=i.group.selectAll(".change-waterfall-histogram-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),n.updateChangeWaterfall(),s.update(),o.update();var y=i.yAxis.width;e.translate(y,0).update()}},{key:"updateLegend",value:function(){var t=this.legend,e=this.widthOfNoMargin;if(!this._legendShow)return t.hide();t.show(),t.limitedWidth(e).fontSize(this._fontSize).fontFamily(this._fontFamily).fontColor(this._fontColor).horizontalAlign(this._legendX).each(function(t){var e=!1===t.active;d3.select(this).classed("clicked",e).style("opacity",e?.5:1)}),this.configLegend(),t.update()}},{key:"configLegend",value:function(){var t=this.sortedDataCopy;this.legend.data(t).onClick(function(t){})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._barWidthPercent=e.barWidthPercent?e.barWidthPercent:this._barWidthPercent,this._barCornerRadius=e.barCornerRadius?e.barCornerRadius:this._barCornerRadius,this._borderWidth=e.borderWidth?e.borderWidth:this._borderWidth,this._borderColor=e.borderColor?e.borderColor:this._borderColor,this._fillOpacity=e.fillOpacity?e.fillOpacity:this._fillOpacity),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=wi;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total})}),0),Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),0)*this._yScaleHeight]:[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?n[1]:parseFloat(e[1])]}}]),i}();function Ci(t,e){var i=0;e.forEach(function(t){"objCol"===t.function&&(i=t.index,t.isLegend)});var n={},o=[],a=t.length,r=t[0];r.forEach(function(t,e){e!==i&&t&&(n[t]={name:t,data:[]})});for(var l=1;l<a;l++){var s=t[l],u=s[i];if(u)for(var h=0;h<s.length;h++){var c=r[h];h!==i&&c&&n[c].data.push({name:u,value:s[h]})}}for(var _ in n)o.push(n[_]);return o.forEach(function(t,e){t.key=t.name+"-"+e}),o}function Fi(t,e){var i=0,n=1;if(e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"vCol"===t.function&&(n=t.index)}),W(t,[i,n])||!m(t,n))return[];var o={},a=[],r=t.length,l=t[0],s=l[n];o[s]={name:s,data:[]};for(var u=0,h=1;h<r;h++){var c=t[h],_=c[i];if(""!=_&&null!=_&&null!=_||(_="&-"+h),_){var d=l[n];1==h||2==h?u=isNaN(parseFloat(t[1][n]))?0:parseFloat(t[1][n]):u-=isNaN(parseFloat(t[h-1][n]))?0:parseFloat(t[h-1][n]),o[d].data.push({name:_,showAxisText:_!="&-"+h,value:""==c[n]||isNaN(parseFloat(c[n]))||null==c[n]||null==c[n]?0:c[n],total:u})}}for(var f in o)a.push(o[f]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Pi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","form-waterfall-histogram-chart"),e.grid=new zt(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(1),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new xi(e.coreGroup),e.overlay=new At(e.coreGroup),e._histogramWidth=1,e._yScaleHeight=1.05,e._marginTop=20,e._barWidthPercent=.5,e._barCornerRadius=0,e._borderWidth=1,e._borderColor="none",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["上面","内部居下","内部居中"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=r.toString()?r[0].data:[],e=i.grid,l=i.tooltip,n=i.rectPlot,o=i.overlay,s=i.selectOverlay,a=i._barWidthPercent?i._barWidthPercent:.8,u=i.xScale,h=i.yScale,c=i.widthOfCore,_=i.heightOfCore,d=d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total-t.value})}),f=(i.widthOfNoMargin,i.heightOfMainGroup);i.yAxis.width,i.xAxis.height;d<0?(i.group.selectAll(".form-water-fall-histogram-chart .axis-x path").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")"),i.group.selectAll(".form-water-fall-histogram-chart .axis-x line").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")")):(i.group.selectAll(".form-water-fall-histogram-chart .axis-x path").attr("transform","translate(0,0)"),i.group.selectAll(".form-water-fall-histogram-chart .axis-x line").attr("transform","translate(0,0)")),o.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update(),s.translate(u(n),0),l.show()}).onMousemove(function(){l.move(),s.show()}).onMouseout(function(){l.hide(),s.hide()}),n.data(t).xScale(u).yScale(h).barCornerRadius(i._barCornerRadius).borderWidth(i._borderWidth).borderColor(i._borderColor).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).rectObj({xFunc:function(t,e){return u.step()*e+u.step()*(1-i._histogramWidth*a)/2},yFunc:function(t){return h(t.total)},widthFunc:function(){return u.step()*i._histogramWidth*a},heightFunc:function(t){return Math.abs(h(0)-h(t.value))}}).textObj({xFunc:function(t,e){return u.step()*e+u.step()*(1-i._histogramWidth*a)/2},yFunc:function(t){return h(t.total)},dxFunc:function(t,e){return u.step()*i._histogramWidth*a/2},dyFunc:function(t,e){return 0==i._positionOptions.indexOf(i._positionChoice)?.5*-i._textLabel.fontSize:1==i._positionOptions.indexOf(i._positionChoice)?h(0)-h(Math.abs(t.value))-.5*i._textLabel.fontSize:2==i._positionOptions.indexOf(i._positionChoice)?(h(0)-h(Math.abs(t.value)))/2+.4*i._textLabel.fontSize:void 0},colorFunc:function(){return i._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:i._textLabel.fontSize,fontFamily:i._textLabel.fontFamily,labelShow:i._labelShow}).fillOpacity(i._fillOpacity),e.width(c).height(_).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray),s.width(u.step()).height(_).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)");var p=i.group.selectAll(".form-waterfall-histogram-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),n.updateFormWaterfall(),s.update(),o.update();var y=i.yAxis.width;e.translate(y,0).update()}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=Fi;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._barWidthPercent=e.barWidthPercent?e.barWidthPercent:this._barWidthPercent,this._barCornerRadius=e.barCornerRadius?e.barCornerRadius:this._barCornerRadius,this._borderWidth=e.borderWidth?e.borderWidth:this._borderWidth,this._borderColor=e.borderColor?e.borderColor:this._borderColor,this._fillOpacity=e.fillOpacity?e.fillOpacity:this._fillOpacity),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=0<t.length?t[0].data.map(function(t){return t.name}):[0,1],n=0<t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total-t.value})}),0),t[0].data[0].value*this._yScaleHeight]:[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?n[1]:parseFloat(e[1])]}}]),i}(),zi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-bar-plot"),e._xScale=null,e._yScale=null,e._fill=null,e._stroke="none",e._strokeWidth=0,e._showZeroLine=!0,e._zeroLineStroke="#000",e._fontColor="#000",e._fontSize=13,e._cornerRadius=0,e}return h(i,M),s(i,[{key:"update",value:function(){for(var e=this,t=e._data,i=e._xScale,n=e._yScale.clamp(!0),o=i.bandwidth()*e._barWidthPercent,a=n.domain(),r=a.every(function(t){return 0<=t})?"up":a.every(function(t){return t<=0})?"down":"both",l=n.range()[0],s=e._transition?e._duration:0,u=[],h=0;h<t.length;h++)u.push(t[h].value);var c=et(u,e._fontSize,e._fontFamily),_=e.group,f=_.selectAll(".rect").data(t);f.exit().remove();var p=f.enter().append("path").attr("class","rect").merge(f).style("fill",function(t){return e._fill||t.color}).style("stroke-width",e._strokeWidth).style("stroke",e._stroke||d.color).call(Ze,e),y=_.selectAll("text").data(t);y.exit().transition().duration(s).remove();var g=y.enter().append("text").attr("class","simple-bar-texts").merge(y).text(function(t){return t.value}).attr("fill",e._fontColor).attr("font-size",e._fontSize).style("font-family",e._fontFamily).style("display",e._labelShow?"block":"none");if("up"===r)p.attr("d",function(t){return tt({x:i(t.name)+o*(1-e._barWidthPercent),y:n(t.value),width:o,height:Math.abs(l-n(t.value)),cornerRadius:e._cornerRadius})}),g.attr("x",function(t){return i(t.name)+o*(1-e._barWidthPercent)}).attr("y",function(t){return n(t.value)}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(l-n(t.value))-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?g.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?g.attr("transform",function(t){return"rotate(-90 "+(i(t.name)+o)+" "+(n(t.value)+Math.abs(l-n(t.value))-.5*e._fontSize-4)+" )"}).attr("text-anchor","start"):g.attr("transform","rotate(0)");else if("down"===r)p.attr("d",function(t){return tt({x:i(t.name)+o*(1-e._barWidthPercent),y:0,width:o,height:n(t.value),cornerRadius:e._cornerRadius})}),g.attr("x",function(t){return i(t.name)+o*(1-e._barWidthPercent)}).attr("y",0).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?n(t.value)-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?g.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?g.attr("transform",function(t){return"rotate(-90 "+(i(t.name)+o||0)+" "+(n(t.value)-.5*e._fontSize-4)+" )"}).attr("text-anchor","start"):g.attr("transform","rotate(0)");else{var v=Math.round(n(0));p.attr("d",function(t){return tt({x:i(t.name)+o*(1-e._barWidthPercent),y:0<=t.value?n(t.value):v,width:o,height:Math.abs(v-n(t.value)),cornerRadius:e._cornerRadius})}),g.attr("x",function(t){return i(t.name)+o*(1-e._barWidthPercent)}).attr("y",function(t){return 0<=t.value?n(t.value):v}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(v-n(t.value))-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?g.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?g.attr("transform",function(t){return"rotate(-90 "+(i(t.name)+o||0)+" "+((0<=t.value?n(t.value):v)+Math.abs(v-n(t.value))-.5*e._fontSize-4)+" )"}).attr("text-anchor","start"):g.attr("transform","rotate(0)"),(_.select(".zero-line").empty()?_.append("line").attr("class","zero-line"):_.select(".zero-line")).attr("x1",i.range()[0]).attr("y1",v).attr("x2",i.range()[1]).attr("y2",v).style("stroke",e._showZeroLine?e._zeroLineStroke:"none")}if(null==e._positionOptions||null==e._positionChoice)g.style("display","none");else if(o<c&&1==e._positionOptions.indexOf(e._positionChoice)){for(var m=_.selectAll(".simple-bar-texts"),x=[],S=[],k=0;k<m._groups[0].length;k++){S.push(k);for(var b=k+1;b<m._groups[0].length;b++){var w=at(d3.select(m._groups[0][k])),O=at(d3.select(m._groups[0][b])),C=w.width;w.width=w.height,w.height=C;var F=O.width;O.width=O.height,O.height=F,rt(w,O)&&(x.push(k),d3.select(m._groups[0][k]).style("opacity","0"))}}for(var P=new Set(x),z=Array.from(P),A=$(z,S),L=0;L<z.length;L++){for(var M=[],D=0;D<A.length;D++){var W=at(d3.select(m._groups[0][z[L]])),T=at(d3.select(m._groups[0][A[D]])),R=W.width;W.width=W.height,W.height=R;var N=T.width;if(T.width=T.height,T.height=N,M.push(rt(W,T)),rt(W,T)){if(z[L]==A[D])continue;d3.select(m._groups[0][z[L]]).style("opacity","0")}}0==M.filter(function(t){return 1==t}).length&&A.push(z[L])}for(var j=0;j<A.length;j++)d3.select(m._groups[0][A[j]]).style("opacity","1")}else{for(var Y=_.selectAll(".simple-bar-texts"),X=[],G=[],B=0;B<Y._groups[0].length;B++){G.push(B);for(var E=B+1;E<Y._groups[0].length;E++){rt(at(d3.select(Y._groups[0][B])),at(d3.select(Y._groups[0][E])))&&(X.push(B),d3.select(Y._groups[0][B]).style("opacity","0"))}}for(var H=new Set(X),V=Array.from(H),I=$(V,G),Z=0;Z<V.length;Z++){for(var Q=[],q=0;q<I.length;q++){var U=at(d3.select(Y._groups[0][V[Z]])),K=at(d3.select(Y._groups[0][I[q]]));if(Q.push(rt(U,K)),rt(U,K)){if(V[Z]==I[q])continue;d3.select(Y._groups[0][V[Z]]).style("opacity","0")}}0==Q.filter(function(t){return 1==t}).length&&I.push(V[Z])}for(var J=0;J<I.length;J++)d3.select(Y._groups[0][I[J]]).style("opacity","1")}function $(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}}]),i}(),Ai=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-bar-chart"),e.grid=new zt(e.coreGroup),e.core=new zi(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xTickShow=!0,e._yTickShow=!0,e._barWidthPercent=.5,e._cornerRadius=0,e._stroke="none",e._strokeWidth=0,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="内部居下",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var t=this,e=t.activeData,i=t.grid,n=t.core,o=t.tooltip,a=t.clipArea,r=t.widthOfCore,l=t.heightOfCore;i.width(r).height(l).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),n.data(e).xScale(t.xScale).yScale(t.yScale).zeroLineStroke(t._axisLineStroke).cornerRadius(t._cornerRadius).stroke(t._stroke).barWidthPercent(t._barWidthPercent).strokeWidth(t._strokeWidth).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).textObj({colorFunc:function(){return t._fontColor}}).onMouseover(function(t,e){d3.select(this).style("stroke","#000").style("stroke-width",1);var i=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];o.data(i).update().show()}).onMousemove(function(){o.move()}).onMouseout(function(){o.hide(),d3.select(this).style("stroke",n.stroke()).style("stroke-width",0)}),t.coreGroup.call(B,t.yAxis.width+.5,0),0!=t._clipShow.length?(a.width(r).height(l).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+a.id+")")):(a.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","")),a.update();var s=t.group.selectAll(".simple-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="$-"+e});d3.selectAll(s).remove(),i.update(),n.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange||[]).slice().sort(d3.ascending),i=t.length?t.map(function(t){return t.name}):[0,1],n=void 0;if(t.length){var o=d3.min(t,function(t){return+t.value}),a=1.1*d3.max(t,function(t){return+t.value});n=o<0?a<=0?[o,0]:[o,a]:[0,a]}else n=[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&this.barWidthPercent(l(e.barWidthPercent?e.barWidthPercent:this._barWidthPercent)).cornerRadius(l(e.barCornerRadius?e.barCornerRadius:this._cornerRadius)).stroke(e.borderColor||this._stroke).strokeWidth(l(e.borderWidth?e.borderWidth:this._strokeWidth)),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}}]),i}(),Li=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,R),s(e,[{key:"update",value:function(){var t=this,e=(t._data,t.arcFunc.innerRadius(t._innerRadius).outerRadius(t._outerRadius).cornerRadius(t._cornerRadius).startAngle(t._startAngle).endAngle(t._endAngle));t.pieFunc.value(function(t){return+t.value}).startAngle(t._startAngle).endAngle(t._endAngle).sort(t._sortMethod);var i=t.pieFunc(t._data),n=t.group.selectAll("path").data(i,function(t){return t.data.key});n.exit().remove();n.merge(n.enter().append("path")).attr("d",e).style("stroke",t._stroke).style("stroke-width",t._strokeWidth).style("fill",function(t){return t.data.color_special});return t}}]),e}();function Mi(t,e){var i=0,n=1;if(e.forEach(function(t){"objCol"===t.function?i=t.index:"vCol"===t.function&&(n=t.index)}),W(t,[i,n])||!m(t,n))return[];var o=[],a=t[0][i],r=t[0][n],l=t.slice(1,2),s=parseFloat(l[0][n]);return s=10<s||10==s?(s/Math.pow(10,String(parseInt(s)).length)).toFixed(3):s<10&&1<s?(s/Math.pow(10,String(parseInt(s)).length+1)).toFixed(3):s.toFixed(3),isNaN(s)||o.push({name:l[0][i],value:+s,nameLabel:a,valueLabel:r}),o.forEach(function(t,e){t.key=D(t.name)+"-"+e}),o}var Di=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","Progress-Round-pie-chart"),e.pieBg=new Li(e.mainGroup),e.core=e.pie=new R(e.mainGroup),e._innerRadius=0,e._padAngle=0,e._startAngle=0,e._endAngle=2*Math.PI,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=0,e._areaBorderWidth=0,e._areaBorderColor=null,e._numberShow=!0,e._nFontSize=35,e._nFontFamily="noto",e._nColor="0",e._textShow=!0,e._tFontSize=25,e._tFontFamily="noto",e._tColor="1",e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var a=this,t=a.pieBg,r=a.pie,e=a.widthOfNoMargin,i=.88*e,n=.88*a.heightOfMainGroup,o=a._startAngle,l=a._endAngle,s=A(i,n,o,l),u=s.radius,h=a._innerRadius||(a._innerRadiusRatio?a._innerRadiusRatio*u:.75*u),c=s.cx+(e-i)/2,_=s.cy+.06*a.heightOfMainGroup;t.data(a.activeData).innerRadius(h).outerRadius(u).cornerRadius(a._cornerRadius).startAngle(o).endAngle(-l*(1-(0<a.activeData.length?a.activeData[0].value:1))),a.pieBg.translate(c,_).update(),r.data(a.activeData).innerRadius(h).outerRadius(u).cornerRadius(a._cornerRadius).startAngle(o).endAngle(l*(0<a.activeData.length?a.activeData[0].value:0)).areaBorderColor(a._areaBorderColor).areaBorderWidth(a._areaBorderWidth).transition(a._transition).duration(a._duration).onTransitionEnd(function(t,e){var i=d3.select(this.parentNode);if(i.selectAll("text").remove(),1==r.data().length){var n=i.append("text").attr("class","middleNumber").attr("dy","-5px").style("text-anchor","middle").text((-1==String(100*t.data.value).indexOf(".")?100*t.data.value:(100*t.data.value).toFixed(1))+"% ").style("pointer-events","none").style("fill",isNaN(parseFloat(a._nColor))?a._nColor:a._colorList[a._nColor]).attr("font-size",a._nFontSize).attr("font-family",a._nFontFamily),o=i.append("text").attr("class","middleText").attr("dy","1em").style("text-anchor","middle").text(t.data.name+" ").style("pointer-events","none").style("fill",isNaN(parseFloat(a._tColor))?a._tColor:a._colorList[a._tColor]).attr("font-size",a._tFontSize).attr("font-family",a._tFontFamily);1==a._textShow&&0==a._numberShow?o.attr("dy","0.5em"):0==a._textShow&&1==a._numberShow&&n.attr("dy","0.5em"),1==a._textShow&&0<a.activeData.length?a.group.selectAll(".middleText").style("display","block"):a.group.selectAll(".middleText").style("display","none"),null!=a._textShow&&0!=a._textShow&&null!=a._tFontSize&&null!=a._tColor&&null!=a._tFontFamily&&0!=a.activeData.length||a.group.selectAll(".middleText").style("display","none"),1==a._numberShow&&0<a.activeData.length?a.group.selectAll(".middleNumber").style("display","block"):a.group.selectAll(".middleNumber").style("display","none"),null!=a._numberShow&&0!=a._numberShow&&null!=a._nFontSize&&null!=a._nColor&&null!=a._nFontFamily&&0!=a.activeData.length||a.group.selectAll(".middleNumber").style("display","none")}}).onMouseover(function(n,t){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(u,1.05*u);return function(t){var e=i(t);return r.arcFunc.outerRadius(e),r.arcFunc(n)}});var e=[{text:n.data.name+": "+100*n.data.value+"%",color:n.data.color}];a.tooltip.data(e).update().show()}).onMousemove(function(){a.tooltip.move()}).onMouseout(function(n){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(1.05*u,u);return function(t){var e=i(t);return r.arcFunc.outerRadius(e),r.arcFunc(n)}}),a.tooltip.hide()}),0==a.activeData.length&&(a.group.selectAll(".middleText").style("display","none"),a.group.selectAll(".middleNumber").style("display","none")),a.pie.translate(c,_).update()}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Mi;switch(i.dataType){case"cross-table":n=_;break;default:n=Mi}return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._innerRadiusRatio=e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio,this._cornerRadius=e.cornerRadius?e.cornerRadius:this._cornerRadius,this._areaBorderWidth=e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth,this._areaBorderColor=e.areaBorderColor?e.areaBorderColor:this._areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(null!=i.numberLabel&&(this._numberShow=i.numberLabel?i.numberLabel.show:this._numberShow,this._nFontSize=i.numberLabel.fontSize?i.numberLabel.fontSize:this._nFontSize,this._nFontFamily=i.numberLabel.fontFamily?i.numberLabel.fontFamily:this._nFontFamily,this._nColor=i.numberLabel.color||0==i.numberLabel.color?i.numberLabel.color:this._nColor),null!=i.textLabel&&(this._textShow=i.textLabel?i.textLabel.show:this._textShow,this._tFontSize=i.textLabel.fontSize?i.textLabel.fontSize:this._tFontSize,this._tFontFamily=i.textLabel.fontFamily?i.textLabel.fontFamily:this._tFontFamily,this._tColor=i.textLabel.color||0==i.textLabel.color?i.textLabel.color:this._tColor))}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}}]),i}(),Wi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","Half-Progress-pie-chart"),e.pieBg=new Li(e.mainGroup),e.core=e.pie=new R(e.mainGroup),e._innerRadius=0,e._startAngle=-Math.PI/2,e._endAngle=Math.PI,e._padAngle=0,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=0,e._areaBorderWidth=0,e._areaBorderColor=null,e._numberShow=!0,e._nFontSize=35,e._nFontFamily="noto",e._nColor="0",e._textShow=!0,e._tFontSize=25,e._tFontFamily="noto",e._tColor="1",e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var o=this,t=o.pieBg,a=o.pie,e=o.widthOfNoMargin,i=.88*e,n=o.heightOfMainGroup,r=o._startAngle,l=o._endAngle,s=function(t,e,i,n){var o=Math.min(t,e),a=o/2,r=e/2+a/2;o==e&&(r=1.1*(a=.88*e),t/2<a&&(r=e/2+(a=t/2)/2));return{radius:a,cx:t/2,cy:r,quadrant:0}}(i,n),u=s.radius,h=o._innerRadius||(o._innerRadiusRatio?o._innerRadiusRatio*u:.75*u),c=s.cx+(e-i)/2,_=s.cy;t.data(o.activeData).innerRadius(h).outerRadius(u).cornerRadius(o._cornerRadius).startAngle(r+l*(0<o.activeData.length?o.activeData[0].value:0)).endAngle(l/2),a.data(o.activeData).innerRadius(h).outerRadius(u).cornerRadius(o._cornerRadius).startAngle(r).endAngle(r+l*(0<o.activeData.length?o.activeData[0].value:0)).areaBorderColor(o._areaBorderColor).areaBorderWidth(o._areaBorderWidth).transition(o._transition).duration(o._duration).onTransitionEnd(function(t,e){var i=d3.select(this.parentNode);if(i.selectAll("text").remove(),1==a.data().length){var n=i.append("text").attr("class","middleNumber").attr("dy","-"+(parseFloat(o._tFontSize)+5)).style("text-anchor","middle").text((-1==String(100*t.data.value).indexOf(".")?100*t.data.value:(100*t.data.value).toFixed(1))+"% ").style("pointer-events","none").style("fill",isNaN(parseFloat(o._nColor))?o._nColor:o._colorList[o._nColor]).attr("font-size",o._nFontSize).attr("font-family",o._nFontFamily);i.append("text").attr("class","middleText").attr("dy","-0.1em").style("text-anchor","middle").text(t.data.name+" ").style("pointer-events","none").style("fill",isNaN(parseFloat(o._tColor))?o._tColor:o._colorList[o._tColor]).attr("font-size",o._tFontSize).attr("font-family",o._tFontFamily);1==o._textShow&&0==o._numberShow||0==o._textShow&&1==o._numberShow&&n.attr("dy","-0.1em"),1==o._textShow&&0<o.activeData.length?o.group.selectAll(".middleText").style("display","block"):o.group.selectAll(".middleText").style("display","none"),null!=o._textShow&&0!=o._textShow&&null!=o._tFontSize&&null!=o._tColor&&null!=o._tFontFamily||o.group.selectAll(".middleText").style("display","none"),1==o._numberShow&&0<o.activeData.length?o.group.selectAll(".middleNumber").style("display","block"):o.group.selectAll(".middleNumber").style("display","none"),null!=o._numberShow&&0!=o._numberShow&&null!=o._nFontSize&&null!=o._nColor&&null!=o._nFontFamily||o.group.selectAll(".middleNumber").style("display","none")}}).onMouseover(function(n,t){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(u,1.05*u);return function(t){var e=i(t);return a.arcFunc.outerRadius(e),a.arcFunc(n)}});var e=[{text:n.data.name+": "+100*n.data.value+"%",color:n.data.color}];o.tooltip.data(e).update().show()}).onMousemove(function(){o.tooltip.move()}).onMouseout(function(n){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(1.05*u,u);return function(t){var e=i(t);return a.arcFunc.outerRadius(e),a.arcFunc(n)}}),o.tooltip.hide()}),0==o.activeData.length&&(o.group.selectAll(".middleText").style("display","none"),o.group.selectAll(".middleNumber").style("display","none")),o.pie.translate(c,_).update(),o.pieBg.translate(c,_).update()}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Mi;switch(i.dataType){case"cross-table":n=_;break;default:n=Mi}return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._innerRadiusRatio=e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio,this._cornerRadius=e.cornerRadius?e.cornerRadius:this._cornerRadius,this._areaBorderWidth=e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth,this._areaBorderColor=e.areaBorderColor?e.areaBorderColor:this._areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(null!=i.numberLabel&&(this._numberShow=i.numberLabel?i.numberLabel.show:this._numberShow,this._nFontSize=i.numberLabel.fontSize?i.numberLabel.fontSize:this._nFontSize,this._nFontFamily=i.numberLabel.fontFamily?i.numberLabel.fontFamily:this._nFontFamily,this._nColor=i.numberLabel.color||0==i.numberLabel.color?i.numberLabel.color:this._nColor),null!=i.textLabel&&(this._textShow=i.textLabel?i.textLabel.show:_textShow,this._tFontSize=i.textLabel.fontSize?i.textLabel.fontSize:_tFontSize,this._tFontFamily=i.textLabel.fontFamily?i.textLabel.fontFamily:_tFontFamily,this._tColor=i.textLabel.color||0==i.textLabel.color?i.textLabel.color:this._tColor))}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}}]),i}(),Ti=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","half-pie-chart"),e.core=e.pie=new R(e.mainGroup),e.lineText=new N(e.mainGroup),e._innerRadius=0,e._startAngle=-Math.PI/2,e._endAngle=Math.PI/2,e._padAngle=0,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=0,e._areaBorderWidth=0,e._areaBorderColor=null,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){for(var r=this,o=r.pie,t=r.lineText,e=r.widthOfNoMargin,i=[],n=0;n<r.activeData.length;n++)i.push(r.activeData[n].name);var a=.74*e-et(i,r._fontSize,r._fontFamily);null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice?a=.88*e:0!=r._labelShow&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||(a=.88*e);var l=r.heightOfMainGroup,s=r._startAngle,u=r._endAngle,h=function(t,e,i,n){var o=Math.min(t,e),a=o/2,r=e/2+a/2;o==e&&(r=1.1*(a=.88*e),t/2<a&&(r=e/2+(a=t/2)/2));return{radius:a,cx:t/2,cy:r,quadrant:0}}(a,l),c=h.radius,_=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*c:.75*c);for(var d=[],f=0;f<r.activeData.length;f++)d.push(r.activeData[f].value);for(var p=0,y=0;y<r.activeData.length;y++)p+=r.activeData[y].value;for(var g=0;g<r.activeData.length;g++)r.activeData[g].percent=(r.activeData[g].value/p*100).toFixed(1);o.data(r.activeData).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).startAngle(s).endAngle(u).areaBorderColor(r._areaBorderColor).areaBorderWidth(r._areaBorderWidth).transition(r._transition).duration(r._duration).onTransitionEnd(function(t,e){var i=d3.select(this.parentNode),n="arc-path-"+t.data.key.replace(/\s*/g,"").replace(/\./g,"")+"-"+r.id;r.defs.select("#"+n).remove();var o=z((_+c)*r._labelRadiusRatio,t.startAngle+.025,t.endAngle-.025),a=r.defs.select("#"+n).empty()?r.defs.append("path").attr("d",o).attr("id",n):r.defs.select("#"+n).attr("d",o);null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice?r.group.selectAll(".chart-label-text").style("display","none"):0==r._labelShow?r.group.selectAll(".chart-label-text").style("display","none"):1==r._positionOptions.indexOf(r._positionChoice)&&(1==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])?L(i,a,t.data.name=="$-"+e?"":t.data.name,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("dx",0):1==r._contentOption.indexOf(r._contentChoice[0])?L(i,a,t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("dx",0):2==r._contentOption.indexOf(r._contentChoice[0])&&L(i,a,t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("dx",0):2==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1])||1==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1]))&&L(i,a,t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==r._contentChoice.length&&L(i,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"))}).onMouseover(function(n,t){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(c,1.05*c);return function(t){var e=i(t);return o.arcFunc.outerRadius(e),o.arcFunc(n)}});var e=[{text:""+(n.data.name=="$-"+t?"":n.data.name),color:n.data.color},{text:n.data.valueLabel+": "+n.data.value}];r.tooltip.data(e).update().show()}).onMousemove(function(){r.tooltip.move()}).onMouseout(function(n){d3.select(this).transition().duration(30).attrTween("d",function(){var i=d3.interpolateNumber(1.05*c,c);return function(t){var e=i(t);return o.arcFunc.outerRadius(e),o.arcFunc(n)}}),r.tooltip.hide()});var v=h.cx+(e-a)/2,m=h.cy;null!=r._labelShow&&(0!=r._labelShow&&0==r._positionOptions.indexOf(r._positionChoice)?(t.data(r.activeData).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).startAngle(s).endAngle(u).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).values(d).areaType("half").transition(r._transition).duration(r._duration),r.group.select(".outside-text-polygon").attr("display","block")):r.group.select(".outside-text-polygon").attr("display","none")),r.lineText.translate(v||0,m).update(),r.pie.translate(v||0,m).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(e.innerRadiusRatio).cornerRadius(e.cornerRadius).areaBorderWidth(e.areaBorderWidth).areaBorderColor(e.areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._contentChoice=i.contentChoice?i.contentChoice:this._contentChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}}]),i}(),Ri=function(t){function a(t){r(this,a);var e=c(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.xAxis=null,e.yAxis=null,e.yAxisDoubleY=null,e.xScale=null,e.yScale=null,e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._xDomain=null,e._yDomain=null,e._xTitle="",e._yTitle="",e._axisLineStroke=null,e._xTickShow=!0,e._yTickShow=!0,e._gapPadding=20,e._titlePadding=20,e}return h(a,J),s(a,[{key:"update",value:function(){return this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),this.updateTitle(),this.updateAxis(),this.updateCore(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();t.xAxis;var e=t.yAxis,i=t.yAxisDoubleY,n=t.xScale,o=t.yScale,a=(t._xType,t._yType),r=(t._xOrient,t._yOrient),l=t._yOrientRight,s=t._fontSize,u=t.widthOfNoMargin,h=t.heightOfMainGroup;n.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(o).allowedMaxTextWidth(.5*u).type(a).orient(r).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(s).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),i.scaleFunc(o).allowedMaxTextWidth(.5*u).type(a).orient(l).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(s).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);var c=(null==t._yTitle[0]?0:e.titleHeight)||(null==t._yTitle[1]?0:i.titleHeight),_=h/(3*s);e.tickCount(_),i.tickCount(_),o.nice().range([h-c,0]);e.width;var d=e.width,f=c;e.translate(d,f).update(),i.translate(d,f).update()}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yDomain||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?n[1]:parseFloat(e[1])]}},{key:"xType",value:function(t){return arguments.length?(this._xType=t,this):this._xType}},{key:"yType",value:function(t){return arguments.length?(this._yType=t,this):this._yType}},{key:"xOrient",value:function(t){return arguments.length?(this._xOrient=t,this):this._xOrient}},{key:"yOrient",value:function(t){return arguments.length?(this._yOrient=t,this):this._yOrient}},{key:"yOrientRight",value:function(t){return arguments.length?(this._yOrientRight=t,this):this._yOrientRight}},{key:"xDomain",value:function(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"yDomain",value:function(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"xTitle",value:function(t){return arguments.length?(this._xTitle=t,this):this._xTitle}},{key:"yTitle",value:function(t){return arguments.length?(this._yTitle=t,this):this._yTitle}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"axisLabelShowLeft",value:function(t){return arguments.length?(this._axisLabelShowLeft=t,this):this._axisLabelShowLeft}},{key:"axisLabelShowRight",value:function(t){return arguments.length?(this._axisLabelShowRight=t,this):this._axisLabelShowRight}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"setPublicOption",value:function(t){u(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{},o=e.y1||{};this.axisLineStroke(e.color).xTitle(i.name).axisLabelShowLeft(n.labelShow).axisLabelShowRight(o.labelShow).xDomain(i.range).yDomain(n.range)}},{key:"widthOfCore",get:function(){var t=this.yAxis?this.yAxis.width:0,e=this.widthOfNoMargin-t;return 0<e?e:0}},{key:"heightOfCore",get:function(){var t=this.xAxis?this.xAxis.height:0,e=this.yAxis||this.yAxisDoubleY?this.yAxis.titleHeight||this.yAxisDoubleY.titleHeight:0,i=this.heightOfMainGroup-t-e;return 0<i?i:0}}]),a}(),Ni="axis-group",ji="y-slope-title",Yi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-slope"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e}return h(i,ft),s(i,[{key:"update",value:function(){var t=this,e=t._orient,i=t._scaleFunc,n=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(i):d3.axisLeft(i);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=n.select("."+Ni).empty()?n.append("g").attr("class",Ni):n.select("."+Ni);s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return a[e]}),s.selectAll(".tick line").style("stroke",t._lineStroke),s.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none")});var u=Math.abs(i.range()[0]-i.range()[1]);if(t._title="left"==e?t._title[0]:"right"==e?t._title[1]:t._title,t._titleShow&&t._title){var h=n.select("."+ji).empty()?n.append("g").attr("class",ji):n.select("."+ji),c=h.select("text").empty()?h.append("text"):h.select("text"),_=E(t._title,o,t._fontFamily);c.attr("x",_>=2*t.width?-_/2:0).attr("y",u+this._fontSize+4).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).style("text-anchor",_>=2*t.width?"start":"middle").text(t._title)}else n.select("."+ji).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);var s=d3.max(t,function(t){return E(t,r,e._fontFamily)});return s<=l?(i=t,n=s):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,console.log(e),e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),t}}]),i}(),Xi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","slope"),e._xScale=null,e._yScale=null,e._sWidth=null,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e.group;i.selectAll(".slope-lines").remove();var n=i.selectAll("line").data(t);n.exit().remove(),n.enter().append("line").attr("class","slope-lines").merge(n).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._lineWidth).style("stroke-dasharray",e._strokeDasharry).style("display","block").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).transition().duration(e._transition?e._duration:0).attr("x1",e._textLength).attr("y1",function(t){return t.data.length&&1==t.data[0].index?e._yScale(t.data[0].value):0}).attr("x2",e._sWidth).attr("y2",function(t){return 1<t.data.length?e._yScale(t.data[1].value):1==t.data.length&&2==t.data[0].index?e._yScale(t.data[0].value):0});for(var o=i.selectAll(".slope-lines").nodes(),a=0;a<o.length;a++)0==o[a].__data__.data.length?d3.select(o[a]).style("display","none"):1==o[a].__data__.data.length?o[a].__data__.data[0].tooltipValueShow||d3.select(o[a]).style("display","none"):2==o[a].__data__.data.length&&(o[a].__data__.data[0].tooltipValueShow&&o[a].__data__.data[1].tooltipValueShow||d3.select(o[a]).style("display","none"));return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}}]),i}(),Gi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","slope-scatter-plot"),e._xScale=null,e._yScale=null,e._sWidth=null,e._circleRadius=2,e._circleBorderWidth=1,e._circleBorderColor="#000",e._fill=null,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var o=this,t=o.group,a=o._data,r=(o._xScale,o._yScale);t.selectAll(".slope-circles").remove(),t.selectAll(".slopeTexts text").remove(),t.selectAll(".slopeNumbers text").remove();var e=t.selectAll("g").data(a);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var i=d3.select(this).selectAll("circle").data(t.data);i.exit().remove(),i.enter().append("circle").attr("class","slope-circles").merge(i).style("fill",o._fill||t.color).style("stroke",o._circleBorderColor||t.color).style("stroke-width",o._circleBorderWidth).attr("r",o._circleRadius).attr("cx",function(t){return 1==t.index?o._textLength:2==t.index?o._sWidth:void 0}).attr("cy",function(t){return r(t.value)||0})});var i=t.append("g").selectAll("g").data(a);i.exit().remove(),i.enter().append("g").attr("class","slope-text-groups").merge(i).each(function(t,e){var i=d3.select(this).append("g").attr("class","slopeNumbers").selectAll("text").data(t.data);i.exit().remove(),i.enter().append("text").merge(i).text(function(t){return t.value}).style("text-anchor",function(t){return 1==t.index?"end":2==t.index?"start":void 0}).attr("fill",o._fontColor).attr("font-size",o._fontSize).style("font-family",o._fontFamily).style("display","block").attr("x",function(t){return 1==t.index?o._textLength:2==t.index?o._sWidth:void 0}).attr("y",function(t){return r(t.value)||0}).attr("dx",function(t){return 1==t.index?"-0.5em":2==t.index?E(a[e].name,o._fontSize,o._fontFamily)+o._fontSize:void 0}).attr("dy","0.3em");var n=d3.select(this).append("g").attr("class","slopeTexts").selectAll("text").data(t.data);n.exit().remove(),n.enter().append("text").merge(n).text(a[e].name).style("text-anchor",function(t){return 1==t.index?"end":2==t.index?"start":void 0}).attr("fill",o._fontColor).attr("font-size",o._fontSize).style("font-family",o._fontFamily).style("display","block").attr("x",function(t){return 1==t.index?o._textLength:2==t.index?o._sWidth:void 0}).attr("y",function(t){return r(t.value)||0}).attr("dx",function(t){return 1==t.index?-(E(a[e].data[0].value,o._fontSize,o._fontFamily)+o._fontSize):2==t.index?"0.5em":void 0}).attr("dy","0.3em")});var n=t.selectAll(".slopeTexts text").nodes().filter(function(t,e,i){return e%2==0}),l=t.selectAll(".slopeTexts text").nodes().filter(function(t,e){return e%2!=0}),s=t.selectAll(".slopeNumbers text").nodes().filter(function(t,e,i){return e%2==0}),u=t.selectAll(".slopeNumbers text").nodes().filter(function(t,e){return e%2!=0});null!=o._axisLabelShowLeft&&null!=o._axisLabelShowRight||(d3.selectAll(s).attr("fill","none"),d3.selectAll(u).attr("fill","none")),null==o._labelShow||null==o._positionOptions||null==o._positionChoice?(d3.selectAll(n).attr("fill","none"),d3.selectAll(l).attr("fill","none"),d3.selectAll(u).attr("dx","0.5em"),d3.selectAll(s).attr("dx","-0.5em")):0==o._labelShow?(d3.selectAll(n).attr("fill","none"),d3.selectAll(l).attr("fill","none"),d3.selectAll(u).attr("dx","0.5em"),d3.selectAll(s).attr("dx","-0.5em")):0==o._positionOptions.indexOf(o._positionChoice)?(d3.selectAll(l).attr("fill","none"),d3.selectAll(u).attr("dx","0.5em"),(0==o._axisLabelShowLeft&&1==o._axisLabelShowRight||0==o._axisLabelShowLeft&&0==o._axisLabelShowRight)&&d3.selectAll(n).attr("dx","-0.5em")):1==o._positionOptions.indexOf(o._positionChoice)?(d3.selectAll(n).attr("fill","none"),d3.selectAll(s).attr("dx","-0.5em")):2==o._positionOptions.indexOf(o._positionChoice)&&(0==o._axisLabelShowLeft&&1==o._axisLabelShowRight||0==o._axisLabelShowLeft&&0==o._axisLabelShowRight)&&d3.selectAll(n).attr("dx","-0.5em"),0==o._axisLabelShowLeft&&d3.selectAll(s).attr("fill","none"),0==o._axisLabelShowRight&&d3.selectAll(u).attr("fill","none");var h=t.selectAll(".slope-circles").nodes(),c=t.selectAll(".slopeTexts text").nodes(),p=t.selectAll(".slopeNumbers text").nodes(),_=c.concat(p);d3.selectAll(_);!function(t){for(var e=t,i=[],n=[],o=0;o<e._groups[0].length;o++){n.push(o);for(var a=o+1;a<e._groups[0].length;a++)rt(at(d3.select(e._groups[0][o])),at(d3.select(e._groups[0][a])))&&(i.push(o),d3.select(e._groups[0][o]).style("opacity","0"),d3.select(p[o]).style("opacity","0"))}for(var r=new Set(i),l=Array.from(r),s=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(l,n),u=0;u<l.length;u++){for(var h=[],c=0;c<s.length;c++){var _=at(d3.select(e._groups[0][l[u]])),d=at(d3.select(e._groups[0][s[c]]));if(h.push(rt(_,d)),rt(_,d)){if(l[u]==s[c])continue;d3.select(e._groups[0][l[u]]).style("opacity","0"),d3.select(p[l[u]]).style("opacity","0")}}0==h.filter(function(t){return 1==t}).length&&s.push(l[u])}for(var f=0;f<s.length;f++)d3.select(e._groups[0][s[f]]).style("opacity","1"),d3.select(p[s[f]]).style("opacity","1")}(d3.selectAll(c));for(var d=0;d<h.length;d++)h[d].__data__.tooltipValueShow||d3.select(h[d]).style("opacity","0");for(var f=0;f<c.length;f++)c[f].__data__.tooltipValueShow||d3.select(c[f]).style("opacity","0");for(var y=0;y<p.length;y++)p[y].__data__.tooltipValueShow||d3.select(p[y]).style("opacity","0");return o}},{key:"circleRadius",value:function(t){return arguments.length?(this._circleRadius=t,this):this._circleRadius}},{key:"circleBorderWidth",value:function(t){return arguments.length?(this._circleBorderWidth=t,this):this._circleBorderWidth}},{key:"circleBorderColor",value:function(t){return arguments.length?(this._circleBorderColor=t,this):this._circleBorderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"axisLabelShowLeft",value:function(t){return arguments.length?(this._axisLabelShowLeft=t,this):this._axisLabelShowLeft}},{key:"axisLabelShowRight",value:function(t){return arguments.length?(this._axisLabelShowRight=t,this):this._axisLabelShowRight}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"numberLength",value:function(t){return arguments.length?(this._numberLength=t,this):this._numberLength}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}}]),i}(),Bi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","slopeOverlay-polygon"),e._width=0,e._height=0,e._shadowColor="#000",e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e.group,n=i.selectAll("polygon").data(t);n.exit().remove(),n.enter().append("polygon").attr("class","slope-polygons").merge(n).style("fill",e._shadowColor).style("fill-opacity",.85).style("opacity",0).style("transition","transform 0.15s").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).transition().duration(e._transition?e._duration:0).attr("points",function(t){return e._textLength+","+((0<t.data.length?e._yScale(t.data[0].value):0)+.012*e._sHeight)+"\n        "+e._sWidth+","+((1<t.data.length?e._yScale(t.data[1].value):0)+.012*e._sHeight)+" \n        "+e._sWidth+","+((1<t.data.length?e._yScale(t.data[1].value):0)-.012*e._sHeight)+" \n        "+e._textLength+","+((0<t.data.length?e._yScale(t.data[0].value):0)-.012*e._sHeight)});for(var o=i.selectAll(".slope-polygons").nodes(),a=0;a<o.length;a++)0==o[a].__data__.data.length?d3.select(o[a]).style("display","none"):1==o[a].__data__.data.length?o[a].__data__.data[0].tooltipValueShow||d3.select(o[a]).style("display","none"):2==o[a].__data__.data.length&&(o[a].__data__.data[0].tooltipValueShow&&o[a].__data__.data[1].tooltipValueShow||d3.select(o[a]).style("display","none"));return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),i}();function Ei(t,e){var i=0,n=!1;if(e.forEach(function(t){"objCol"===t.function&&(i=t.index,n=t.isLegend)}),W(t,[i],2))return[];var o=T(t,e),a={},r=[],l=o.length,s=o[0];if(n)for(var u=1;u<l;u++){var h=o[u],c=h[i];if(c){for(var _={name:c,index:u-1,data:[]},d=0;d<3;d++){var f=s[d];d!==i&&_.data.push({name:f,value:""==h[d]||isNaN(parseFloat(h[d]))||null==h[d]||null==h[d]?0:h[d],tooltipValueShow:!isNaN(parseFloat(h[d])),index:d})}r.push(_)}}else{s.forEach(function(t,e){e!==i&&t&&(a[t]={name:t,index:e-1,data:[]})});for(var p=1;p<l;p++){var y=o[p],g=y[i];if(g)for(var v=0;v<y.length+1;v++){var m=s[v];v!==i&&m&&a[m].data.push({name:g,index:p,value:""==y[v]||null==y[v]||null==y[v]?0:y[v],tooltipValueShow:!isNaN(parseFloat(y[v]))})}}for(var x in a)r.push(a[x])}return r.forEach(function(t,e){t.key=D(t.name)+"-"+e}),r}var Hi=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","slope-chart"),e.yAxis=new Yi(e.mainGroup),e.yAxisDoubleY=new Yi(e.mainGroup),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.slopeOverlay=new Bi(e.coreGroup),e.slope=new Xi(e.coreGroup),e.scatterPlot=new Gi(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._curve=d3.curveCardinal,e._showPoints=!0,e._marginRight=0,e._marginLeft=20,e._circleRadius=3.5,e._lineWidth=2,e._circleBorderWidth=1,e._circleBorderColor=null,e._shadowColor="#ccc",e._labelShow=!0,e._positionOptions=["左侧","右侧","两侧"],e._positionChoice="两侧",e._axisLabelShowLeft=!0,e._axisLabelShowRight=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(o,Ri),s(o,[{key:"updateCore",value:function(){var r=this,t=r.activeData,e=r.slopeOverlay,i=r.slope,n=r.scatterPlot,o=(r.tooltip,r.xScale),a=r.yScale,l=(r.widthOfCore,r.heightOfCore);r.widthOfNoMargin;for(var s=function(t){for(var e,i=0;i<t.length;i++)for(var n=i;n<t.length;n++)0<t[i].data.length&&t[i].data[0].value<t[n].data[0].value&&(e=t[n],t[n]=t[i],t[i]=e);return t}(t),u=0;u<s.length;u++)s[u].index=u;for(var h=[],c=0;c<t.length;c++)h.push(t[c].name);for(var _=[],d=0;d<t.length;d++)0<t[d].data.length&&_.push(t[d].data[0].value),1<t[d].data.length&&_.push(t[d].data[1].value);var f=0<t.length&&0<t[0].data.length?et(h,r._fontSize,r._fontFamily):0,p=0<t.length&&0<t[0].data.length?et(_,r._fontSize,r._fontFamily):0,y=f+p,g=r.widthOfNoMargin-f-p;null==r._labelShow||0==r._labelShow||null==r._positionOptions||null==r._positionChoice?(r.yAxis.translate(9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-p,0),g=r.widthOfNoMargin-p,y=p,0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-p,0),g=r.widthOfNoMargin-p,y=0):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),g=r.widthOfNoMargin,y=p):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),g=r.widthOfNoMargin,y=0)):0==r._positionOptions.indexOf(r._positionChoice)?(r.yAxis.translate(f+9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-p,0),g=r.widthOfNoMargin-p,0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-p,0),g=r.widthOfNoMargin-p,y=f):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(f+9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),g=r.widthOfNoMargin):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),g=r.widthOfNoMargin,y=f)):1==r._positionOptions.indexOf(r._positionChoice)?(r.yAxis.translate(9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin-f+9-p,0),y=p,0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-p-f,0),g=r.widthOfNoMargin-p-f,y=0):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),g=r.widthOfNoMargin-f,y=p):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),g=r.widthOfNoMargin-f,y=0)):2==r._positionOptions.indexOf(r._positionChoice)&&(r.yAxis.translate(f+9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin-f+9-p,0),0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-p-f,0),g=r.widthOfNoMargin-p-f,y=f):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(f+9+p,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),g=r.widthOfNoMargin-f):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),g=r.widthOfNoMargin-f,y=f)),n.data(s).xScale(o).yScale(a).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).axisLabelShowLeft(r._axisLabelShowLeft).axisLabelShowRight(r._axisLabelShowRight).textLength(y).numberLength(p).sWidth(g).circleBorderColor(r._circleBorderColor).circleBorderWidth(r._circleBorderWidth).circleRadius(r._circleRadius),i.data(s).xScale(o).yScale(a).textLength(y).sWidth(g).lineWidth(r._lineWidth).onMouseover(function(t,e){var i=d3.selectAll(".slope-chart .slope-scatter-plot circle").nodes(),n=r.coreGroup.selectAll("polygon").nodes(),o=d3.select(this).node().__data__.index;d3.select(n[o]).style("opacity",.45),d3.select(i[2*o+1]).attr("r",1.8*r._circleRadius),d3.select(i[2*o]).attr("r",1.8*r._circleRadius);var a=[{text:t.name,color:t.color},{text:t.data[0].name+": "+(t.data[0].tooltipValueShow?t.data[0].value:""),color:"none"},{text:t.data[1].name+": "+(t.data[1].tooltipValueShow?t.data[1].value:""),color:"none"}];r.tooltip.data(a).update().show()}).onMousemove(function(){r.tooltip.move();var t=d3.selectAll(".slope-chart .slope-scatter-plot circle").nodes(),e=r.coreGroup.selectAll("polygon").nodes(),i=d3.select(this).node().__data__.index;d3.select(e[i]).style("opacity",.45),d3.select(t[2*i+1]).attr("r",1.8*r._circleRadius),d3.select(t[2*i]).attr("r",1.8*r._circleRadius)}).onMouseout(function(t){r.tooltip.hide();var e=d3.selectAll(".slope-chart .slope-scatter-plot circle").nodes(),i=r.coreGroup.selectAll("polygon").nodes(),n=d3.select(this).node().__data__.index;d3.select(i[n]).style("opacity",0),d3.select(e[2*n+1]).attr("r",r._circleRadius),d3.select(e[2*n]).attr("r",r._circleRadius)}),e.data(s).xScale(o).yScale(a).textLength(y).sWidth(g).sHeight(l).shadowColor(r._shadowColor).onMouseover(function(t,e){var i=r.coreGroup.selectAll("circle").nodes(),n=d3.select(this).node().__data__.index;d3.select(this).style("opacity",.35),d3.select(i[2*n+1]).attr("r",1.8*r._circleRadius),d3.select(i[2*n]).attr("r",1.8*r._circleRadius);var o=[{text:t.name,color:t.color},{text:t.data[0].name+": "+(t.data[0].tooltipValueShow?t.data[0].value:""),color:"none"},{text:t.data[1].name+": "+(t.data[1].tooltipValueShow?t.data[1].value:""),color:"none"}];r.tooltip.data(o).update().show()}).onMousemove(function(){r.tooltip.move();var t=r.coreGroup.selectAll("circle").nodes(),e=d3.select(this).node().__data__.index;d3.select(this).style("opacity",.35),d3.select(t[2*e+1]).attr("r",1.8*r._circleRadius),d3.select(t[2*e]).attr("r",1.8*r._circleRadius)}).onMouseout(function(t){r.tooltip.hide();var e=r.coreGroup.selectAll("circle").nodes(),i=d3.select(this).node().__data__.index;d3.select(this).style("opacity",0),d3.select(e[2*i+1]).attr("r",r._circleRadius),d3.select(e[2*i]).attr("r",r._circleRadius)}),r.coreGroup.call(B,r.yAxis.width+.5,0),e.update(),i.update(),n.translate(r.yAxis.width+.5,0).update()}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=Ei;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t.map(function(t){return t.name}):[0,1]),i=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=e,this._yDomain=i}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.y.name||null,n=e.y1.name||null;this.yTitle([i,n])}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._circleRadius=0==e.circleRadius||e.circleRadius?e.circleRadius:this._circleRadius,this._lineWidth=e.lineWidth?e.lineWidth:this._lineWidth,this._circleBorderWidth=e.circleBorderWidth?e.circleBorderWidth:this._circleBorderWidth,this._circleBorderColor=e.circleBorderColor?e.circleBorderColor:this._circleBorderColor,this._shadowColor=e.shadowColor?e.shadowColor:this._shadowColor),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"widthOfNoMargin",get:function(){var t=this._width-3*this._marginLeft-this._marginRight;return 0<t?t:0}}]),o}(),Vi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bar-progress"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"bg",value:function(){var e=this,t=e._data;e.group.selectAll(".bg-rect").remove();var i=e.group.append("g").selectAll("rect").data(t,function(t){return t.key});i.exit().remove();var n=i.enter().append("rect").attr("class","bg-rect").merge(i).style("fill",function(t){return t.color_special}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return t.color_special}).style("stroke-width",function(t){return e._strokeWidth||0});return this._rectObj?n.attr("x",this._rectObj.xFunc).attr("y",this._rectObj.yFunc).attr("width",this._rectObj.widthFunc).attr("height",this._rectObj.heightFunc):n.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),e}},{key:"update",value:function(){var e=this,t=e._data;e.group.selectAll(".progress-rect").remove();var i=e.group.append("g").selectAll("rect").data(t,function(t){return t.key});i.exit().remove();var n=i.enter().append("g"),o=n.append("rect").attr("class","progress-rect").merge(i).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return e._strokeColor||t.color}).style("stroke-width",function(t){return e._strokeWidth||0});return e._rectObj?(o.attr("x",e._rectObj.xFunc),o.attr("y",e._rectObj.yFunc),o.attr("width",e._rectObj.widthFunc),o.attr("height",e._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),e._textObj&&(e.group.selectAll(".bar-text").remove(),n.append("text").attr("class","bar-text").merge(i).text(e._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",e._textObj.xFunc).attr("y",e._textObj.yFunc).attr("dx",e._textObj.dxFunc).attr("dy",e._textObj.dyFunc).style("display",e._labelShow?"block":"none")),o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),Ii=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bar-progress-chart"),e.rect=new Vi(e.mainGroup),e.rectBg=new Vi(e.mainGroup),e._labelShow=!1,e._positionOptions=["内部居右","内部居中"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var n=this,t=n.rect,e=n.rectBg,i=n.activeData,o=.9*n.widthOfNoMargin,a=.9*n.heightOfMainGroup;var r,l,s,u=(s=.15*(r=o),(l=a)<r/5&&(s=.6*l),s);e.data(i).rectObj({xFunc:function(t){return o*t.value},yFunc:a/2.1,widthFunc:function(t){return o*(1-t.value)},heightFunc:u}),t.data(i).labelShow(n._labelShow).rectObj({xFunc:0,yFunc:a/2.1,widthFunc:function(t){return o*t.value},heightFunc:u}).textObj({xFunc:function(t){return t.value},yFunc:a/2.1,dyFunc:u/2+.4*n._textLabel.fontSize,dxFunc:function(t,e){return 0==n._positionOptions.indexOf(n._positionChoice)?o*t.value-E((100*t.value).toFixed(1)+"%",n._textLabel.fontSize,n._fontFamily)-5:1==n._positionOptions.indexOf(n._positionChoice)?o*t.value/2-.5*E((100*t.value).toFixed(1)+"%",n._textLabel.fontSize,n._fontFamily):void 0},colorFunc:function(){return n._labelShow?n._textLabel.color:"none"},textFunc:function(t){return(100*t.value).toFixed(1)+"%"},fontSize:n._textLabel.fontSize,fontFamily:n._textLabel.fontFamily}).fillOpacity(1).onMouseover(function(t,e){var i=[{text:t.name+": "+(100*t.value).toFixed(1)+"%",color:t.color}];n.tooltip.data(i).update().show()}).onMousemove(function(){n.tooltip.move()}).onMouseout(function(t){n.tooltip.hide()}),n.rect.translate(.1*n.widthOfNoMargin/2,0).update(),n.rectBg.translate(.1*n.widthOfNoMargin/2,0).bg()}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Mi;switch(i.dataType){case"cross-table":n=_;break;default:n=Mi}return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.label;0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel);var i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY)}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}}]),i}(),Zi=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","polygon-radar"),e._lineFunc=null,e._startAngle=0,e._endAngle=2*Math.PI,e._radius=100,e._stroke=null,e._borderWidth=2,e._strokeDasharry="",e._transition=!0,e}return h(i,M),s(i,[{key:"update",value:function(){for(var n=this,t=n._data,o=(n.startAngle,n.endAngle,n._radius),e=t.length?[0,1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return parseFloat(+t.value)})})]:[0,1],i=d3.scaleLinear().domain(e).nice().range([0,o]),a=n._deadData[0].data.length,r=2*Math.PI/a,l=[],s=0;s<t.length;s++){l[s]=[];for(var u=0;u<t[s].data.length;u++){var h=t[s].data[u].value;l[s][u]=i(h)}}for(var c=[],_=0;_<l.length;_++)for(var d=l[_],f="",p=[],y=0;y<a;y++){var g=d[y],v=g*Math.sin(y*r),m=-g*Math.cos(y*r);f+=v+","+m+" ",p.push({x:v,y:m,value:t[_].data[y].value}),c[_]={polygon:f,points:p}}var x=n.group,S=x.selectAll("polygon").data(t);S.exit().remove(),S.enter().append("polygon").merge(S).style("fill","none").style("stroke-opacity",n._fillOpacity).style("stroke",function(t){return n._stroke||t.color||"#000"}).style("stroke-width",n._borderWidth).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).transition().duration(n._transition?n._duration:0).attr("points",function(t,e){return c[e].polygon}),x.selectAll(".circle-g").remove();var k=x.append("g").selectAll("g").data(t);k.exit().remove(),k.enter().append("g").attr("class","circle-g").merge(k).each(function(t,e){var i=d3.select(this).selectAll("circle").data(c[e].points);i.exit().remove(),i.enter().append("circle").attr("class","circle-"+e).attr("cx",function(t){return t.x||0}).attr("cy",function(t){return t.y||0}).merge(i).style("fill",t.color).style("stroke","#FFFFFF").style("stroke-width",1).style("stroke-width",n._strokeWidth).attr("r",n._endPointRadius).attr("cx",function(t){return t.x||0}).attr("cy",function(t){return t.y||0})}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);for(var b=[],w=0;w<a;w++){for(var O=[],C=0;C<c.length;C++)O.push(c[C].points[w].value);b.push(d3.max(O))}x.selectAll(".polygon-radar-texts").remove();var F=x.append("g").selectAll("g").data(t);F.exit().remove(),F.enter().append("g").merge(F).each(function(t,e){var i=d3.select(this).append("g").selectAll("text").data(c[e].points);i.exit().remove(),i.enter().append("text").attr("class","polygon-radar-texts").merge(i).text(function(t,e){return t.value}).attr("fill",n._fontColor).attr("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return t.value==b[e]?t.x+.06*o*(e*r==1.5*Math.PI?-1:Math.sin(e*r))||0:t.x-.06*o*Math.sin(e*r)||0}).attr("y",function(t,e){return t.value==b[e]?t.y+.06*o*(e*r==0?1.5:Math.cos(e*r))+(e*r==0?n._fontSize/2.5:0)||0:t.y-.06*o*(e*r==Math.PI?-1.5:Math.cos(e*r))+(e*r==Math.PI?n._fontSize/2.5:0)||0}).attr("text-anchor",function(t,e){return e*r==0||e*r==Math.PI?"middle":e*r>Math.PI&&t.value!=b[e]?"start":e*r>Math.PI&&t.value==b[e]||0<e*r&&e*r<Math.PI&&t.value!=b[e]?"end":void 0}).attr("dy",function(t,e){if(t.value==b[e])if(t.value==d3.max(b)){if(e*r<Math.PI/2||e*r>1.5*Math.PI)return"0.7em";if(e*r>Math.PI/2&&e*r<1.5*Math.PI)return"-0.7em";if(e*r==Math.PI/2||e*r==1.5*Math.PI)return"1.1em"}else{if(e*r==0)return"0.1em";if(e*r==Math.PI)return"0";if(e*r<Math.PI/2||e*r>1.5*Math.PI)return"0.5em";if(e*r>Math.PI/2&&e*r<1.5*Math.PI)return"-0.5em";if(e*r==Math.PI/2||e*r==1.5*Math.PI)return"0.9em"}else if(t.value!=b[e])return e*r==0||e*r>Math.PI&&e*r<1.5*Math.PI?0:"0.4em"}).style("display",n._labelShow?"block":"none")});for(var P=[],z=1.06*o,A=0;A<a;A++){var L=z*Math.sin(A*r),M=-z*Math.cos(A*r);P.push({x:L,y:M})}x.selectAll(".angle-text").remove();var D=x.append("g").selectAll("text").data(P);D.exit().remove(),D.enter().append("text").attr("class","angle-text").text(function(t,e){return n._deadData[0].data[e].name=="&-"+(e+1)?"":n._deadData[0].data[e].name}).style("font-size",n._themeFontSize).style("font-family",n._themeFontFamily).style("fill",n._themeFontColor).attr("x",function(t){return t.x}).attr("y",function(t){return t.y});for(var W=0;W<a;W++)W*r==0||W*r==Math.PI?d3.select(x.selectAll(".angle-text").nodes()[W]).attr("text-anchor","middle"):W*r>Math.PI?d3.select(x.selectAll(".angle-text").nodes()[W]).attr("text-anchor","end"):0<W*r&&W*r<Math.PI&&d3.select(x.selectAll(".angle-text").nodes()[W]).attr("text-anchor","start");for(var T=0;T<a;T++)T*r==Math.PI&&d3.select(x.selectAll(".angle-text").nodes()[T]).attr("dy","0.8em");for(var R=x.selectAll(".polygon-radar-texts"),N=[],j=[],Y=0;Y<R._groups[0].length;Y++){j.push(Y);for(var X=Y+1;X<R._groups[0].length;X++){rt(at(d3.select(R._groups[0][Y])),at(d3.select(R._groups[0][X])))&&(N.push(Y),d3.select(R._groups[0][Y]).style("opacity","0"))}}for(var G=new Set(N),B=Array.from(G),E=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(B,j),H=0;H<B.length;H++){for(var V=[],I=0;I<E.length;I++){var Z=at(d3.select(R._groups[0][B[H]])),Q=at(d3.select(R._groups[0][E[I]]));if(V.push(rt(Z,Q)),rt(Z,Q)){if(B[H]==E[I])continue;d3.select(R._groups[0][B[H]]).style("opacity","0")}}0==V.filter(function(t){return 1==t}).length&&E.push(B[H])}for(var q=0;q<E.length;q++)d3.select(R._groups[0][E[q]]).style("opacity","1");return n}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"deadData",value:function(t){return arguments.length?(this._deadData=t,this):this._deadData}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"themeFontColor",value:function(t){return arguments.length?(this._themeFontColor=t,this):this._themeFontColor}},{key:"themeFontSize",value:function(t){return arguments.length?(this._themeFontSize=t,this):this._themeFontSize}},{key:"themeFontFamily",value:function(t){return arguments.length?(this._themeFontFamily=t,this):this._themeFontFamily}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),i}(),Qi="grid-polygon-path",qi="grid-line",Ui=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","polygon-grid"),e.group=e.elem.append("g"),e._radius=100,e._startAngle=0,e._endAngle=2*Math.PI,e._donutCount=5,e._sectorCount=8,e}return h(i,Q),s(i,[{key:"update",value:function(){for(var e=this,t=e._data,i=(e._startAngle,e._endAngle,e._radius),n=e._donutCount,o=t[0].data.length||e._sectorCount,a=2*Math.PI/o,r={webs:[],webPoints:[]},l=n;0<l;l--){for(var s="",u=[],h=i/n*l,c=0;c<o;c++){var _=h*Math.sin(c*a),d=-h*Math.cos(c*a);s+=_+","+d+" ",u.push({x:_,y:d})}r.webs.push(s),r.webPoints.push(u)}var f=e.group.style("fill","none").style("stroke",e._stroke).style("stroke-dasharray","none");!function(){if(!e._showX)return f.selectAll("."+Qi).remove();var t=f.selectAll("."+Qi).data(r.webs);t.exit().remove(),t.enter().append("polygon").attr("class",Qi).merge(t).attr("points",function(t){return t}).attr("fill","white").attr("fill-opacity",1),d3.selectAll(t.nodes().filter(function(t,e){return e%2!=0})).attr("fill","#e4e3e6").attr("fill-opacity",.4)}(),function(){if(!e._showY)return f.selectAll("."+qi).remove();var t=f.selectAll("."+qi).data(r.webPoints[0]);t.exit().remove(),t.enter().append("line").attr("class",qi).merge(t).attr("x1",0).attr("y1",0).attr("x2",function(t){return t.x}).attr("y2",function(t){return t.y})}()}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=parseFloat(t),this):this._donutCount}},{key:"sectorCount",value:function(t){return arguments.length?(this._sectorCount=parseFloat(t),this):this._sectorCount}}]),i}();function Ki(t,e){var i=0,n=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(i=t.index,n=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),W(t,[i],2))return[];var a=T(t,e),r={},l=[],s=a.length,u=a[0];if(n){for(var h=[],c=1;c<s;c++)h.push(a[c].length);h.sort(function(t,e){return e-t});for(var _=1;_<h[0];_++)if(_!==i){var d=u[_];""!=u[_]&&null!=u[_]&&null!=u[_]||(d="$-"+_),r[d+"-"+_]={name:d,showLegend:d!="$-"+_,data:[]}}for(var f=1;f<s;f++){var p=a[f],y=p[i];if(""!=y&&null!=y&&null!=y||(y="&-"+f),y)for(var g=0;g<h[0];g++){var v=u[g];""!=u[g]&&null!=u[g]&&null!=u[g]||(v="text-"+g),g!==i&&v&&r[v+"-"+g].data.push({name:y,showAxisText:y!="&-"+f,value:""==p[g]||isNaN(parseFloat(p[g]))||null==p[g]||null==p[g]?0:p[g],tooltipValueShow:!isNaN(parseFloat(p[g]))})}}for(var m in r)l.push(r[m])}else{for(var x=[],S=1;S<s;S++)x.push(a[S].length);x.sort(function(t,e){return e-t});for(var k=1;k<s;k++){var b=a[k],w=b[i];if(""!=w&&null!=w&&null!=w||(w="$-"+k),w){for(var O={name:w,showLegend:w!="$-"+k,data:[]},C=0;C<x[0];C++){var F=u[C];""!=F&&null!=F&&null!=F||(F="&-"+C),C!==i&&O.data.push({name:F,showAxisText:F!="&-"+C,value:""==b[C]||isNaN(parseFloat(b[C]))||null==b[C]||null==b[C]?0:b[C],tooltipValueShow:!isNaN(parseFloat(b[C]))})}l.push(O)}}}return l.forEach(function(t,e){t.key=D(t.name)+"-"+e}),l}var Ji=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.gridPolygon=new Ui(e.mainGroup),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.radar=new Zi(e.coreGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._showPoints=!0,e._fillOpacity=0,e._endPointRadius=3.5,e._borderWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,J),s(i,[{key:"updateCore",value:function(){var a=this,r=a.activeData,t=a.gridPolygon,e=a.radar,i=(a.tooltip,a.widthOfCore,a.heightOfCore,a.widthOfNoMargin),n=a.heightOfMainGroup,o=A(.84*i,.84*a.heightOfMainGroup,a._startAngle,a._endAngle).radius;e.data(r).deadData(a.sortedDataCopy).fontSize(a._textLabel.fontSize).fontColor(a._textLabel.color).fontFamily(a._textLabel.fontFamily).themeFontSize(a._fontSize).themeFontColor(a._fontColor).themeFontFamily(a._fontFamily).fillOpacity(.6).labelShow(a._labelShow).radius(o).borderWidth(a._borderWidth).endPointRadius(a._endPointRadius).onMouseover(function(t,e){var i=[{text:r[e].name=="$-"+(e+1)?"":r[e].name,color:r[e].color}];r[e].data.forEach(function(t,e){i.push({text:(t.name=="&-"+(e+1)?"":t.name)+": "+t.value,color:"none"})}),d3.select(this).style("stroke-opacity",1).style("stroke-width",1.5*a._borderWidth);var n=a.group.selectAll(".circle-g").nodes(),o=a.group.selectAll(".polygon-radar polygon").nodes();d3.selectAll(n[e].childNodes).style("r",1.5*a._endPointRadius),d3.select(o[e]).style("stroke-width",1.5*a._borderWidth),a.tooltip.data(i).update().show()}).onMousemove(function(t,e){d3.select(this).style("stroke-opacity",1).style("stroke-width",1.5*a._borderWidth);var i=a.group.selectAll(".circle-g").nodes(),n=a.group.selectAll(".polygon-radar polygon").nodes();d3.select(n[e]).style("stroke-width",1.5*a._borderWidth),d3.selectAll(i[e].childNodes).style("r",1.5*a._endPointRadius),a.tooltip.move()}).onMouseout(function(t,e){d3.select(this).style("stroke-opacity",.8).style("stroke-width",a._borderWidth);var i=a.group.selectAll(".circle-g").nodes(),n=a.group.selectAll(".polygon-radar polygon").nodes();d3.select(n[e]).style("stroke-width",a._borderWidth),d3.selectAll(i[e].childNodes).style("r",a._endPointRadius),a.tooltip.hide()}),t.data(a.sortedDataCopy).radius(o).fillOpacity(null==a._fillOpacity?0:a._fillOpacity).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray);var l=(a._width-a._marginLeft-a._marginRight)/2;a.gridPolygon.translate(l,n/2).update(),a.coreGroup.call(B,l,n/2),t.update(),e.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=Ki;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.fillOpacity(e.fillOpacity).endPointRadius(e.endPointRadius).borderWidth(e.borderWidth)}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"widthOfNoMargin",get:function(){var t=this._width-3*this._marginLeft-this._marginRight;return 0<t?t:0}}]),i}(),$i="axis-group",tn="y-ranking-title",en=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-ranking"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e}return h(i,ft),s(i,[{key:"update",value:function(){var t=this,e=t._orient,i=t._scaleFunc,n=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(i):d3.axisLeft(i);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=n.select("."+$i).empty()?n.append("g").attr("class",$i):n.select("."+$i);s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return a[e]}),s.selectAll(".tick line").style("stroke",t._lineStroke).style("display","none"),s.select("path").style("stroke",t._lineStroke).style("display","none")});var u=Math.abs(i.range()[0]-i.range()[1]);if(t._titleShow&&t._title){var h=n.select("."+tn).empty()?n.append("g").attr("class",tn):n.select("."+tn),c=h.select("text").empty()?h.append("text"):h.select("text");E(t._title,o,t._fontFamily);h.call(B,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-5).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else n.select("."+tn).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);(t="category"===a?o.domain():o.ticks(e._tickCount)).push(1),t.splice(t.indexOf(0),1);var s=d3.max(t,function(t){return E(t,r,e._fontFamily)});return s<=l?(i=t,n=s):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+24:0):this._titleShow&&this._title?1.125*this._fontSize+24:0),t}}]),i}(),nn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.grid=new zt(e.coreGroup),e.linePlot=new Dt(e.coreGroup),e.scatterPlot=new Wt(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new en(e.mainGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new Wt(e.coreGroup),e.stackText=new wt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._curve=d3.curveCardinal,e._showPoints=!0,e._endPointRadius=3.5,e._lineShadowColor="#ccc",e._lineWidth=2,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="下面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var t=this,i=t.activeData,e=t.grid,n=t.linePlot,o=t.scatterPlot,r=t.tooltip,a=t.overlay,l=t.guideLine,s=t.guideScatter,u=t.stackText,h=t.xScale,c=t.yScale,_=t.widthOfCore,d=t.heightOfCore;t.xAxis,t.yAxis;e.width(_).height(d).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),n.data(i).xScale(h).yScale(c).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).mainGroup(t.mainGroup).lineWidth(t._lineWidth),o.data(i).xScale(h).yScale(c).radius(t._endPointRadius).fill("#fff").strokeWidth(2),l.y1(0).y2(d).strokeDasharray(t._gridStrokeDasharray),s.xScale(h).yScale(c).radius(t._endPointRadius).fill("#fff"),a.data(h.domain()).isScalePoint(!1).bandWidth(h.step()).bandHeight(d).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),r.data(o).update().show(),l.x(h(n)+h.bandwidth()/2).update().show(),s.data(a).update().show()}).onMousemove(function(){r.move()}).onMouseout(function(){r.hide(),l.hide(),s.hide()}),u.data(i).xScale(h).yScale(c).type("mix").fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice),t.coreGroup.call(B,t.yAxis.width+.5,0),s.elem.style("pointer-events","none");var f=t.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(f).remove(),a.update(),e.update(),n.update(),t._showPoints?o.update().show():o.hide(),u.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t[0].data.map(function(t){return t.name}):[0,1]),i=t.length?[d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0)]:[1,0];this._xDomain=e,this._yDomain=i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._endPointRadius=0==e.endPointRadius||e.endPointRadius?e.endPointRadius:this._endPointRadius,this._lineShadowColor=e.lineShadowColor?e.lineShadowColor:this._lineShadowColor,this._lineWidth=e.lineWidth?e.lineWidth:this._lineWidth),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Lt;return i.dataSolveFunc(n),i}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}}]),i}(),on="axis-group",an="y-percent-title",rn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-percent"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return h(i,ft),s(i,[{key:"update",value:function(){var t=this,e=t._orient,i=t._scaleFunc,n=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(i):d3.axisLeft(i);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=n.select("."+on).empty()?n.append("g").attr("class",on):n.select("."+on);s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("dx",.6*-o).attr("dy",.4*o).text(function(t,e){return 100*a[e]+"%"}),s.selectAll(".tick line").style("stroke",t._lineStroke).style("display","none"),s.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none").style("display","none")});var u=Math.abs(i.range()[0]-i.range()[1]);if(t._titleShow&&t._title){var h=n.select("."+an).empty()?n.append("g").attr("class",an):n.select("."+an),c=h.select("text").empty()?h.append("text"):h.select("text");E(t._title,o,t._fontFamily);h.call(B,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-5).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else n.select("."+an).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);var s=d3.max(t,function(t){return E(t,r,e._fontFamily)})+r;return s<=l?(i=t,n=s):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+24:0):this._titleShow&&this._title?1.125*this._fontSize+24:0),t}}]),i}(),ln=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","percentage-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var o=this,t=o._data,n=o.group;n.selectAll(".percentageStackBar").remove();var e=n.append("g").selectAll("g").data(t);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var i=o._rectObj.barWidthPercent,n=d3.select(this).selectAll("rect").data(t.data);n.exit().remove(),n.enter().append("rect").attr("class","percentageStackBar").merge(n).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return o._fillOpacity}).style("stroke",function(t){return o._strokeColor||t.color}).style("stroke-width",function(t){return o._strokeWidth||0}).attr("x",function(t,e){return o._xScale.step()*e+o._xScale.step()*(1-i)/2}).attr("y",function(t){return o._yScale(t.total)}).attr("width",o._xScale.step()*i).attr("height",function(t){return 0<o._yScale(1-t.percent)?o._yScale(1-t.percent):0}),n.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),n.selectAll(".percentageStackBarTexts").remove();var i=n.append("g").selectAll("g").data(t);i.exit().remove(),i.enter().append("g").merge(i).each(function(t,e){var i=d3.select(this).append("g").attr("class","percentageStackBarTexts").selectAll("text").data(t.data);i.exit().remove(),i.enter().append("text").merge(i).text(function(t){return null==o._contentOption||null==o._contentChoice?0==t.value?"":t.value:0==o._contentOption.indexOf(o._contentChoice[0])?0==t.value?"":(100*parseFloat(t.percent)).toFixed(2)+"%":1==o._contentOption.indexOf(o._contentChoice[0])?0==t.value?"":t.value:void 0}).attr("fill",o._textObj.colorFunc).attr("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return o._xScale.step()*e+.25*o._xScale.step()}).attr("y",function(t){return o._yScale(t.total)}).attr("text-anchor","middle").attr("dx",.25*o._xScale.step()).attr("dy",function(t){return null==o._positionOptions||null==o._positionChoice?0:0==o._positionOptions.indexOf(o._positionChoice)?o._yScale(1-t.percent)/2+.4*o._fontSize:1==o._positionOptions.indexOf(o._positionChoice)?o._yScale(1-t.percent)-.3*o._fontSize:void 0}).style("display",o._labelShow?"block":"none"),null!=o._labelShow&&null!=o._positionOptions&&null!=o._positionChoice&&null!=o._contentOption&&null!=o._contentChoice&&-1!=o._positionOptions.indexOf(o._positionChoice)||n.selectAll(".percentageStackBarTexts text").style("display","none")});for(var a=n.selectAll(".percentageStackBarTexts text"),r=[],l=[],s=0;s<a._groups[0].length;s++){l.push(s);for(var u=s+1;u<a._groups[0].length;u++){rt(at(d3.select(a._groups[0][s])),at(d3.select(a._groups[0][u])))&&(r.push(s),d3.select(a._groups[0][s]).style("opacity","0"))}}for(var h=new Set(r),c=Array.from(h),_=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(c,l),d=0;d<c.length;d++){for(var f=[],p=0;p<_.length;p++){var y=at(d3.select(a._groups[0][c[d]])),g=at(d3.select(a._groups[0][_[p]]));if(f.push(rt(y,g)),rt(y,g)){if(c[d]==_[p])continue;d3.select(a._groups[0][c[d]]).style("opacity","0")}}0==f.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var v=0;v<_.length;v++)d3.select(a._groups[0][_[v]]).style("opacity","1");return o}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),sn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","percentage-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new ln(e.coreGroup),e.overlay=new At(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new rn(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._curve=d3.curveCardinal,e._histogramWidth=1,e._yScaleHeight=1.05,e._barWidthPercent=.5,e._labelShow=!1,e._positionOptions=["内部居中","内部居下"],e._positionChoice="内部居中",e._contentOption=["百分比","数值"],e._contentChoice=["百分比"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=[],n=0;n<(0==i.length?0:i[0].data.length);n++){for(var o=0,a=0;a<i.length;a++)o+=parseFloat(i[a].data[n].value);e.push(o)}for(var r=0;r<i.length;r++)for(var l=0;l<i[r].data.length;l++)0==e[l]?i[r].data[l].percent=0:i[r].data[l].percent=i[r].data[l].value/e[l];for(var s=0;s<i.length;s++)for(var u=0;u<i[s].data.length;u++)i[s].data[u].total=0==s?parseFloat(i[s].data[u].percent):i[s-1].data[u].total+parseFloat(i[s].data[u].percent);var h=i,c=t.grid,_=t.tooltip,d=t.rectPlot,f=t.overlay,p=t.selectOverlay,y=t.xScale,g=t.yScale,v=t.widthOfCore,m=t.heightOfCore;f.data(y.domain()).isScalePoint(!1).bandWidth(y.step()).bandHeight(m).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),_.data(o).update(),p.translate(y(n),0),_.show()}).onMousemove(function(){_.move(),p.show()}).onMouseout(function(){_.hide(),p.hide()}),d.data(h).xScale(y).yScale(g).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).rectObj({barWidthPercent:t._barWidthPercent}).textObj({colorFunc:function(){return t._textLabel.color}}).fillOpacity(1),c.width(v).height(m).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),p.width(y.step()).height(m).shadowColor("#ccc").hide(),t.coreGroup.attr("transform","translate("+t.yAxis.width+",0)");var x=t.group.selectAll(".percentage-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(x).remove(),d.update(),p.update(),f.update(),c.update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]);this._xDomain=e,this._yDomain=[0,1]}}]),i}(),un=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._fillOpacity=.7,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e._areaFunc||d3.area().x(function(t){return e._xScale(t.name)}).y0(e._yScale.range()[0]).y1(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(e._curve);var n=e.group.selectAll("path").data(t,function(t){return t.key});return n.exit().remove(),n.enter().append("path").merge(n).style("fill",function(t){return t.color}).style("fill-opacity",e._fillOpacity).transition().duration(e._transition?e._duration:0).attr("d",function(t){return i(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}}]),i}(),hn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","percentage-line-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._strokeWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var e=this,t=e._data,i=e._lineFunc||d3.line().x(function(t){return e._xScale(t.name)}).y(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(e._curve);var n=e.group.selectAll("path").data(t,function(t){return t.key});return n.exit().remove(),n.enter().append("path").merge(n).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._strokeWidth).style("stroke-dasharray",e._strokeDasharry).transition().duration(e._transition?e._duration:0).attr("d",function(t){return i(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),i}(),cn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","percentage-area-text"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._strokeWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,e=i.group;e.selectAll(".stackAreaTexts").remove();var n=e.selectAll("g").data(t);n.exit().remove(),n.enter().append("g").merge(n).each(function(t){var e=d3.select(this).append("g").attr("class","stackAreaTexts").selectAll("text").data(t.data.slice(1));e.exit().remove(),e.enter().append("text").merge(e).text(function(t){return null==i._contentOption||null==i._contentChoice?isNaN(parseFloat(t.value))||0==t.value?"":t.value:0==i._contentOption.indexOf(i._contentChoice[0])?isNaN(parseFloat(t.value))||0==t.value?"":(100*parseFloat(t.percent)).toFixed(1)+"%":1==i._contentOption.indexOf(i._contentChoice[0])?isNaN(parseFloat(t.value))||0==t.value?"":t.value:void 0}).attr("fill",i._textObj.colorFunc).attr("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return i._xScale.step()*(e+1)+.15*i._xScale.step()}).attr("y",function(t){return i._yScale(t.total)}).attr("text-anchor","middle").attr("dx",.15*-i._xScale.step()).attr("dy",function(t){return null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?0:1==i._positionOptions.indexOf(i._positionChoice)?i._fontSize:void 0}).style("display",i._labelShow?"block":"none")}),null!=i._labelShow&&null!=i._positionOptions&&null!=i._positionChoice&&null!=i._contentOption&&null!=i._contentChoice&&-1!=i._positionOptions.indexOf(i._positionChoice)||e.selectAll(".stackAreaTexts text").style("display","none");for(var o=e.selectAll(".stackAreaTexts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){rt(at(d3.select(o._groups[0][l])),at(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("opacity","0"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var p=at(d3.select(o._groups[0][h[_]])),y=at(d3.select(o._groups[0][c[f]]));if(d.push(rt(p,y)),rt(p,y)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("opacity","0")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var g=0;g<c.length;g++)d3.select(o._groups[0][c[g]]).style("opacity","1");for(var v=e.selectAll(".stackAreaTexts text").nodes(),m=0;m<v.length;m++)isNaN(v[m].__data__.value)&&d3.select(v[m]).style("opacity","0");return i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),i}(),_n=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","percentage-area-chart"),e.grid=new zt(e.coreGroup),e.areaPlot=new un(e.coreGroup),e.linePlot=new hn(e.coreGroup),e.percentareatext=new cn(e.mainGroup),e.overlay=new At(e.mainGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new gi(e.coreGroup),e.clipArea=new Ot(e.defs),e.AnimationArea=new Ct(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new rn(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._curve=null,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="下面",e._contentOption=["百分比","数值"],e._contentChoice=["百分比"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=[],n=0;n<(0==i.length?0:i[0].data.length);n++){for(var o=0,a=0;a<i.length;a++)o+=isNaN(parseFloat(i[a].data[n].value))?0:parseFloat(i[a].data[n].value);e.push(o)}for(var r=0;r<i.length;r++)for(var l=0;l<i[r].data.length;l++)0==e[l]||isNaN(parseFloat(i[r].data[l].value))?i[r].data[l].percent=0:i[r].data[l].percent=i[r].data[l].value/e[l];for(var s=0;s<i.length;s++)for(var u=0;u<i[s].data.length;u++)i[s].data[u].total=0==s?parseFloat(i[s].data[u].percent):i[s-1].data[u].total+parseFloat(i[s].data[u].percent);var h=t.grid,c=t.areaPlot,_=t.linePlot,d=t.percentareatext,f=t.guideScatter,p=t.tooltip,y=t.overlay,g=t.guideLine,v=(t.clipArea,t.AnimationArea,t.xScale),m=t.yScale,x=t.widthOfCore,S=t.heightOfCore;t.widthOfNoMargin,t.heightOfMainGroup;h.width(x).height(S).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),c.data(i).xScale(v).yScale(m).curve(t._curve).areaFunc(d3.area().x(function(t){return v(t.name)}).y0(function(t){return m(t.total-t.percent)}).y1(function(t){return m(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),_.data(i).xScale(v).yScale(m).curve(t._curve).lineFunc(d3.line().x(function(t){return v(t.name)}).y(function(t){return m(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),d.data(i).xScale(v).yScale(m).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).textObj({colorFunc:function(){return t._textLabel.color}}),f.data(i).xScale(v).yScale(m).fill("#fff"),g.y1(0).y2(S).strokeDasharray(t._gridStrokeDasharray),y.data(v.domain()).isScalePoint(!0).bandWidth(v.step()).bandHeight(S).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),p.data(o).update(),g.x(v(n)).update(),f.data(a).update(),p.show(),g.show(),f.show()}).onMousemove(function(){p.move()}).onMouseout(function(){p.hide(),g.hide(),f.hide()}),t.coreGroup.call(B,t.yAxis.width+.5,0),f.elem.style("pointer-events","none");var k=t.group.selectAll(".percentage-area-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(k).remove(),h.update(),c.update(),_.update(),d.translate(t.yAxis.width+.5,0).update(),y.translate(t.yAxis.width+.5,0).update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=Lt;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]);this._xDomain=e,this._yDomain=[0,1]}}]),i}(),dn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","arcDiagram-chart"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=1,e._transition=!1,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._startAngle=-Math.PI/2,e._endAngle=Math.PI/2,e._sWidth=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._sortMethod=null,e}return h(i,M),s(i,[{key:"update",value:function(){for(var h=this,t=h.group,i=h._data,e=[],n=0;n<i[0].length;n++)e.push(parseFloat(i[0][n].value));var o=d3.max(e),a=d3.scaleLinear().domain([0,o]).range([4.5,8.5]).clamp(!0),r=h._sWidth,c=(h._sHeight,r/(i[0].length-1)),l=(h._xScale,h._yScale,h.arcFunc.startAngle(h._startAngle).endAngle(h._endAngle));l.setRadius=function(t){var e=.5*Math.abs(t.x2-t.x1);this.innerRadius(e-h._lineWidth/2).outerRadius(e+h._lineWidth/2)};var s=t.selectAll("path").data(i[1]);s.exit().remove(),s.merge(s.enter().append("path")).attr("transform",function(t,e){return t.x1=i[0][t.target].displayOrder*c,t.x2=i[0][t.source].displayOrder*c,"translate("+(t.x1+t.x2)/2+",0)"}).attr("d",function(t){return l.setRadius(t),l()}).style("stroke",function(t){return i[0][t.source].color}).style("stroke-width",0).style("fill",function(t){return i[0][t.source].color}).style("fill-opacity",h._lineOpacity).on("mouseover",h._onMouseover).on("mousemove",h._onMousemove).on("mouseout",h._onMouseout).transition().duration(h._transition?h._duration:0).ease(d3.easeLinear).on("start",h._onTransitionStart).on("end",h._onTransitionEnd),t.select(".arc-groups").remove();var u=t.append("g").attr("class","arc-groups").selectAll("circle").data(i[0]);u.exit().remove();u.enter().append("circle").attr("cx",function(t){return t.displayOrder*c||0}).attr("cy",0).merge(u).style("fill",function(t){return t.color}).style("fill-opacity",.5).style("stroke",function(t){return t.color}).style("stroke-width",1).attr("r",function(t){return a(t.value)}).attr("cx",function(t){return t.displayOrder*c||0}).attr("cy",0);t.select(".arc-texts").remove();var _=t.append("g").attr("class","arc-texts").selectAll("g").data(i[0]);function d(t){return!!/^[\u4E00-\u9FA5]+$/.test(t)}return _.exit().remove(),_.enter().append("g").attr("class","arc-text").attr("fill",h._fontColor).attr("font-size",h._fontSize).attr("text-anchor","start").attr("x",function(t){return d(t.name)?t.displayOrder*c-.5*h._fontSize||0:t.displayOrder*c||0}).attr("y",function(t){return d(t.name)?h._fontSize+9:0}).attr("dx",function(t){return d(t.name)?0:-(E(t.name,h._fontSize,h._fontFamily)+h._fontSize)}).attr("transform",function(t){return d(t.name)?"":"rotate(-90 "+(t.displayOrder*c||0)+" "+.3*-h._fontSize+" )"}).each(function(t){if(d(t.name))for(var e=d3.select(this),i=t.name.split("").reverse(),n=void 0,o=[],a=0,r=(e.node().getBoundingClientRect().height,+e.attr("x")),l=+e.attr("y"),s=e.text(null).append("text").attr("x",r).attr("y",l);n=i.pop();){o.push(n);var u=0<a?"-":"";s.text(u+o.join("")),s.node().getComputedTextLength()>h._fontSize&&(o.pop(),s.text(o.join("")),o=[n],s=e.append("text").attr("x",r).attr("y",++a*h._fontSize*1.3+l).text(n))}else d3.select(this).append("text").text(function(t){return t.name}).attr("fill",h._fontColor).attr("font-size",h._fontSize).attr("text-anchor","start").attr("x",function(t){return d(t.name)?t.displayOrder*c-.5*h._fontSize||0:t.displayOrder*c||0}).attr("y",function(t){return d(t.name)?h._fontSize+9:0}).attr("dx",function(t){return d(t.name)?0:-(E(t.name,h._fontSize,h._fontFamily)+h._fontSize)})}),h}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"lineOpacity",value:function(t){return arguments.length?(this._lineOpacity=t,this):this._lineOpacity}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}}]),i}(),fn=function(t){function i(t,e){return r(this,i),c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return h(i,F),s(i,[{key:"data",get:function(){var t,i,e=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),n=this.generateColorList(e.length);return i=n,(t=e)[0].forEach(function(t,e){t.color=i[e]}),t}}]),i}();function pn(t,e){var i=0,n=1,o=2;e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"targetCol"===t.function?n=t.index:"vCol"===t.function&&(o=t.index)});for(var a=[],r=t.length,l=[],s=1;s<r;s++){var u=t[s];""!=u[i]&&null!=u[i]&&null!=u[i]&&(l.push(u[i]),""!=u[n]&&null!=u[n]&&null!=u[n]&&l.push(u[n]))}Array.prototype.distinct=function(){var t,e,i=this.length;for(t=0;t<i;t++)for(e=t+1;e<i;e++)this[t]==this[e]&&(this.splice(e,1),i--,e--);return this};for(var h=l.distinct(),c=[],_=0;_<h.length;_++)c.push({name:h[_]});for(var d=[],f=1;f<r;f++){var p=t[f];d.push({source:h.indexOf(p[i]),target:h.indexOf(p[n]),s:p[i],t:p[n],value:""==p[o]||null==p[o]||null==p[o]?0:p[o]})}for(var y=0;y<c.length;y++)c[y].value=0,c[y].displayOrder=y;return a.push(c),a.push(d),a[0].forEach(function(t,e){t.key=t.name+"-"+e}),a}var yn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","arcDiagram-chart"),e.arcDiagram=new dn(e.mainGroup),e._innerRadius=0,e._startAngle=-Math.PI/2,e._endAngle=Math.PI/2,e.lineOpacity=.7,e.lineWidth=1,e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){var r=this,t=r.activeData,l=[];l.push(C(t[0]));for(var e=[],i=0;i<l[0].length;i++)null!=l[0][i].name&&e.push(l[0][i].name);for(var s=et(e,r._fontSize,r._fontFamily),n=0;n<t[1].length;n++)-1==e.indexOf(t[1][n].s)||-1==e.indexOf(t[1][n].t)?t[1][n].active=!1:t[1][n].active=!0;l.push(C(t[1]));for(var o=0;o<l[0].length;o++)l[0][o].value=0,l[0][o].displayOrder=o;for(var a=0;a<l[1].length;a++)for(var u=0;u<l[0].length;u++)l[1][a].s==l[0][u].name&&(l[1][a].source=l[0][u].displayOrder),l[1][a].t==l[0][u].name&&(l[1][a].target=l[0][u].displayOrder);for(var h=0;h<l[1].length;h++){var c=l[1][h];l[0][c.source].value+=parseFloat(c.value),l[0][c.target].value+=parseFloat(c.value)}var _=r.arcDiagram,d=r.widthOfNoMargin,f=(r.heightOfNoMargin,d),p=r.heightOfMainGroup,y=r._startAngle,g=r._endAngle,v=function(t,e,i,n){var o=Math.min(t,e),a=o/2,r=0,l=e/2+a/2-s/2;o==e&&(r=(t-2*(a=.85*e-s/2))/2,l=1.1*a-s/2,t/2<a&&(r=0,l=e/2+(a=t/2)/2-s/2));return{radius:a,cx:r,cy:l,quadrant:0}}(f,p),m=v.radius;r._innerRadius||r._innerRadiusRatio&&r._innerRadiusRatio;for(var x=1e8,S=0,k=0;k<l[0].length;k++)x=Math.min(x,l[0][k].value),S=Math.max(S,l[0][k].value);function b(t,e,i,n,o){return n+(Math.min(Math.max(t,e),i)-e)/(i-e)*(o-n)}_.data(l).startAngle(y).endAngle(g).sWidth(2*m).lineWidth(r.lineWidth).lineOpacity(r.lineOpacity).fontSize(r._fontSize).fontColor(r._fontColor).transition(r._transition).duration(r._duration).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){var i=d3.select(this)._groups[0][0].__data__.source,n=d3.select(this)._groups[0][0].__data__.target,o=d3.selectAll(".arc-groups circle").nodes();d3.select(o[i]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)}),d3.select(o[n]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)});var a=[{text:l[0][t.source].name+"→"+l[0][t.target].name+"："+t.value,color:l[0][t.source].color}];r.tooltip.data(a).update().show()}).onMousemove(function(){var t=d3.select(this)._groups[0][0].__data__.source,e=d3.select(this)._groups[0][0].__data__.target,i=d3.selectAll(".arc-groups circle").nodes();d3.select(i[t]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)}),d3.select(i[e]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)}),r.tooltip.move()}).onMouseout(function(t){var e=d3.select(this)._groups[0][0].__data__.source,i=d3.select(this)._groups[0][0].__data__.target,n=d3.selectAll(".arc-groups circle").nodes();d3.select(n[e]).attr("r",function(t){return b(t.value,x,S,4.5,8.5)||4.5}),d3.select(n[i]).attr("r",function(t){return b(t.value,x,S,4.5,8.5)||4.5}),r.tooltip.hide()});var w=v.cx,O=v.cy;r.arcDiagram.translate(w||0,O||0).update()}},{key:"configLegend",value:function(){var e=this,n=e.sortedDataCopy;e.legend.data(n[0]).onClick(function(t){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n[0].forEach(function(e){e.key===t.key&&(e.active=!i),n[1].forEach(function(t){e.active==!i&&(t.s!=e.name&&t.t!=e.name||(t.active=!i))})}),e.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new fn(t,e),n=pn;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this.lineOpacity=e.lineOpacity?e.lineOpacity:this.lineOpacity,this.lineWidth=e.lineWidth?e.lineWidth:this.lineWidth)}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}}]),i}(),gn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","basic-horizontal-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new xi(e.coreGroup),e.overlay=new At(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new ri(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._barWidthPercent=.5,e._barCornerRadius=0,e._borderWidth=0,e._borderColor="none",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["外部居右","内部居左","内部居中","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var i=this,a=i.activeData,t=i.grid,e=i.rectPlot,r=i.tooltip,n=i.overlay,l=i.selectOverlay,o=i.barWidthPercent?i.barWidthPercent:.8,s=i.xScale,u=i.yScale,h=i.widthOfCore,c=i.heightOfCore,_=u.step(),d=[],f=[],p=0;p<i.activeData.length;p++)null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?(d.push(0),f.push(0)):1==i._labelShow&&0==i._positionOptions.indexOf(i._positionChoice)?0<parseFloat(i.activeData[p].value)||0==parseFloat(i.activeData[p].value)?f.push(E(i.activeData[p].value,i._textLabel.fontSize,i._textLabel.fontFamily)):parseFloat(i.activeData[p].value)<0&&d.push(E(i.activeData[p].value,i._textLabel.fontSize,i._textLabel.fontFamily)):(d.push(0),f.push(0));Math.min(d3.min(a,function(t){return+t.value}),0);t.width(h-(0==d.length?0:d3.max(d))-(0==f.length?0:d3.max(f))).height(c).xTickLocations(i.xAxis.tickLocations).yTickLocations(i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray),n.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==d.length?0:d3.max(d))-(0==f.length?0:d3.max(f))).bandHeight(u.step()).onMouseover(function(t,e){var i=u.domain()[a.length-e-1==-1?1:a.length-e-1==-2?0:a.length-e-1],n=a.filter(function(t){return t.name===i}),o=[];i&&1!=i&&((o=[{text:n[0].valueLabel}]).push({text:(n[0].showLegend?i:"")+": "+n[0].value,color:n[0].color}),l.translate(0,u(i))),r.data(o).update(),l.translate(0,u(i)),r.show()}).onMousemove(function(){r.move(),l.show()}).onMouseout(function(){r.hide(),l.hide()}),l.width(h-(0==d.length?0:d3.max(d))-(0==f.length?0:d3.max(f))).height(u.step()).shadowColor("#ccc").hide(),e.data(a).xScale(s).yScale(u).fontSize(i._fontSize).barCornerRadius(i._barCornerRadius).borderWidth(i._borderWidth).borderColor(i._borderColor).fillOpacity(i._fillOpacity).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).rectObj({xFunc:function(t,e){return 0<t.value||0==t.value?i.xScale(0):t.value<0?i.xScale(t.value):void 0},yFunc:function(t,e){return i.yScale.range()[0]-(e*_+(_-_*o)/2+_*o)},widthFunc:function(t){return 0<t.value||0==t.value?0<i.xScale(t.value)-i.xScale(0)?i.xScale(t.value)-i.xScale(0):0:t.value<0?0<i.xScale(0)-i.xScale(t.value)?i.xScale(0)-i.xScale(t.value):0:void 0},heightFunc:function(t){return _*o}}).textObj({xFunc:function(t,e){return i.xScale(t.value)},yFunc:function(t,e){return i.yScale.range()[0]-(e*_+(_-.9*_*o)/2+.7*_*o)},dyFunc:.5*_*o/2+i._textLabel.fontSize/3,colorFunc:function(){return i._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:i._textLabel.fontSize,fontFamily:i._textLabel.fontFamily,labelShow:i._labelShow}),i.coreGroup.call(B,i.yAxis.width+.5,0);var y=i.group.selectAll(".basic-horizontal-bar-chart .axis-y-horizontal .tick text").nodes().filter(function(t,e){return t.__data__=="$-"+e});d3.selectAll(y).remove(),t.update(),l.update(),e.updateHorizontalBar(),n.update(),i.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==d.length?0:d3.max(d))+",0 )"),i.group.selectAll(".bands-overlay").attr("transform","translate("+(0==d.length?0:d3.max(d))+",0 )"),i.group.selectAll(".selectOverlay-rect").attr("x",""+(0==d.length?0:d3.max(d)))}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);for(var _=[],d=[],f=0;f<e.activeData.length;f++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(_.push(0),d.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].value)||0==parseFloat(e.activeData[f].value)?d.push(E(e.activeData[f].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].value)<0&&_.push(E(e.activeData[f].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(_.push(0),d.push(0));i&&i.titleHeight;var p=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(p).compute(),i.compute();var y=(h-i.width-(0==_.length?0:d3.max(_))-(0==d.length?0:d3.max(d)))/t._tickValues.length,g=d3.max(t._tickValues,function(t){return E(t,u,e._fontFamily)}),v=(t._tickShow?t._tickSize+t._tickPadding+(g<y?1.125*t._fontSize:t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-v,0]),i.compute(),n.range([0==_.length?0:d3.max(_),h-i.width-(0==d.length?0:d3.max(d))]),t.compute();var m=i.width,x=c-v,S=i.width;t.translate(m,x).update(),i.translate(S,0).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=((this._yRange||[]).slice().sort(d3.ascending),t.length?t.map(function(t){return t.name}):[0,1]),i=t.length?[1.1*Math.min(d3.min(t,function(t){return+t.value}),0),1.1*d3.max(t,function(t){return+t.value})]:[0,1];this._yDomain=e,this._xDomain=i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&(this.barWidthPercent=e.barWidthPercent?e.barWidthPercent:this.barWidthPercent,this.barCornerRadius=e.barCornerRadius?e.barCornerRadius:this.barCornerRadius,this.borderWidth=e.borderWidth?e.borderWidth:this.borderWidth,this.borderColor=e.borderColor?e.borderColor:this.borderColor,this.fillOpacity=e.fillOpacity?e.fillOpacity:this.fillOpacity)}}]),i}(),vn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var n=this,t=n._data,o=n.group;o.selectAll("g").remove();var e=o.append("g").selectAll("g").data(t);e.exit().remove(),e.enter().append("g").merge(e).each(function(t){var e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","stackBars").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return n._fillOpacity}).style("stroke",function(t){return n._strokeColor||t.color}).style("stroke-width",function(t){return n._strokeWidth||0}).attr("x",function(t,e){return n._xScale.step()*e+.25*n._xScale.step()}).attr("y",function(t){return 0<t.value||0==t.value?n._yScale(t.total):t.value<0?n._yScale(t.downtotal-t.value):void 0}).attr("width",n._xScale.step()/2).attr("height",function(t){return 0<t.value||0==t.value?0<n._yScale(0)-n._yScale(t.value)?n._yScale(0)-n._yScale(t.value):0:t.value<0?0<n._yScale(t.value)-n._yScale(0)?n._yScale(t.value)-n._yScale(0):0:void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o.selectAll(".stackBarTexts").remove();var i=o.append("g").selectAll("g").data(t);i.exit().remove(),i.enter().append("g").merge(i).each(function(t,e){var i=d3.select(this).append("g").attr("class","stackBarTexts").selectAll("text").data(t.data);i.exit().remove(),i.enter().append("text").merge(i).text(function(t){return 0==t.value?"":t.value}).attr("fill",n._textObj.colorFunc).attr("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return n._xScale.step()*e+.25*n._xScale.step()}).attr("y",function(t){if(null==n._positionOptions||null==n._positionChoice)return 0;if(0==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return n._yScale(t.total)+(n._yScale(0)-n._yScale(t.value))/2+.4*n._fontSize;if(t.value<0)return n._yScale(t.downtotal-t.value)+(n._yScale(t.value)-n._yScale(0))/2+.4*n._fontSize}else if(1==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return n._yScale(t.total)+(n._yScale(0)-n._yScale(t.value))-.2*n._fontSize;if(t.value<0)return n._yScale(t.downtotal-t.value)+(n._yScale(t.value)-n._yScale(0))-.2*n._fontSize}}).attr("text-anchor","middle").attr("dx",.25*n._xScale.step()).style("display",function(t){return n._labelShow&&t.textShow?"block":"none"}),0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?o.selectAll(".stackBarTexts").style("display","none"):o.selectAll(".stackBarTexts").style("display","block")});for(var a=o.selectAll(".stackBarTexts text"),r=[],l=[],s=0;s<a._groups[0].length;s++){l.push(s);for(var u=s+1;u<a._groups[0].length;u++){rt(at(d3.select(a._groups[0][s])),at(d3.select(a._groups[0][u])))&&(r.push(s),d3.select(a._groups[0][s]).style("opacity","0"))}}for(var h=new Set(r),c=Array.from(h),_=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(c,l),d=0;d<c.length;d++){for(var f=[],p=0;p<_.length;p++){var y=at(d3.select(a._groups[0][c[d]])),g=at(d3.select(a._groups[0][_[p]]));if(f.push(rt(y,g)),rt(y,g)){if(c[d]==_[p])continue;d3.select(a._groups[0][c[d]]).style("opacity","0")}}0==f.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var v=0;v<_.length;v++)d3.select(a._groups[0][_[v]]).style("opacity","1");return n}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),mn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new vn(e.coreGroup),e.overlay=new At(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["内部居中","内部居下"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=0;e<(0==i.length?0:i[0].data.length);e++)for(var n=0;n<i.length;n++)parseFloat(i[n].data[e].value);for(var o=0;o<i.length;o++)for(var a=0;a<i[o].data.length;a++)0==o?0<i[o].data[a].value||0==i[o].data[a].value?(i[o].data[a].total=parseFloat(i[o].data[a].value),i[o].data[a].downtotal=0):i[o].data[a].value<0&&(i[o].data[a].downtotal=parseFloat(i[o].data[a].value),i[o].data[a].total=0):0<i[o].data[a].value||0==i[o].data[a].value?(i[o].data[a].total=i[o-1].data[a].total+parseFloat(i[o].data[a].value),i[o].data[a].downtotal=i[o-1].data[a].downtotal):i[o].data[a].value<0&&(i[o].data[a].total=i[o-1].data[a].total,i[o].data[a].downtotal=i[o-1].data[a].downtotal+parseFloat(i[o].data[a].value)),0<i[o].data[a].value||0==i[o].data[a].value?t.yScale(0)-t.yScale(i[o].data[a].value)<t._textLabel.fontSize?i[o].data[a].textShow=!1:i[o].data[a].textShow=!0:i[o].data[a].value<0&&(t.yScale(i[o].data[a].value-t.yScale(0))<t._textLabel.fontSize?i[o].data[a].textShow=!1:i[o].data[a].textShow=!0);var r=i,l=t.grid,s=t.tooltip,u=t.rectPlot,h=t.overlay,c=t.selectOverlay,_=t.clipArea,d=t.xScale,f=t.yScale,p=t.widthOfCore,y=t.heightOfCore,g=1.1*Math.min(d3.min(i,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0);g<0?(t.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(f.range()[0]-f(0))+")"),t.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(f.range()[0]-f(0))+")")):(t.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),t.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0,0)")),h.data(d.domain()).isScalePoint(!1).bandWidth(d.step()).bandHeight(y).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),s.data(o).update(),c.translate(d(n),0),s.show()}).onMousemove(function(){s.move(),c.show()}).onMouseout(function(){s.hide(),c.hide()}),u.data(r).xScale(d).yScale(f).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).textObj({colorFunc:function(){return t._textLabel.color}}).fillOpacity(1),l.width(p).height(y).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),c.width(d.step()).height(y).shadowColor("#ccc").hide(),t.coreGroup.attr("transform","translate("+t.yAxis.width+",0)"),0!=t._clipShow.length?_.width(p).height(y).paddingVertical([0,0]).transition(t._transition).duration(t._duration):_.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+_.id+")"),_.update();var v=t.group.selectAll(".stack-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(v).remove(),u.update(),c.update(),h.update(),l.update(),g<0?(t.coreGroup.selectAll(".fake-x-line").remove(),t.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",d.range()[0]).attr("y1",f.range()[0]).attr("x2",d.range()[1]).attr("y2",f.range()[0]).attr("stroke","rgb(233, 233, 233)")):t.coreGroup.selectAll(".fake-x-line").remove()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var i=0;i<t[e].data.length;i++)0==e?0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=parseFloat(t[e].data[i].value),t[e].data[i].downtotal=0):t[e].data[i].value<0&&(t[e].data[i].downtotal=parseFloat(t[e].data[i].value),t[e].data[i].total=0):0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=t[e-1].data[i].total+parseFloat(t[e].data[i].value),t[e].data[i].downtotal=t[e-1].data[i].downtotal):t[e].data[i].value<0&&(t[e].data[i].total=t[e-1].data[i].total,t[e].data[i].downtotal=t[e-1].data[i].downtotal+parseFloat(t[e].data[i].value));var n=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),1.1*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total+1})}),0)]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(n[0]))?a[0]:parseFloat(n[0]),isNaN(parseFloat(n[1]))?isNaN(parseFloat(n[0]))?a[1]:a[1]<n[0]?1.5*n[0]:a[1]:parseFloat(n[1])]}}]),i}(),xn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var n=this,t=n._data,o=n.group;o.selectAll(".stackHorizontalBar").remove();var e=o.append("g").selectAll("g").data(t);e.exit().remove(),e.enter().append("g").merge(e).each(function(t){var e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","stackHorizontalBar").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return n._fillOpacity}).style("stroke",function(t){return n._strokeColor||t.color}).style("stroke-width",function(t){return n._strokeWidth||0}).attr("y",function(t,e){return n._yScale(t.name)+n._yScale.step()*(1-n._barWidthPercent)/2}).attr("x",function(t){return 0<t.value||0==t.value?n._xScale(t.total-t.value):t.value<0?n._xScale(t.downtotal):void 0}).attr("height",n._yScale.step()*n._barWidthPercent).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(n._xScale(0)-n._xScale(t.value)):t.value<0?Math.abs(n._xScale(t.value)-n._xScale(0)):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o.selectAll(".stackHorizontalBarTexts").remove();var i=o.append("g").selectAll("g").data(t);i.exit().remove(),i.enter().append("g").merge(i).each(function(t,e){var i=d3.select(this).append("g").attr("class","stackHorizontalBarTexts").selectAll("text").data(t.data);i.exit().remove(),i.enter().append("text").merge(i).text(function(t){return 0==t.value?"":t.value}).attr("fill",n._textObj.colorFunc).attr("font-size",n._fontSize).style("font-family",n._fontFamily).attr("text-anchor","start").attr("y",function(t,e){return n._yScale(t.name)+.75*n._yScale.step()}).attr("x",function(t,e){if(null==n._labelShow||null==n._positionOptions||null==n._positionChoice)return 0;if(1==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return n._xScale(t.total-t.value)+.3*n._fontSize;if(t.value<0)return n._xScale(t.downtotal)+.3*n._fontSize}else if(0==n._positionOptions.indexOf(n._positionChoice)){if(d3.selectAll(".stackHorizontalBarTexts text").attr("text-anchor","middle"),0<t.value||0==t.value)return n._xScale(t.total-t.value)+Math.abs(n._xScale(0)-n._xScale(t.value))/2;if(t.value<0)return n._xScale(t.downtotal)+Math.abs(n._xScale(t.value)-n._xScale(0))/2}}).attr("dy",-(n._yScale.step()/4-n._fontSize/2.7)).style("display",n._labelShow?"block":"none"),null!=n._labelShow&&null!=n._positionOptions&&null!=n._positionChoice&&-1!=n._positionOptions.indexOf(n._positionChoice)||o.selectAll(".stackHorizontalBarTexts").style("display","none")});for(var a=o.selectAll(".stackHorizontalBarTexts text"),r=[],l=[],s=0;s<a._groups[0].length;s++){l.push(s);for(var u=s+1;u<a._groups[0].length;u++){rt(at(d3.select(a._groups[0][s])),at(d3.select(a._groups[0][u])))&&(r.push(s),d3.select(a._groups[0][s]).style("opacity","0"))}}for(var h=new Set(r),c=Array.from(h),_=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(c,l),d=0;d<c.length;d++){for(var f=[],p=0;p<_.length;p++){var y=at(d3.select(a._groups[0][c[d]])),g=at(d3.select(a._groups[0][_[p]]));if(f.push(rt(y,g)),rt(y,g)){if(c[d]==_[p])continue;d3.select(a._groups[0][c[d]]).style("opacity","0")}}0==f.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var v=0;v<_.length;v++)d3.select(a._groups[0][_[v]]).style("opacity","1");return n}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=parseFloat(t),this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return ar}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),Sn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-horizontal-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new xn(e.coreGroup),e.overlay=new At(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new ri(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=1,e._yScaleHeight=1.05,e._labelShow=!1,e._barWidthPercent=.5,e._positionOptions=["内部居中","内部居左"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=0;e<(0==i.length?0:i[0].data.length);e++)for(var n=0;n<i.length;n++)parseFloat(i[n].data[e].value);for(var o=0;o<i.length;o++)for(var a=0;a<i[o].data.length;a++)0==o?0<i[o].data[a].value||0==i[o].data[a].value?(i[o].data[a].total=parseFloat(i[o].data[a].value),i[o].data[a].downtotal=0):i[o].data[a].value<0&&(i[o].data[a].downtotal=parseFloat(i[o].data[a].value),i[o].data[a].total=0):0<i[o].data[a].value||0==i[o].data[a].value?(i[o].data[a].total=i[o-1].data[a].total+parseFloat(i[o].data[a].value),i[o].data[a].downtotal=i[o-1].data[a].downtotal):i[o].data[a].value<0&&(i[o].data[a].total=i[o-1].data[a].total,i[o].data[a].downtotal=i[o-1].data[a].downtotal+parseFloat(i[o].data[a].value));var r=i,l=t.grid,s=t.tooltip,u=t.rectPlot,h=t.overlay,c=t.selectOverlay,_=t.clipArea,d=t.xScale,f=t.yScale,p=t.widthOfCore,y=t.heightOfCore,g=1.1*Math.min(d3.min(i,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0);g<0?(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+-(d.range()[0]-d(0))+",0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+-(d.range()[0]-d(0))+",0)")):(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,0)")),h.data(f.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(p).bandHeight(f.step()).onMouseover(function(t,e){var n=f.domain()[f.domain().length-e-1==-1?1:f.domain().length-e-1==-2?0:f.domain().length-e-1],o=[{text:n=="&-"+(f.domain().length-e)?"":n}];n&&1!=n&&(i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),c.translate(0,f(n))),s.data(o).update(),c.translate(0,f(n)),s.show()}).onMousemove(function(){s.move(),c.show()}).onMouseout(function(){s.hide(),c.hide()}),u.data(r).xScale(d).yScale(f).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).barWidthPercent(t._barWidthPercent).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).textObj({colorFunc:function(){return t._textLabel.color}}).fillOpacity(1),l.width(p).height(y).xTickLocations(t.xAxis.tickLocations).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),c.width(p).height(f.step()).shadowColor("#ccc").hide(),t.coreGroup.attr("transform","translate("+t.yAxis.width+",0)"),0!=t._clipShow.length?_.width(p).height(y).paddingVertical([0,0]).transition(t._transition).duration(t._duration):_.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+_.id+")"),_.update();var v=t.group.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(v).remove(),u.update(),c.update(),h.update(),l.update(),g<0?(t.coreGroup.selectAll(".fake-y-line").remove(),this.coreGroup.append("g").attr("class","fake-y-line").append("line").attr("x1",d.range()[0]).attr("y1",f.range()[0]).attr("x2",d.range()[0]).attr("y2",f.range()[1]).attr("stroke","rgb(233, 233, 233)")):t.coreGroup.selectAll(".fake-y-line").remove()}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);i&&i.titleHeight;var _=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(_).compute(),i.compute();var d=(h-i.width)/t._tickValues.length,f=d3.max(t._tickValues,function(t){return E(t,u,e._fontFamily)}),p=(t._tickShow?t._tickSize+t._tickPadding+(f<.8*d?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-p,0]),n.range([0,h-i.width]),t.compute();var y=i.width,g=c-p,v=i.width;t.translate(y,g).update(),i.translate(v,0).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var i=0;i<t[e].data.length;i++)0==e?0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=parseFloat(t[e].data[i].value),t[e].data[i].downtotal=0):t[e].data[i].value<0&&(t[e].data[i].downtotal=parseFloat(t[e].data[i].value),t[e].data[i].total=0):0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=t[e-1].data[i].total+parseFloat(t[e].data[i].value),t[e].data[i].downtotal=t[e-1].data[i].downtotal):t[e].data[i].value<0&&(t[e].data[i].total=t[e-1].data[i].total,t[e].data[i].downtotal=t[e-1].data[i].downtotal+parseFloat(t[e].data[i].value));var n=this._xRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),Math.max(1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),0)]:[0,1];this._xDomain=[isNaN(parseFloat(n[0]))?a[0]:parseFloat(n[0]),isNaN(parseFloat(n[1]))?isNaN(parseFloat(n[0]))?a[1]:a[1]<n[0]?1.5*n[0]:a[1]:parseFloat(n[1])],this._yDomain=o}}]),i}(),kn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){for(var o=this,a=o._data,t=[],e=0;e<a.length;e++)for(var i=0;i<a[e].data.length;i++)t.push(Number(a[e].data[i].value));var r=et(t,o._fontSize,o._fontFamily),l=o.group;l.selectAll(".group-bar-rects").remove(),l.selectAll(".group-bar-texts").remove();var n=l.append("g").selectAll("g").data(a,function(t){return t.name});n.exit().remove(),n.enter().append("g").merge(n).each(function(t,i){var n=2*o._xScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","group-bar-rects").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return o._fillOpacity}).style("stroke",function(t){return o._strokeColor||t.color}).style("stroke-width",function(t){return o._strokeWidth||0}).attr("x",function(t,e){return(n/a.length+(3<a.length||1==a.length?0:1))*i+n/4+o._xScale.step()*e}).attr("y",function(t){return t.value<0?o._yScale(0):0<t.value?o._yScale(t.value):void 0}).attr("width",0<n/a.length?n/a.length:0).attr("height",function(t){return t.value<0?o._yScale(t.value)-o._yScale(0)<0?0:o._yScale(t.value)-o._yScale(0):0<t.value?o._yScale(0)-o._yScale(t.value)<0?0:o._yScale(0)-o._yScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var s=2*o._xScale.step()/3,u=0<s/a.length?s/a.length:0,h=l.append("g").selectAll("g").data(a,function(t){return t.name});if(h.exit().remove(),h.enter().append("g").merge(h).each(function(t,i){var e=d3.select(this).attr("class","groupedBarTexts").selectAll("text").data(t.data);e.exit().remove();var n=e.enter().append("text").attr("class","group-bar-texts").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",o._textObj.colorFunc).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return(s/a.length+(3<a.length||1==a.length?0:1))*i+s/4+o._xScale.step()*e+(0<s/a.length?s/a.length:0)/2}).attr("text-anchor","middle").attr("y",function(t){return null==o._positionOptions||null==o._positionChoice?o._yScale(t.value):0==o._positionOptions.indexOf(o._positionChoice)?t.value<0?o._yScale(0)-.3*o._fontSize:o._yScale(t.value)-.3*o._fontSize:1==o._positionOptions.indexOf(o._positionChoice)?0<t.value?o._yScale(0)-.3*o._fontSize:o._yScale(t.value)-.3*o._fontSize:void 0}).style("display",o._labelShow?"block":"none");null==o._positionOptions||null==o._positionChoice||u<r&&1==o._positionOptions.indexOf(o._positionChoice)&&n.attr("transform",function(t,e){return 0<t.value?"rotate(-90 "+((s/a.length+(3<a.length||1==a.length?0:1))*i+s/4+o._xScale.step()*e+(0<s/a.length?s/a.length:0)/2||0)+"\n                         "+(o._yScale(t.value)+o._yScale(0)-o._yScale(t.value)-.65*o._fontSize)+" )":"rotate(-90 "+((s/a.length+(3<a.length||1==a.length?0:1))*i+s/4+o._xScale.step()*e+(0<s/a.length?s/a.length:0)/2||0)+"\n                         "+(o._yScale(t.value)-.65*o._fontSize)+" )"}).attr("text-anchor","start"),0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||-1==o._positionOptions.indexOf(o._positionChoice)?l.selectAll(".groupedBarTexts").style("display","none"):l.selectAll(".groupedBarTexts").style("display","block")}),null==o._positionOptions||null==o._positionChoice||-1==o._positionOptions.indexOf(o._positionChoice))l.selectAll(".groupedBarTexts").style("display","none");else if(u<r&&1==o._positionOptions.indexOf(o._positionChoice)){for(var c=l.selectAll(".group-bar-texts"),_=[],d=[],f=0;f<c._groups[0].length;f++){d.push(f);for(var p=f+1;p<c._groups[0].length;p++){var y=at(d3.select(c._groups[0][f])),g=at(d3.select(c._groups[0][p])),v=y.width;y.width=y.height,y.height=v;var m=g.width;g.width=g.height,g.height=m,rt(y,g)&&(_.push(f),d3.select(c._groups[0][f]).style("opacity","0"))}}for(var x=new Set(_),S=Array.from(x),k=V(S,d),b=0;b<S.length;b++){for(var w=[],O=0;O<k.length;O++){var C=at(d3.select(c._groups[0][S[b]])),F=at(d3.select(c._groups[0][k[O]])),P=C.width;C.width=C.height,C.height=P;var z=F.width;if(F.width=F.height,F.height=z,w.push(rt(C,F)),rt(C,F)){if(S[b]==k[O])continue;d3.select(c._groups[0][S[b]]).style("opacity","0")}}0==w.filter(function(t){return 1==t}).length&&k.push(S[b])}for(var A=0;A<k.length;A++)d3.select(c._groups[0][k[A]]).style("opacity","1")}else{for(var L=l.selectAll(".group-bar-texts"),M=[],D=[],W=0;W<L._groups[0].length;W++){D.push(W);for(var T=W+1;T<L._groups[0].length;T++){rt(at(d3.select(L._groups[0][W])),at(d3.select(L._groups[0][T])))&&(M.push(W),d3.select(L._groups[0][W]).style("opacity","0"))}}for(var R=new Set(M),N=Array.from(R),j=V(N,D),Y=0;Y<N.length;Y++){for(var X=[],G=0;G<j.length;G++){var B=at(d3.select(L._groups[0][N[Y]])),E=at(d3.select(L._groups[0][j[G]]));if(X.push(rt(B,E)),rt(B,E)){if(N[Y]==j[G])continue;d3.select(L._groups[0][N[Y]]).style("opacity","0")}}0==X.filter(function(t){return 1==t}).length&&j.push(N[Y])}for(var H=0;H<j.length;H++)d3.select(L._groups[0][j[H]]).style("opacity","1")}function V(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}return o}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),bn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new kn(e.coreGroup),e.overlay=new At(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=r,e=i.grid,l=i.tooltip,n=i.rectPlot,o=i.overlay,a=i.selectOverlay,s=i.clipArea,u=i.xScale,h=i.yScale,c=i.widthOfCore,_=i.heightOfCore,d=1.1*Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0);d<0?(i.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")"),i.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")")):(i.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),i.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0,0)")),o.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),l.data(o).update(),i.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+u(n)+",0)"),l.show()}).onMousemove(function(){l.move(),a.show()}).onMouseout(function(){l.hide(),a.hide()}),n.data(t).xScale(u).yScale(h).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).textObj({colorFunc:function(){return i._textLabel.color}}).fillOpacity(1),e.width(c).height(_).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(i.yAxis.tickLocations.slice(1)).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray),s.width(c).height(_).paddingVertical([0,0]).transition(i._transition).duration(i._duration),a.width(u.step()).height(_).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)"),0!=i._clipShow.length?(s.width(c).height(_).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url(#"+s.id+")"),s.update()):s.width(i._width).height(i._height).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url(#"+s.id+")"),s.update();var f=i.group.selectAll(".grouped-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(f).remove(),n.update(),a.update(),o.update(),e.update(),d<0?(i.coreGroup.selectAll(".fake-x-line").remove(),i.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",u.range()[0]).attr("y1",h.range()[0]).attr("x2",u.range()[1]).attr("y2",h.range()[0]).attr("stroke","rgb(233, 233, 233)")):i.coreGroup.selectAll(".fake-x-line").remove()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}}]),i}(),wn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var v=this,m=v._data,x=v.group;x.selectAll(".groupedHoizontalBar").remove(),x.selectAll(".groupedHoizontalBarTexts").remove();var t=x.selectAll("g").data(m);t.exit().remove(),t.enter().append("g").merge(t).each(function(t,i){var n=2*v._yScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","groupedHoizontalBar").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return v._fillOpacity}).style("stroke",function(t){return v._strokeColor||t.color}).style("stroke-width",function(t){return v._strokeWidth||0}).attr("y",function(t,e){return Math.abs(v._yScale.range()[0]-v._yScale.range()[1])-((n/m.length+(3<m.length||1==m.length?0:1))*i+n/4+v._yScale.step()*e)-(0<n/m.length?n/m.length:0)}).attr("x",function(t){return 0<t.value?v._xScale(0):t.value<0?v._xScale(t.value):void 0}).attr("height",0<n/m.length?n/m.length:0).attr("width",function(t){return 0<t.value?v._xScale(t.value)-v._xScale(0)<0?0:v._xScale(t.value)-v._xScale(0):t.value<0?v._xScale(0)-v._xScale(t.value)<0?0:v._xScale(0)-v._xScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var e=x.append("g").selectAll("g").data(m);return e.exit().remove(),e.enter().append("g").merge(e).each(function(t,i){var n=2*v._yScale.step()/3,e=d3.select(this).append("g").attr("class","groupedHoizontalBarTexts").selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",v._textObj.colorFunc).attr("font-size",v._fontSize).style("font-family",v._fontFamily).attr("text-anchor","start").attr("x",function(t){return 0<t.value?v._xScale(0):t.value<0?v._xScale(t.value):void 0}).attr("y",function(t,e){return Math.abs(v._yScale.range()[0]-v._yScale.range()[1])-((n/m.length+(3<m.length||1==m.length?0:1))*i+n/4+v._yScale.step()*e)-(0<n/m.length?n/m.length:0)}).attr("dy",(0<n/m.length?n/m.length:0)/2+v._fontSize/3).attr("dx",function(t,e){if(null==v._positionOptions||null==v._positionChoice)return 0;if(0==v._positionOptions.indexOf(v._positionChoice)){if(0<t.value)return v._xScale(t.value)-v._xScale(0)+.3*v._fontSize;if(t.value<0)return.3*-v._fontSize}else if(1==v._positionOptions.indexOf(v._positionChoice)){if(0<t.value)return.3*v._fontSize;if(t.value<0)return v._xScale(0)-v._xScale(t.value)-.3*v._fontSize}else if(2==v._positionOptions.indexOf(v._positionChoice)){if(t.value<0)return.3*v._fontSize+E(t.value,v._fontSize,v._fontFamily);if(0<t.value)return(v._xScale(t.value)-v._xScale(0)<0?0:v._xScale(t.value)-v._xScale(0))-E(t.value,v._fontSize,v._fontFamily)-.3*v._fontSize}}).style("display",v._labelShow?"block":"none"),d3.selectAll(x.selectAll(".groupedHoizontalBarTexts text").nodes().filter(function(t){return t.__data__.value<0})).attr("text-anchor","end"),null!=v._labelShow&&0!=v._labelShow&&null!=v._positionOptions&&null!=v._positionChoice&&-1!=v._positionOptions.indexOf(v._positionChoice)||x.selectAll(".groupedHoizontalBarTexts").style("display","none");for(var o=x.selectAll(".groupedHoizontalBarTexts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){rt(at(d3.select(o._groups[0][l])),at(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("opacity","0"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var p=at(d3.select(o._groups[0][h[_]])),y=at(d3.select(o._groups[0][c[f]]));if(d.push(rt(p,y)),rt(p,y)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("opacity","0")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var g=0;g<c.length;g++)d3.select(o._groups[0][c[g]]).style("opacity","1")}),v}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),On=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-horizontal-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new wn(e.coreGroup),e.overlay=new At(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new ri(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["右边","内部居左","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=i,n=t.grid,a=t.tooltip,o=t.rectPlot,r=t.overlay,l=t.selectOverlay,s=t.xScale,u=t.yScale,h=t.widthOfCore,c=t.heightOfCore,_=d3.min(i,function(t){return d3.min(t.data,function(t){return+t.value})}),d=[],f=[],p=0;p<t.activeData.length;p++)for(var y=0;y<t.activeData[p].data.length;y++)null==t._labelShow||null==t._positionOptions||null==t._positionChoice||-1==t._positionOptions.indexOf(t._positionChoice)?(f.push(0),d.push(0)):1==t._labelShow&&0==t._positionOptions.indexOf(t._positionChoice)?0<parseFloat(t.activeData[p].data[y].value)||0==parseFloat(t.activeData[p].data[y].value)?d.push(E(t.activeData[p].data[y].value,t._textLabel.fontSize,t._textLabel.fontFamily)):parseFloat(t.activeData[p].data[y].value)<0&&f.push(E(t.activeData[p].data[y].value,t._textLabel.fontSize,t._textLabel.fontFamily)):(f.push(0),d.push(0));_<0?(d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+",0)"),d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+","+-u.step()/2+")")):(d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,"+-u.step()/2+")")),r.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).bandHeight(u.step()).onMouseover(function(t,e){var n=u.domain()[u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1],o=[{text:n=="&-"+(u.domain().length-e)?"":n}];n&&1!=n&&(i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),l.translate(0,u(n))),a.data(o).update(),a.show()}).onMousemove(function(){a.move(),l.show()}).onMouseout(function(){a.hide(),l.hide()}),o.data(e).xScale(s).yScale(u).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).textObj({colorFunc:function(){return t._textLabel.color}}).fillOpacity(1),n.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(c).xTickLocations(t.xAxis.tickLocations).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),l.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(u.step()).shadowColor("#ccc").hide(),t.coreGroup.attr("transform","translate("+t.yAxis.width+",0)");var g=t.group.selectAll(".grouped-horizontal-bar-chart .axis-y-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(g).remove(),o.update(),l.update(),r.update(),n.update(),t.group.selectAll(".selectOverlay-rect").attr("x",""+(0==f.length?0:d3.max(f))),t.group.selectAll(".bands-overlay").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),t.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )")}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);i&&i.titleHeight;e.data().forEach(function(t){t.data.forEach(function(t){})});for(var _=[],d=[],f=0;f<e.activeData.length;f++)for(var p=0;p<e.activeData[f].data.length;p++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(d.push(0),_.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].data[p].value)||0==parseFloat(e.activeData[f].data[p].value)?_.push(E(e.activeData[f].data[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].data[p].value)<0&&d.push(E(e.activeData[f].data[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(d.push(0),_.push(0));var y=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(y).compute(),i.compute();var g=Math.abs(0==d.length?0:d3.max(d)-(h-i.width-(0==_.length?0:d3.max(_))))/t._tickValues.length,v=d3.max(t._tickValues.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)}),m=(t._tickShow?t._tickSize+t._tickPadding+(v<.8*g?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-m,0]),i.compute(),n.range([0==d.length?0:d3.max(d),h-i.width-(0==_.length?0:d3.max(_))]),t.compute();var x=i.width,S=c-m,k=i.width;t.translate(x,S).update(),i.translate(k,0).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t[0].data.map(function(t){return t.name}):[0,1]),i=t.length?[1.05*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=i,this._yDomain=e}}]),i}(),Cn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","negative-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var v=this,m=v._data,x=v.group;x.selectAll(".negativeHoizontalBar").remove(),x.selectAll(".negativeHoizontalBarTexts").remove();var t=x.selectAll("g").data(m);t.exit().remove(),t.enter().append("g").merge(t).each(function(t,i){var n=2*v._yScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","negativeHoizontalBar").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return v._fillOpacity}).style("stroke",function(t){return v._strokeColor||t.color}).style("stroke-width",function(t){return v._strokeWidth||0}).attr("y",function(t,e){return Math.abs(v._yScale.range()[0]-v._yScale.range()[1])-((n/m.length+(3<m.length||1==m.length?0:1))*i+n/4+v._yScale.step()*e)-(0<n/m.length?n/m.length:0)}).attr("x",function(t){return 0<t.value?v._xScale(0):t.value<0?v._xScale(t.value):void 0}).attr("height",0<n/m.length?n/m.length:0).attr("width",function(t){return 0<t.value?v._xScale(t.value)-v._xScale(0)<0?0:v._xScale(t.value)-v._xScale(0):t.value<0?v._xScale(0)-v._xScale(t.value)<0?0:v._xScale(0)-v._xScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var e=x.append("g").selectAll("g").data(m);return e.exit().remove(),e.enter().append("g").merge(e).each(function(t,i){var n=2*v._yScale.step()/3,e=d3.select(this).append("g").attr("class","negativeHoizontalBarTexts").selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",v._textObj.colorFunc).attr("font-size",v._fontSize).style("font-family",v._fontFamily).attr("text-anchor","start").attr("x",function(t){return 0<t.value?v._xScale(0):t.value<0?v._xScale(t.value):void 0}).attr("y",function(t,e){return Math.abs(v._yScale.range()[0]-v._yScale.range()[1])-((n/m.length+(3<m.length||1==m.length?0:1))*i+n/4+v._yScale.step()*e)-(0<n/m.length?n/m.length:0)}).attr("dy",(0<n/m.length?n/m.length:0)/2+v._fontSize/3).attr("dx",function(t,e){if(null==v._positionOptions||null==v._positionChoice)return 0;if(0==v._positionOptions.indexOf(v._positionChoice)){if(0<t.value)return v._xScale(t.value)-v._xScale(0)+.3*v._fontSize;if(t.value<0)return.3*-v._fontSize}else if(1==v._positionOptions.indexOf(v._positionChoice)){if(0<t.value)return.3*v._fontSize;if(t.value<0)return v._xScale(0)-v._xScale(t.value)-.3*v._fontSize}}).style("display",v._labelShow?"block":"none"),d3.selectAll(x.selectAll(".negativeHoizontalBarTexts text").nodes().filter(function(t){return t.__data__.value<0})).attr("text-anchor","end"),null!=v._labelShow&&0!=v._labelShow&&null!=v._positionOptions&&null!=v._positionChoice&&-1!=v._positionOptions.indexOf(v._positionChoice)||d3.selectAll(".negativeHoizontalBarTexts").style("display","none");for(var o=x.selectAll(".negativeHoizontalBarTexts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){rt(at(d3.select(o._groups[0][l])),at(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("opacity","0"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var p=at(d3.select(o._groups[0][h[_]])),y=at(d3.select(o._groups[0][c[f]]));if(d.push(rt(p,y)),rt(p,y)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("opacity","0")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var g=0;g<c.length;g++)d3.select(o._groups[0][c[g]]).style("opacity","1")}),v}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),Fn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","negative-horizontal-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new Cn(e.coreGroup),e.overlay=new At(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new ri(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["外部","内部"],e._positionChoice="外部",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=i,n=t.grid,a=t.tooltip,o=t.rectPlot,r=t.overlay,l=t.selectOverlay,s=t.xScale,u=t.yScale,h=t.widthOfCore,c=t.heightOfCore,_=d3.min(i,function(t){return d3.min(t.data,function(t){return+t.value})}),d=[],f=[],p=0;p<t.activeData.length;p++)for(var y=0;y<t.activeData[p].data.length;y++)null==t._labelShow||null==t._positionOptions||null==t._positionChoice||-1==t._positionOptions.indexOf(t._positionChoice)?(f.push(0),d.push(0)):1==t._labelShow&&0==t._positionOptions.indexOf(t._positionChoice)?0<parseFloat(t.activeData[p].data[y].value)||0==parseFloat(t.activeData[p].data[y].value)?d.push(E(t.activeData[p].data[y].value,t._textLabel.fontSize,t._textLabel.fontFamily)):parseFloat(t.activeData[p].data[y].value)<0&&f.push(E(t.activeData[p].data[y].value,t._textLabel.fontSize,t._textLabel.fontFamily)):(f.push(0),d.push(0));_<0?(d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+",0)"),d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+","+-u.step()/2+")")):(d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,"+-u.step()/2+")")),r.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).bandHeight(u.step()).onMouseover(function(t,e){var n=u.domain()[u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1],o=[{text:n=="&-"+(u.domain().length-e)?"":n}];n&&1!=n&&(i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),l.translate(0,u(n))),a.data(o).update(),l.translate(0,u(n)),a.show()}).onMousemove(function(){a.move(),l.show()}).onMouseout(function(){a.hide(),l.hide()}),o.data(e).xScale(s).yScale(u).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).textObj({colorFunc:function(){return t._textLabel.color}}).fillOpacity(1),n.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(c).xTickLocations(t.xAxis.tickLocations).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),l.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(u.step()).shadowColor("#ccc").hide(),t.coreGroup.attr("transform","translate("+t.yAxis.width+",0)");var g=t.group.selectAll(".negative-horizontal-bar-chart .axis-y-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(g).remove(),o.update(),l.update(),r.update(),n.update(),t.group.selectAll(".selectOverlay-rect").attr("x",""+(0==f.length?0:d3.max(f))),t.group.selectAll(".bands-overlay").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),t.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),_<0?(t.coreGroup.selectAll(".fake-y-line").remove(),this.coreGroup.append("g").attr("class","fake-y-line").append("line").attr("x1",s.range()[0]-(0==f.length?0:d3.max(f))).attr("y1",u.range()[0]).attr("x2",s.range()[0]-(0==f.length?0:d3.max(f))).attr("y2",u.range()[1]).attr("stroke","rgb(233, 233, 233)")):t.coreGroup.selectAll(".fake-y-line").remove()}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);i&&i.titleHeight;e.data().forEach(function(t){t.data.forEach(function(t){})});for(var _=[],d=[],f=0;f<e.activeData.length;f++)for(var p=0;p<e.activeData[f].data.length;p++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(d.push(0),_.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].data[p].value)||0==parseFloat(e.activeData[f].data[p].value)?_.push(E(e.activeData[f].data[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].data[p].value)<0&&d.push(E(e.activeData[f].data[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(d.push(0),_.push(0));var y=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(y).compute(),i.compute();var g=Math.abs(0==d.length?0:d3.max(d)-(h-i.width-(0==_.length?0:d3.max(_))))/t._tickValues.length,v=d3.max(t._tickValues.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)}),m=(t._tickShow?t._tickSize+t._tickPadding+(v<.8*g?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-m,0]),i.compute(),n.range([0==d.length?0:d3.max(d),h-i.width-(0==_.length?0:d3.max(_))]),t.compute();var x=i.width,S=c-m,k=i.width;t.translate(x,S).update(),i.translate(k,0).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t[0].data.map(function(t){return t.name}):[0,1]),i=t.length?[1.05*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=i,this._yDomain=e}}]),i}(),Pn="axis-group",zn="y-mix-title",An=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-mix"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return h(i,ft),s(i,[{key:"update",value:function(){var i=this,n=i._orient,t=i._scaleFunc,e=i.group,o=i._fontSize,a=i._tickValueTexts,r=void 0;r=i.axisFunc="right"===n?d3.axisRight(t):d3.axisLeft(t);var l=null;"number"===i._type&&i._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding).tickFormat(l),e.select(".axis-group").remove();var s=e.select("."+Pn).empty()?e.append("g").attr("class",Pn):e.select("."+Pn);s.transition().duration(i._transition?i._duration:0).call(r).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dx",function(t,e){return"left"==n?.6*-o:"right"==n?.6*o:void 0}).attr("dy",.4*o).text(function(t,e){return a[e]+(i._unit?i._unit:"")}),s.selectAll(".tick line").style("stroke",i._lineStroke).style("display","none"),s.select("path").style("stroke",i._lineStroke).style("display","none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var h=e.select("."+zn).empty()?e.append("g").attr("class",zn):e.select("."+zn),c=h.select("text").empty()?h.append("text"):h.select("text");E(i._title,o,i._fontFamily);h.call(B,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-5).style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(i._title),"second"==i._times&&(h.call(B,this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0,u/2),c.attr("y",-5).style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("transform","rotate(90)").style("text-anchor","middle").text(i._title))}else e.select("."+zn).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);for(var s=0;s<t.length;s++)t[s]=t[s]+(e._unit?e._unit:"");var u=d3.max(t,function(t){return E(t,r,e._fontFamily)});return t="category"===a?o.domain():o.ticks(e._tickCount),u<=l?(i=t,n=u):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"times",value:function(t){return arguments.length?(this._times=t,this):this._times}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+24:0):this._titleShow&&this._title?1.125*this._fontSize+24:0),t}}]),i}(),Ln=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","mix-line-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){for(var o=this,a=o._data,t=[],e=0;e<a.length;e++)for(var i=0;i<a[e].data.length;i++)t.push(Number(a[e].data[i].value));et(t,o._fontSize,o._fontFamily);var n=o.group;n.selectAll("g").remove();var r=n.append("g").selectAll("g").data(a,function(t){return t.name});return r.exit().remove(),r.enter().append("g").attr("class","mix-line-bar-bar-rects").merge(r).each(function(t,i){var n=2*o._xScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").merge(e).style("fill",function(t){return o._fillColor||t.color}).style("fill-opacity",function(t){return o._fillOpacity}).style("stroke",function(t){return o._strokeColor||t.color}).style("stroke-width",function(t){return o._strokeWidth||0}).attr("x",function(t,e){return(n/a.length+(3<a.length||1==a.length?0:1))*i+n/4+o._xScale.step()*e}).attr("y",function(t){return t.value<0?o._yScale(0):0<t.value?o._yScale(t.value):void 0}).attr("width",0<n/a.length?n/a.length:0).attr("height",function(t){return t.value<0?o._yScale(t.value)-o._yScale(0)<0?0:o._yScale(t.value)-o._yScale(0):0<t.value?o._yScale(0)-o._yScale(t.value)<0?0:o._yScale(0)-o._yScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),Mn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","mix-line-bar-text"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e}return h(i,M),s(i,[{key:"update",value:function(){for(var r=this,l=r._data,t=[],e=0;e<l.length;e++)for(var i=0;i<l[e].data.length;i++)t.push(Number(l[e].data[i].value));var s=et(t,r._fontSize,r._fontFamily),u=r.group;u.selectAll("g").remove(),u.append("g").selectAll("g").data(l,function(t){return t.name}).exit().remove();var n=u.append("g").selectAll("g").data(l,function(t){return t.name});return n.exit().remove(),n.enter().append("g").merge(n).each(function(t,i){var n=2*r._xScale.step()/3,e=d3.select(this).attr("class","mixLineBarTexts").selectAll("text").data(t.data);e.exit().remove();var o=e.enter().append("text").attr("class","mix-line-bar-texts").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",r._textObj.colorFunc).style("font-size",r._fontSize).style("font-family",r._fontFamily).attr("x",function(t,e){return(n/l.length+(3<l.length||1==l.length?0:1))*i+n/4+r._xScale.step()*e+(0<n/l.length?n/l.length:0)/2}).attr("text-anchor","middle").attr("y",function(t){return null==r._positionOptions||null==r._positionChoice?r._yScale(t.value):0==r._positionOptions.indexOf(r._positionChoice)?t.value<0?r._yScale(0)-.3*r._fontSize:r._yScale(t.value)-.3*r._fontSize:1==r._positionOptions.indexOf(r._positionChoice)?(r._yScale(0)+r._yScale(t.value))/2+.35*r._fontSize:2==r._positionOptions.indexOf(r._positionChoice)?0<t.value?r._yScale(0)-.3*r._fontSize:r._yScale(t.value)-.3*r._fontSize:void 0}).style("display",r._labelShow?"block":"none"),a=0<n/l.length?n/l.length:0;null==r._positionOptions||null==r._positionChoice||a<s&&2==r._positionOptions.indexOf(r._positionChoice)&&o.attr("transform",function(t,e){return 0<t.value?"rotate(-90 "+((n/l.length+(3<l.length||1==l.length?0:1))*i+n/4+r._xScale.step()*e+(0<n/l.length?n/l.length:0)/2||0)+"\n                         "+(r._yScale(t.value)+r._yScale(0)-r._yScale(t.value)-.65*r._fontSize)+" )":"rotate(-90 "+((n/l.length+(3<l.length||1==l.length?0:1))*i+n/4+r._xScale.step()*e+(0<n/l.length?n/l.length:0)/2||0)+"\n                         "+(r._yScale(t.value)-.65*r._fontSize)+" )"}).attr("text-anchor","start"),0==r._labelShow||null==r._labelShow||null==r._positionOptions||null==r._positionChoice?u.selectAll(".mixLineBarTexts").style("display","none"):u.selectAll(".mixLineBarTexts").style("display","block")}),r}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}}]),i}(),Dn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-tooltip"),e._width=0,e._height=0,e._shadowColor="#000",e}return h(i,M),s(i,[{key:"update",value:function(){var t=this._data,e=this.group,i=this._defs;i.selectAll("#bg").remove();var n=i.append("filter").attr("x","-15%").attr("y","-25%").attr("width","135%").attr("height","150%").attr("id","bg");n.append("feFlood").attr("flood-color","black"),n.append("feComposite").attr("in","SourceGraphic");var o=e.selectAll("text").attr("class","axis-tooltip-text").data(t);o.exit().remove();o.enter().append("g").append("text").merge(o).text(function(t){return t.text}).attr("filter","url(#bg)").style("fill","white").style("fill-opacity",1).style("opacity",.8).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("dy","0.4em").attr("font-size",10).style("transition","transform 0.15s").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);return this}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),i}();function Wn(t,e){var i=0,n=0;e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"vCol"===t.function&&"折线列"==t.name&&(n=t.index)});for(var o={},a=[],r=t.length,l=t[0],s=[],u=1;u<r;u++)s.push(t[u].length);s.sort(function(t,e){return e-t});for(var h=[],c=0;c<r;c++)for(var _=0;_<s[0];_++)h.push(isNaN(parseFloat(t[c][_])));if(0==h.filter(function(t,e){return 0==t}).length)return[];for(var d=1;d<s[0];d++)if(d!==i){var f=l[d];""!=f&&null!=f&&null!=f||(f="$-"+d),o[f]=d==n?{name:f,data:[],showLegend:f!="$-"+d,type:"折线列"}:{name:f,showLegend:f!="$-"+d,data:[]}}for(var p=1;p<r;p++){var y=t[p],g=y[i];if(""!=g&&null!=g&&null!=g||(g="&-"+p),g)for(var v=0;v<s[0];v++){var m=l[v];v!==i&&(""!=l[v]&&null!=l[v]&&null!=l[v]||(m="$-"+v),o[m].data.push({name:g,showAxisText:g!="&-"+p,value:v==n||""!=y[v]&&null!=y[v]&&null!=y[v]&&!isNaN(parseFloat(y[v]))?y[v]:0,tooltipValueShow:!isNaN(parseFloat(y[v]))}))}}for(var x in o)a.push(o[x]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Tn=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","mix-line-bar-chart"),e.grid=new zt(e.coreGroup),e.selectOverlay=new pi(e.coreGroup),e.rectPlot=new Ln(e.coreGroup),e.linePlot=new vi(e.coreGroup),e.scatterPlot=new kt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.textPlot=new Mn(e.coreGroup),e.stackText=new wt(e.coreGroup),e.overlay=new At(e.coreGroup),e.xAxis=new gt(e.mainGroup),e.yAxis=new An(e.mainGroup),e.yAxisDoubleY=new An(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e.yScaleRight=d3.scaleLinear(),e.axisTooltip=new Dn(e.mainGroup),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._sortValue=0,e._curve=null,e._histogramWidth=.7,e._yScaleHeight=1.05,e._bardisplay=!1,e._barpositionOptions=["外部居上","内部居中","内部居下"],e._barpositionChoice="外部居上",e._linedisplay=!1,e._linepositionOptions=["上面","下面"],e._linepositionChoice="上面",e._lineWidth=2,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(o,dt),s(o,[{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.yAxisDoubleY,o=t.xScale,a=t.yScale,r=t.yScaleRight,l=t._xType,s=t._yType,u=t._xOrient,h=t._yOrient,c=t._yOrientRight,_=t._fontSize,d=t.widthOfNoMargin,f=t.heightOfMainGroup;o.domain(t._xDomain),a.domain(t._yDomain),r.domain(t._yDomain1),e.scaleFunc(o).allowedMaxTextHeight(.3*f).type(l).orient(u).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),i.scaleFunc(a).allowedMaxTextWidth(.5*d).type(s).orient(h).title(t._yLeftName).unit(t._yLeftTitle?t._yLeftTitle:null).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),n.scaleFunc(r).allowedMaxTextWidth(.5*d).type(s).orient(c).title(t._yRightName).times("second").unit(t._yRightTitle?t._yRightTitle:null).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);i.titleHeight;var p=(f-e.allowedMaxTextHeight())/(3*_);i.tickCount(p),n.tickCount(p),i.compute(),n.compute();var y=t.activeData,g=i.width,v=n.width;0==y.filter(function(t){return"折线列"==t.type}).length&&(g=i.width,v=t._yRightName?24:0),0==y.filter(function(t){return"折线列"!=t.type}).length&&(g=t._yLeftName?24:0,v=n.width),0==y.length&&(g=t.yAxis.width,v=t.yAxisDoubleY.width),o.range([0,d-g-v]),e.compute(),a.range([f-e.height,0]),r.range([f-e.height,0]);var m=g,x=f-e.height,S=g;e.translate(m,x),i.translate(S,0);var k=d-v;n.translate(k,0),0==y.length&&(e.translate(m,x),i.translate(S,0),n.translate(k,0)),e.update(),i.update(),n.update()}},{key:"updateCore",value:function(){var l=this,s=l.activeData,t=s,e=l.grid,u=l.tooltip,i=(l.axisTooltip,l.rectPlot),n=l.textPlot,o=l.linePlot,a=l.overlay,r=l.scatterPlot,h=l.selectOverlay,c=l.guideLine,_=l.stackText,d=l.xScale,f=l.yScale,p=l.yScaleRight,y=1.2*Math.min(d3.min(s.filter(function(t){return"折线列"!=t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0);y<0?(l.group.selectAll(".mix-line-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(f.range()[0]-f(0))+")"),l.group.selectAll(".mix-line-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(f.range()[0]-f(0))+")")):(l.group.selectAll(".mix-line-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),l.group.selectAll(".mix-line-bar-chart .axis-x-line line").attr("transform","translate(0,0)"));var g=l.yAxis.width,v=l.yAxisDoubleY.width;0==s.filter(function(t){return"折线列"==t.type}).length&&(g=l.yAxis.width,v=l._yRightName?24:0),0==s.filter(function(t){return"折线列"!=t.type}).length&&(g=l._yLeftName?24:0,v=l.yAxisDoubleY.width),0==s.length&&(g=l.yAxis.width,v=l.yAxisDoubleY.width);var m=l.widthOfNoMargin-g-v,x=l.heightOfCore;e.width(m).height(x).xTickLocations(l.xAxis.tickLocations).yTickLocations(l.yAxis.tickLocations).showX(l._gridShowX).showY(l._gridShowY).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray),0==s.filter(function(t){return"折线列"!=t.type}).length&&e.width(m).height(x).xTickLocations(l.xAxis.tickLocations).yTickLocations(l.yAxisDoubleY.tickLocations).showX(l._gridShowX).showY(l._gridShowY).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray),a.data(d.domain()).isScalePoint(!1).bandWidth(d.step()).bandHeight(x).onMouseover(function(t,e){u.show(),h.show();var i=l.elem.node().parentNode,n=(d3.mouse(i),e);d3.select(l.group.selectAll(".mix-line-bar-chart .scatter-plot circle").nodes()[n]).attr("r",5),d3.selectAll(l.group.selectAll(".mix-line-bar-chart .scatter-plot circle").nodes().filter(function(t,e){return e!=n})).attr("r",3.5)}).onMousemove(function(t,e){var i=l.elem.node().parentNode,n=d3.mouse(i),o=(d3.mouse(this)[0],d3.mouse(this)[1],d.step(),e),a=t,r=[{text:a=="&-"+(o+1)?"":a}];a&&(s.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===a});r.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),h.translate(d(a),0)),u.data(r).update().move([n[0],n[1]]),d3.select(l.group.selectAll(".mix-line-bar-chart .scatter-plot circle").nodes()[o]).attr("r",5),d3.selectAll(l.group.selectAll(".mix-line-bar-chart .scatter-plot circle").nodes().filter(function(t,e){return e!=o})).attr("r",3.5)}).onMouseout(function(){u.hide(),h.hide(),d3.selectAll(l.group.selectAll(".mix-line-bar-chart .scatter-plot circle").nodes()).attr("r",3.5)}),i.data(t.filter(function(t){return"折线列"!=t.type})).xScale(d).yScale(f).fontSize(l._textLabel.fontSize).fontColor(l._textLabel.color).fontFamily(l._textLabel.fontFamily).labelShow(l._bardisplay).positionOptions(l._barpositionOptions).positionChoice(l._barpositionChoice).textObj({colorFunc:function(){return l._textLabel.color}}).fillOpacity(1),o.data(s.filter(function(t){return"折线列"==t.type})).xScale(d).yScale(p).labelShow(l._linedisplay).positionOptions(l._linepositionOptions).positionChoice(l._linepositionChoice).lineWidth(l._lineWidth).curve(l._curve).lineFunc(d3.line().x(function(t){return d(t.name)}).y(function(t){return p(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))})),r.data(s.filter(function(t){return"折线列"==t.type})).xScale(d).yScale(p).stroke("#fff").strokeWidth(1).radius(3.5),c.x1(0).x2(m).strokeDasharray(l._gridStrokeDasharray),n.data(t.filter(function(t){return"折线列"!=t.type})).xScale(d).yScale(f).fontSize(l._textLabel.fontSize).fontColor(l._textLabel.color).fontFamily(l._textLabel.fontFamily).labelShow(l._bardisplay).positionOptions(l._barpositionOptions).positionChoice(l._barpositionChoice).textObj({colorFunc:function(){return l._textLabel.color}}).fillOpacity(1),_.data(s.filter(function(t){return"折线列"==t.type})).xScale(d).yScale(p).type("mix").fontSize(l._textLabel.fontSize).fontColor(l._textLabel.color).fontFamily(l._textLabel.fontFamily).labelShow(l._linedisplay).positionOptions(l._linepositionOptions).positionChoice(l._linepositionChoice),h.width(d.step()).height(x).shadowColor("#ccc").hide(),l.coreGroup.attr("transform","translate("+g+",0)");var S=l.group.selectAll(".mix-line-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(S).remove(),i.update(),o.translate(d.step()/2,0).update(),r.translate(d.step()/2,0).update(),n.update(),_.update(),h.update(),a.update(),e.update(),y<0?(l.coreGroup.selectAll(".fake-x-line").remove(),l.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",d.range()[0]).attr("y1",f.range()[0]).attr("x2",d.range()[1]).attr("y2",f.range()[0]).attr("stroke","rgb(233, 233, 233)")):l.coreGroup.selectAll(".fake-x-line").remove();var k=l.group.selectAll(".mix-line-bar-texts").nodes(),b=l.group.selectAll(".ranking-text-group text").nodes(),w=k.concat(b),O=d3.selectAll(w);if(null==l._barpositionOptions||null==l._barpositionChoice||-1==l._barpositionOptions.indexOf(l._barpositionChoice))l.group.selectAll(".mixLineBarTexts").style("display","none");else if(0==l._barpositionOptions.indexOf(l._barpositionChoice)||1==l._barpositionOptions.indexOf(l._barpositionChoice)){for(var C=[],F=[],P=0;P<O._groups[0].length;P++){F.push(P);for(var z=P+1;z<O._groups[0].length;z++){rt(at(d3.select(O._groups[0][P])),at(d3.select(O._groups[0][z])))&&(C.push(P),d3.select(O._groups[0][P]).style("opacity","0"))}}for(var A=new Set(C),L=Array.from(A),M=ot(L,F),D=0;D<L.length;D++){for(var W=[],T=0;T<M.length;T++){var R=at(d3.select(O._groups[0][L[D]])),N=at(d3.select(O._groups[0][M[T]]));if(W.push(rt(R,N)),rt(R,N)){if(L[D]==M[T])continue;d3.select(O._groups[0][L[D]]).style("opacity","0")}}0==W.filter(function(t){return 1==t}).length&&M.push(L[D])}for(var j=0;j<M.length;j++)d3.select(O._groups[0][M[j]]).style("opacity","1")}else if(2==l._barpositionOptions.indexOf(l._barpositionChoice)){for(var Y=[],X=[],G=0;G<O._groups[0].length;G++){X.push(G);for(var B=G+1;B<O._groups[0].length;B++){var E=at(d3.select(O._groups[0][G])),H=at(d3.select(O._groups[0][B]));if(G<k.length){var V=E.width;E.width=E.height,E.height=V}if(B<k.length){var I=H.width;H.width=H.height,H.height=I}rt(E,H)&&(Y.push(G),d3.select(O._groups[0][G]).style("opacity","0"))}}for(var Z=new Set(Y),Q=Array.from(Z),q=ot(Q,X),U=0;U<Q.length;U++){for(var K=[],J=0;J<q.length;J++){var $=at(d3.select(O._groups[0][Q[U]])),tt=at(d3.select(O._groups[0][q[J]]));if(Q[U]<k.length){var et=$.width;$.width=$.height,$.height=et}if(q[J]<k.length){var it=tt.width;tt.width=tt.height,tt.height=it}if(K.push(rt($,tt)),rt($,tt)){if(Q[U]==q[J])continue;d3.select(O._groups[0][Q[U]]).style("opacity","0")}}0==K.filter(function(t){return 1==t}).length&&q.push(Q[U])}for(var nt=0;nt<q.length;nt++)d3.select(O._groups[0][q[nt]]).style("opacity","1")}function ot(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(e.color).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xDomain(i.range).yDomain(n.range).yLeftName(n.leftName).yLeftTitle(n.leftTitle).yRightName(n.rightName).yRightTitle(n.rightTitle)}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=Wn;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._bardisplay=e?e.bardisplay:this._bardisplay,this._linedisplay=e?e.linedisplay:this._linedisplay,this._barpositionChoice=e.barpositionChoice?e.barpositionChoice:this._barpositionChoice,this._linepositionChoice=e.linepositionChoice?e.linepositionChoice:this._linepositionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]),i=t.length?[1.2*Math.min(d3.min(t.filter(function(t){return"折线列"!=t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.2*Math.max(d3.max(t.filter(function(t){return"折线列"!=t.type}),function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1],n=t.length?[1.2*Math.min(d3.min(t.filter(function(t){return"折线列"==t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.2*Math.max(d3.max(t.filter(function(t){return"折线列"==t.type}),function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=e,this._yDomain=i,this._yDomain1=n}}]),o}(),Rn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","deformed-pie-chart"),e.core=e.rose=new Z(e.mainGroup),e.lineText=new N(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!0,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){for(var u=this,h=u.rose,t=u.lineText,e=u._startAngle,i=u._endAngle,n=u.widthOfNoMargin,o=u.heightOfMainGroup,c=u._fontSize,a=(u.legend.height(),[]),r=0;r<u.activeData.length;r++)a.push(u.activeData[r].name);et(a,u._fontSize,u._fontFamily);var l=.74*u.heightOfMainGroup,s=.74*u.widthOfNoMargin;null==u._labelShow||null==u._positionOptions||null==u._positionChoice||null==u._contentOption||null==u._contentChoice||0==u._contentChoice.length?(l=.88*u.heightOfMainGroup,s=.88*u.widthOfNoMargin):0!=u._labelShow&&0!=u._positionOptions.indexOf(u._positionChoice)&&1!=u._positionOptions.indexOf(u._positionChoice)&&-1!=u._positionOptions.indexOf(u._positionChoice)||(l=.88*u.heightOfMainGroup,s=.88*u.widthOfNoMargin);for(var _=s,d=l,f=A(_,d,e,i),p=f.radius,y=f.cx,g=f.cy,v=p+c,m=[],x=0;x<u.activeData.length;x++)m.push(u.activeData[x].value);for(var S=0,k=0;k<u.activeData.length;k++)S+=u.activeData[k].value;for(var b=0;b<u.activeData.length;b++)u.activeData[b].percent=(u.activeData[b].value/S*100).toFixed(1);var w=u.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});w.unshift(w[w.length-1]),w.pop(w[w.length-1]),h.data(w).radius(p).fontSize(u._textLabel.fontSize).fontFamily(u._textLabel.fontFamily).fontColor(u._textLabel.color).labelShow(u._labelShow).positionOptions(u._positionOptions).positionChoice(u._positionChoice).contentOption(u._contentOption).contentChoice(u._contentChoice).startAngle(e).endAngle(i).cornerRadius(u._cornerRadius).stroke(u._stroke).strokeWidth(u._strokeWidth).sortMethod(u._sortMethod).transition(u._transition).duration(u._duration).onTransitionEnd(function(t,e){var i=h.arcFunc.outerRadius()(t),n=d3.select(this.parentNode),o=t.startAngle,a=t.endAngle,r="arc-path-"+t.data.key+"-"+u.id,l=z(i-c,o+.015,a-.015),s=u.defs.select("#"+r).empty()?u.defs.append("path").attr("d",l).attr("id",r):u.defs.select("#"+r).attr("d",l);0==u._labelShow||null==u._labelShow||null==u._positionOptions||null==u._positionChoice||null==u._contentOption||null==u._contentChoice||1==u._positionOptions.indexOf(u._positionChoice)||2==u._positionOptions.indexOf(u._positionChoice)||0==u._contentChoice.length?u.group.selectAll(".chart-label-text").style("display","none"):0==u._positionOptions.indexOf(u._positionChoice)&&(1==u._contentChoice.length?0==u._contentOption.indexOf(u._contentChoice[0])?L(n,s,t.data.name=="$-"+e?"":t.data.name,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily):1==u._contentOption.indexOf(u._contentChoice[0])?L(n,s,t.data.percent+"%",u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily):2==u._contentOption.indexOf(u._contentChoice[0])&&L(n,s,t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily):2==u._contentChoice.length?0==u._contentOption.indexOf(u._contentChoice[0])&&1==u._contentOption.indexOf(u._contentChoice[1])||1==u._contentOption.indexOf(u._contentChoice[0])&&0==u._contentOption.indexOf(u._contentChoice[1])?L(n,s,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%",u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==u._contentOption.indexOf(u._contentChoice[0])&&2==u._contentOption.indexOf(u._contentChoice[1])||2==u._contentOption.indexOf(u._contentChoice[0])&&0==u._contentOption.indexOf(u._contentChoice[1])?L(n,s,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==u._contentOption.indexOf(u._contentChoice[0])&&2==u._contentOption.indexOf(u._contentChoice[1])||2==u._contentOption.indexOf(u._contentChoice[0])&&1==u._contentOption.indexOf(u._contentChoice[1]))&&L(n,s,t.data.percent+"%  "+t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==u._contentChoice.length&&L(n,s,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","start").attr("xml:space","preserve"))}).onMouseover(function(t,e){d3.select(this).transition().style("opacity",.8);var i=[{text:""+(t.data.name=="$-"+e?"":t.data.name),color:t.data.color},{text:t.data.valueLabel+": "+t.data.value}];u.tooltip.data(i).update().show()}).onMousemove(function(){u.tooltip.move()}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),u.tooltip.hide()});var O=(n-_)/2+y,C=(o-d)/2+g,F=(v-p)/2;switch(f.quadrant){case 4:O+=F,C+=F;break;case 1:O-=F,C+=F;break;case 2:O-=F,C-=F;break;case 3:O+=F,C-=spcae}if(null!=u._labelShow)if(0!=u._labelShow&&2==u._positionOptions.indexOf(u._positionChoice)){var P=u.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});P.unshift(P[P.length-1]),P.pop(P[P.length-1]),t.data(P).outerRadius(p).type("change").cornerRadius(u._cornerRadius).startAngle(e).endAngle(i).fontSize(u._textLabel.fontSize).fontColor(u._textLabel.color).fontFamily(u._textLabel.fontFamily).labelShow(u._labelShow).positionOptions(u._positionOptions).positionChoice(u._positionChoice).contentOption(u._contentOption).contentChoice(u._contentChoice).values(m).transition(u._transition).duration(u._duration),u.lineText.translate(O||0,C).update(),u.group.selectAll(".outside-text-polygon").attr("display","block")}else 0!=u._labelShow&&0!=u._positionOptions.indexOf(u._positionChoice)&&1!=u._positionOptions.indexOf(u._positionChoice)&&-1!=u._positionOptions.indexOf(u._positionChoice)||u.group.selectAll(".outside-text-polygon").attr("display","none");h.translate(O||0,C).update()}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._contentChoice=i.contentChoice?i.contentChoice:this._contentChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),i}(),Nn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._padAngle=.01,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=0,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,j),s(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._contentChoice=i.contentChoice?i.contentChoice:this._contentChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}}]),i}(),jn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","funnel-polygon"),e._fontColor="#ffffff",e}return h(i,M),s(i,[{key:"update",value:function(){for(var i=this,n=i._data,t=d3.max(n,function(t){return Math.abs(t.value)}),o=0<n.length?n[0].value:0,a=d3.scaleLinear().domain([0,t]).range([0,i._sWidth]),r=(0<i._sHeight?i._sHeight:0)/n.length,e=i.group,l=0;l<n.length;l++)n[l].percent=Math.ceil(n[l].value/t*100);i.group.selectAll(".funnel-groups").remove();var s=e.selectAll("polygon").data(n);s.exit().remove();var u=s.enter().append("g").attr("class","funnel-groups");u.append("polygon").merge(s).attr("class","funnel-polygons").style("fill",function(t){return t.color}).style("fill-opacity",1).style("stroke","#ffffff").style("opacity",1).style("transition","transform 0.15s").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).transition().duration(i._transition?i._duration:0).attr("points",function(t,e){return e==n.length-1?a(n[e].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth+","+r*e+"\n        "+(a(t.value)+a(n[e].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth)+","+r*e+" \n        "+(a(t.value)/2+a(n[e].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth)+","+r*(e+1):a(n[e].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth+","+r*e+"\n        "+(a(t.value)+a(n[e].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth)+","+r*e+" \n        "+(a(n[e+1].value)+a(n[e+1].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth)+","+r*(e+1)+" \n        "+(a(n[e+1].total)/2+(i._sWidth-a(o))/2+.05*i._sWidth)+","+r*(e+1)});var h=u.append("g").merge(s).attr("class","funnel-text-group");return h.append("text").text(function(t,e){return t.name=="$-"+e?"":t.name}).attr("class","funnel-texts-name").style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(n[e].total)/2+.05*i._sWidth+(i._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",i._labelShow?"block":"none"),h.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(n[e].total)/2+.05*i._sWidth+(i._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",i._labelShow?"block":"none"),h.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(n[e].total)/2+.05*i._sWidth+(i._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",i._labelShow?"block":"none"),0==i._labelShow||null==i._labelShow||null==i._contentOption||null==i._contentChoice||0==i._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==i._contentChoice.length&&i._labelShow?0==i._contentOption.indexOf(i._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==i._contentOption.indexOf(i._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block"),e.selectAll(".funnel-texts-value").style("display","none")):2==i._contentOption.indexOf(i._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block")):2==i._contentChoice.length&&i._labelShow?0==i._contentOption.indexOf(i._contentChoice[0])&&1==i._contentOption.indexOf(i._contentChoice[1])||1==i._contentOption.indexOf(i._contentChoice[0])&&0==i._contentOption.indexOf(i._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),e.selectAll(".funnel-texts-value").style("display","none"),h.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,i._fontSize,i._fontFamily)-E(t.percent,i._fontSize,i._fontFamily))/2+", 0)"})):0==i._contentOption.indexOf(i._contentChoice[0])&&2==i._contentOption.indexOf(i._contentChoice[1])||2==i._contentOption.indexOf(i._contentChoice[0])&&0==i._contentOption.indexOf(i._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),h.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,i._fontSize,i._fontFamily)-E(t.value,i._fontSize,i._fontFamily))/2+", 0)"})):(1==i._contentOption.indexOf(i._contentChoice[0])&&2==i._contentOption.indexOf(i._contentChoice[1])||2==i._contentOption.indexOf(i._contentChoice[0])&&1==i._contentOption.indexOf(i._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),h.attr("transform",function(t,e){return"translate("+(E(t.percent,i._fontSize,i._fontFamily)-E(t.value,i._fontSize,i._fontFamily))/2+", 0)"})):3==i._contentChoice.length&&i._labelShow&&(e.selectAll(".funnel-texts-name").attr("text-anchor","end").attr("dx","-1.5em"),e.selectAll(".funnel-texts-percent"),e.selectAll(".funnel-texts-value").attr("text-anchor","start").attr("dx","1.5em"),h.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,i._fontSize,i._fontFamily)-E(t.value,i._fontSize,i._fontFamily))/2+", 0)"})),i}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}}]),i}(),Yn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","funnel-chart"),e.funnel=new jn(e.mainGroup),e._sortValue=null,e._labelShow=!0,e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#FFFFFF",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,P),s(i,[{key:"updateCore",value:function(){for(var n=this,t=n.activeData,e=n.funnel,i=.69*n.widthOfNoMargin,o=.92*n.heightOfMainGroup,a=0;a<t.length;a++)t[a].percent=0==a?0:t[a-1].value-t[a].value;for(var r=0;r<t.length;r++)t[r].total=0==r?0:t[r-1].total+parseFloat(t[r].percent);e.data(t).sWidth(i).sHeight(o).labelShow(n._labelShow).contentOption(n._contentOption).contentChoice(n._contentChoice).transition(n._transition).duration(n._duration).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){d3.select(this).transition().duration(30).style("opacity",.8);var i=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];n.tooltip.data(i).update().show()}).onMousemove(function(){n.tooltip.move()}).onMouseout(function(t){d3.select(this).transition().duration(30).style("opacity",1),n.tooltip.hide()}),n.funnel.translate(.15*i,.04*o).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}}]),i}(),Xn="axis-group",Gn="y-title",Bn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e}return h(i,ft),s(i,[{key:"update",value:function(){var t=this,e=t._orient,i=t._scaleFunc,n=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(i):d3.axisLeft(i);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=n.select("."+Xn).empty()?n.append("g").attr("class",Xn):n.select("."+Xn);if(s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return a[e]}),s.selectAll(".tick line").style("stroke",t._lineStroke),s.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none")}),t._titleShow&&t._title){var u=n.select("."+Gn).empty()?n.append("g").attr("class",Gn):n.select("."+Gn),h=u.select("text").empty()?u.append("text"):u.select("text"),c=E(t._title,o,t._fontFamily);h.attr("x",c>=2*t.width?2-t.width:0).attr("y",-this._fontSize).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).style("text-anchor",c>=2*t.width?"start":"middle").text(t._title)}else n.select("."+Gn).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=o.domain()[0]&&t.push(-1==String(o.domain()[0]).indexOf(".")?o.domain()[0]:o.domain()[0].toFixed(0));var s=d3.max(t,function(t){return E(t,r,e._fontFamily)});return s<=l?(i=t,n=s):(i=t.map(function(t){return H(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),t}}]),i}(),En=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.xAxis=null,e.yAxis=null,e.yAxisDoubleY=null,e.xScale=null,e.yScale=null,e._marginLeft=24,e._marginRight=24,e._marginTop=20,e._gapPadding=15,e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._xDomain=null,e._yDomain=null,e._clipShow=null,e._xTitle="",e._yTitle="",e._axisLineStroke=null,e._xTickShow=!0,e._yTickShow=!0,e}return h(o,J),s(o,[{key:"update",value:function(){return this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),this.updateTitle(),this.updateAxis(),this.updateCore(),this.updateScale(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);var _=i.titleHeight,d=(c-e.allowedMaxTextHeight())/(3*u);i.tickCount(d),i.compute(),n.range([0,h-i.width]),e.compute(),o.range([c-_-e.height,0]);var f=i.width,p=c-e.height,y=i.width,g=_;e.translate(f,p).update(),i.translate(y,g).update()}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"updateScale",value:function(){}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yDomain||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=void 0;if(t.length){var o=d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),a=1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})});n=o<0?a<=0?[o,0]:[o,a]:[0,a]}else n=[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}},{key:"xType",value:function(t){return arguments.length?(this._xType=t,this):this._xType}},{key:"yType",value:function(t){return arguments.length?(this._yType=t,this):this._yType}},{key:"xOrient",value:function(t){return arguments.length?(this._xOrient=t,this):this._xOrient}},{key:"yOrient",value:function(t){return arguments.length?(this._yOrient=t,this):this._yOrient}},{key:"xDomain",value:function(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"yDomain",value:function(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"clipShow",value:function(t){return arguments.length?(this._clipShow=t,this):this._clipShow}},{key:"clipShowX",value:function(t){return arguments.length?(this._clipShowX=t,this):this._clipShowX}},{key:"xTitle",value:function(t){return arguments.length?(this._xTitle=t,this):this._xTitle}},{key:"yTitle",value:function(t){return arguments.length?(this._yTitle=t,this):this._yTitle}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"yLeftName",value:function(t){return arguments.length?(this._yLeftName=t,this):this._yLeftName}},{key:"yLeftTitle",value:function(t){return arguments.length?(this._yLeftTitle=t,this):this._yLeftTitle}},{key:"yRightName",value:function(t){return arguments.length?(this._yRightName=t,this):this._yRightName}},{key:"yRightTitle",value:function(t){return arguments.length?(this._yRightTitle=t,this):this._yRightTitle}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(e.color).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xDomain(i.range).yDomain(n.range).clipShow(n.range).clipShowX(i.range)}},{key:"widthOfCore",get:function(){var t=this.yAxis?this.yAxis.width:0,e=this.widthOfNoMargin-t;return 0<e?e:0}},{key:"heightOfCore",get:function(){var t=this.xAxis?this.xAxis.height:0,e=this.yAxis?this.yAxis.titleHeight:0,i=this.heightOfMainGroup-t-e;return 0<i?i:0}}]),o}(),Hn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","histogram-chart"),e.selectOverlay=new pi(e.coreGroup),e.grid=new zt(e.coreGroup),e.rectPlot=new xi(e.coreGroup),e.overlay=new At(e.coreGroup),e.xAxis=new $e(e.mainGroup),e.yAxis=new Bn(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e}return h(i,En),s(i,[{key:"updateCore",value:function(){var a=this,r=a.activeData,t=r.toString()?r[0].data:[],e=a.grid,l=a.tooltip,i=a.rectPlot,n=a.overlay,o=a.selectOverlay,s=a.xScale,u=a.yScale,h=a.widthOfCore,c=a.heightOfCore;n.data(s.domain()).bandWidth(s.step()).bandHeight(c).isScalePoint(!1).onMouseover(function(t,e){var i=s.domain()[e],n=[{text:i}];r.forEach(function(t){var e=t.data.filter(function(t){return t.name===i});n.push({text:t.name+": "+e[0].value,color:t.color})}),o.translate(s(i),0),l.data(n).update(),l.show(),o.show()}).onMousemove(function(){l.move()}).onMouseout(function(){l.hide(),o.hide()}),i.data(t).xScale(s).yScale(u).rectObj({xFunc:function(t,e){return s.step()*e+.15*s.step()},yFunc:function(t,e){return u(t.value)},widthFunc:function(t){return.7*s.step()},heightFunc:function(t){return u.range()[0]-u(t.value)}}).fillOpacity(1).onMousemove(function(t){var e=a.elem.node().parentNode,i=d3.mouse(e),n=r[0].name,o=[{text:t.name},{text:n+": "+t.value,color:t.color}];l.show(),l.data(o).update().move([i[0],i[1]]),d3.select(this).style("cursor","pointer")}).onMouseout(function(){l.hide()}),e.width(h).height(c).xTickLocations(a.xAxis.tickLocations.slice(1)).yTickLocations(a.yAxis.tickLocations.slice(1)).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray),o.width(s.step()).height(c).hide(),a.coreGroup.attr("transform","translate("+a.yAxis.width+","+a.yAxis.titleHeight+")"),i.update(),o.update(),n.update(),e.update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=Ci;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain||[]).slice().sort(d3.ascending),i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?n[1]:parseFloat(e[1])]}}]),i}(),Vn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bee-line-chart"),e._showPoints=!1,e._curve=d3.curveLinear,e._strokeWidth=2,e._labelShow=!1,e._endPointRadius=3.5,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,Tt),s(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};this.strokeWidth(l(e.lineWidth)).curve(r[e.lineType]||d3.curveLinear)}}]),i}(),In=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stacked-linear-chart"),e.elem.attr("class","stacked-linear-chart"),e.grid=new zt(e.coreGroup),e.areaPlot=new Ye(e.coreGroup),e.linePlot=new vi(e.coreGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new gi(e.coreGroup),e.stackText=new wt(e.coreGroup),e.clipArea=new Ot(e.defs),e.AnimationArea=new Ct(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._endPointRadius=2,e._radius=3.5,e._curve=d3.curveLinear,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){for(var t=this,i=t.activeData,e=t.grid,n=t.areaPlot,o=t.linePlot,a=(t.StackedScatterPlot,t.stackText),r=t.tooltip,l=t.overlay,s=t.guideLine,u=t.guideScatter,h=t.clipArea,c=(t.AnimationArea,t.xScale),_=t.yScale,d=t.widthOfCore,f=t.heightOfCore,p=0;p<i.length;p++)for(var y=0;y<i[p].data.length;y++)i[p].data[y].value=parseFloat(i[p].data[y].value),i[p].data[y].total=0==p?isNaN(parseFloat(i[p].data[y].value))?0:parseFloat(i[p].data[y].value):i[p-1].data[y].total+(isNaN(parseFloat(i[p].data[y].value))?0:parseFloat(i[p].data[y].value));Math.min(d3.min(i,function(t){return d3.min(t.data,function(t){return+t.total})}),0);e.width(d).height(f).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),n.data(i).xScale(c).yScale(_).fillOpacity(.7).curve(t._curve).areaFunc(d3.area().x(function(t){return c(t.name)}).y0(function(t){return _(t.total-t.value)}).y1(function(t){return _(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),o.data(i).xScale(c).yScale(_).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).mainGroup(t.mainGroup).curve(t._curve).lineFunc(d3.line().x(function(t){return c(t.name)}).y(function(t){return _(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),u.data(i).xScale(c).yScale(_).radius(3.5).stroke("#fff").strokeWidth(2),s.y1(0).y2(f).stroke("#c6c6c6").strokeDasharray("0 0"),l.data(c.domain()).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),r.data(o).update(),s.x(c(n)).update(),u.data(a).update(),r.show(),s.show(),u.show()}).onMousemove(function(){r.move()}).onMouseout(function(){r.hide(),s.hide(),u.hide()}),a.data(i).xScale(c).yScale(_).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice),t.coreGroup.call(B,t.yAxis.width+.5,0),0!=t._clipShow.length?h.width(d).height(f).paddingVertical([0,0]).transition(t._transition).duration(t._duration):h.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+h.id+")"),h.update(),u.elem.style("pointer-events","none");var g=t.group.selectAll(".stacked-linear-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(g).remove(),e.update(),l.update(),n.update(),o.update(),a.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=Lt;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var i=0;i<t[e].data.length;i++)t[e].data[i].value=parseFloat(t[e].data[i].value),t[e].data[i].total=0==e?isNaN(parseFloat(t[e].data[i].value))?0:parseFloat(t[e].data[i].value):t[e-1].data[i].total+(isNaN(parseFloat(t[e].data[i].value))?0:parseFloat(t[e].data[i].value));var n=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})})]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(n[0]))?a[0]:parseFloat(n[0]),isNaN(parseFloat(n[1]))?isNaN(parseFloat(n[0]))?a[1]:a[1]<n[0]?1.5*n[0]:a[1]:parseFloat(n[1])]}}]),i}(),Zn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","smooth-line-chart"),e._showPoints=!1,e._curve=d3.curveCardinal,e._strokeWidth=2,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,Tt),s(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};this.strokeWidth(l(e.lineWidth)).curve(r[e.lineType]||d3.curveLinear)}}]),i}(),Qn="axis-group",qn="x-title",Un=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,gt),s(e,[{key:"update",value:function(){var i=this,n=i._orient,t=i._scaleFunc,e=i.group,o=i._fontSize,a=i._tickTextRotate,r=i._tickValueTexts,l=void 0;if("top"===n){(l=i.axisFunc=d3.axisTop(t)).tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding).tickFormat(i._tickFormat);var s=e.select("."+Qn).empty()?e.append("g").attr("class",Qn):e.select("."+Qn);s.style("font-size",o+"px").style("font-family",i._fontFamily).transition().duration(i._transition?i._duration:0).call(l).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",i._fontColor).attr("dx",0).attr("dy","-1em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t){return t+"%"}).filter(function(){return a}).attr("dx","-0.5em").attr("dy","-0.3em").style("text-anchor","end").attr("transform","rotate("+i._tickTextRotate+")").filter(function(){return"top"!==n}),s.selectAll(".tick line").style("stroke",i._lineStroke),s.select("path").style("stroke",i._lineStroke).style("display",i._axisLineShow?"block":"none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var h=e.select("."+qn).empty()?e.append("g").attr("class",qn):e.select("."+qn),c=h.select("text").empty()?h.append("text"):h.select("text"),_=r.map(function(t){return t+"%"}),d=u/_.length,f=d3.max(_,function(t){return E(t,o,i._fontFamily)});h.call(B,u/2+Math.abs(t.range()[0]),-(this._tickShow?this._tickSize+this._tickPadding+(f<.8*d?this._tickTextHeight:1.2*this._tickTextHeight):0)),c.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dy",-6).text(i._title)}else e.select("."+qn).remove()}else{(l=i.axisFunc=d3.axisBottom(t)).tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding);var p=e.select("."+Qn).empty()?e.append("g").attr("class",Qn):e.select("."+Qn);p.style("font-size",o+"px").style("font-family",i._fontFamily).transition().duration(i._transition?i._duration:0).call(l).on("start",function(t,e){p.selectAll(".tick text").remove(),p.selectAll(".tick").append("text").style("fill",i._fontColor).attr("dx",0).attr("dy",parseFloat(o)+6).attr("transform","rotate(0)").style("text-anchor","middle").text(function(t){return t+"%"}).filter(function(){return a}).attr("dx","-0.6em").attr("dy","0.5em").style("text-anchor","end").attr("transform","rotate("+i._tickTextRotate+")").filter(function(){return"bottom"!==n}),p.selectAll(".tick line").style("stroke",i._lineStroke),p.select("path").style("stroke",i._lineStroke).style("display",i._axisLineShow?"block":"none")});var y=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)}),g=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)});d3.selectAll(y).remove(),d3.selectAll(g).remove();var v=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var m=e.select("."+qn).empty()?e.append("g").attr("class",qn):e.select("."+qn),x=m.select("text").empty()?m.append("text"):m.select("text"),S=r.map(function(t){return t+"%"}),k=v/S.length,b=d3.max(S,function(t){return E(t,o,i._fontFamily)});m.call(B,v/2+Math.abs(t.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(b<.8*k?this._tickTextHeight:1.2*this._tickTextHeight):0),x.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dy",1.125*o/2+6).text(i._title)}else e.select("."+qn).remove()}}},{key:"compute",value:function(){var i=this,n=[],o=[],a=0,r=0;function l(){i._tickTextRotate=a,i._tickValues=n,i._tickValueTexts=o,i._tickTextHeight=r}var t=i._scaleFunc,e=i._type,s=i._fontSize,u=(i._minTickDistance,i._allowedMaxTextHeight),h=Math.abs(t.range()[0]-t.range()[1]),c=void 0,_=void 0;if(n="category"===e?t.domain():t.ticks(),function(){var t=!1;c=h/n.length;var e=n.map(function(t){return t+="%"});(_=d3.max(e,function(t){return E(t,s,i._fontFamily)}))<.8*c&&(a=0,o=n,r=1.125*s,l(),t=!0);return t}())return i;a="top"===i._orient?45:-45;var d=Math.abs(Math.sin(Math.PI/4));_*d<u?(r=_*d,o=n):(r=u,o=n.map(function(t){return H(t,r/d,s,i._fontFamily)}));Math.abs(Math.cos(Math.PI/4));var f=h/n.length;if("category"!=e&&f<2*s){var p=Math.ceil(2*s/f);n=n.filter(function(t,e){return e%p==0})}return l(),i}},{key:"height",get:function(){var e=this,t=this._scaleFunc,i=Math.abs(t.range()[0]-t.range()[1]),n=this._tickValueTexts.map(function(t){return t+"%"}),o=i/n.length,a=d3.max(n.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}),r=0;return this.isShow&&(r=(this._tickShow?(a?this._tickSize+this._tickPadding:0)+(a<.8*o?this._tickTextHeight:1.2*this._tickTextHeight):0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),r}}]),e}(),Kn=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rect-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,e=this,t=e._data,n=e.group;n.selectAll(".symmetric-rect").remove();var o=n.selectAll("rect").data(t,function(t){return t.key});o.exit().remove();var a=o.enter().append("g").attr("class","symmetric-rect").append("rect").merge(o).style("fill",function(t){return e._fillColor||t.color}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return e._strokeColor||t.color}).style("stroke-width",function(t){return e._strokeWidth||0});if(this._rectObj?(a.attr("x",e._rectObj.xFunc),a.attr("y",this._rectObj.yFunc),a.attr("width",this._rectObj.widthFunc),a.attr("height",this._rectObj.heightFunc)):a.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){n.selectAll(".symmetric-texts").remove();var r=n.append("g").attr("class","symmetric-texts").selectAll("text").data(t,function(t){return t.key});r.exit().remove();r.enter().append("g").append("text").merge(r).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).attr("text-anchor","middle").style("display",function(t,e){return i._textObj.labelShow&&t.textShow?"block":"none"})}return a.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}();function Jn(t,e){var i=0,n=[];if(e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"vCol"===t.function&&0!=t.configurable&&n.push(t.index-1)}),W(t,[i],2))return[];var o=T(t,e),a=o[0],r=o.slice(1),l=a.slice(1),s=[],u=[],h=[],c=r.map(function(t){return t.slice(1)});return l.forEach(function(t,e){s.push({name:t,data:[]})}),r.forEach(function(t){var e=0;t.slice(1).forEach(function(t){e+=""==t||isNaN(parseFloat(t))||null==t||null==t?0:parseFloat(t)}),u.push(e)}),c.forEach(function(t,e){h.push(t.map(function(t){return 0==u[e]?0:(t/u[e]*100).toFixed(2)}))}),r.forEach(function(i,n){s.forEach(function(t,e){t.data.push({name:""==i[0]?"&-"+n:i[0],type:t.name,value:""==i[e+1]||isNaN(parseFloat(i[e+1]))||null==i[e+1]||null==i[e+1]?0:parseFloat(i[e+1]),total:u[n],rate:h[n][e]+"%"})})}),s.forEach(function(t,e){t.key=D(t.name)+"-"+e}),s}var $n=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","symmetric-chart"),e.grid=new zt(e.coreGroup),e.rectPlot=new Kn(e.coreGroup),e.xAxis=new Un(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="top",e._yOrient="left",e._sortValue=null,e._curve=d3.curveCardinal,e._histogramWidth=.5,e._yScaleHeight=1.05,e._shapeType="rect",e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"update",value:function(){return this._marginLeft=this._yTitle?0:24,this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),"top"==this._xOrient?(this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"top"==this._legendY?8:15:this._gapPadding=0,this._marginTop=this._xTitle&&0==this._legendShow?8:20,this._marginTop=this._xTitle&&0==this.legend.height()?8:20):(this._marginTop=20,this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"bottom"==this._legendY?8:15:this._gapPadding=0),this.updateTitle(),this.updateAxis(),this.updateCore(),this.updateScale(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateCore",value:function(){for(var a=this,t=a.activeData,e=a.grid,r=a.tooltip,i=a.rectPlot,o=a.xScale,n=a.yScale,l=a.widthOfCore,s=a.heightOfCore,u=0;u<t.length;u++)for(var h=0;h<t[u].data.length;h++){var c=Math.abs(o.domain()[0])+Math.abs(o.domain()[1]);t[u].data[h].rate.replace(/\%$/,"")/c*o.range()[1]<E(t[u].data[h].value,a._fontSize,a._fontFamily)?t[u].data[h].textShow=!1:t[u].data[h].textShow=!0}i.data(a.drawData).xScale(o).yScale(n).rectObj({xFunc:function(t,e){return o(t.x)},yFunc:function(t,e){return"top"==a._xOrient?n(t.name)+n.step()*(1-a._histogramWidth)/2+a.xAxis.height:n(t.name)+n.step()*(1-a._histogramWidth)/2},widthFunc:function(t){var e=Math.abs(o.domain()[0])+Math.abs(o.domain()[1]);return t.rate.replace(/\%$/,"")/e*o.range()[1]},heightFunc:function(t){return n.step()*a._histogramWidth}}).textObj({xFunc:function(t,e){var i=Math.abs(o.domain()[0])+Math.abs(o.domain()[1]),n=t.rate.replace(/\%$/,"")/i*o.range()[1];return o(t.x)+n/2},yFunc:function(t,e){return"top"==a._xOrient?n(t.name)+n.step()*(1-a._histogramWidth)/2+a.xAxis.height:n(t.name)+n.step()*(1-a._histogramWidth)/2},dxFunc:0,dyFunc:function(t){return n.step()*a._histogramWidth/2+a._textLabel.fontSize/2},colorFunc:function(){return a._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:a._textLabel.fontSize,fontFamily:a._textLabel.fontFamily,labelShow:a._labelShow}).fillOpacity(1).onMousemove(function(t,e){var i=a.elem.node().parentNode,n=d3.mouse(i),o=[{text:"&-"==t.name.slice(0,2)?"":t.name},{text:t.type,color:t.color},{text:"数值:"+t.value},{text:"比例:"+t.rate}];r.show(),r.data(o).update().move([n[0],n[1]]),d3.select(this).style("cursor","pointer")}).onMouseout(function(){r.hide()}),e.width(l).height(s).xTickLocations(a.xAxis.tickLocations.slice()).yTickLocations(a.yAxis.tickLocations.slice()).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray),a.coreGroup.attr("transform","translate("+a.yAxis.width+",0)");var _=a.group.selectAll(".symmetric-chart .axis-y-line .tick text").nodes().filter(function(t,e){return"&-"==t.__data__.slice(0,2)});d3.selectAll(_).remove(),i.update(),"top"==a._xOrient?e.translate(0,a.xAxis.height).update():e.update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var i=new Si(t,e);this.rawData=t.dataSrc.data[0];var n=Jn;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData||[];this.drawData=function(t,e,i){for(var n=[],o=[],a=[],r=i.slice(1).map(function(t){return t.slice(1)}),l=[],s=[],u=[],h=[],c=0<t.length?t[0].data.length:0,_=[],d=0;d<c;d++){for(var f=[],p=0;p<t.length;p++)f.push(t[p].data[d].value);_.push(f)}var y=Math.floor(e.length/2);if(t.forEach(function(t){o.push(t.key.split("-")[1])}),r.forEach(function(e){var i=[];o.forEach(function(t){i.push(e[t])})}),_.forEach(function(t){var e=0;t.forEach(function(t){e+=""==t||isNaN(parseFloat(t))||null==t||null==t?0:parseFloat(t)}),l.push(e)}),_.forEach(function(t,e){a.push(t.map(function(t){return 0==l[e]?0:(t/l[e]*100).toFixed(2)}))}),-1!=o.indexOf(y.toString())&&e.length%2!=0&&1!=e.length){var g=o.indexOf(y.toString());a.forEach(function(t,e){var i=-t[g]/2,n=t[g]/2;s.push([]),s[e][g]=-(t[g]/2).toFixed(2);for(var o=g-1;0<=o;o--)s[e][o]=parseFloat((-t[o]+s[e][o+1]).toFixed(2)),i+=-t[o];for(var a=g+1;a<t.length;a++)s[e][a]=parseFloat((s[e][a-1]+ +t[a-1]).toFixed(2)),n+=+t[a];u.push(i),h.push(n)})}else{for(var v=-1,m=0;m<o.length;m++){if(+o[m]>=y){v=m;break}if(m==o.length-1){v=m+1;break}}a.forEach(function(t,e){var i=0,n=+t[v]||0;s.push([]),s[e][v]=0;for(var o=v-1;0<=o;o--)s[e][o]=parseFloat((-t[o]+s[e][o+1]).toFixed(2)),i+=-t[o];for(var a=v+1;a<t.length;a++)s[e][a]=parseFloat((s[e][a-1]+ +t[a-1]).toFixed(2)),n+=+t[a];u.push(i),h.push(n)})}return t.forEach(function(t,i){t.data.forEach(function(t,e){t.x=s[e][i],t.rate=a[e][i]+"%"})}),t.forEach(function(t){t.range=[Math.min.apply(null,u),Math.max.apply(null,h)],t.data.forEach(function(t){n.push(t)})}),n}(t,this.data(),this.rawData)||[];var e=[],i=[];t[0]&&(t[0].data.forEach(function(t){i.push(t.name)}),e=[t[0].range[0]-5,t[0].range[1]+5]),this._xDomain=""==e?[-100,100]:e,this._yDomain=""==i?[0,1]:i.reverse()}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),o.domain(t._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);i&&i.titleHeight;var _=t._tickCount?t._tickCount:(h-i.allowedMaxTextWidth())/(2*u);if(e.tickCount(_).compute(),i.compute(),n.range([0,h-i.width]),e.compute(),o.range([c-e.height,0]),i.compute(),"top"==l){var d=i.width,f=e.height,p=i.width,y=e.height;e.translate(d,f).update(),i.translate(p,y).update(),this.coreGroup.selectAll("line").remove(),this.coreGroup.append("line").attr("x1",n(0)).attr("y1",e.height).attr("x2",n(0)).attr("y2",o.range()[0]+e.height).attr("stroke","#000000")}else{var g=i.width,v=c-e.height,m=i.width;e.translate(g,v).update(),i.translate(m,0).update(),this.coreGroup.selectAll("line").remove(),this.coreGroup.append("line").attr("x1",n(0)).attr("y1",0).attr("x2",n(0)).attr("y2",o.range()[0]).attr("stroke","#000000")}}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return""!=t.name});t.legend.data(n).shapeType("rect").onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}}]),i}();var to=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-line-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return h(i,M),s(i,[{key:"update",value:function(){var i=this,t=i._data,e=i.group,n=i._xScale,o=i._yScale;e.selectAll("filter").remove();var a=i._defs.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow").attr("filterUnits","objectBoundingBox");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1).attr("result","blurredAlpha"),a.append("feOffset").attr("in","blurredAlpha").attr("dx",0).attr("dy",0).attr("result","offsetBlurredAlpha"),a.append("feFlood").attr("result","flooded").style("flood-color","#000000").style("flood-opacity","1"),a.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),a.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var r=e.selectAll("g").data(t,function(t){return t.name});r.exit().remove(),r.enter().append("g").attr("class","simple-text-group").merge(r).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").attr("x",function(t){return n(t.name)+("mix"==i._type?n.bandwidth()/2:0)||0}).attr("y",function(t){return o(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t){return n(t.name)+("mix"==i._type?n.bandwidth()/2:0)||0}).attr("y",function(t){return o(t.value)||0}).attr("text-anchor","middle").style("display",i._labelShow?"block":"none")}),null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?e.selectAll(".simple-text-group text").style("display","none"):0==i._positionOptions.indexOf(i._positionChoice)?e.selectAll(".simple-text-group text").attr("dy",.4*-i._fontSize):1==i._positionOptions.indexOf(i._positionChoice)&&e.selectAll(".simple-text-group text").attr("dy",1.3*i._fontSize);for(var l=e.selectAll(".simple-text-group text"),s=[],u=[],h=0;h<l._groups[0].length;h++){u.push(h);for(var c=h+1;c<l._groups[0].length;c++){rt(at(d3.select(l._groups[0][h])),at(d3.select(l._groups[0][c])))&&(s.push(h),d3.select(l._groups[0][h]).style("opacity","0"))}}for(var _=new Set(s),d=Array.from(_),f=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(d,u),p=0;p<d.length;p++){for(var y=[],g=0;g<f.length;g++){var v=at(d3.select(l._groups[0][d[p]])),m=at(d3.select(l._groups[0][f[g]]));if(y.push(rt(v,m)),rt(v,m)){if(d[p]==f[g])continue;d3.select(l._groups[0][d[p]]).style("opacity","0")}}0==y.filter(function(t){return 1==t}).length&&f.push(d[p])}for(var x=0;x<f.length;x++)d3.select(l._groups[0][f[x]]).style("opacity","1");return i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),i}(),eo=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-line-chart"),e.grid=new zt(e.coreGroup),e.linePlot=new Dt(e.coreGroup),e.scatterPlot=new Wt(e.coreGroup),e.clipArea=new Ot(e.defs),e.xAxis=new gt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.overlay=new At(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new Wt(e.coreGroup),e.SimpleLineText=new to(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._showPoints=!0,e._curve=d3.curveLinear,e._lineWidth=2,e._strokeWidth=1,e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var t=this,i=t.activeData,e=t.grid,n=t.linePlot,o=t.scatterPlot,a=t.clipArea,r=t.tooltip,l=t.overlay,s=t.guideLine,u=t.guideScatter,h=t.SimpleLineText,c=t.xScale,_=t.yScale,d=t.widthOfCore,f=t.heightOfCore;Math.min(d3.min(i,function(t){return d3.min(t.data,function(t){return+t.value})}),0);e.width(d).height(f).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),n.data(i).xScale(c).yScale(_).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).curve(t._curve).strokeWidth(t._lineWidth),o.data(i).xScale(c).yScale(_).radius(t._endPointRadius).stroke("#fff").strokeWidth(t._strokeWidth),s.y1(0).y2(f).strokeDasharray(t._gridStrokeDasharray),u.xScale(c).yScale(_).fill("#fff"),l.data(c.domain()).isScalePoint(!1).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];i.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),r.data(o).update().show(),s.x(c(n)+c.bandwidth()/2).update().show(),u.data(a).update().show()}).onMousemove(function(){r.move()}).onMouseout(function(){r.hide(),s.hide(),u.hide()}),h.data(i).xScale(c).yScale(_).type("mix").defs(t.defs).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice),t.coreGroup.call(B,t.yAxis.width+.5,0),0!=t._clipShow.length?a.width(d).height(f).paddingVertical([0,0]).transition(t._transition).duration(t._duration):a.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+a.id+")"),a.update(),u.elem.style("pointer-events","none");var p=t.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),l.update(),e.update(),n.update(),o.update().show(),h.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new F(t,e),n=wi;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._strokeWidth=l(e.lineWidth?e.lineWidth:this._strokeWidth),this._curve=r[e.lineType]||this._curve)}}]),i}(),io="axis-group",no="x-title",oo=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._hmsShow=null,e}return h(i,gt),s(i,[{key:"update",value:function(){var i=this,t=i._orient,e=i._scaleFunc,n=i.group,o=i._fontSize,a=i._tickTextRotate,r=i._tickValueTexts,l=void 0;(l=i.axisFunc="top"===t?d3.axisTop(e):d3.axisBottom(e)).tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding).tickFormat(i._tickFormat);var s=n.select("."+io).empty()?n.append("g").attr("class",io):n.select("."+io);s.style("font-size",o+"px").style("font-family",i._fontFamily).transition().duration(i._transition?i._duration:0).call(l).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",i._fontColor).attr("dx",0).attr("dy","1.5em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t){var e=new Date(t);return i._hmsShow?e.toLocaleDateString()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e.toLocaleDateString()}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+i._tickTextRotate+")").filter(function(){return"top"!==t}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",i._lineStroke),s.select("path").style("stroke",i._lineStroke).style("display",i._axisLineShow?"block":"none")});var u=Math.abs(e.range()[0]-e.range()[1]);if(i._titleShow&&i._title){var h=n.select("."+no).empty()?n.append("g").attr("class",no):n.select("."+no),c=h.select("text").empty()?h.append("text"):h.select("text"),_=u/r.length,d=d3.max(r,function(t){return E(t,o,i._fontFamily)});h.call(B,u/2+Math.abs(e.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(d<.8*_?this._tickTextHeight:1.2*this._tickTextHeight):0),c.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dy",1.125*o/2+6).text(i._title)}else n.select("."+no).remove()}},{key:"compute",value:function(){var o=this,d=[],a=[],r=0,l=0,t=!1;function s(){o._tickTextRotate=r,o._tickValues=d,o._tickValueTexts=a,o._tickTextHeight=l,o._rotateFlag=t}var f=o._scaleFunc,e=o._type,u=o._fontSize,i=(o._minTickDistance,o._allowedMaxTextHeight),h=Math.abs(f.range()[0]-f.range()[1]),c=void 0,_=void 0;if(function(){if(""==f.domain())return;for(var t=[1,2,6,12,24,48,168],e=new Date(f.domain()[0]),i=new Date(f.domain()[1]),n=parseInt(i.getTime()-e.getTime()),o=!1,a=0,r=0;r<t.length;r++)if(n/(36e5*t[r])<=12){o=!0,a=36e5*t[r];break}if(o)for(var l=0;!(f.domain()[0]+a*l>=f.domain()[1]);l++)d.push(f.domain()[0]+a*l);else{var s=e.toLocaleDateString().split("/"),u=i.toLocaleDateString().split("/");if(3<=u[0]-s[0]){a=Math.ceil((u[0]-s[0])/12);for(var h=0;!(+new Date(e).setFullYear(parseInt(s[0])+h*a)>=f.domain()[1]);h++)d.push(+new Date(e).setFullYear(parseInt(s[0])+h*a))}else if(n<=31536e6)for(var c=0;!(+new Date(e).setMonth(parseInt(s[1])-1+c)>=f.domain()[1]);c++)d.push(+new Date(e).setMonth(parseInt(s[1])-1+c));else for(var _=0;!(+new Date(e).setMonth(parseInt(s[1])-1+3*_)>=f.domain()[1]);_++)d.push(+new Date(e).setMonth(parseInt(s[1])-1+3*_))}}(),function(){var t=!1;c=h/d.length;for(var e=[],i=0;i<d.length;i++){var n=new Date(d[i]);o._hmsShow?e.push(n.toLocaleDateString()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()):e.push(n.toLocaleDateString())}(_=d3.max(e,function(t){return E(t,u,o._fontFamily)}))<c&&(r=0,a=d,l=1.125*u,s(),t=!0);return t}())return o;r="top"===o._orient?45:-45;var n=Math.abs(Math.sin(Math.PI/4));_*n<i?(l=_*n,a=d,t=!1):(l=i,a=d.map(function(t){return H(t,l/n,u,o._fontFamily)}),t=!0);Math.abs(Math.cos(Math.PI/4));var p=h/d.length;if("category"===e&&p<2*u){var y=Math.ceil(2*u/p);d=d.filter(function(t,e){return e%y==0})}return s(),o}},{key:"hmsShow",value:function(t){return arguments.length?(this._hmsShow=t,this):this._hmsShow}}]),i}();function ao(t,e){var i=0,n=1,o=2,a=3;if(e.forEach(function(t){"任务"===t.name?i=t.index:"起始时间"===t.name?n=t.index:"结束时间"===t.name?o=t.index:"说明"===t.name&&(a=t.index)}),W(t,[i,n,o]))return[];var r={},l=[],s=t.slice(1).map(function(t){return t[i]}),u=t.slice(1);for(var h in u.forEach(function(t,e){l.push({name:""==s[e]||null==s[e]||null==s[e]?"&-"+e:s[e],data:[{name:""==s[e]||null==s[e]||null==s[e]?"&-"+e:s[e],showLegend:""!=s[e]&&null!=s[e]&&null!=s[e],timeStart:t[n],timeEnd:t[o],tip:t[a]}]})}),r)l.push(r[h]);return l.forEach(function(t,e){t.key=t.name+"-"+e}),l}var ro=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","gantt-chart"),e.grid=new zt(e.coreGroup),e.rectPlot=new xi(e.coreGroup),e.xAxis=new oo(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e._rectHeight=.5,e._unitShow=!0,e._unitWord="单位：ml",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!0,e._sourceWord="数据来源：镝次元",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e}return h(i,dt),s(i,[{key:"updateCore",value:function(){var e,a=this,t=a.activeData,i=(e=[],t.forEach(function(t){e.push(t.data[0])}),e),n=a.grid,r=a.tooltip,o=a.rectPlot,l=a.xScale,s=a.yScale,u=a.widthOfCore,h=a.heightOfCore;o.data(i).xScale(l).yScale(s).rectObj({xFunc:function(t){return l(+new Date(t.timeStart))},yFunc:function(t){return s(t.name)+s.step()*(1-a._rectHeight)/2},widthFunc:function(t){return l(+new Date(t.timeEnd))-l(+new Date(t.timeStart))},heightFunc:function(){return s.step()*a._rectHeight}}).fillOpacity(1).onMousemove(function(t,e){var i=a.elem.node().parentNode,n=d3.mouse(i),o=[{text:t.name=="&-"+e?"":t.name,color:t.color},{text:t.name=="&-"+e?"":t.name},{text:"起始时间: "+t.timeStart},{text:"终止时间: "+t.timeEnd}];r.show(),r.data(o).update().move([n[0],n[1]]),d3.select(this).style("cursor","pointer")}).onMouseout(function(){r.hide()}),n.width(u).height(h).xTickLocations(a.xAxis.tickLocations.slice(0)).yTickLocations(a.yAxis.tickLocations.slice(0)).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray),a.coreGroup.attr("transform","translate("+a.yAxis.width+",0)"),o.update(),n.update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),o.domain(t._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke("transparent").fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);i&&i.titleHeight;i.compute(),n.range([0,h-i.width]),e.compute(),o.range([c-e.height,0]),i.compute();var _=i.width,d=c-e.height,f=i.width;e.translate(_,d).update(),i.translate(f,0).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new Si(t,e),n=ao;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.data(),e=this.activeData,i=e.length?e.map(function(t){return t.name}):[0,1],n=!1,o=[],a=[];t.forEach(function(t){n||(1<t.data[0].timeStart.split(" ").length&&(n=!0),1<t.data[0].timeEnd.split(" ").length&&(n=!0))}),e.forEach(function(t){o.push(+new Date(t.data[0].timeStart)),o.push(+new Date(t.data[0].timeEnd))}),""!=o&&(a=[Math.min.apply(null,o),Math.max.apply(null,o)]),this._xDomain=a,this._yDomain=i,this.xAxis.hmsShow(n)}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n.text?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?n.color:this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}}]),i}(),lo=new Date;lo.toLocaleDateString(),console.log("【d3Chart】 update"+lo),t.RoundCornerDonutChart=j,t.RoundCornerPieChart=G,t.WaveCircleChart=I,t.IconBarChart=st,t.RoseChart=$,t.QuarterRoseChart=it,t.RadialBarChart=ct,t.RadialLineChart=_t,t.OverlapAreaChart=Mt,t.StepLineChart=Rt,t.SankeyChart=ae,t.SimpleSankeyChart=re,t.VerticalSankeyChart=se,t.ChordChart=_e,t.IconPieChart=fe,t.TwoLevelDonutChart=me,t.OneLevelTreemapChart=be,t.TwoLevelTreemapChart=Oe,t.SunburstChart=Ae,t.TreeChart=We,t.WeightedTreeChart=Re,t.StreamgraphChart=Ge,t.RadarChart=Ee,t.PyramidChart=Ie,t.MultipleBarChart=ti,t.GroupingBubbleChart=li,t.CalendarHeatmapChart=di,t.HollowChart=yi,t.StackedChart=mi,t.FormWaterfallHistogramChart=Pi,t.ChangeWaterfallHistogramChart=Oi,t.SimpleBarChart=Ai,t.SmoothLineChart=Zn,t.SymmetricChart=$n,t.PieChart=Y,t.HistogramChart=Hn,t.ProgressRoundPieChart=Di,t.HalfProgressPieChart=Wi,t.HalfPieChart=Ti,t.SlopeChart=Hi,t.BarProgressChart=Ii,t.PolygonRadarChart=Ji,t.RankingChangeChart=nn,t.PercentageBarChart=sn,t.PercentageAreaChart=_n,t.ArcDiagramChart=yn,t.BasicHorizontalBarChart=gn,t.StackBarChart=mn,t.StackHorizontalBarChart=Sn,t.GroupedBarChart=bn,t.GroupedHorizontalBarChart=On,t.NegativeHorizontalBarChart=Fn,t.MixLineBarChart=Tn,t.MultipleLineChart=Tt,t.DeformedPieChart=Rn,t.DonutChart=Nn,t.FunnelChart=Yn,t.BeeLineChart=Vn,t.StackedLinearChart=In,t.setUserMd=function(t){window.userId=t},t.SimpleLineChart=eo,t.GanttChart=ro,Object.defineProperty(t,"__esModule",{value:!0})});
